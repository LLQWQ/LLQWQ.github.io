<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JUC | LLQWQçš„åšå®¢</title><meta name="keywords" content="java,JUC,é«˜å¹¶å‘ç¼–ç¨‹"><meta name="author" content="LLQWQ"><meta name="copyright" content="LLQWQ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Java ç§ƒå¤´ç³»åˆ—ä¹‹ JUC">
<meta property="og:type" content="article">
<meta property="og:title" content="JUC">
<meta property="og:url" content="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/index.html">
<meta property="og:site_name" content="LLQWQçš„åšå®¢">
<meta property="og:description" content="Java ç§ƒå¤´ç³»åˆ—ä¹‹ JUC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://llqwq.gitee.io/img/Java-JUC-cover.jpg">
<meta property="article:published_time" content="2021-04-12T05:58:52.000Z">
<meta property="article:modified_time" content="2021-04-13T13:32:03.423Z">
<meta property="article:author" content="LLQWQ">
<meta property="article:tag" content="java">
<meta property="article:tag" content="JUC">
<meta property="article:tag" content="é«˜å¹¶å‘ç¼–ç¨‹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://llqwq.gitee.io/img/Java-JUC-cover.jpg"><link rel="shortcut icon" href="/img/48668845.jpg"><link rel="canonical" href="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/LLQWQ" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-13 21:32:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/48668845.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">14</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">30</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/Java-JUC.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">LLQWQçš„åšå®¢</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JUC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-04-12T05:58:52.000Z" title="å‘è¡¨äº 2021-04-12 13:58:52">2021-04-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-04-13T13:32:03.423Z" title="æ›´æ–°äº 2021-04-13 21:32:03">2021-04-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/JUC/">JUC</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/%E9%AB%98%E5%B9%B6%E5%8F%91/">é«˜å¹¶å‘</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>Java ç§ƒå¤´ç³»åˆ—ä¹‹ JUC</p>
</blockquote>
<span id="more"></span>

<h2 id="JUC-æ˜¯ä»€ä¹ˆ-ğŸ˜¦"><a href="#JUC-æ˜¯ä»€ä¹ˆ-ğŸ˜¦" class="headerlink" title="JUC æ˜¯ä»€ä¹ˆ ğŸ˜¦"></a>JUC æ˜¯ä»€ä¹ˆ ğŸ˜¦</h2><blockquote>
<p><code>java.util.concurrent</code>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ä½¿ç”¨çš„<strong>å·¥å…·ç±»</strong></p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image004.jpg" alt="graphic"></p>
<h3 id="è¿›ç¨‹-çº¿ç¨‹å›é¡¾-ğŸ˜…"><a href="#è¿›ç¨‹-çº¿ç¨‹å›é¡¾-ğŸ˜…" class="headerlink" title="è¿›ç¨‹/çº¿ç¨‹å›é¡¾ ğŸ˜…"></a>è¿›ç¨‹/çº¿ç¨‹å›é¡¾ ğŸ˜…</h3><h4 id="è¿›ç¨‹-çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ-â“"><a href="#è¿›ç¨‹-çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ-â“" class="headerlink" title="è¿›ç¨‹/çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ â“"></a>è¿›ç¨‹/çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ â“</h4><p>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚å®ƒæ˜¯æ“ä½œç³»ç»ŸåŠ¨æ€æ‰§è¡Œçš„åŸºæœ¬å•å…ƒï¼Œåœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ—¢æ˜¯åŸºæœ¬çš„åˆ†é…å•å…ƒï¼Œä¹Ÿæ˜¯åŸºæœ¬çš„æ‰§è¡Œå•å…ƒã€‚</p>
<p>çº¿ç¨‹ï¼šé€šå¸¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œå½“ç„¶ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç„¶æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚çº¿ç¨‹å¯ä»¥åˆ©ç”¨è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œåœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸éƒ½æ˜¯æŠŠè¿›ç¨‹ä½œä¸ºåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œè€ŒæŠŠçº¿ç¨‹ä½œä¸ºç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œç”±äºçº¿ç¨‹æ¯”è¿›ç¨‹æ›´å°ï¼ŒåŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œæ•…å¯¹å®ƒçš„è°ƒåº¦æ‰€ä»˜å‡ºçš„å¼€é”€å°±ä¼šå°å¾—å¤šï¼Œèƒ½æ›´é«˜æ•ˆçš„æé«˜ç³»ç»Ÿå¤šä¸ªç¨‹åºé—´å¹¶å‘æ‰§è¡Œçš„ç¨‹åº¦ã€‚</p>
<h4 id="ä¸¾ä¸ªæ —å­-ğŸŒ°"><a href="#ä¸¾ä¸ªæ —å­-ğŸŒ°" class="headerlink" title="ä¸¾ä¸ªæ —å­ ğŸŒ°"></a>ä¸¾ä¸ªæ —å­ ğŸŒ°</h4><ul>
<li><strong>ä¾‹å­ä¸€ï¼š</strong> ä½¿ç”¨ QQï¼ŒæŸ¥çœ‹è¿›ç¨‹ä¸€å®šæœ‰ä¸€ä¸ª QQ.exe çš„è¿›ç¨‹ï¼Œæˆ‘å¯ä»¥ç”¨ qq å’Œ A æ–‡å­—èŠå¤©ï¼Œå’Œ B è§†é¢‘èŠå¤©ï¼Œç»™ C ä¼ æ–‡ä»¶ï¼Œç»™ D å‘ä¸€æ®µè¯­è¨€ï¼ŒQQ æ”¯æŒå½•å…¥ä¿¡æ¯çš„æœç´¢ã€‚</li>
<li><strong>ä¾‹å­äºŒï¼š</strong> å¤§å››çš„æ—¶å€™å†™è®ºæ–‡ï¼Œç”¨ word å†™è®ºæ–‡ï¼ŒåŒæ—¶ç”¨ QQ éŸ³ä¹æ”¾éŸ³ä¹ï¼ŒåŒæ—¶ç”¨ QQ èŠå¤©ï¼Œå¤šä¸ªè¿›ç¨‹ã€‚</li>
<li><strong>ä¾‹å­ä¸‰ï¼š</strong> word å¦‚æ²¡æœ‰ä¿å­˜ï¼Œåœç”µå…³æœºï¼Œå†é€šç”µåæ‰“å¼€ word å¯ä»¥æ¢å¤ä¹‹å‰æœªä¿å­˜çš„æ–‡æ¡£ï¼Œword ä¹Ÿä¼šæ£€æŸ¥ä½ çš„æ‹¼å†™ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼šå®¹ç¾å¤‡ä»½ï¼Œè¯­æ³•æ£€æŸ¥</li>
</ul>
<h4 id="çº¿ç¨‹çš„çŠ¶æ€-ğŸ˜´"><a href="#çº¿ç¨‹çš„çŠ¶æ€-ğŸ˜´" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€ ğŸ˜´"></a>çº¿ç¨‹çš„çŠ¶æ€ ğŸ˜´</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/Java+%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%8F%98%E8%BF%81.png" alt="Java çº¿ç¨‹çŠ¶æ€å˜è¿ "></p>
<p>åœ¨ Java ä¸­æˆ‘ä»¬åªèƒ½å¾—åˆ°çº¿ç¨‹ä»¥ä¸‹çš„çº¿ç¨‹çŠ¶æ€ï¼š</p>
<ul>
<li>new</li>
<li>runnable</li>
<li>blocked</li>
<li>waiting</li>
<li>time_waiting</li>
<li>terminated</li>
</ul>
<blockquote>
<p>æ“ä½œç³»ç»Ÿéšè— Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ RUNNABLE å’Œ RUNNING çŠ¶æ€ï¼Œå®ƒåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€ï¼Œæ‰€ä»¥ Java ç³»ç»Ÿä¸€èˆ¬å°†è¿™ä¸¤ä¸ªçŠ¶æ€ç»Ÿç§°ä¸º <strong>RUNNABLEï¼ˆè¿è¡Œä¸­ï¼‰</strong> çŠ¶æ€ ã€‚</p>
</blockquote>
<h4 id="wait-sleep-çš„åŒºåˆ«-ğŸ˜¦"><a href="#wait-sleep-çš„åŒºåˆ«-ğŸ˜¦" class="headerlink" title="wait/sleep çš„åŒºåˆ« ğŸ˜¦"></a>wait/sleep çš„åŒºåˆ« ğŸ˜¦</h4><ul>
<li>waitï¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶<strong>é‡Šæ”¾é”</strong>ï¼ˆæ”¾å¼€æ‰‹å»ç¡ï¼Œæ”¾å¼€æ‰‹é‡Œçš„é”ï¼‰</li>
<li>sleepï¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ<strong>ä¸é‡Šæ”¾é”</strong>ï¼ˆæ¡ç´§æ‰‹å»ç¡ï¼Œé†’äº†æ‰‹é‡Œè¿˜æœ‰é”ï¼‰</li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”"><a href="#ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”"></a>ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”</h4><ul>
<li>å¹¶å‘ï¼šåŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åœ¨è®¿é—®åŒä¸€ä¸ªèµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªç‚¹ï¼ˆCPU åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åå¤æ¨ªè·³ï¼‰</li>
<li>å¹¶è¡Œï¼šå¤šé¡¹å·¥ä½œä¸€èµ·æ‰§è¡Œï¼Œä¹‹åå†æ±‡æ€»ï¼ˆå¤šä¸ª CPU åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ª CPU è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼‰</li>
</ul>
<h2 id="Lock-æ¥å£-ğŸ”’"><a href="#Lock-æ¥å£-ğŸ”’" class="headerlink" title="Lock æ¥å£ ğŸ”’"></a>Lock æ¥å£ ğŸ”’</h2><h3 id="å¤ä¹ -SynchronizedğŸ˜³"><a href="#å¤ä¹ -SynchronizedğŸ˜³" class="headerlink" title="å¤ä¹  SynchronizedğŸ˜³"></a>å¤ä¹  SynchronizedğŸ˜³</h3><p><strong>ä¹°ç¥¨ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String name = Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;ä¹°ç¥¨å¤±è´¥ï¼Œæ²¡æœ‰ç¥¨å•¦&quot;</span>;</span><br><span class="line">        ticket--;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;å”®å‡ºä¸€å¼ ç¥¨ï¼Œè¿˜å‰©ï¼š&quot;</span> + ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº”ä¸ªçº¿ç¨‹å»ä¹°ç¥¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ¯ä¸ªçº¿ç¨‹ä¹°10æ¬¡ç¥¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                x.sell();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ä¼‘æ¯ä¸€ä¸‹ï¼ŒCPUæ ¸æ•°å¤ªå¤šäº†ï¼Œä¸ä¼‘æ¯çœ‹ä¸å‡ºæ¥ç¥¨è¢«æŠ¢å¤º</span></span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;çª—å£&quot;</span> + j).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ˜¯ä»€ä¹ˆï¼Ÿâ“"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿâ“" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿâ“"></a>æ˜¯ä»€ä¹ˆï¼Ÿâ“</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277453136.jpg" alt="graphic"></p>
<blockquote>
<p>Lock implementations provide more extensive locking operations than can be obtained using synchronized methods and statements. They allow more flexible structuring, may have quite different properties, and may support multiple associated Condition objects.</p>
<p>ç¿»è¯‘ï¼šé”å®ç°æä¾›äº†æ¯”ä½¿ç”¨åŒæ­¥æ–¹æ³•å’Œè¯­å¥å¯ä»¥è·å¾—çš„æ›´å¹¿æ³›çš„é”æ“ä½œã€‚å®ƒä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯èƒ½å…·æœ‰éå¸¸ä¸åŒçš„å±æ€§ï¼Œå¹¶ä¸”å¯èƒ½æ”¯æŒå¤šä¸ªå…³è”çš„æ¡ä»¶å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="æ€ä¹ˆç”¨-ğŸ”§"><a href="#æ€ä¹ˆç”¨-ğŸ”§" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ”§"></a>æ€ä¹ˆç”¨ ğŸ”§</h3><blockquote>
<p>Lock æ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œæˆ‘ä»¬ä»¥ ReentrantLock ä¸ºä¾‹</p>
</blockquote>
<h4 id="Lock-æ¥å£çš„å®ç°-ReentrantLock-å¯é‡å…¥é”"><a href="#Lock-æ¥å£çš„å®ç°-ReentrantLock-å¯é‡å…¥é”" class="headerlink" title="Lock æ¥å£çš„å®ç° ReentrantLock å¯é‡å…¥é”"></a>Lock æ¥å£çš„å®ç° ReentrantLock å¯é‡å…¥é”</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277530938.jpg" alt="graphic"></p>
<p>çœ‹çœ‹å®˜ç½‘æ–‡æ¡£çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     lock.lock();  <span class="comment">// block until condition holds</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">// ... method body</span></span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock()</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>ReentrantLock</code>å®ç°ä¹°ç¥¨ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–ç¥¨æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = Thread.currentThread().getName();</span><br><span class="line">            <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;ä¹°ç¥¨å¤±è´¥ï¼Œæ²¡æœ‰ç¥¨å•¦&quot;</span>;</span><br><span class="line">            ticket--;</span><br><span class="line">            System.out.println(name + <span class="string">&quot;å”®å‡ºä¸€å¼ ç¥¨ï¼Œè¿˜å‰©ï¼š&quot;</span> + ticket);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">        <span class="comment">// åˆ›å»ºäº”ä¸ªçº¿ç¨‹å»ä¹°ç¥¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// æ¯ä¸ªçº¿ç¨‹ä¹°10æ¬¡ç¥¨</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    x.sell();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// ä¼‘æ¯ä¸€ä¸‹ï¼ŒCPUæ ¸æ•°å¤ªå¤šäº†ï¼Œä¸ä¼‘æ¯çœ‹ä¸å‡ºæ¥ç¥¨è¢«æŠ¢å¤º</span></span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;çª—å£&quot;</span> + j).start();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="synchronized-ä¸-Lock-çš„åŒºåˆ«-ğŸ˜¦"><a href="#synchronized-ä¸-Lock-çš„åŒºåˆ«-ğŸ˜¦" class="headerlink" title="synchronized ä¸ Lock çš„åŒºåˆ« ğŸ˜¦"></a>synchronized ä¸ Lock çš„åŒºåˆ« ğŸ˜¦</h3><p><strong>ä¸¤è€…åŒºåˆ«ï¼š</strong></p>
<ol>
<li>é¦–å…ˆ<code>synchronized</code>æ˜¯<strong>java å†…ç½®å…³é”®å­—</strong>ï¼Œåœ¨ jvm å±‚é¢ï¼Œ<strong>Lock æ˜¯ä¸ª java ç±»</strong>ï¼›</li>
<li><code>synchronized</code><strong>æ— æ³•</strong>åˆ¤æ–­æ˜¯å¦è·å–é”çš„çŠ¶æ€ï¼Œ<code>Lock</code><strong>å¯ä»¥</strong>åˆ¤æ–­æ˜¯å¦è·å–åˆ°é”ï¼›</li>
<li><code>synchronized</code>ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾é”</strong>(a çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ä¼šé‡Šæ”¾é” ï¼›b çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¼šé‡Šæ”¾é”)ï¼Œ<code>Lock</code>éœ€åœ¨ finally ä¸­<strong>æ‰‹å·¥é‡Šæ”¾é”</strong>ï¼ˆunlock()æ–¹æ³•é‡Šæ”¾é”ï¼‰ï¼Œå¦åˆ™å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é”ï¼›</li>
<li>ç”¨<code>synchronized</code>å…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ 1 è·å¾—é”ï¼Œçº¿ç¨‹ 2 çº¿ç¨‹ç­‰å¾…ã€‚<strong>å¦‚æœçº¿ç¨‹ 1 é˜»å¡ï¼Œçº¿ç¨‹ 2 åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»</strong>ï¼Œè€Œ Lock é”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œ<strong>å¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†</strong>ï¼›</li>
<li><code>synchronized</code>çš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€Œ<code>Lock</code>é”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰</li>
<li><code>Lock</code>é”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œ<code>synchronized</code>é”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ã€‚</li>
</ol>
<h2 id="çº¿ç¨‹é—´é€šä¿¡-ğŸ“"><a href="#çº¿ç¨‹é—´é€šä¿¡-ğŸ“" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡ ğŸ“"></a>çº¿ç¨‹é—´é€šä¿¡ ğŸ“</h2><h3 id="é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å°-ğŸ“"><a href="#é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å°-ğŸ“" class="headerlink" title="é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å° ğŸ“"></a>é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å° ğŸ“</h3><p>âœ ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰“å°æ•°å­— 1-52ï¼Œå¦ä¸€ä¸ªæ‰“å°å­—æ¯ A-Z æ‰“å°é¡ºåºä¸º 12A34Bâ€¦5152Z</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…+æ¶ˆè´¹è€…</li>
<li>é€šçŸ¥ç­‰å¾…å”¤é†’æœºåˆ¶</li>
</ul>
<p>å®ç°ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCommunication</span> </span>&#123;</span><br><span class="line">    <span class="comment">// falseï¼šæ‰“å°æ•°å­—ï¼Œtrueï¼šæ‰“å°å­—æ¯</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// è®°å½•æ•°å­—</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è®°å½•å­—æ¯</span></span><br><span class="line">    <span class="keyword">int</span> letter = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°æ•°å­—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printNumber</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸ºtrueå…ˆä¼‘çœ ï¼Œè®©å­—æ¯å…ˆæ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°äº†52å°±é€€å‡ºå¹¶å”¤é†’å­—æ¯çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">52</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span> + num + <span class="string">&quot;, &quot;</span> + (++num));</span><br><span class="line">        num++;</span><br><span class="line">        flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°å­—æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printLetter</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸ºfalseå…ˆä¼‘çœ ï¼Œè®©æ•°å­—å…ˆæ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°äº†Zå°±é€€å‡ºå¹¶å”¤é†’æ•°å­—çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (letter &gt; <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span> + ((<span class="keyword">char</span>) letter++));</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    ThreadCommunication threadCommunication = <span class="keyword">new</span> ThreadCommunication();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printNumber();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;æ•°å­—çº¿ç¨‹&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printLetter();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;å­—æ¯çº¿ç¨‹&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¢åŠ åˆ°-4-ä¸ªçº¿ç¨‹-ğŸ†™"><a href="#å¢åŠ åˆ°-4-ä¸ªçº¿ç¨‹-ğŸ†™" class="headerlink" title="å¢åŠ åˆ° 4 ä¸ªçº¿ç¨‹ ğŸ†™"></a>å¢åŠ åˆ° 4 ä¸ªçº¿ç¨‹ ğŸ†™</h3><ul>
<li><p><strong>å‡ºç°é—®é¢˜ï¼š</strong> æ¢æˆ 4 ä¸ªçº¿ç¨‹ä¼šå¯¼è‡´é”™è¯¯ï¼Œè™šå‡å”¤é†’</p>
</li>
<li><p><strong>åŸå› ï¼š</strong> åœ¨ java å¤šçº¿ç¨‹åˆ¤æ–­æ—¶ï¼Œä¸èƒ½ç”¨ ifï¼Œç¨‹åºå‡ºäº‹å‡ºåœ¨äº†åˆ¤æ–­ä¸Šé¢ï¼Œçªç„¶æœ‰ä¸€æ·»åŠ çš„çº¿ç¨‹è¿›åˆ° if äº†ï¼Œçªç„¶ä¸­æ–­äº†äº¤å‡ºæ§åˆ¶æƒï¼Œæ²¡æœ‰è¿›è¡ŒéªŒè¯ï¼Œè€Œæ˜¯ç›´æ¥èµ°ä¸‹å»äº†ï¼ŒåŠ äº†ä¸¤æ¬¡ï¼Œç”šè‡³å¤šæ¬¡</p>
</li>
<li><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p>è§£å†³è™šå‡å”¤é†’ï¼šæŸ¥çœ‹ APIï¼Œjava.lang.Object</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618284313147.jpg" alt="graphic"></p>
<p>ä¸­æ–­å’Œè™šå‡å”¤é†’æ˜¯å¯èƒ½äº§ç”Ÿçš„ï¼Œæ‰€ä»¥è¦ç”¨<strong>loop å¾ªç¯</strong>ï¼Œif åªåˆ¤æ–­ä¸€æ¬¡ï¼Œ<strong>while æ˜¯åªè¦å”¤é†’å°±è¦æ‹‰å›æ¥å†åˆ¤æ–­ä¸€æ¬¡</strong>ã€‚if æ¢æˆ while</p>
</li>
</ul>
</li>
<li><p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ifæ”¹ä¸ºwhileğŸ‘‡</span></span><br><span class="line"><span class="keyword">while</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="java8-æ–°ç‰ˆå®ç°-ğŸ†•"><a href="#java8-æ–°ç‰ˆå®ç°-ğŸ†•" class="headerlink" title="java8 æ–°ç‰ˆå®ç° ğŸ†•"></a>java8 æ–°ç‰ˆå®ç° ğŸ†•</h3><p><code>lock</code>å¯¹æ ‡<code>synchronization</code>å®ç°</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413114243997.png" alt="image-20210413114243997"></p>
<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p><code>lock</code> çš„ <code>await</code> å’Œ <code>signal </code>æ–¹æ³•éœ€è¦é  <code>Condition </code>æ¥å£å®ç°</p>
<p>æŸ¥çœ‹ APIï¼Œjava.util.concurrent</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618286075328.jpg" alt="graphic"></p>
<p>ä»£ç ä¸¾ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">final</span> Condition notFull  = lock.newCondition();</span><br><span class="line">    <span class="keyword">final</span> Condition notEmpty = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == items.length)</span><br><span class="line">                notFull.await();</span><br><span class="line">            items[putptr] = x;</span><br><span class="line">            <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</span><br><span class="line">            ++count;</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡-ğŸ’±"><a href="#çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡-ğŸ’±" class="headerlink" title="çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡ ğŸ’±"></a>çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡ ğŸ’±</h2><h3 id="ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å°-ğŸ“"><a href="#ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å°-ğŸ“" class="headerlink" title="ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å° ğŸ“"></a>ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å° ğŸ“</h3><p>âœ æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼ŒA çº¿ç¨‹æ‰“å°å­—ç¬¦ AAï¼ŒB çº¿ç¨‹æ‰“å°å­—ç¬¦ BBï¼ŒC çº¿ç¨‹æ‰“å°å­—ç¬¦ CCï¼Œéœ€è¦ä¾æ¬¡æ‰“å°å‡º abcï¼Œæ‰“å°åè½®ï¼Œæ¯è½® AA è¦æ‰“å°äº”æ¬¡ï¼ŒBB è¦æ‰“å° 10 æ¬¡ï¼ŒCC è¦æ‰“å° 15 æ¬¡</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<ul>
<li>æœ‰é¡ºåºé€šçŸ¥ï¼Œéœ€è¦æœ‰æ ‡è¯†ä½</li>
<li>æœ‰ä¸€ä¸ªé” Lockï¼Œ3 æŠŠé’¥åŒ™ Condition</li>
<li>åˆ¤æ–­æ ‡å¿—ä½</li>
<li>è¾“å‡ºçº¿ç¨‹å+ç¬¬å‡ æ¬¡+ç¬¬å‡ è½®</li>
<li>ä¿®æ”¹æ ‡å¿—ä½ï¼Œé€šçŸ¥ä¸‹ä¸€ä¸ª</li>
</ul>
<p><strong>å®ç°ä»£ç ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareResource</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1:A 2:B 3:C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print5</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            c2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print10</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            c3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print15</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            c1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ShareResource sr = <span class="keyword">new</span> ShareResource();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print5(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print10(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print15(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;CC&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Synchronization-é”é—®é¢˜-â“"><a href="#Synchronization-é”é—®é¢˜-â“" class="headerlink" title="Synchronization é”é—®é¢˜ â“"></a>Synchronization é”é—®é¢˜ â“</h2><h3 id="å…«ä¸ªé—®é¢˜-ğŸ“"><a href="#å…«ä¸ªé—®é¢˜-ğŸ“" class="headerlink" title="å…«ä¸ªé—®é¢˜ ğŸ“"></a>å…«ä¸ªé—®é¢˜ ğŸ“</h3><ol>
<li><p>æ ‡å‡†è®¿é—®ï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>åœ 4 ç§’åœ¨çŸ­ä¿¡æ–¹æ³•å†…ï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        è¿™é‡Œä½¿ç”¨sleepåœæ­¢<span class="number">4</span>ç§’</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>æ™®é€šçš„ hello æ–¹æ³•ï¼Œæ˜¯å…ˆæ‰“çŸ­ä¿¡è¿˜æ˜¯ hello</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// phone.sendEmail();</span></span><br><span class="line">     phone.getHello();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ç°åœ¨æœ‰ä¸¤éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
</li>
<li><p>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
</li>
<li><p>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ2 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
</li>
<li><p>1 ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œ1 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
</li>
<li><p>1 ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œ2 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p>
</li>
</ol>
<h3 id="é—®é¢˜ç­”æ¡ˆ-ğŸ¤«"><a href="#é—®é¢˜ç­”æ¡ˆ-ğŸ¤«" class="headerlink" title="é—®é¢˜ç­”æ¡ˆ ğŸ¤«"></a>é—®é¢˜ç­”æ¡ˆ ğŸ¤«</h3><ol>
<li>çŸ­ä¿¡</li>
<li>çŸ­ä¿¡</li>
<li>Hello</li>
<li>é‚®ä»¶</li>
<li>çŸ­ä¿¡</li>
<li>çŸ­ä¿¡</li>
<li>é‚®ä»¶</li>
<li>é‚®ä»¶</li>
</ol>
<h3 id="é—®é¢˜åˆ†æ-ğŸ§"><a href="#é—®é¢˜åˆ†æ-ğŸ§" class="headerlink" title="é—®é¢˜åˆ†æ ğŸ§"></a>é—®é¢˜åˆ†æ ğŸ§</h3><ul>
<li><code>synchronization</code>å…³é”®å­—é”çš„æ˜¯å¯¹è±¡ï¼Œä¸”å½“å¯¹è±¡è¢«é”æ—¶ï¼Œéœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾åå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å¾—é”</li>
<li>å½“<code>synchronization</code>ä¿®é¥°æ™®é€šæ–¹æ³•æ—¶ï¼Œé”çš„æ˜¯å®ä¾‹å¯¹è±¡</li>
<li>å½“<code>synchronization</code>ä¿®é¥°çš„æ˜¯é™æ€æ–¹æ³•æ—¶ï¼Œé”çš„æ˜¯ç±»å¯¹è±¡</li>
</ul>
<h2 id="ä¸å®‰å…¨é›†åˆ-ğŸš¨"><a href="#ä¸å®‰å…¨é›†åˆ-ğŸš¨" class="headerlink" title="ä¸å®‰å…¨é›†åˆ ğŸš¨"></a>ä¸å®‰å…¨é›†åˆ ğŸš¨</h2><blockquote>
<p>æ€»æ‰€å‘¨çŸ¥<code>HashMap</code>ã€<code>ArrayList</code>ã€<code>HashSet</code>éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å»ä¿è¯é›†åˆçš„çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ</p>
</blockquote>
<h3 id="è¯æ˜çº¿ç¨‹ä¸å®‰å…¨-ğŸ¤¯"><a href="#è¯æ˜çº¿ç¨‹ä¸å®‰å…¨-ğŸ¤¯" class="headerlink" title="è¯æ˜çº¿ç¨‹ä¸å®‰å…¨ ğŸ¤¯"></a>è¯æ˜çº¿ç¨‹ä¸å®‰å…¨ ğŸ¤¯</h3><p><strong>è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; arr = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">30</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> i = j;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        String key = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>) + Thread.currentThread().getName() + i;</span><br><span class="line">        arr.add(key);</span><br><span class="line">        System.out.println(arr);</span><br><span class="line">    &#125;, <span class="string">&quot;çº¿ç¨‹&quot;</span> + j + <span class="string">&quot;ï¼š&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143558545.png" alt="image-20210413143558545"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œä¸Šé¢çš„ä»£ç åå‡ºç°äº†<code>java.util.ConcurrentModificationException</code>ï¼ˆå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰å¼‚å¸¸ï¼ŒArrayList åœ¨è¿­ä»£çš„æ—¶å€™å¦‚æœå¯¹å…¶è¿›è¡Œä¿®æ”¹å°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸</p>
<ul>
<li><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><p><strong>æ–¹æ¡ˆä¸€ï¼š</strong> Vector</p>
<ul>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143920131.png" alt="image-20210413143920131"></li>
<li>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨<code>Vector</code>è¿™ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆ</li>
<li>ä¸‹é¢è¿™ä¸ªæ˜¯<code>Vector</code>æ·»åŠ å…ƒç´ çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¸Šé¢æ·»åŠ äº†<code>synchronization</code>å…³é”®å­—ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨</li>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144051872.png" alt="image-20210413144051872"></li>
</ul>
</li>
<li><p><strong>æ–¹æ¡ˆäºŒï¼š</strong> Collections</p>
<ul>
<li>ä½¿ç”¨<code>Collections#synchronizedList</code>æ–¹æ³•å°†<code>ArrayList</code>è½¬æ¢æˆçº¿ç¨‹å®‰å…¨çš„</li>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144654816.png" alt="image-20210413144654816"></li>
<li>å¯ä»¥çœ‹åˆ°å®é™…ä¸Šä¹Ÿæ˜¯ä½¿ç”¨äº†<code>synchronization</code>å…³é”®å­—æ¥ä¿è¯çš„çº¿ç¨‹å®‰å…¨</li>
</ul>
</li>
<li><p><strong>æ–¹æ¡ˆä¸‰ï¼š</strong> å†™æ—¶å¤åˆ¶</p>
<ul>
<li><p>è™½ç„¶ä¸åŠ é”æ€§èƒ½å¥½ä½†æ˜¯ä¼šå‡ºé”™è¯¯ï¼ŒåŠ é”åˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™</p>
</li>
<li><p>æˆ‘ä»¬å¯ä»¥æŠ˜ä¸­ä¸€ä¸‹ä½¿ç”¨<code>CopyOnWriteArrayList</code></p>
</li>
<li><blockquote>
<p>A thread-safe variant of ArrayList in which all mutative operations (add, set, and so on) are implemented by making a fresh copy of the underlying array.</p>
<p>CopyOnWriteArrayList æ˜¯ arraylist çš„ä¸€ç§çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddã€set ç­‰ï¼‰éƒ½æ˜¯é€šè¿‡ç”Ÿæˆåº•å±‚æ•°ç»„çš„æ–°å‰¯æœ¬æ¥å®ç°çš„ã€‚</p>
</blockquote>
</li>
<li><p><code>CopyOnWrite</code>å®¹å™¨å³<strong>å†™æ—¶å¤åˆ¶çš„å®¹å™¨</strong>ã€‚å¾€ä¸€ä¸ªå®¹å™¨<strong>æ·»åŠ å…ƒç´ </strong>çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å½“å‰å®¹å™¨<code>Object[]</code>æ·»åŠ ï¼Œè€Œæ˜¯<strong>å…ˆå°†å½“å‰å®¹å™¨<code>Object[]</code>è¿›è¡Œ Copy</strong>ï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨<code>Object[] newElements</code>ï¼Œç„¶åå‘æ–°çš„å®¹å™¨<code>Object[] newElements</code>é‡Œæ·»åŠ å…ƒç´ ã€‚æ·»åŠ å…ƒç´ åï¼Œ<strong>å†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨<code>setArray(newElements)</code><strong>ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥å¯¹<code>CopyOnWrite</code>å®¹å™¨è¿›è¡Œ</strong>å¹¶å‘çš„è¯»</strong>ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚æ‰€ä»¥<code>CopyOnWrite</code>å®¹å™¨ä¹Ÿæ˜¯ä¸€ç§<strong>è¯»å†™åˆ†ç¦»çš„æ€æƒ³</strong>ï¼Œè¯»å’Œå†™ä¸åŒçš„å®¹å™¨ã€‚</p>
<ol>
<li>å…ˆå¤åˆ¶</li>
<li>å¾€å¤åˆ¶çš„æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </li>
<li>å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘å¤åˆ¶çš„æ•°ç»„</li>
</ol>
</li>
<li><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413151325401.png" alt="image-20210413151325401"></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Callable-æ¥å£-â†©ï¸"><a href="#Callable-æ¥å£-â†©ï¸" class="headerlink" title="Callable æ¥å£ â†©ï¸"></a>Callable æ¥å£ â†©ï¸</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“"><a href="#æ˜¯ä»€ä¹ˆ-â“" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><h4 id="é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ"><a href="#é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ" class="headerlink" title="é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ"></a>é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ</h4><p><strong>ä¸å®Œæ•´ç­”æ¡ˆï¼š</strong> ç»§æ‰¿<code>Thread</code>ç±» å’Œ å®ç°<code>Runnable</code>æ¥å£</p>
<p>==<strong>å¦‚æœåªå›ç­”è¿™ä¸¤ä¸ªä½ è¿è¢«é—®åˆ° juc çš„æœºä¼šéƒ½æ²¡æœ‰</strong>==</p>
<p><strong>æ­£ç¡®ç­”æ¡ˆå¦‚ä¸‹ï¼š</strong></p>
<p><strong>ä¼ ç»Ÿçš„æ˜¯</strong>ç»§æ‰¿<code>Thread</code>ç±» å’Œ å®ç°<code>Runnable</code>æ¥å£ï¼Œ<br><strong>java5 ä»¥å</strong>åˆæœ‰å®ç°<code>Callable</code>æ¥å£ å’Œ java çš„çº¿ç¨‹æ±  è·å¾—</p>
<h4 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413153235849.png" alt="image-20210413153235849"></p>
<p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå› æ­¤å¯ä»¥ç”¨ä½œ lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨çš„èµ‹å€¼å¯¹è±¡</p>
<h3 id="ä¸-Runnable-æ¥å£çš„å¯¹æ¯”-ğŸ˜¦"><a href="#ä¸-Runnable-æ¥å£çš„å¯¹æ¯”-ğŸ˜¦" class="headerlink" title="ä¸ Runnable æ¥å£çš„å¯¹æ¯” ğŸ˜¦"></a>ä¸ Runnable æ¥å£çš„å¯¹æ¯” ğŸ˜¦</h3><p><strong>ç¼–ç æ–¹é¢çš„åŒºåˆ«</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ–°ç±»MyThreadå®ç°runnableæ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°ç±»MyThread2å®ç°callableæ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é¢è¯•é¢˜ï¼šcallable æ¥å£ä¸ runnable æ¥å£çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li>Callable æ¥å£æœ‰è¿”å›å€¼ï¼ŒRunnable æ¥å£æ²¡æœ‰</li>
<li>Callable æ¥å£å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼ŒRunnable æ¥å£ä¸è¡Œ</li>
<li>è½åœ°æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ runï¼Œä¸€ä¸ªæ˜¯ call</li>
</ul>
<h3 id="æ€ä¹ˆç”¨-ğŸ”§-1"><a href="#æ€ä¹ˆç”¨-ğŸ”§-1" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ”§"></a>æ€ä¹ˆç”¨ ğŸ”§</h3><h4 id="ç›´æ¥æ›¿æ¢-runnable-æ˜¯å¦å¯è¡Œï¼Ÿ"><a href="#ç›´æ¥æ›¿æ¢-runnable-æ˜¯å¦å¯è¡Œï¼Ÿ" class="headerlink" title="ç›´æ¥æ›¿æ¢ runnable æ˜¯å¦å¯è¡Œï¼Ÿ"></a>ç›´æ¥æ›¿æ¢ runnable æ˜¯å¦å¯è¡Œï¼Ÿ</h4><p>æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½ç›´æ¥æ›¿æ¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread2(), <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154606831.png" alt="image-20210413154606831"></p>
<h4 id="æ›²çº¿æ•‘å›½"><a href="#æ›²çº¿æ•‘å›½" class="headerlink" title="æ›²çº¿æ•‘å›½"></a>æ›²çº¿æ•‘å›½</h4><p>å¯ä»¥çœ‹åˆ°ä¸èƒ½ç›´æ¥æŠŠ<code>runnable</code>æ¥å£çš„å®ç°ç›´æ¥æ¢æˆ<code>callable</code>æ¥å£çš„å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼æ¥ä¿®æ”¹</p>
<p>æˆ‘ä»¬çŸ¥é“æ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾ä¸€ä¸ªå®ç°äº†<code>runnable</code>å’Œ<code>callable</code>æ¥å£çš„ç±»ä¸å°±å¥½äº†å˜› ğŸ¤£</p>
<p>é‚£ä¹ˆçƒ­çƒˆæ¬¢è¿æˆ‘ä»¬çš„<code>FutureTask</code>åŒå­¦ç™»åœº</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154959592.png" alt="image-20210413154959592"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> MyThread());</span><br><span class="line">    <span class="keyword">new</span> Thread(ft, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155210045.png" alt="image-20210413155210045"></p>
<p>å½“å½“å½“ï¼Œè¿™æ ·å°±æ²¡æœ‰æŠ¥é”™å•¦ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°å¥½åƒå¹¶æ²¡æœ‰æŠŠæˆ‘ä»¬çš„ 200 ç»™è¾“å‡ºæ¬¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè·å¾—è¿”å›å€¼å‘¢ï¼Ÿ</p>
<p>ä½¿ç”¨ï¼š<code>ft.get();</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155428880.png" alt="image-20210413155428880"></p>
<p>è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡çº¿ç¨‹è¿è¡Œç»“æŸ</p>
<h3 id="FutureTaskğŸ˜²"><a href="#FutureTaskğŸ˜²" class="headerlink" title="FutureTaskğŸ˜²"></a>FutureTaskğŸ˜²</h3><blockquote>
<p>æˆ‘ä»¬ç°åœ¨æ¥æ­£å¼ä»‹ç»ä¸€ä¸‹<code>FutureTask</code>ç±»</p>
</blockquote>
<h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h4><p>æœªæ¥çš„ä»»åŠ¡ï¼Œç”¨å®ƒå°±å¹²ä¸€ä»¶äº‹ï¼Œ<strong>å¼‚æ­¥è°ƒç”¨</strong></p>
<p>ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªä»»åŠ¡å¹¶å†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œçº¿ç¨‹å¼€å¯åå®ƒä¼šé»˜é»˜æ‰§è¡Œï¼Œä½ ä½¿ç”¨<code>ft.get();</code>å°±å¯ä»¥å¾—åˆ°è¯¥ä»»åŠ¡çš„è¿”å›å€¼</p>
<h5 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h5><p>è€å¸ˆä¸Šç€è¯¾ï¼Œå£æ¸´äº†ï¼Œå»ä¹°æ°´ä¸åˆé€‚ï¼Œè®²è¯¾çº¿ç¨‹ç»§ç»­ï¼Œæˆ‘å¯ä»¥å•èµ·ä¸ªçº¿ç¨‹æ‰¾ç­é•¿å¸®å¿™ä¹°æ°´ï¼Œæ°´ä¹°å›æ¥äº†æ”¾æ¡Œä¸Šï¼Œæˆ‘éœ€è¦çš„æ—¶å€™å†å» getã€‚</p>
<h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><ul>
<li>åœ¨ä¸»çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œ<strong>æ¯”è¾ƒè€—æ—¶</strong>çš„æ“ä½œæ—¶ï¼Œä½†åˆ<strong>ä¸æƒ³é˜»å¡ä¸»çº¿ç¨‹</strong>æ—¶ï¼Œå¯ä»¥æŠŠè¿™äº›ä½œä¸šäº¤ç»™ Future å¯¹è±¡åœ¨åå°å®Œæˆï¼Œå½“ä¸»çº¿ç¨‹å°†æ¥éœ€è¦æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ Future å¯¹è±¡è·å¾—åå°ä½œä¸šçš„è®¡ç®—ç»“æœæˆ–è€…æ‰§è¡ŒçŠ¶æ€ã€‚</li>
<li>ä¸€èˆ¬ FutureTask å¤šç”¨äº<strong>è€—æ—¶çš„è®¡ç®—</strong>ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚</li>
<li>ä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½æ£€ç´¢ç»“æœï¼›<ul>
<li>å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡ get æ–¹æ³•ã€‚</li>
<li>ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚</li>
<li>get æ–¹æ³•è€Œè·å–ç»“æœåªæœ‰åœ¨è®¡ç®—å®Œæˆæ—¶è·å–ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡è½¬å…¥å®ŒæˆçŠ¶æ€ï¼Œç„¶åä¼šè¿”å›ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>åªè®¡ç®—ä¸€æ¬¡</li>
</ul>
</li>
</ul>
<h2 id="JUC-å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£-ğŸ§°"><a href="#JUC-å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£-ğŸ§°" class="headerlink" title="JUC å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£ ğŸ§°"></a>JUC å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£ ğŸ§°</h2><h3 id="CountDownLatch-å‡å°‘è®¡æ•°-â–"><a href="#CountDownLatch-å‡å°‘è®¡æ•°-â–" class="headerlink" title="CountDownLatch å‡å°‘è®¡æ•° â–"></a>CountDownLatch å‡å°‘è®¡æ•° â–</h3><ul>
<li>CountDownLatch ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨ await æ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡ã€‚</li>
<li>å…¶å®ƒçº¿ç¨‹è°ƒç”¨ countDown æ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡ 1(è°ƒç”¨ countDown æ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)ï¼Œ</li>
<li>å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º 0 æ—¶ï¼Œå›  await æ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>6 ä¸ªåŒå­¦é™†ç»­ç¦»å¼€æ•™å®¤åå€¼ç­åŒå­¦æ‰å¯ä»¥å…³é—¨ã€‚</p>
<h4 id="ä»£ç ä¸¾ä¾‹"><a href="#ä»£ç ä¸¾ä¾‹" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//6ä¸ªä¸Šè‡ªä¹ çš„åŒå­¦ï¼Œå„è‡ªç¦»å¼€æ•™å®¤çš„æ—¶é—´ä¸ä¸€è‡´</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t å·åŒå­¦ç¦»å¼€æ•™å®¤&quot;</span>);</span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t****** ç­é•¿å…³é—¨èµ°äººï¼Œmainçº¿ç¨‹æ˜¯ç­é•¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CyclicBarrier-å¾ªç¯æ …æ -ğŸš§"><a href="#CyclicBarrier-å¾ªç¯æ …æ -ğŸš§" class="headerlink" title="CyclicBarrier å¾ªç¯æ …æ  ğŸš§"></a>CyclicBarrier å¾ªç¯æ …æ  ğŸš§</h3><ul>
<li>CyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ï¼ˆCyclicï¼‰ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚çº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡ CyclicBarrier çš„ await()æ–¹æ³•ã€‚</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹-1"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹-1" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>è€å¸ˆéœ€è¦ç­‰æ‰€æœ‰å­¦ç”Ÿï¼ˆ7 ä¸ªï¼‰åˆ°äº†æ‰ä¸Šè¯¾</p>
<h4 id="ä»£ç ä¸¾ä¾‹-1"><a href="#ä»£ç ä¸¾ä¾‹-1" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(NUMBER, ()-&gt;System.out.println(<span class="string">&quot;*****è€å¸ˆå¼€å§‹ä¸Šè¯¾*****&quot;</span>)) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;åˆ°æ•™å®¤äº†&quot;</span>);</span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)+<span class="string">&quot;åŒå­¦&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Semaphore-ä¿¡å·ç¯-ğŸš¦"><a href="#Semaphore-ä¿¡å·ç¯-ğŸš¦" class="headerlink" title="Semaphore ä¿¡å·ç¯ ğŸš¦"></a>Semaphore ä¿¡å·ç¯ ğŸš¦</h3><ul>
<li>åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š<ul>
<li>acquireï¼ˆè·å–ï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire æ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡æˆåŠŸè·å–ä¿¡å·é‡ï¼ˆä¿¡å·é‡å‡ 1ï¼‰ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è¶…æ—¶ã€‚</li>
<li>releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šä¼šå°†ä¿¡å·é‡çš„å€¼åŠ  1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
</ul>
</li>
<li>ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹-2"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹-2" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>å…­è¾†è½¦æŠ¢ä¸‰ä¸ªè½¦ä½ï¼Œéœ€è¦ç­‰åœè½¦ä½ä¸Šé¢çš„è½¦ç¦»å¼€åï¼Œå¤–é¢çš„è½¦æ‰èƒ½è¿›æ¥</p>
<h4 id="ä»£ç ä¸¾ä¾‹-2"><a href="#ä»£ç ä¸¾ä¾‹-2" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);<span class="comment">//æ¨¡æ‹Ÿ3ä¸ªåœè½¦ä½</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//æ¨¡æ‹Ÿ6éƒ¨æ±½è½¦</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t æŠ¢åˆ°äº†è½¦ä½&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">5</span>));</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t------- ç¦»å¼€&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ReentrantReadWriteLock-è¯»å†™é”-ğŸ”"><a href="#ReentrantReadWriteLock-è¯»å†™é”-ğŸ”" class="headerlink" title="ReentrantReadWriteLock è¯»å†™é” ğŸ”"></a>ReentrantReadWriteLock è¯»å†™é” ğŸ”</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-1"><a href="#æ˜¯ä»€ä¹ˆ-â“-1" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><p>è¯»å†™é”å®šä¹‰å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p>
<ul>
<li>è¯»çš„æ—¶å€™åˆ«äººä¸èƒ½å†™</li>
<li>å†™çš„æ—¶å€™åˆ«äººä¸èƒ½è¯»</li>
<li>å†™çš„æ—¶å€™åˆ«äººä¸èƒ½å†™</li>
<li>è¯»çš„æ—¶å€™åˆ«äººå¯ä»¥è¯»</li>
</ul>
<p>å†ç®€å•ç‚¹è¯´å°±æ˜¯ï¼šè¯»å†™ä¸èƒ½åŒæ—¶è¿›è¡Œï¼Œè¯»è¯»å¯ä»¥</p>
<h3 id="é—®é¢˜ä¸¾ä¾‹-ğŸŒ°"><a href="#é—®é¢˜ä¸¾ä¾‹-ğŸŒ°" class="headerlink" title="é—®é¢˜ä¸¾ä¾‹ ğŸŒ°"></a>é—®é¢˜ä¸¾ä¾‹ ğŸŒ°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨å†™&quot;</span> + key);</span><br><span class="line">        <span class="comment">//æš‚åœä¸€ä¼šå„¿çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å®Œäº†&quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨è¯»&quot;</span> + key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        result = map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å®Œäº†&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1	 æ­£åœ¨å†™1</span><br><span class="line">2	 æ­£åœ¨å†™2</span><br><span class="line">5	 æ­£åœ¨å†™5</span><br><span class="line">1	 æ­£åœ¨è¯»1</span><br><span class="line">4	 æ­£åœ¨è¯»4</span><br><span class="line">5	 æ­£åœ¨è¯»5</span><br><span class="line">3	 æ­£åœ¨å†™3</span><br><span class="line">4	 æ­£åœ¨å†™4</span><br><span class="line">2	 æ­£åœ¨è¯»2</span><br><span class="line">3	 æ­£åœ¨è¯»3</span><br><span class="line">1	 è¯»å®Œäº†null</span><br><span class="line">2	 å†™å®Œäº†2</span><br><span class="line">4	 è¯»å®Œäº†null</span><br><span class="line">5	 è¯»å®Œäº†null</span><br><span class="line">3	 è¯»å®Œäº†null</span><br><span class="line">2	 è¯»å®Œäº†2</span><br><span class="line">4	 å†™å®Œäº†4</span><br><span class="line">3	 å†™å®Œäº†3</span><br><span class="line">1	 å†™å®Œäº†1</span><br><span class="line">5	 å†™å®Œäº†5</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿˜æ²¡å†™å®Œå°±å¼€å§‹è¯»äº†ï¼Œè¿˜æ²¡è¯»å®Œå°±å¼€å§‹å†™äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§</p>
<h3 id="ä½¿ç”¨è¯»å†™é”çš„ä»£ç -ğŸ‘©â€ğŸ’»"><a href="#ä½¿ç”¨è¯»å†™é”çš„ä»£ç -ğŸ‘©â€ğŸ’»" class="headerlink" title="ä½¿ç”¨è¯»å†™é”çš„ä»£ç  ğŸ‘©â€ğŸ’»"></a>ä½¿ç”¨è¯»å†™é”çš„ä»£ç  ğŸ‘©â€ğŸ’»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> ReadWriteLock rwLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨å†™&quot;</span> + key);</span><br><span class="line">            <span class="comment">//æš‚åœä¸€ä¼šå„¿çº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å®Œäº†&quot;</span> + key);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨è¯»&quot;</span> + key);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            result = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å®Œäº†&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1	 æ­£åœ¨å†™1</span><br><span class="line">1	 å†™å®Œäº†1</span><br><span class="line"></span><br><span class="line">3	 æ­£åœ¨å†™3</span><br><span class="line">3	 å†™å®Œäº†3</span><br><span class="line"></span><br><span class="line">4	 æ­£åœ¨å†™4</span><br><span class="line">4	 å†™å®Œäº†4</span><br><span class="line"></span><br><span class="line">2	 æ­£åœ¨å†™2</span><br><span class="line">2	 å†™å®Œäº†2</span><br><span class="line"></span><br><span class="line">5	 æ­£åœ¨å†™5</span><br><span class="line">5	 å†™å®Œäº†5</span><br><span class="line"></span><br><span class="line">1	 æ­£åœ¨è¯»1</span><br><span class="line">2	 æ­£åœ¨è¯»2</span><br><span class="line">3	 æ­£åœ¨è¯»3</span><br><span class="line">4	 æ­£åœ¨è¯»4</span><br><span class="line">5	 æ­£åœ¨è¯»5</span><br><span class="line">4	 è¯»å®Œäº†4</span><br><span class="line">2	 è¯»å®Œäº†2</span><br><span class="line">1	 è¯»å®Œäº†1</span><br><span class="line">5	 è¯»å®Œäº†5</span><br><span class="line">3	 è¯»å®Œäº†3</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†è¯»å†™é”åï¼Œåœ¨å†™çš„æ—¶å€™æ²¡æœ‰è¢«æ‰“æ–­äº†ï¼Œä½†æ˜¯è¯»å’Œè¯»ä¹‹é—´å¯ä»¥éšæ„æ‰“æ–­</p>
<h2 id="BlockingQueue-é˜»å¡é˜Ÿåˆ—-â³"><a href="#BlockingQueue-é˜»å¡é˜Ÿåˆ—-â³" class="headerlink" title="BlockingQueue é˜»å¡é˜Ÿåˆ— â³"></a>BlockingQueue é˜»å¡é˜Ÿåˆ— â³</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-2"><a href="#æ˜¯ä»€ä¹ˆ-â“-2" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><p>è™½ç„¶è¯´ç¨‹åºè¿è¡Œä¸­é˜»å¡ä¸å¥½ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬å¿…é¡»ä½¿ç”¨é˜»å¡æ¥å®ŒæˆæŸäº›äº‹æƒ…</p>
<p><strong>é˜»å¡ï¼šå¿…é¡»è¦é˜»å¡/ä¸å¾—ä¸é˜»å¡</strong></p>
<p>é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­èµ·çš„ä½œç”¨å¦‚ä¸‹å›¾ï¼š</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413170339956.png" alt="image-20210413170339956"></p>
<ul>
<li>å½“é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li>
<li>å½“é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä»é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li>
<li>è¯•å›¾ä»ç©ºçš„é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—æ’å…¥æ–°çš„å…ƒç´ </li>
<li>è¯•å›¾å‘å·²æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æˆ–è€…å®Œå…¨æ¸…ç©ºï¼Œä½¿é˜Ÿåˆ—å˜å¾—ç©ºé—²èµ·æ¥å¹¶åç»­æ–°å¢</li>
</ul>
<h3 id="é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„-ğŸ¤”"><a href="#é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„-ğŸ¤”" class="headerlink" title="é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„ ğŸ¤”"></a>é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„ ğŸ¤”</h3><ul>
<li>åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼š<ul>
<li>æ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼š<strong>æŒ‚èµ·çº¿ç¨‹</strong>ï¼ˆå³é˜»å¡ï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼š<strong>è‡ªåŠ¨è¢«å”¤èµ·</strong></li>
</ul>
</li>
<li>ä¸ºä»€ä¹ˆéœ€è¦ BlockingQueueï¼š<ul>
<li>å¥½å¤„æ˜¯æˆ‘ä»¬<strong>ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆæ—¶å€™éœ€è¦é˜»å¡çº¿ç¨‹</strong>ï¼Œ<strong>ä»€ä¹ˆæ—¶å€™éœ€è¦å”¤é†’çº¿ç¨‹</strong>ï¼Œå› ä¸ºè¿™ä¸€åˆ‡ BlockingQueue éƒ½ç»™ä½ ä¸€æ‰‹åŒ…åŠ</li>
<li>åœ¨ concurrent åŒ…å‘å¸ƒä»¥å‰ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬<strong>æ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»å»è‡ªå·±æ§åˆ¶è¿™äº›ç»†èŠ‚ï¼Œå°¤å…¶è¿˜è¦å…¼é¡¾æ•ˆç‡å’Œçº¿ç¨‹å®‰å…¨</strong>ï¼Œè€Œè¿™ä¼šç»™æˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥ä¸å°çš„å¤æ‚åº¦ã€‚</li>
</ul>
</li>
</ul>
<h3 id="æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ-ğŸ“š"><a href="#æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ-ğŸ“š" class="headerlink" title="æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ ğŸ“š"></a>æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ ğŸ“š</h3><ul>
<li><p>æ¶æ„ä»‹ç»</p>
<img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192734518.png" alt="image-20210413192734518" style="zoom:200%;"></li>
<li><p>ç§ç±»åˆ†æ</p>
<ul>
<li>ArrayBlockingQueueï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingQueueï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸º integer.MAX_VALUEï¼‰é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>DelayQueueï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ã€‚</li>
<li>LinkedTransferQueueï¼šç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingDequeï¼šç”±é“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li>
</ul>
</li>
</ul>
<h3 id="BlockingQueue-æ ¸å¿ƒæ–¹æ³•-ğŸ’ "><a href="#BlockingQueue-æ ¸å¿ƒæ–¹æ³•-ğŸ’ " class="headerlink" title="BlockingQueue æ ¸å¿ƒæ–¹æ³• ğŸ’ "></a>BlockingQueue æ ¸å¿ƒæ–¹æ³• ğŸ’ </h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192944228.png" alt="image-20210413192944228"></p>
<table>
<thead>
<tr>
<th>æ–¹æ³•ç±»å‹</th>
<th align="center">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>æŠ›å‡ºå¼‚å¸¸</td>
<td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œ add æ’å…¥å…ƒç´ ä¼šæŠ› IllegalStateException:Queue full å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œ remove ç§»é™¤å…ƒç´ ä¼šæŠ› NoSuchElementException</td>
</tr>
<tr>
<td>ç‰¹æ®Šå€¼</td>
<td align="center">æ’å…¥æ–¹æ³•ï¼ŒæˆåŠŸ ture å¤±è´¥ false ç§»é™¤æ–¹æ³•ï¼ŒæˆåŠŸè¿”å›å‡ºé˜Ÿåˆ—çš„å…ƒç´ ï¼Œé˜Ÿåˆ—é‡Œæ²¡æœ‰å°±è¿”å› null</td>
</tr>
<tr>
<td>ä¸€ç›´é˜»å¡</td>
<td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç»§ç»­å¾€é˜Ÿåˆ—é‡Œ put å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ç›´åˆ° put æ•°æ® or å“åº”ä¸­æ–­é€€å‡º å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»é˜Ÿåˆ—é‡Œ take å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ç›´åˆ°é˜Ÿåˆ—å¯ç”¨</td>
</tr>
<tr>
<td>è¶…æ—¶é€€å‡º</td>
<td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€å®šæ—¶é—´ï¼Œè¶…è¿‡é™æ—¶åç”Ÿäº§è€…çº¿ç¨‹ä¼šé€€å‡º</td>
</tr>
</tbody></table>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockingQueueDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//        List list = new ArrayList();</span></span><br><span class="line"></span><br><span class="line">        BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ç»„</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.element());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//System.out.println(blockingQueue.add(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//    ç¬¬äºŒç»„</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//    ç¬¬ä¸‰ç»„</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;a&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;c&quot;);</span></span><br><span class="line">        <span class="comment">//         //blockingQueue.put(&quot;x&quot;);</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//    ç¬¬å››ç»„</span></span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>,<span class="number">3L</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ThreadPool-çº¿ç¨‹æ± -ğŸŒŠ"><a href="#ThreadPool-çº¿ç¨‹æ± -ğŸŒŠ" class="headerlink" title="ThreadPool çº¿ç¨‹æ±  ğŸŒŠ"></a>ThreadPool çº¿ç¨‹æ±  ğŸŒŠ</h2><h3 id="ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ± -â“"><a href="#ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ± -â“" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ±  â“"></a>ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ±  â“</h3><h4 id="ä¸¾ä¸ªæ —å­-ğŸŒ°-1"><a href="#ä¸¾ä¸ªæ —å­-ğŸŒ°-1" class="headerlink" title="ä¸¾ä¸ªæ —å­ ğŸŒ°"></a>ä¸¾ä¸ªæ —å­ ğŸŒ°</h4><ul>
<li>10 å¹´å‰å•æ ¸ CPU ç”µè„‘ï¼Œå‡çš„å¤šçº¿ç¨‹ï¼Œåƒé©¬æˆå›¢å°ä¸‘ç©å¤šä¸ªçƒï¼ŒCPU éœ€è¦æ¥å›åˆ‡æ¢ã€‚</li>
<li>ç°åœ¨æ˜¯å¤šæ ¸ç”µè„‘ï¼Œå¤šä¸ªçº¿ç¨‹å„è‡ªè·‘åœ¨ç‹¬ç«‹çš„ CPU ä¸Šï¼Œä¸ç”¨åˆ‡æ¢æ•ˆç‡é«˜ã€‚</li>
</ul>
<h4 id="çº¿ç¨‹æ± çš„ä¼˜åŠ¿-ğŸ‘"><a href="#çº¿ç¨‹æ± çš„ä¼˜åŠ¿-ğŸ‘" class="headerlink" title="çº¿ç¨‹æ± çš„ä¼˜åŠ¿ ğŸ‘"></a>çº¿ç¨‹æ± çš„ä¼˜åŠ¿ ğŸ‘</h4><blockquote>
<p>çº¿ç¨‹æ± åšçš„å·¥ä½œåªè¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œ<strong>å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</strong>ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œ<strong>å¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™</strong>ï¼Œç­‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>
</blockquote>
<p><strong>å®ƒçš„ä¸»è¦ç‰¹ç‚¹ä¸ºï¼š</strong></p>
<blockquote>
<ol>
<li><strong>çº¿ç¨‹å¤ç”¨</strong></li>
<li><strong>æ§åˆ¶æœ€å¤§å¹¶å‘æ•°</strong></li>
<li><strong>ç®¡ç†çº¿ç¨‹</strong></li>
</ol>
</blockquote>
<ul>
<li><strong>é™ä½èµ„æºæ¶ˆè€—ï¼š</strong>é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€è€—ã€‚</li>
<li><strong>æé«˜å“åº”é€Ÿåº¦ï¼š</strong>å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li>
<li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼š</strong>çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šé”€è€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li>
</ul>
<h3 id="æ€ä¹ˆç”¨-ğŸ¦¾"><a href="#æ€ä¹ˆç”¨-ğŸ¦¾" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ¦¾"></a>æ€ä¹ˆç”¨ ğŸ¦¾</h3><h4 id="æ¶æ„è¯´æ˜"><a href="#æ¶æ„è¯´æ˜" class="headerlink" title="æ¶æ„è¯´æ˜"></a>æ¶æ„è¯´æ˜</h4><blockquote>
<p>Java ä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡<code>Executor</code>æ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº†<code>Executor</code>ï¼Œ<code>Executors</code>ï¼Œ<code>ExecutorService</code>ï¼Œ<code>ThreadPoolExecutor</code>è¿™å‡ ä¸ªç±»</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618314213310.jpg" alt="graphic" style="zoom:200%;">

<h4 id="ç¼–ç å®ç°"><a href="#ç¼–ç å®ç°" class="headerlink" title="ç¼–ç å®ç°"></a>ç¼–ç å®ç°</h4><ul>
<li><p><strong>FixedThreadPool</strong></p>
<p>å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </p>
<p><code>Executors.newFixedThreadPool(int)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newFixedThreadPool</code>åˆ›å»ºçš„çº¿ç¨‹æ± <code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>å€¼æ˜¯ç›¸ç­‰çš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>LinkedBlockingQueue</code></p>
<p>æ‰§è¡Œé•¿æœŸä»»åŠ¡æ€§èƒ½å¥½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œ ä¸€æ± æœ‰ N ä¸ªå›ºå®šçš„çº¿ç¨‹ï¼Œæœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹</p>
</li>
<li><p><strong>SingleThreadExecutor</strong></p>
<p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œä¸€æ± ä¸€çº¿ç¨‹</p>
<p><code>Executors.newSingleThreadExecutor()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newSingleThreadExecutor </code>åˆ›å»ºçš„çº¿ç¨‹æ± <code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>å€¼éƒ½æ˜¯ 1ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>LinkedBlockingQueue</code></p>
</li>
<li><p><strong>CachedThreadPool</strong></p>
<p>å¯ä»¥åŠ¨æ€ä¿®æ”¹çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± </p>
<p><code>Executors.newCachedThreadPool()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newCachedThreadPool</code>åˆ›å»ºçš„çº¿ç¨‹æ± å°†<code>corePoolSize</code>è®¾ç½®ä¸º 0ï¼Œå°†<code>maximumPoolSize</code>è®¾ç½®ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>SynchronousQueue</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œï¼Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡ 60 ç§’ï¼Œå°±é”€æ¯çº¿ç¨‹ã€‚</p>
<p>æ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œ ä½†åœ¨å…ˆå‰æ„å»ºçš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚å¯æ‰©å®¹ï¼Œé‡å¼ºåˆ™å¼º</p>
</li>
<li><p><strong>ä¸¾ä¾‹ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//å›ºå®šæ•°çš„çº¿ç¨‹æ± ï¼Œä¸€æ± äº”çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ5ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ1ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        ExecutorService threadPool =  Executors.newCachedThreadPool(); <span class="comment">//ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œå¯æ‰©å±•å—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£"><a href="#ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£" class="headerlink" title="ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£"></a>ä½¿ç”¨<code>Executors</code>å·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£</h4><blockquote>
<p>å…¶å®ä½¿ç”¨<code>Executors</code>å·¥å…·ç±»åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œå®é™…ä¸Šéƒ½æ˜¯æ“ä½œçš„<code>ThreadPoolExecutor</code>ç±»æ¥åˆ›å»ºçš„çº¿ç¨‹æ± </p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413195750394.png" alt="image-20210413195750394"></p>
<h3 id="çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•°-ğŸ’¨"><a href="#çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•°-ğŸ’¨" class="headerlink" title="çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•° ğŸ’¨"></a>çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•° ğŸ’¨</h3><blockquote>
<p>å°±æ˜¯åˆ›å»º<code>ThreadPoolExecutor</code>ç±»æ‰€éœ€çš„ 7 ä¸ªå±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ThreadPoolExecutorç±»çš„æ„é€ å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>corePoolSizeï¼š</strong>çº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± ä¸­èƒ½å¤Ÿå®¹çº³åŒæ—¶ æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤å€¼å¿…é¡»å¤§äºç­‰äº 1</li>
<li><strong>keepAliveTime</strong>ï¼šå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ å½“å‰æ± ä¸­çº¿ç¨‹æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå½“ç©ºé—²æ—¶é—´ è¾¾åˆ° keepAliveTime æ—¶ï¼Œå¤šä½™çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ° åªå‰©ä¸‹ corePoolSize ä¸ªçº¿ç¨‹ä¸ºæ­¢</li>
<li><strong>unit</strong>ï¼škeepAliveTime çš„å•ä½</li>
<li><strong>workQueue</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡</li>
<li><strong>threadFactory</strong>ï¼šè¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œ ç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤çš„å³å¯</li>
<li><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ï¼Œè¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äº ç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰æ—¶å¦‚ä½•æ¥æ‹’ç» è¯·æ±‚æ‰§è¡Œçš„ runnable çš„ç­–ç•¥</li>
</ol>
<h3 id="çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†-ğŸ”"><a href="#çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†-ğŸ”" class="headerlink" title="çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç† ğŸ”"></a>çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç† ğŸ”</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001.jpg" alt="graphic"><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003.jpg" alt="graphic"></p>
<p>==<strong>ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â—</strong>==</p>
<ol>
<li>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œå¼€å§‹<strong>ç­‰å¾…è¯·æ±‚</strong>ã€‚</li>
<li>å½“è°ƒç”¨**<code>execute()</code><strong>æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå‡º</strong>å¦‚ä¸‹åˆ¤æ–­**ï¼š<ol>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„<strong>çº¿ç¨‹æ•°é‡å°äº <code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆ</strong>é©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡</strong>ï¼›</li>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„<strong>çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº<code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡</strong>æ”¾å…¥é˜Ÿåˆ—</strong>ï¼›</li>
<li>å¦‚æœè¿™ä¸ªæ—¶å€™<strong>é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äº<code>maximumPoolSize</code><strong>ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦</strong>åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡</strong>ï¼›</li>
<li>å¦‚æœ<strong>é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº<code>maximumPoolSize</code><strong>ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨</strong>é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œ</strong>ã€‚</li>
</ol>
</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼š<strong>ä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ</strong>ã€‚</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹<strong>æ— äº‹å¯åš</strong>è¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆ**<code>keepAliveTime</code>**ï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­ï¼š<ol>
<li>å¦‚æœå½“å‰<strong>è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº<code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«</strong>åœæ‰</strong>ã€‚</li>
<li>æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°**<code>corePoolSize</code>**çš„å¤§å°ã€‚</li>
</ol>
</li>
</ol>
<h3 id="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥-â¸"><a href="#çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥-â¸" class="headerlink" title="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ â¸"></a>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ â¸</h3><h4 id="æ˜¯ä»€ä¹ˆ-â“-3"><a href="#æ˜¯ä»€ä¹ˆ-â“-3" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h4><blockquote>
<p><strong>ç­‰å¾…é˜Ÿåˆ—å·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†</strong>ã€‚åŒæ—¶ï¼Œ<strong>çº¿ç¨‹æ± ä¸­çš„ max çº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡</strong>ã€‚è¿™ä¸ªæ˜¯æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<ul>
<li>JDK å†…ç½®çš„æ‹’ç»ç­–ç•¥<ul>
<li><strong>AbortPolicy(é»˜è®¤)ï¼š</strong>ç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</li>
<li><strong>CallerRunsPolicyï¼š</strong>â€œè°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ã€‚</li>
<li><strong>DiscardOldestPolicyï¼š</strong>æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ äººé˜Ÿåˆ—ä¸­ å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li>
<li><strong>DiscardPolicyï¼š</strong>è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§ç­–ç•¥ã€‚</li>
</ul>
</li>
<li>ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº† <code>RejectedExecutionHandle</code>æ¥å£</li>
</ul>
<h3 id="çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜-â“"><a href="#çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜-â“" class="headerlink" title="çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜ â“"></a>çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜ â“</h3><h4 id="åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘"><a href="#åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘" class="headerlink" title="åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘"></a>åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘</h4><p>==<strong>ç­”æ¡ˆæ˜¯ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œæˆ‘ä»¬å·¥ä½œä¸­åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„</strong>==</p>
<p>Executors ä¸­ JDK å·²ç»ç»™ä½ æä¾›äº†ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ï¼Ÿ</p>
<p>é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œä¸­è§„å®š</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413202451128.png" alt="image-20210413202451128"></p>
<h4 id="åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± "><a href="#åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± " class="headerlink" title="åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± "></a>åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="number">5</span>,</span><br><span class="line">            <span class="number">2L</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">3</span>),</span><br><span class="line">            Executors.defaultThreadFactory(),</span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.AbortPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.CallerRunsPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.DiscardOldestPolicy()</span></span><br><span class="line">            <span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy()</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">threadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//å›ºå®šæ•°çš„çº¿ç¨‹æ± ï¼Œä¸€æ± äº”çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ5ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ1ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        ExecutorService threadPool = Executors.newCachedThreadPool(); <span class="comment">//ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œå¯æ‰©å±•å—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æ”¯åˆå¹¶æ¡†æ¶-ğŸ”±"><a href="#åˆ†æ”¯åˆå¹¶æ¡†æ¶-ğŸ”±" class="headerlink" title="åˆ†æ”¯åˆå¹¶æ¡†æ¶ ğŸ”±"></a>åˆ†æ”¯åˆå¹¶æ¡†æ¶ ğŸ”±</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-4"><a href="#æ˜¯ä»€ä¹ˆ-â“-4" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><blockquote>
<p>å¯ä»¥å°†ä»»åŠ¡è¿›è¡Œåˆ†å‘å¹¶å¯ç”¨ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œå¯ä»¥ç†è§£æˆå¤šçº¿ç¨‹ç‰ˆçš„é€’å½’,å› ä¸ºåœ¨æ‰§è¡Œæ¨¡å‹ä¸Šè¿˜æŒºåƒçš„</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413203059515.png" alt="image-20210413203059515"></p>
<p><strong>ä¸»è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</strong></p>
<ul>
<li>Forkï¼šæŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡è¿›è¡Œåˆ†æ‹†ï¼Œå¤§äº‹åŒ–å°</li>
<li>Joinï¼šæŠŠåˆ†æ‹†ä»»åŠ¡çš„ç»“æœè¿›è¡Œåˆå¹¶</li>
</ul>
<h3 id="ç›¸å…³ç±»-ğŸ™„"><a href="#ç›¸å…³ç±»-ğŸ™„" class="headerlink" title="ç›¸å…³ç±» ğŸ™„"></a>ç›¸å…³ç±» ğŸ™„</h3><h4 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001-1618317139087.jpg" alt="graphic"></p>
<p>åˆ†æ”¯åˆå¹¶æ±  ç±»æ¯”=&gt; çº¿ç¨‹æ± </p>
<h4 id="ForkJoinTask"><a href="#ForkJoinTask" class="headerlink" title="ForkJoinTask"></a>ForkJoinTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618317139089.jpg" alt="graphic"></p>
<p>ForkJoinTask ç±»æ¯”=&gt; FutureTask</p>
<h4 id="RecursiveTask"><a href="#RecursiveTask" class="headerlink" title="RecursiveTask"></a>RecursiveTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003-1618317139089.jpg" alt="graphic"></p>
<p>é€’å½’ä»»åŠ¡ï¼šç»§æ‰¿åå¯ä»¥å®ç°é€’å½’(è‡ªå·±è°ƒè‡ªå·±)è°ƒç”¨çš„ä»»åŠ¡</p>
<h3 id="ä»£ç ä¸¾ä¾‹-ğŸ‘©â€ğŸ’»"><a href="#ä»£ç ä¸¾ä¾‹-ğŸ‘©â€ğŸ’»" class="headerlink" title="ä»£ç ä¸¾ä¾‹ ğŸ‘©â€ğŸ’»"></a>ä»£ç ä¸¾ä¾‹ ğŸ‘©â€ğŸ’»</h3><h4 id="å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—"></a>å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> n;</span><br><span class="line">    Fibonacci(<span class="keyword">int</span> n) &#123; <span class="keyword">this</span>.n = n; &#125;</span><br><span class="line">    <span class="function">Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        Fibonacci f1 = <span class="keyword">new</span> Fibonacci(n - <span class="number">1</span>);</span><br><span class="line">        f1.fork();</span><br><span class="line">        Fibonacci f2 = <span class="keyword">new</span> Fibonacci(n - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> f2.compute() + f1.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°ä¸€åŠ åˆ°ä¸€ç™¾"><a href="#å®ç°ä¸€åŠ åˆ°ä¸€ç™¾" class="headerlink" title="å®ç°ä¸€åŠ åˆ°ä¸€ç™¾"></a>å®ç°ä¸€åŠ åˆ°ä¸€ç™¾</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ADJUST_VALUE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> begin;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.begin = begin;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((end - begin)&lt;=ADJUST_VALUE)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =begin;i &lt;= end;i++)&#123;</span><br><span class="line">                result = result + i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> middle = (begin + end)/<span class="number">2</span>;</span><br><span class="line">            MyTask task01 = <span class="keyword">new</span> MyTask(begin,middle);</span><br><span class="line">            MyTask task02 = <span class="keyword">new</span> MyTask(middle+<span class="number">1</span>,end);</span><br><span class="line">            task01.fork();</span><br><span class="line">            task02.fork();</span><br><span class="line">            result =  task01.join() + task02.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ”¯åˆå¹¶ä¾‹å­</span></span><br><span class="line"><span class="comment"> * ForkJoinPool</span></span><br><span class="line"><span class="comment"> * ForkJoinTask</span></span><br><span class="line"><span class="comment"> * RecursiveTask</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForkJoinDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyTask myTask = <span class="keyword">new</span> MyTask(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        ForkJoinTask&lt;Integer&gt; forkJoinTask = forkJoinPool.submit(myTask);</span><br><span class="line"></span><br><span class="line">        System.out.println(forkJoinTask.get());</span><br><span class="line"></span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚æ­¥å›è°ƒ-ğŸ”"><a href="#å¼‚æ­¥å›è°ƒ-ğŸ”" class="headerlink" title="å¼‚æ­¥å›è°ƒ ğŸ”"></a>å¼‚æ­¥å›è°ƒ ğŸ”</h2><blockquote>
<p>è¿™ä¸ªå¾ˆç®€å•å•¦,å°±æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¼‚æ­¥çš„è°ƒç”¨ä½ æ‰€å†™çš„æ–¹æ³•,åªä¸è¿‡å¯¹æ‰§è¡Œé€”ä¸­çš„å„ä¸ªç¯èŠ‚æœ‰æä¾›å›è°ƒ,å¯ä»¥çµæ´»çš„å¤„ç†,æ¯”å¦‚å‡ºç°å¼‚å¸¸ä¼šè°ƒç”¨<code>exceptionally</code>å‡½æ•°ä¸­ä¼ å…¥çš„å›è°ƒå‡½æ•°</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413204257768.png" alt="image-20210413204257768"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œå¼‚æ­¥å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŒæ­¥</span></span><br><span class="line">        <span class="comment">//        CompletableFuture&lt;Void&gt; completableFuture1 = CompletableFuture.runAsync(()-&gt;&#123;</span></span><br><span class="line">        <span class="comment">//            System.out.println(Thread.currentThread().getName()+&quot;\t completableFuture1&quot;);</span></span><br><span class="line">        <span class="comment">//        &#125;);</span></span><br><span class="line">        <span class="comment">//        completableFuture1.get();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t completableFuture2&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        completableFuture2.whenComplete((t,u)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-------t=&quot;</span>+t);</span><br><span class="line">            System.out.println(<span class="string">&quot;-------u=&quot;</span>+u);</span><br><span class="line">        &#125;).exceptionally(f-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----exception:&quot;</span>+f.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">444</span>;</span><br><span class="line">        &#125;).get();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">LLQWQ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/">http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://llqwq.gitee.io" target="_blank">LLQWQçš„åšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/JUC/">JUC</a><a class="post-meta__tags" href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">é«˜å¹¶å‘ç¼–ç¨‹</a></div><div class="post_share"><div class="social-share" data-image="/img/Java-JUC-cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/"><img class="next-cover" data-lazy-src="/img/default_top.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2020/01/05/spring-boot/spring-boot/" title="spring boot å­¦ä¹ ç¬”è®°"><img class="cover" data-lazy-src="/img/Spring-Boot.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-05</div><div class="title">spring boot å­¦ä¹ ç¬”è®°</div></div></a></div><div><a href="/2020/07/05/spring-cloud/spring-cloud/" title="Spring Cloud å­¦ä¹ ç¬”è®°"><img class="cover" data-lazy-src="/img/spring-cloud-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">Spring Cloud å­¦ä¹ ç¬”è®°</div></div></a></div><div><a href="/2020/02/05/spring-boot/é”™è¯¯æ•´ç†/" title="Spring-Boot é”™è¯¯è®°å½•"><img class="cover" data-lazy-src="/img/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-02-05</div><div class="title">Spring-Boot é”™è¯¯è®°å½•</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/48668845.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">LLQWQ</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">14</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">30</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LLQWQ"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LLQWQ" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://gitee.com/LLQWQ" target="_blank" title="Gitee"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JUC-%E6%98%AF%E4%BB%80%E4%B9%88-%F0%9F%98%A6"><span class="toc-number">1.</span> <span class="toc-text">JUC æ˜¯ä»€ä¹ˆ ğŸ˜¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B%E5%9B%9E%E9%A1%BE-%F0%9F%98%85"><span class="toc-number">1.1.</span> <span class="toc-text">è¿›ç¨‹&#x2F;çº¿ç¨‹å›é¡¾ ğŸ˜…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F-%E2%9D%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">è¿›ç¨‹&#x2F;çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ â“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90-%F0%9F%8C%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">ä¸¾ä¸ªæ —å­ ğŸŒ°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81-%F0%9F%98%B4"><span class="toc-number">1.1.3.</span> <span class="toc-text">çº¿ç¨‹çš„çŠ¶æ€ ğŸ˜´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wait-sleep-%E7%9A%84%E5%8C%BA%E5%88%AB-%F0%9F%98%A6"><span class="toc-number">1.1.4.</span> <span class="toc-text">wait&#x2F;sleep çš„åŒºåˆ« ğŸ˜¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E8%A1%8C%EF%BC%9F%F0%9F%A4%94"><span class="toc-number">1.1.5.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lock-%E6%8E%A5%E5%8F%A3-%F0%9F%94%92"><span class="toc-number">2.</span> <span class="toc-text">Lock æ¥å£ ğŸ”’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0-Synchronized%F0%9F%98%B3"><span class="toc-number">2.1.</span> <span class="toc-text">å¤ä¹  SynchronizedğŸ˜³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E2%9D%93"><span class="toc-number">2.2.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆï¼Ÿâ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%94%A7"><span class="toc-number">2.3.</span> <span class="toc-text">æ€ä¹ˆç”¨ ğŸ”§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lock-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0-ReentrantLock-%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">Lock æ¥å£çš„å®ç° ReentrantLock å¯é‡å…¥é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized-%E4%B8%8E-Lock-%E7%9A%84%E5%8C%BA%E5%88%AB-%F0%9F%98%A6"><span class="toc-number">2.4.</span> <span class="toc-text">synchronized ä¸ Lock çš„åŒºåˆ« ğŸ˜¦</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%F0%9F%93%9E"><span class="toc-number">3.</span> <span class="toc-text">çº¿ç¨‹é—´é€šä¿¡ ğŸ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%89%93%E5%8D%B0-%F0%9F%93%9D"><span class="toc-number">3.1.</span> <span class="toc-text">é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å° ğŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%B0-4-%E4%B8%AA%E7%BA%BF%E7%A8%8B-%F0%9F%86%99"><span class="toc-number">3.2.</span> <span class="toc-text">å¢åŠ åˆ° 4 ä¸ªçº¿ç¨‹ ğŸ†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java8-%E6%96%B0%E7%89%88%E5%AE%9E%E7%8E%B0-%F0%9F%86%95"><span class="toc-number">3.3.</span> <span class="toc-text">java8 æ–°ç‰ˆå®ç° ğŸ†•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Condition"><span class="toc-number">3.3.1.</span> <span class="toc-text">Condition</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E5%AE%9A%E5%88%B6%E5%8C%96%E8%B0%83%E7%94%A8%E9%80%9A%E4%BF%A1-%F0%9F%92%B1"><span class="toc-number">4.</span> <span class="toc-text">çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡ ğŸ’±</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%E5%A4%9A%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%BE%9D%E6%AC%A1%E6%89%93%E5%8D%B0-%F0%9F%93%9D"><span class="toc-number">4.1.</span> <span class="toc-text">ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å° ğŸ“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Synchronization-%E9%94%81%E9%97%AE%E9%A2%98-%E2%9D%93"><span class="toc-number">5.</span> <span class="toc-text">Synchronization é”é—®é¢˜ â“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E4%B8%AA%E9%97%AE%E9%A2%98-%F0%9F%93%9D"><span class="toc-number">5.1.</span> <span class="toc-text">å…«ä¸ªé—®é¢˜ ğŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E7%AD%94%E6%A1%88-%F0%9F%A4%AB"><span class="toc-number">5.2.</span> <span class="toc-text">é—®é¢˜ç­”æ¡ˆ ğŸ¤«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-%F0%9F%A7%90"><span class="toc-number">5.3.</span> <span class="toc-text">é—®é¢˜åˆ†æ ğŸ§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E9%9B%86%E5%90%88-%F0%9F%9A%A8"><span class="toc-number">6.</span> <span class="toc-text">ä¸å®‰å…¨é›†åˆ ğŸš¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E6%98%8E%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8-%F0%9F%A4%AF"><span class="toc-number">6.1.</span> <span class="toc-text">è¯æ˜çº¿ç¨‹ä¸å®‰å…¨ ğŸ¤¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callable-%E6%8E%A5%E5%8F%A3-%E2%86%A9%EF%B8%8F"><span class="toc-number">7.</span> <span class="toc-text">Callable æ¥å£ â†©ï¸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93"><span class="toc-number">7.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ â“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E8%8E%B7%E5%BE%97%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95%E5%87%A0%E7%A7%8D%EF%BC%9F"><span class="toc-number">7.1.1.</span> <span class="toc-text">é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.1.2.</span> <span class="toc-text">å‡½æ•°å¼æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-Runnable-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AF%B9%E6%AF%94-%F0%9F%98%A6"><span class="toc-number">7.2.</span> <span class="toc-text">ä¸ Runnable æ¥å£çš„å¯¹æ¯” ğŸ˜¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%94%A7-1"><span class="toc-number">7.3.</span> <span class="toc-text">æ€ä¹ˆç”¨ ğŸ”§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%9B%BF%E6%8D%A2-runnable-%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A1%8C%EF%BC%9F"><span class="toc-number">7.3.1.</span> <span class="toc-text">ç›´æ¥æ›¿æ¢ runnable æ˜¯å¦å¯è¡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B2%E7%BA%BF%E6%95%91%E5%9B%BD"><span class="toc-number">7.3.2.</span> <span class="toc-text">æ›²çº¿æ•‘å›½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FutureTask%F0%9F%98%B2"><span class="toc-number">7.4.</span> <span class="toc-text">FutureTaskğŸ˜²</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">7.4.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90"><span class="toc-number">7.4.1.1.</span> <span class="toc-text">ä¸¾ä¸ªæ —å­</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">7.4.1.2.</span> <span class="toc-text">åŸç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JUC-%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB%E8%AE%B2%E8%A7%A3-%F0%9F%A7%B0"><span class="toc-number">8.</span> <span class="toc-text">JUC å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£ ğŸ§°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CountDownLatch-%E5%87%8F%E5%B0%91%E8%AE%A1%E6%95%B0-%E2%9E%96"><span class="toc-number">8.1.</span> <span class="toc-text">CountDownLatch å‡å°‘è®¡æ•° â–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B"><span class="toc-number">8.1.1.</span> <span class="toc-text">åº”ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B"><span class="toc-number">8.1.2.</span> <span class="toc-text">ä»£ç ä¸¾ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CyclicBarrier-%E5%BE%AA%E7%8E%AF%E6%A0%85%E6%A0%8F-%F0%9F%9A%A7"><span class="toc-number">8.2.</span> <span class="toc-text">CyclicBarrier å¾ªç¯æ …æ  ğŸš§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">8.2.1.</span> <span class="toc-text">åº”ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">8.2.2.</span> <span class="toc-text">ä»£ç ä¸¾ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semaphore-%E4%BF%A1%E5%8F%B7%E7%81%AF-%F0%9F%9A%A6"><span class="toc-number">8.3.</span> <span class="toc-text">Semaphore ä¿¡å·ç¯ ğŸš¦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">8.3.1.</span> <span class="toc-text">åº”ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">8.3.2.</span> <span class="toc-text">ä»£ç ä¸¾ä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReentrantReadWriteLock-%E8%AF%BB%E5%86%99%E9%94%81-%F0%9F%94%90"><span class="toc-number">9.</span> <span class="toc-text">ReentrantReadWriteLock è¯»å†™é” ğŸ”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-1"><span class="toc-number">9.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ â“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%BE%E4%BE%8B-%F0%9F%8C%B0"><span class="toc-number">9.2.</span> <span class="toc-text">é—®é¢˜ä¸¾ä¾‹ ğŸŒ°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%BB%E5%86%99%E9%94%81%E7%9A%84%E4%BB%A3%E7%A0%81-%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB"><span class="toc-number">9.3.</span> <span class="toc-text">ä½¿ç”¨è¯»å†™é”çš„ä»£ç  ğŸ‘©â€ğŸ’»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BlockingQueue-%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97-%E2%8F%B3"><span class="toc-number">10.</span> <span class="toc-text">BlockingQueue é˜»å¡é˜Ÿåˆ— â³</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-2"><span class="toc-number">10.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ â“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E7%9A%84%E7%94%A8%E5%A4%84-%F0%9F%A4%94"><span class="toc-number">10.2.</span> <span class="toc-text">é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„ ğŸ¤”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E6%A2%B3%E7%90%86%E3%80%81%E7%A7%8D%E7%B1%BB%E5%88%86%E6%9E%90-%F0%9F%93%9A"><span class="toc-number">10.3.</span> <span class="toc-text">æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ ğŸ“š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BlockingQueue-%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95-%F0%9F%92%A0"><span class="toc-number">10.4.</span> <span class="toc-text">BlockingQueue æ ¸å¿ƒæ–¹æ³• ğŸ’ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ThreadPool-%E7%BA%BF%E7%A8%8B%E6%B1%A0-%F0%9F%8C%8A"><span class="toc-number">11.</span> <span class="toc-text">ThreadPool çº¿ç¨‹æ±  ğŸŒŠ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0-%E2%9D%93"><span class="toc-number">11.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ±  â“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90-%F0%9F%8C%B0-1"><span class="toc-number">11.1.1.</span> <span class="toc-text">ä¸¾ä¸ªæ —å­ ğŸŒ°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BC%98%E5%8A%BF-%F0%9F%91%8D"><span class="toc-number">11.1.2.</span> <span class="toc-text">çº¿ç¨‹æ± çš„ä¼˜åŠ¿ ğŸ‘</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%A6%BE"><span class="toc-number">11.2.</span> <span class="toc-text">æ€ä¹ˆç”¨ ğŸ¦¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">11.2.1.</span> <span class="toc-text">æ¶æ„è¯´æ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.2.2.</span> <span class="toc-text">ç¼–ç å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Executors%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E8%AF%A6%E8%A7%A3"><span class="toc-number">11.2.3.</span> <span class="toc-text">ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0-%F0%9F%92%A8"><span class="toc-number">11.3.</span> <span class="toc-text">çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•° ğŸ’¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%BA%95%E5%B1%82%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%F0%9F%94%8D"><span class="toc-number">11.4.</span> <span class="toc-text">çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç† ğŸ”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5-%E2%8F%B8"><span class="toc-number">11.5.</span> <span class="toc-text">çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ â¸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-3"><span class="toc-number">11.5.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ â“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98-%E2%9D%93"><span class="toc-number">11.6.</span> <span class="toc-text">çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜ â“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%8D%95%E4%B8%80%E7%9A%84-%E5%9B%BA%E5%AE%9A%E6%95%B0%E7%9A%84-%E5%8F%AF%E5%8F%98%E7%9A%84%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%96%B9%E6%B3%95%E5%93%AA%E4%B8%AA%E7%94%A8%E7%9A%84%E5%A4%9A%EF%BC%9F%E8%B6%85%E7%BA%A7%E5%A4%A7%E5%9D%91"><span class="toc-number">11.6.1.</span> <span class="toc-text">åœ¨å·¥ä½œä¸­å•ä¸€çš„&#x2F;å›ºå®šæ•°çš„&#x2F;å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E6%98%AF%E5%90%A6%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">11.6.2.</span> <span class="toc-text">åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E6%A1%86%E6%9E%B6-%F0%9F%94%B1"><span class="toc-number">12.</span> <span class="toc-text">åˆ†æ”¯åˆå¹¶æ¡†æ¶ ğŸ”±</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-4"><span class="toc-number">12.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆ â“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%B1%BB-%F0%9F%99%84"><span class="toc-number">12.2.</span> <span class="toc-text">ç›¸å…³ç±» ğŸ™„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ForkJoinPool"><span class="toc-number">12.2.1.</span> <span class="toc-text">ForkJoinPool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ForkJoinTask"><span class="toc-number">12.2.2.</span> <span class="toc-text">ForkJoinTask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RecursiveTask"><span class="toc-number">12.2.3.</span> <span class="toc-text">RecursiveTask</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB"><span class="toc-number">12.3.</span> <span class="toc-text">ä»£ç ä¸¾ä¾‹ ğŸ‘©â€ğŸ’»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97"><span class="toc-number">12.3.1.</span> <span class="toc-text">å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%8A%A0%E5%88%B0%E4%B8%80%E7%99%BE"><span class="toc-number">12.3.2.</span> <span class="toc-text">å®ç°ä¸€åŠ åˆ°ä¸€ç™¾</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%9B%9E%E8%B0%83-%F0%9F%94%81"><span class="toc-number">13.</span> <span class="toc-text">å¼‚æ­¥å›è°ƒ ğŸ”</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/" title="JUC"><img data-lazy-src="/img/Java-JUC-cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC"/></a><div class="content"><a class="title" href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/" title="JUC">JUC</a><time datetime="2021-04-12T05:58:52.000Z" title="å‘è¡¨äº 2021-04-12 13:58:52">2021-04-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/" title="æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°"><img data-lazy-src="/img/default_top.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°"/></a><div class="content"><a class="title" href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/" title="æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°">æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°</a><time datetime="2020-11-04T16:00:00.000Z" title="å‘è¡¨äº 2020-11-05 00:00:00">2020-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/10/21/MQ/RabbitMQ/RabbitMQ/" title="rabbitMQ å­¦ä¹ ç¬”è®°"><img data-lazy-src="/img/rabbitMQ-cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rabbitMQ å­¦ä¹ ç¬”è®°"/></a><div class="content"><a class="title" href="/2020/10/21/MQ/RabbitMQ/RabbitMQ/" title="rabbitMQ å­¦ä¹ ç¬”è®°">rabbitMQ å­¦ä¹ ç¬”è®°</a><time datetime="2020-10-20T16:00:00.000Z" title="å‘è¡¨äº 2020-10-21 00:00:00">2020-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/" title="rabbitMQ é”™è¯¯è®°å½•"><img data-lazy-src="/img/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rabbitMQ é”™è¯¯è®°å½•"/></a><div class="content"><a class="title" href="/2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/" title="rabbitMQ é”™è¯¯è®°å½•">rabbitMQ é”™è¯¯è®°å½•</a><time datetime="2020-10-20T16:00:00.000Z" title="å‘è¡¨äº 2020-10-21 00:00:00">2020-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/08/14/zookeeper/zookeeper/" title="zookeeper å­¦ä¹ ç¬”è®°"><img data-lazy-src="/img/zookeeper-cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zookeeper å­¦ä¹ ç¬”è®°"/></a><div class="content"><a class="title" href="/2020/08/14/zookeeper/zookeeper/" title="zookeeper å­¦ä¹ ç¬”è®°">zookeeper å­¦ä¹ ç¬”è®°</a><time datetime="2020-08-13T16:00:00.000Z" title="å‘è¡¨äº 2020-08-14 00:00:00">2020-08-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By LLQWQ</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ¬¸å˜¿( â€¢Ì€ Ï‰ â€¢Ì )âœ§</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '62ac94f6f26fbdbc60b4',
      clientSecret: '2aa21994b6d9b95bb5605ed581e6a73c6da34eb5',
      repo: 'llqwq.github.io',
      owner: 'LLQWQ',
      admin: ['LLQWQ'],
      id: 'f83d10a086cd142cafd8a0c81a5c70b4',
      language: 'zh-CN',
      perPage: 15,
      distractionFreeMode: true,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>