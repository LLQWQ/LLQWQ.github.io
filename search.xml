<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JUC</title>
      <link href="2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/"/>
      <url>2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Java ç§ƒå¤´ç³»åˆ—ä¹‹ JUC</p></blockquote><span id="more"></span><h2 id="JUC-æ˜¯ä»€ä¹ˆ-ğŸ˜¦"><a href="#JUC-æ˜¯ä»€ä¹ˆ-ğŸ˜¦" class="headerlink" title="JUC æ˜¯ä»€ä¹ˆ ğŸ˜¦"></a>JUC æ˜¯ä»€ä¹ˆ ğŸ˜¦</h2><blockquote><p><code>java.util.concurrent</code>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ä½¿ç”¨çš„<strong>å·¥å…·ç±»</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image004.jpg" alt="graphic"></p><h3 id="è¿›ç¨‹-çº¿ç¨‹å›é¡¾-ğŸ˜…"><a href="#è¿›ç¨‹-çº¿ç¨‹å›é¡¾-ğŸ˜…" class="headerlink" title="è¿›ç¨‹/çº¿ç¨‹å›é¡¾ ğŸ˜…"></a>è¿›ç¨‹/çº¿ç¨‹å›é¡¾ ğŸ˜…</h3><h4 id="è¿›ç¨‹-çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ-â“"><a href="#è¿›ç¨‹-çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ-â“" class="headerlink" title="è¿›ç¨‹/çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ â“"></a>è¿›ç¨‹/çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ â“</h4><p>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚å®ƒæ˜¯æ“ä½œç³»ç»ŸåŠ¨æ€æ‰§è¡Œçš„åŸºæœ¬å•å…ƒï¼Œåœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ—¢æ˜¯åŸºæœ¬çš„åˆ†é…å•å…ƒï¼Œä¹Ÿæ˜¯åŸºæœ¬çš„æ‰§è¡Œå•å…ƒã€‚</p><p>çº¿ç¨‹ï¼šé€šå¸¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œå½“ç„¶ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç„¶æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚çº¿ç¨‹å¯ä»¥åˆ©ç”¨è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œåœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸éƒ½æ˜¯æŠŠè¿›ç¨‹ä½œä¸ºåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œè€ŒæŠŠçº¿ç¨‹ä½œä¸ºç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œç”±äºçº¿ç¨‹æ¯”è¿›ç¨‹æ›´å°ï¼ŒåŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œæ•…å¯¹å®ƒçš„è°ƒåº¦æ‰€ä»˜å‡ºçš„å¼€é”€å°±ä¼šå°å¾—å¤šï¼Œèƒ½æ›´é«˜æ•ˆçš„æé«˜ç³»ç»Ÿå¤šä¸ªç¨‹åºé—´å¹¶å‘æ‰§è¡Œçš„ç¨‹åº¦ã€‚</p><h4 id="ä¸¾ä¸ªæ —å­-ğŸŒ°"><a href="#ä¸¾ä¸ªæ —å­-ğŸŒ°" class="headerlink" title="ä¸¾ä¸ªæ —å­ ğŸŒ°"></a>ä¸¾ä¸ªæ —å­ ğŸŒ°</h4><ul><li><strong>ä¾‹å­ä¸€ï¼š</strong> ä½¿ç”¨ QQï¼ŒæŸ¥çœ‹è¿›ç¨‹ä¸€å®šæœ‰ä¸€ä¸ª QQ.exe çš„è¿›ç¨‹ï¼Œæˆ‘å¯ä»¥ç”¨ qq å’Œ A æ–‡å­—èŠå¤©ï¼Œå’Œ B è§†é¢‘èŠå¤©ï¼Œç»™ C ä¼ æ–‡ä»¶ï¼Œç»™ D å‘ä¸€æ®µè¯­è¨€ï¼ŒQQ æ”¯æŒå½•å…¥ä¿¡æ¯çš„æœç´¢ã€‚</li><li><strong>ä¾‹å­äºŒï¼š</strong> å¤§å››çš„æ—¶å€™å†™è®ºæ–‡ï¼Œç”¨ word å†™è®ºæ–‡ï¼ŒåŒæ—¶ç”¨ QQ éŸ³ä¹æ”¾éŸ³ä¹ï¼ŒåŒæ—¶ç”¨ QQ èŠå¤©ï¼Œå¤šä¸ªè¿›ç¨‹ã€‚</li><li><strong>ä¾‹å­ä¸‰ï¼š</strong> word å¦‚æ²¡æœ‰ä¿å­˜ï¼Œåœç”µå…³æœºï¼Œå†é€šç”µåæ‰“å¼€ word å¯ä»¥æ¢å¤ä¹‹å‰æœªä¿å­˜çš„æ–‡æ¡£ï¼Œword ä¹Ÿä¼šæ£€æŸ¥ä½ çš„æ‹¼å†™ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼šå®¹ç¾å¤‡ä»½ï¼Œè¯­æ³•æ£€æŸ¥</li></ul><h4 id="çº¿ç¨‹çš„çŠ¶æ€-ğŸ˜´"><a href="#çº¿ç¨‹çš„çŠ¶æ€-ğŸ˜´" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€ ğŸ˜´"></a>çº¿ç¨‹çš„çŠ¶æ€ ğŸ˜´</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/Java+%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%8F%98%E8%BF%81.png" alt="Java çº¿ç¨‹çŠ¶æ€å˜è¿ "></p><p>åœ¨ Java ä¸­æˆ‘ä»¬åªèƒ½å¾—åˆ°çº¿ç¨‹ä»¥ä¸‹çš„çº¿ç¨‹çŠ¶æ€ï¼š</p><ul><li>new</li><li>runnable</li><li>blocked</li><li>waiting</li><li>time_waiting</li><li>terminated</li></ul><blockquote><p>æ“ä½œç³»ç»Ÿéšè— Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ RUNNABLE å’Œ RUNNING çŠ¶æ€ï¼Œå®ƒåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€ï¼Œæ‰€ä»¥ Java ç³»ç»Ÿä¸€èˆ¬å°†è¿™ä¸¤ä¸ªçŠ¶æ€ç»Ÿç§°ä¸º <strong>RUNNABLEï¼ˆè¿è¡Œä¸­ï¼‰</strong> çŠ¶æ€ ã€‚</p></blockquote><h4 id="wait-sleep-çš„åŒºåˆ«-ğŸ˜¦"><a href="#wait-sleep-çš„åŒºåˆ«-ğŸ˜¦" class="headerlink" title="wait/sleep çš„åŒºåˆ« ğŸ˜¦"></a>wait/sleep çš„åŒºåˆ« ğŸ˜¦</h4><ul><li>waitï¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶<strong>é‡Šæ”¾é”</strong>ï¼ˆæ”¾å¼€æ‰‹å»ç¡ï¼Œæ”¾å¼€æ‰‹é‡Œçš„é”ï¼‰</li><li>sleepï¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ<strong>ä¸é‡Šæ”¾é”</strong>ï¼ˆæ¡ç´§æ‰‹å»ç¡ï¼Œé†’äº†æ‰‹é‡Œè¿˜æœ‰é”ï¼‰</li></ul><h4 id="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”"><a href="#ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”"></a>ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ŸğŸ¤”</h4><ul><li>å¹¶å‘ï¼šåŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åœ¨è®¿é—®åŒä¸€ä¸ªèµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªç‚¹ï¼ˆCPU åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åå¤æ¨ªè·³ï¼‰</li><li>å¹¶è¡Œï¼šå¤šé¡¹å·¥ä½œä¸€èµ·æ‰§è¡Œï¼Œä¹‹åå†æ±‡æ€»ï¼ˆå¤šä¸ª CPU åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ª CPU è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼‰</li></ul><h2 id="Lock-æ¥å£-ğŸ”’"><a href="#Lock-æ¥å£-ğŸ”’" class="headerlink" title="Lock æ¥å£ ğŸ”’"></a>Lock æ¥å£ ğŸ”’</h2><h3 id="å¤ä¹ -SynchronizedğŸ˜³"><a href="#å¤ä¹ -SynchronizedğŸ˜³" class="headerlink" title="å¤ä¹  SynchronizedğŸ˜³"></a>å¤ä¹  SynchronizedğŸ˜³</h3><p><strong>ä¹°ç¥¨ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String name = Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;ä¹°ç¥¨å¤±è´¥ï¼Œæ²¡æœ‰ç¥¨å•¦&quot;</span>;</span><br><span class="line">        ticket--;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;å”®å‡ºä¸€å¼ ç¥¨ï¼Œè¿˜å‰©ï¼š&quot;</span> + ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº”ä¸ªçº¿ç¨‹å»ä¹°ç¥¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ¯ä¸ªçº¿ç¨‹ä¹°10æ¬¡ç¥¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                x.sell();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ä¼‘æ¯ä¸€ä¸‹ï¼ŒCPUæ ¸æ•°å¤ªå¤šäº†ï¼Œä¸ä¼‘æ¯çœ‹ä¸å‡ºæ¥ç¥¨è¢«æŠ¢å¤º</span></span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;çª—å£&quot;</span> + j).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ˜¯ä»€ä¹ˆï¼Ÿâ“"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿâ“" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿâ“"></a>æ˜¯ä»€ä¹ˆï¼Ÿâ“</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277453136.jpg" alt="graphic"></p><blockquote><p>Lock implementations provide more extensive locking operations than can be obtained using synchronized methods and statements. They allow more flexible structuring, may have quite different properties, and may support multiple associated Condition objects.</p><p>ç¿»è¯‘ï¼šé”å®ç°æä¾›äº†æ¯”ä½¿ç”¨åŒæ­¥æ–¹æ³•å’Œè¯­å¥å¯ä»¥è·å¾—çš„æ›´å¹¿æ³›çš„é”æ“ä½œã€‚å®ƒä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯èƒ½å…·æœ‰éå¸¸ä¸åŒçš„å±æ€§ï¼Œå¹¶ä¸”å¯èƒ½æ”¯æŒå¤šä¸ªå…³è”çš„æ¡ä»¶å¯¹è±¡ã€‚</p></blockquote><h3 id="æ€ä¹ˆç”¨-ğŸ”§"><a href="#æ€ä¹ˆç”¨-ğŸ”§" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ”§"></a>æ€ä¹ˆç”¨ ğŸ”§</h3><blockquote><p>Lock æ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œæˆ‘ä»¬ä»¥ ReentrantLock ä¸ºä¾‹</p></blockquote><h4 id="Lock-æ¥å£çš„å®ç°-ReentrantLock-å¯é‡å…¥é”"><a href="#Lock-æ¥å£çš„å®ç°-ReentrantLock-å¯é‡å…¥é”" class="headerlink" title="Lock æ¥å£çš„å®ç° ReentrantLock å¯é‡å…¥é”"></a>Lock æ¥å£çš„å®ç° ReentrantLock å¯é‡å…¥é”</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277530938.jpg" alt="graphic"></p><p>çœ‹çœ‹å®˜ç½‘æ–‡æ¡£çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     lock.lock();  <span class="comment">// block until condition holds</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">// ... method body</span></span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock()</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ReentrantLock</code>å®ç°ä¹°ç¥¨ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–ç¥¨æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = Thread.currentThread().getName();</span><br><span class="line">            <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;ä¹°ç¥¨å¤±è´¥ï¼Œæ²¡æœ‰ç¥¨å•¦&quot;</span>;</span><br><span class="line">            ticket--;</span><br><span class="line">            System.out.println(name + <span class="string">&quot;å”®å‡ºä¸€å¼ ç¥¨ï¼Œè¿˜å‰©ï¼š&quot;</span> + ticket);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">        <span class="comment">// åˆ›å»ºäº”ä¸ªçº¿ç¨‹å»ä¹°ç¥¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// æ¯ä¸ªçº¿ç¨‹ä¹°10æ¬¡ç¥¨</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    x.sell();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// ä¼‘æ¯ä¸€ä¸‹ï¼ŒCPUæ ¸æ•°å¤ªå¤šäº†ï¼Œä¸ä¼‘æ¯çœ‹ä¸å‡ºæ¥ç¥¨è¢«æŠ¢å¤º</span></span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;çª—å£&quot;</span> + j).start();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="synchronized-ä¸-Lock-çš„åŒºåˆ«-ğŸ˜¦"><a href="#synchronized-ä¸-Lock-çš„åŒºåˆ«-ğŸ˜¦" class="headerlink" title="synchronized ä¸ Lock çš„åŒºåˆ« ğŸ˜¦"></a>synchronized ä¸ Lock çš„åŒºåˆ« ğŸ˜¦</h3><p><strong>ä¸¤è€…åŒºåˆ«ï¼š</strong></p><ol><li>é¦–å…ˆ<code>synchronized</code>æ˜¯<strong>java å†…ç½®å…³é”®å­—</strong>ï¼Œåœ¨ jvm å±‚é¢ï¼Œ<strong>Lock æ˜¯ä¸ª java ç±»</strong>ï¼›</li><li><code>synchronized</code><strong>æ— æ³•</strong>åˆ¤æ–­æ˜¯å¦è·å–é”çš„çŠ¶æ€ï¼Œ<code>Lock</code><strong>å¯ä»¥</strong>åˆ¤æ–­æ˜¯å¦è·å–åˆ°é”ï¼›</li><li><code>synchronized</code>ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾é”</strong>(a çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ä¼šé‡Šæ”¾é” ï¼›b çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¼šé‡Šæ”¾é”)ï¼Œ<code>Lock</code>éœ€åœ¨ finally ä¸­<strong>æ‰‹å·¥é‡Šæ”¾é”</strong>ï¼ˆunlock()æ–¹æ³•é‡Šæ”¾é”ï¼‰ï¼Œå¦åˆ™å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é”ï¼›</li><li>ç”¨<code>synchronized</code>å…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ 1 è·å¾—é”ï¼Œçº¿ç¨‹ 2 çº¿ç¨‹ç­‰å¾…ã€‚<strong>å¦‚æœçº¿ç¨‹ 1 é˜»å¡ï¼Œçº¿ç¨‹ 2 åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»</strong>ï¼Œè€Œ Lock é”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œ<strong>å¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†</strong>ï¼›</li><li><code>synchronized</code>çš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€Œ<code>Lock</code>é”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰</li><li><code>Lock</code>é”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œ<code>synchronized</code>é”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ã€‚</li></ol><h2 id="çº¿ç¨‹é—´é€šä¿¡-ğŸ“"><a href="#çº¿ç¨‹é—´é€šä¿¡-ğŸ“" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡ ğŸ“"></a>çº¿ç¨‹é—´é€šä¿¡ ğŸ“</h2><h3 id="é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å°-ğŸ“"><a href="#é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å°-ğŸ“" class="headerlink" title="é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å° ğŸ“"></a>é¢è¯•é¢˜ï¼šä¸¤ä¸ªçº¿ç¨‹æ‰“å° ğŸ“</h3><p>âœ ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰“å°æ•°å­— 1-52ï¼Œå¦ä¸€ä¸ªæ‰“å°å­—æ¯ A-Z æ‰“å°é¡ºåºä¸º 12A34Bâ€¦5152Z</p><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç”Ÿäº§è€…+æ¶ˆè´¹è€…</li><li>é€šçŸ¥ç­‰å¾…å”¤é†’æœºåˆ¶</li></ul><p>å®ç°ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCommunication</span> </span>&#123;</span><br><span class="line">    <span class="comment">// falseï¼šæ‰“å°æ•°å­—ï¼Œtrueï¼šæ‰“å°å­—æ¯</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// è®°å½•æ•°å­—</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è®°å½•å­—æ¯</span></span><br><span class="line">    <span class="keyword">int</span> letter = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°æ•°å­—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printNumber</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸ºtrueå…ˆä¼‘çœ ï¼Œè®©å­—æ¯å…ˆæ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°äº†52å°±é€€å‡ºå¹¶å”¤é†’å­—æ¯çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">52</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span> + num + <span class="string">&quot;, &quot;</span> + (++num));</span><br><span class="line">        num++;</span><br><span class="line">        flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°å­—æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printLetter</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸ºfalseå…ˆä¼‘çœ ï¼Œè®©æ•°å­—å…ˆæ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°äº†Zå°±é€€å‡ºå¹¶å”¤é†’æ•°å­—çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (letter &gt; <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span> + ((<span class="keyword">char</span>) letter++));</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    ThreadCommunication threadCommunication = <span class="keyword">new</span> ThreadCommunication();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printNumber();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;æ•°å­—çº¿ç¨‹&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printLetter();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;å­—æ¯çº¿ç¨‹&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ åˆ°-4-ä¸ªçº¿ç¨‹-ğŸ†™"><a href="#å¢åŠ åˆ°-4-ä¸ªçº¿ç¨‹-ğŸ†™" class="headerlink" title="å¢åŠ åˆ° 4 ä¸ªçº¿ç¨‹ ğŸ†™"></a>å¢åŠ åˆ° 4 ä¸ªçº¿ç¨‹ ğŸ†™</h3><ul><li><p><strong>å‡ºç°é—®é¢˜ï¼š</strong> æ¢æˆ 4 ä¸ªçº¿ç¨‹ä¼šå¯¼è‡´é”™è¯¯ï¼Œè™šå‡å”¤é†’</p></li><li><p><strong>åŸå› ï¼š</strong> åœ¨ java å¤šçº¿ç¨‹åˆ¤æ–­æ—¶ï¼Œä¸èƒ½ç”¨ ifï¼Œç¨‹åºå‡ºäº‹å‡ºåœ¨äº†åˆ¤æ–­ä¸Šé¢ï¼Œçªç„¶æœ‰ä¸€æ·»åŠ çš„çº¿ç¨‹è¿›åˆ° if äº†ï¼Œçªç„¶ä¸­æ–­äº†äº¤å‡ºæ§åˆ¶æƒï¼Œæ²¡æœ‰è¿›è¡ŒéªŒè¯ï¼Œè€Œæ˜¯ç›´æ¥èµ°ä¸‹å»äº†ï¼ŒåŠ äº†ä¸¤æ¬¡ï¼Œç”šè‡³å¤šæ¬¡</p></li><li><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><ul><li><p>è§£å†³è™šå‡å”¤é†’ï¼šæŸ¥çœ‹ APIï¼Œjava.lang.Object</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618284313147.jpg" alt="graphic"></p><p>ä¸­æ–­å’Œè™šå‡å”¤é†’æ˜¯å¯èƒ½äº§ç”Ÿçš„ï¼Œæ‰€ä»¥è¦ç”¨<strong>loop å¾ªç¯</strong>ï¼Œif åªåˆ¤æ–­ä¸€æ¬¡ï¼Œ<strong>while æ˜¯åªè¦å”¤é†’å°±è¦æ‹‰å›æ¥å†åˆ¤æ–­ä¸€æ¬¡</strong>ã€‚if æ¢æˆ while</p></li></ul></li><li><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ifæ”¹ä¸ºwhileğŸ‘‡</span></span><br><span class="line"><span class="keyword">while</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="java8-æ–°ç‰ˆå®ç°-ğŸ†•"><a href="#java8-æ–°ç‰ˆå®ç°-ğŸ†•" class="headerlink" title="java8 æ–°ç‰ˆå®ç° ğŸ†•"></a>java8 æ–°ç‰ˆå®ç° ğŸ†•</h3><p><code>lock</code>å¯¹æ ‡<code>synchronization</code>å®ç°</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413114243997.png" alt="image-20210413114243997"></p><h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p><code>lock</code> çš„ <code>await</code> å’Œ <code>signal </code>æ–¹æ³•éœ€è¦é  <code>Condition </code>æ¥å£å®ç°</p><p>æŸ¥çœ‹ APIï¼Œjava.util.concurrent</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618286075328.jpg" alt="graphic"></p><p>ä»£ç ä¸¾ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">final</span> Condition notFull  = lock.newCondition();</span><br><span class="line">    <span class="keyword">final</span> Condition notEmpty = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == items.length)</span><br><span class="line">                notFull.await();</span><br><span class="line">            items[putptr] = x;</span><br><span class="line">            <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</span><br><span class="line">            ++count;</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡-ğŸ’±"><a href="#çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡-ğŸ’±" class="headerlink" title="çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡ ğŸ’±"></a>çº¿ç¨‹é—´å®šåˆ¶åŒ–è°ƒç”¨é€šä¿¡ ğŸ’±</h2><h3 id="ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å°-ğŸ“"><a href="#ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å°-ğŸ“" class="headerlink" title="ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å° ğŸ“"></a>ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹ä¾æ¬¡æ‰“å° ğŸ“</h3><p>âœ æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼ŒA çº¿ç¨‹æ‰“å°å­—ç¬¦ AAï¼ŒB çº¿ç¨‹æ‰“å°å­—ç¬¦ BBï¼ŒC çº¿ç¨‹æ‰“å°å­—ç¬¦ CCï¼Œéœ€è¦ä¾æ¬¡æ‰“å°å‡º abcï¼Œæ‰“å°åè½®ï¼Œæ¯è½® AA è¦æ‰“å°äº”æ¬¡ï¼ŒBB è¦æ‰“å° 10 æ¬¡ï¼ŒCC è¦æ‰“å° 15 æ¬¡</p><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ul><li>æœ‰é¡ºåºé€šçŸ¥ï¼Œéœ€è¦æœ‰æ ‡è¯†ä½</li><li>æœ‰ä¸€ä¸ªé” Lockï¼Œ3 æŠŠé’¥åŒ™ Condition</li><li>åˆ¤æ–­æ ‡å¿—ä½</li><li>è¾“å‡ºçº¿ç¨‹å+ç¬¬å‡ æ¬¡+ç¬¬å‡ è½®</li><li>ä¿®æ”¹æ ‡å¿—ä½ï¼Œé€šçŸ¥ä¸‹ä¸€ä¸ª</li></ul><p><strong>å®ç°ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareResource</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1:A 2:B 3:C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print5</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            c2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print10</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            c3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print15</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//A å°±è¦åœæ­¢</span></span><br><span class="line">                c3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 é€šçŸ¥</span></span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            c1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ShareResource sr = <span class="keyword">new</span> ShareResource();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print5(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print10(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print15(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;CC&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Synchronization-é”é—®é¢˜-â“"><a href="#Synchronization-é”é—®é¢˜-â“" class="headerlink" title="Synchronization é”é—®é¢˜ â“"></a>Synchronization é”é—®é¢˜ â“</h2><h3 id="å…«ä¸ªé—®é¢˜-ğŸ“"><a href="#å…«ä¸ªé—®é¢˜-ğŸ“" class="headerlink" title="å…«ä¸ªé—®é¢˜ ğŸ“"></a>å…«ä¸ªé—®é¢˜ ğŸ“</h3><ol><li><p>æ ‡å‡†è®¿é—®ï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>åœ 4 ç§’åœ¨çŸ­ä¿¡æ–¹æ³•å†…ï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        è¿™é‡Œä½¿ç”¨sleepåœæ­¢<span class="number">4</span>ç§’</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ™®é€šçš„ hello æ–¹æ³•ï¼Œæ˜¯å…ˆæ‰“çŸ­ä¿¡è¿˜æ˜¯ hello</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// phone.sendEmail();</span></span><br><span class="line">     phone.getHello();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç°åœ¨æœ‰ä¸¤éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p></li><li><p>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p></li><li><p>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ2 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p></li><li><p>1 ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œ1 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p></li><li><p>1 ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œ1 ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œ2 éƒ¨æ‰‹æœºï¼Œå…ˆæ‰“å°çŸ­ä¿¡è¿˜æ˜¯é‚®ä»¶</p></li></ol><h3 id="é—®é¢˜ç­”æ¡ˆ-ğŸ¤«"><a href="#é—®é¢˜ç­”æ¡ˆ-ğŸ¤«" class="headerlink" title="é—®é¢˜ç­”æ¡ˆ ğŸ¤«"></a>é—®é¢˜ç­”æ¡ˆ ğŸ¤«</h3><ol><li>çŸ­ä¿¡</li><li>çŸ­ä¿¡</li><li>Hello</li><li>é‚®ä»¶</li><li>çŸ­ä¿¡</li><li>çŸ­ä¿¡</li><li>é‚®ä»¶</li><li>é‚®ä»¶</li></ol><h3 id="é—®é¢˜åˆ†æ-ğŸ§"><a href="#é—®é¢˜åˆ†æ-ğŸ§" class="headerlink" title="é—®é¢˜åˆ†æ ğŸ§"></a>é—®é¢˜åˆ†æ ğŸ§</h3><ul><li><code>synchronization</code>å…³é”®å­—é”çš„æ˜¯å¯¹è±¡ï¼Œä¸”å½“å¯¹è±¡è¢«é”æ—¶ï¼Œéœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾åå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å¾—é”</li><li>å½“<code>synchronization</code>ä¿®é¥°æ™®é€šæ–¹æ³•æ—¶ï¼Œé”çš„æ˜¯å®ä¾‹å¯¹è±¡</li><li>å½“<code>synchronization</code>ä¿®é¥°çš„æ˜¯é™æ€æ–¹æ³•æ—¶ï¼Œé”çš„æ˜¯ç±»å¯¹è±¡</li></ul><h2 id="ä¸å®‰å…¨é›†åˆ-ğŸš¨"><a href="#ä¸å®‰å…¨é›†åˆ-ğŸš¨" class="headerlink" title="ä¸å®‰å…¨é›†åˆ ğŸš¨"></a>ä¸å®‰å…¨é›†åˆ ğŸš¨</h2><blockquote><p>æ€»æ‰€å‘¨çŸ¥<code>HashMap</code>ã€<code>ArrayList</code>ã€<code>HashSet</code>éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å»ä¿è¯é›†åˆçš„çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ</p></blockquote><h3 id="è¯æ˜çº¿ç¨‹ä¸å®‰å…¨-ğŸ¤¯"><a href="#è¯æ˜çº¿ç¨‹ä¸å®‰å…¨-ğŸ¤¯" class="headerlink" title="è¯æ˜çº¿ç¨‹ä¸å®‰å…¨ ğŸ¤¯"></a>è¯æ˜çº¿ç¨‹ä¸å®‰å…¨ ğŸ¤¯</h3><p><strong>è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; arr = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">30</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> i = j;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        String key = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>) + Thread.currentThread().getName() + i;</span><br><span class="line">        arr.add(key);</span><br><span class="line">        System.out.println(arr);</span><br><span class="line">    &#125;, <span class="string">&quot;çº¿ç¨‹&quot;</span> + j + <span class="string">&quot;ï¼š&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143558545.png" alt="image-20210413143558545"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œä¸Šé¢çš„ä»£ç åå‡ºç°äº†<code>java.util.ConcurrentModificationException</code>ï¼ˆå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰å¼‚å¸¸ï¼ŒArrayList åœ¨è¿­ä»£çš„æ—¶å€™å¦‚æœå¯¹å…¶è¿›è¡Œä¿®æ”¹å°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸</p><ul><li><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ul><li><p><strong>æ–¹æ¡ˆä¸€ï¼š</strong> Vector</p><ul><li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143920131.png" alt="image-20210413143920131"></li><li>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨<code>Vector</code>è¿™ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆ</li><li>ä¸‹é¢è¿™ä¸ªæ˜¯<code>Vector</code>æ·»åŠ å…ƒç´ çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¸Šé¢æ·»åŠ äº†<code>synchronization</code>å…³é”®å­—ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨</li><li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144051872.png" alt="image-20210413144051872"></li></ul></li><li><p><strong>æ–¹æ¡ˆäºŒï¼š</strong> Collections</p><ul><li>ä½¿ç”¨<code>Collections#synchronizedList</code>æ–¹æ³•å°†<code>ArrayList</code>è½¬æ¢æˆçº¿ç¨‹å®‰å…¨çš„</li><li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144654816.png" alt="image-20210413144654816"></li><li>å¯ä»¥çœ‹åˆ°å®é™…ä¸Šä¹Ÿæ˜¯ä½¿ç”¨äº†<code>synchronization</code>å…³é”®å­—æ¥ä¿è¯çš„çº¿ç¨‹å®‰å…¨</li></ul></li><li><p><strong>æ–¹æ¡ˆä¸‰ï¼š</strong> å†™æ—¶å¤åˆ¶</p><ul><li><p>è™½ç„¶ä¸åŠ é”æ€§èƒ½å¥½ä½†æ˜¯ä¼šå‡ºé”™è¯¯ï¼ŒåŠ é”åˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™</p></li><li><p>æˆ‘ä»¬å¯ä»¥æŠ˜ä¸­ä¸€ä¸‹ä½¿ç”¨<code>CopyOnWriteArrayList</code></p></li><li><blockquote><p>A thread-safe variant of ArrayList in which all mutative operations (add, set, and so on) are implemented by making a fresh copy of the underlying array.</p><p>CopyOnWriteArrayList æ˜¯ arraylist çš„ä¸€ç§çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddã€set ç­‰ï¼‰éƒ½æ˜¯é€šè¿‡ç”Ÿæˆåº•å±‚æ•°ç»„çš„æ–°å‰¯æœ¬æ¥å®ç°çš„ã€‚</p></blockquote></li><li><p><code>CopyOnWrite</code>å®¹å™¨å³<strong>å†™æ—¶å¤åˆ¶çš„å®¹å™¨</strong>ã€‚å¾€ä¸€ä¸ªå®¹å™¨<strong>æ·»åŠ å…ƒç´ </strong>çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å½“å‰å®¹å™¨<code>Object[]</code>æ·»åŠ ï¼Œè€Œæ˜¯<strong>å…ˆå°†å½“å‰å®¹å™¨<code>Object[]</code>è¿›è¡Œ Copy</strong>ï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨<code>Object[] newElements</code>ï¼Œç„¶åå‘æ–°çš„å®¹å™¨<code>Object[] newElements</code>é‡Œæ·»åŠ å…ƒç´ ã€‚æ·»åŠ å…ƒç´ åï¼Œ<strong>å†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨<code>setArray(newElements)</code><strong>ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥å¯¹<code>CopyOnWrite</code>å®¹å™¨è¿›è¡Œ</strong>å¹¶å‘çš„è¯»</strong>ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚æ‰€ä»¥<code>CopyOnWrite</code>å®¹å™¨ä¹Ÿæ˜¯ä¸€ç§<strong>è¯»å†™åˆ†ç¦»çš„æ€æƒ³</strong>ï¼Œè¯»å’Œå†™ä¸åŒçš„å®¹å™¨ã€‚</p><ol><li>å…ˆå¤åˆ¶</li><li>å¾€å¤åˆ¶çš„æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </li><li>å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘å¤åˆ¶çš„æ•°ç»„</li></ol></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413151325401.png" alt="image-20210413151325401"></p></li></ul></li></ul></li></ul><h2 id="Callable-æ¥å£-â†©ï¸"><a href="#Callable-æ¥å£-â†©ï¸" class="headerlink" title="Callable æ¥å£ â†©ï¸"></a>Callable æ¥å£ â†©ï¸</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“"><a href="#æ˜¯ä»€ä¹ˆ-â“" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><h4 id="é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ"><a href="#é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ" class="headerlink" title="é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ"></a>é¢è¯•é¢˜ï¼šè·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•å‡ ç§ï¼Ÿ</h4><p><strong>ä¸å®Œæ•´ç­”æ¡ˆï¼š</strong> ç»§æ‰¿<code>Thread</code>ç±» å’Œ å®ç°<code>Runnable</code>æ¥å£</p><p>==<strong>å¦‚æœåªå›ç­”è¿™ä¸¤ä¸ªä½ è¿è¢«é—®åˆ° juc çš„æœºä¼šéƒ½æ²¡æœ‰</strong>==</p><p><strong>æ­£ç¡®ç­”æ¡ˆå¦‚ä¸‹ï¼š</strong></p><p><strong>ä¼ ç»Ÿçš„æ˜¯</strong>ç»§æ‰¿<code>Thread</code>ç±» å’Œ å®ç°<code>Runnable</code>æ¥å£ï¼Œ<br><strong>java5 ä»¥å</strong>åˆæœ‰å®ç°<code>Callable</code>æ¥å£ å’Œ java çš„çº¿ç¨‹æ±  è·å¾—</p><h4 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413153235849.png" alt="image-20210413153235849"></p><p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå› æ­¤å¯ä»¥ç”¨ä½œ lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨çš„èµ‹å€¼å¯¹è±¡</p><h3 id="ä¸-Runnable-æ¥å£çš„å¯¹æ¯”-ğŸ˜¦"><a href="#ä¸-Runnable-æ¥å£çš„å¯¹æ¯”-ğŸ˜¦" class="headerlink" title="ä¸ Runnable æ¥å£çš„å¯¹æ¯” ğŸ˜¦"></a>ä¸ Runnable æ¥å£çš„å¯¹æ¯” ğŸ˜¦</h3><p><strong>ç¼–ç æ–¹é¢çš„åŒºåˆ«</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ–°ç±»MyThreadå®ç°runnableæ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°ç±»MyThread2å®ç°callableæ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¢è¯•é¢˜ï¼šcallable æ¥å£ä¸ runnable æ¥å£çš„åŒºåˆ«ï¼Ÿ</strong></p><ul><li>Callable æ¥å£æœ‰è¿”å›å€¼ï¼ŒRunnable æ¥å£æ²¡æœ‰</li><li>Callable æ¥å£å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼ŒRunnable æ¥å£ä¸è¡Œ</li><li>è½åœ°æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ runï¼Œä¸€ä¸ªæ˜¯ call</li></ul><h3 id="æ€ä¹ˆç”¨-ğŸ”§-1"><a href="#æ€ä¹ˆç”¨-ğŸ”§-1" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ”§"></a>æ€ä¹ˆç”¨ ğŸ”§</h3><h4 id="ç›´æ¥æ›¿æ¢-runnable-æ˜¯å¦å¯è¡Œï¼Ÿ"><a href="#ç›´æ¥æ›¿æ¢-runnable-æ˜¯å¦å¯è¡Œï¼Ÿ" class="headerlink" title="ç›´æ¥æ›¿æ¢ runnable æ˜¯å¦å¯è¡Œï¼Ÿ"></a>ç›´æ¥æ›¿æ¢ runnable æ˜¯å¦å¯è¡Œï¼Ÿ</h4><p>æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½ç›´æ¥æ›¿æ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread2(), <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154606831.png" alt="image-20210413154606831"></p><h4 id="æ›²çº¿æ•‘å›½"><a href="#æ›²çº¿æ•‘å›½" class="headerlink" title="æ›²çº¿æ•‘å›½"></a>æ›²çº¿æ•‘å›½</h4><p>å¯ä»¥çœ‹åˆ°ä¸èƒ½ç›´æ¥æŠŠ<code>runnable</code>æ¥å£çš„å®ç°ç›´æ¥æ¢æˆ<code>callable</code>æ¥å£çš„å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼æ¥ä¿®æ”¹</p><p>æˆ‘ä»¬çŸ¥é“æ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾ä¸€ä¸ªå®ç°äº†<code>runnable</code>å’Œ<code>callable</code>æ¥å£çš„ç±»ä¸å°±å¥½äº†å˜› ğŸ¤£</p><p>é‚£ä¹ˆçƒ­çƒˆæ¬¢è¿æˆ‘ä»¬çš„<code>FutureTask</code>åŒå­¦ç™»åœº</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154959592.png" alt="image-20210413154959592"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> MyThread());</span><br><span class="line">    <span class="keyword">new</span> Thread(ft, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155210045.png" alt="image-20210413155210045"></p><p>å½“å½“å½“ï¼Œè¿™æ ·å°±æ²¡æœ‰æŠ¥é”™å•¦ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°å¥½åƒå¹¶æ²¡æœ‰æŠŠæˆ‘ä»¬çš„ 200 ç»™è¾“å‡ºæ¬¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè·å¾—è¿”å›å€¼å‘¢ï¼Ÿ</p><p>ä½¿ç”¨ï¼š<code>ft.get();</code></p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155428880.png" alt="image-20210413155428880"></p><p>è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡çº¿ç¨‹è¿è¡Œç»“æŸ</p><h3 id="FutureTaskğŸ˜²"><a href="#FutureTaskğŸ˜²" class="headerlink" title="FutureTaskğŸ˜²"></a>FutureTaskğŸ˜²</h3><blockquote><p>æˆ‘ä»¬ç°åœ¨æ¥æ­£å¼ä»‹ç»ä¸€ä¸‹<code>FutureTask</code>ç±»</p></blockquote><h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h4><p>æœªæ¥çš„ä»»åŠ¡ï¼Œç”¨å®ƒå°±å¹²ä¸€ä»¶äº‹ï¼Œ<strong>å¼‚æ­¥è°ƒç”¨</strong></p><p>ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªä»»åŠ¡å¹¶å†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œçº¿ç¨‹å¼€å¯åå®ƒä¼šé»˜é»˜æ‰§è¡Œï¼Œä½ ä½¿ç”¨<code>ft.get();</code>å°±å¯ä»¥å¾—åˆ°è¯¥ä»»åŠ¡çš„è¿”å›å€¼</p><h5 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h5><p>è€å¸ˆä¸Šç€è¯¾ï¼Œå£æ¸´äº†ï¼Œå»ä¹°æ°´ä¸åˆé€‚ï¼Œè®²è¯¾çº¿ç¨‹ç»§ç»­ï¼Œæˆ‘å¯ä»¥å•èµ·ä¸ªçº¿ç¨‹æ‰¾ç­é•¿å¸®å¿™ä¹°æ°´ï¼Œæ°´ä¹°å›æ¥äº†æ”¾æ¡Œä¸Šï¼Œæˆ‘éœ€è¦çš„æ—¶å€™å†å» getã€‚</p><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><ul><li>åœ¨ä¸»çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œ<strong>æ¯”è¾ƒè€—æ—¶</strong>çš„æ“ä½œæ—¶ï¼Œä½†åˆ<strong>ä¸æƒ³é˜»å¡ä¸»çº¿ç¨‹</strong>æ—¶ï¼Œå¯ä»¥æŠŠè¿™äº›ä½œä¸šäº¤ç»™ Future å¯¹è±¡åœ¨åå°å®Œæˆï¼Œå½“ä¸»çº¿ç¨‹å°†æ¥éœ€è¦æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ Future å¯¹è±¡è·å¾—åå°ä½œä¸šçš„è®¡ç®—ç»“æœæˆ–è€…æ‰§è¡ŒçŠ¶æ€ã€‚</li><li>ä¸€èˆ¬ FutureTask å¤šç”¨äº<strong>è€—æ—¶çš„è®¡ç®—</strong>ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚</li><li>ä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½æ£€ç´¢ç»“æœï¼›<ul><li>å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡ get æ–¹æ³•ã€‚</li><li>ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚</li><li>get æ–¹æ³•è€Œè·å–ç»“æœåªæœ‰åœ¨è®¡ç®—å®Œæˆæ—¶è·å–ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡è½¬å…¥å®ŒæˆçŠ¶æ€ï¼Œç„¶åä¼šè¿”å›ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>åªè®¡ç®—ä¸€æ¬¡</li></ul></li></ul><h2 id="JUC-å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£-ğŸ§°"><a href="#JUC-å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£-ğŸ§°" class="headerlink" title="JUC å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£ ğŸ§°"></a>JUC å¼ºå¤§çš„è¾…åŠ©ç±»è®²è§£ ğŸ§°</h2><h3 id="CountDownLatch-å‡å°‘è®¡æ•°-â–"><a href="#CountDownLatch-å‡å°‘è®¡æ•°-â–" class="headerlink" title="CountDownLatch å‡å°‘è®¡æ•° â–"></a>CountDownLatch å‡å°‘è®¡æ•° â–</h3><ul><li>CountDownLatch ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨ await æ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡ã€‚</li><li>å…¶å®ƒçº¿ç¨‹è°ƒç”¨ countDown æ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡ 1(è°ƒç”¨ countDown æ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)ï¼Œ</li><li>å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º 0 æ—¶ï¼Œå›  await æ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>6 ä¸ªåŒå­¦é™†ç»­ç¦»å¼€æ•™å®¤åå€¼ç­åŒå­¦æ‰å¯ä»¥å…³é—¨ã€‚</p><h4 id="ä»£ç ä¸¾ä¾‹"><a href="#ä»£ç ä¸¾ä¾‹" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//6ä¸ªä¸Šè‡ªä¹ çš„åŒå­¦ï¼Œå„è‡ªç¦»å¼€æ•™å®¤çš„æ—¶é—´ä¸ä¸€è‡´</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t å·åŒå­¦ç¦»å¼€æ•™å®¤&quot;</span>);</span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t****** ç­é•¿å…³é—¨èµ°äººï¼Œmainçº¿ç¨‹æ˜¯ç­é•¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CyclicBarrier-å¾ªç¯æ …æ -ğŸš§"><a href="#CyclicBarrier-å¾ªç¯æ …æ -ğŸš§" class="headerlink" title="CyclicBarrier å¾ªç¯æ …æ  ğŸš§"></a>CyclicBarrier å¾ªç¯æ …æ  ğŸš§</h3><ul><li>CyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ï¼ˆCyclicï¼‰ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚çº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡ CyclicBarrier çš„ await()æ–¹æ³•ã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹-1"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹-1" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>è€å¸ˆéœ€è¦ç­‰æ‰€æœ‰å­¦ç”Ÿï¼ˆ7 ä¸ªï¼‰åˆ°äº†æ‰ä¸Šè¯¾</p><h4 id="ä»£ç ä¸¾ä¾‹-1"><a href="#ä»£ç ä¸¾ä¾‹-1" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(NUMBER, ()-&gt;System.out.println(<span class="string">&quot;*****è€å¸ˆå¼€å§‹ä¸Šè¯¾*****&quot;</span>)) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;åˆ°æ•™å®¤äº†&quot;</span>);</span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)+<span class="string">&quot;åŒå­¦&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Semaphore-ä¿¡å·ç¯-ğŸš¦"><a href="#Semaphore-ä¿¡å·ç¯-ğŸš¦" class="headerlink" title="Semaphore ä¿¡å·ç¯ ğŸš¦"></a>Semaphore ä¿¡å·ç¯ ğŸš¦</h3><ul><li>åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š<ul><li>acquireï¼ˆè·å–ï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire æ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡æˆåŠŸè·å–ä¿¡å·é‡ï¼ˆä¿¡å·é‡å‡ 1ï¼‰ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è¶…æ—¶ã€‚</li><li>releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šä¼šå°†ä¿¡å·é‡çš„å€¼åŠ  1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul></li><li>ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯ä¸¾ä¾‹-2"><a href="#åº”ç”¨åœºæ™¯ä¸¾ä¾‹-2" class="headerlink" title="åº”ç”¨åœºæ™¯ä¸¾ä¾‹"></a>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</h4><p>å…­è¾†è½¦æŠ¢ä¸‰ä¸ªè½¦ä½ï¼Œéœ€è¦ç­‰åœè½¦ä½ä¸Šé¢çš„è½¦ç¦»å¼€åï¼Œå¤–é¢çš„è½¦æ‰èƒ½è¿›æ¥</p><h4 id="ä»£ç ä¸¾ä¾‹-2"><a href="#ä»£ç ä¸¾ä¾‹-2" class="headerlink" title="ä»£ç ä¸¾ä¾‹"></a>ä»£ç ä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);<span class="comment">//æ¨¡æ‹Ÿ3ä¸ªåœè½¦ä½</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//æ¨¡æ‹Ÿ6éƒ¨æ±½è½¦</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t æŠ¢åˆ°äº†è½¦ä½&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">5</span>));</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t------- ç¦»å¼€&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ReentrantReadWriteLock-è¯»å†™é”-ğŸ”"><a href="#ReentrantReadWriteLock-è¯»å†™é”-ğŸ”" class="headerlink" title="ReentrantReadWriteLock è¯»å†™é” ğŸ”"></a>ReentrantReadWriteLock è¯»å†™é” ğŸ”</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-1"><a href="#æ˜¯ä»€ä¹ˆ-â“-1" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><p>è¯»å†™é”å®šä¹‰å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p><ul><li>è¯»çš„æ—¶å€™åˆ«äººä¸èƒ½å†™</li><li>å†™çš„æ—¶å€™åˆ«äººä¸èƒ½è¯»</li><li>å†™çš„æ—¶å€™åˆ«äººä¸èƒ½å†™</li><li>è¯»çš„æ—¶å€™åˆ«äººå¯ä»¥è¯»</li></ul><p>å†ç®€å•ç‚¹è¯´å°±æ˜¯ï¼šè¯»å†™ä¸èƒ½åŒæ—¶è¿›è¡Œï¼Œè¯»è¯»å¯ä»¥</p><h3 id="é—®é¢˜ä¸¾ä¾‹-ğŸŒ°"><a href="#é—®é¢˜ä¸¾ä¾‹-ğŸŒ°" class="headerlink" title="é—®é¢˜ä¸¾ä¾‹ ğŸŒ°"></a>é—®é¢˜ä¸¾ä¾‹ ğŸŒ°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨å†™&quot;</span> + key);</span><br><span class="line">        <span class="comment">//æš‚åœä¸€ä¼šå„¿çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å®Œäº†&quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨è¯»&quot;</span> + key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        result = map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å®Œäº†&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1 æ­£åœ¨å†™1</span><br><span class="line">2 æ­£åœ¨å†™2</span><br><span class="line">5 æ­£åœ¨å†™5</span><br><span class="line">1 æ­£åœ¨è¯»1</span><br><span class="line">4 æ­£åœ¨è¯»4</span><br><span class="line">5 æ­£åœ¨è¯»5</span><br><span class="line">3 æ­£åœ¨å†™3</span><br><span class="line">4 æ­£åœ¨å†™4</span><br><span class="line">2 æ­£åœ¨è¯»2</span><br><span class="line">3 æ­£åœ¨è¯»3</span><br><span class="line">1 è¯»å®Œäº†null</span><br><span class="line">2 å†™å®Œäº†2</span><br><span class="line">4 è¯»å®Œäº†null</span><br><span class="line">5 è¯»å®Œäº†null</span><br><span class="line">3 è¯»å®Œäº†null</span><br><span class="line">2 è¯»å®Œäº†2</span><br><span class="line">4 å†™å®Œäº†4</span><br><span class="line">3 å†™å®Œäº†3</span><br><span class="line">1 å†™å®Œäº†1</span><br><span class="line">5 å†™å®Œäº†5</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿˜æ²¡å†™å®Œå°±å¼€å§‹è¯»äº†ï¼Œè¿˜æ²¡è¯»å®Œå°±å¼€å§‹å†™äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§</p><h3 id="ä½¿ç”¨è¯»å†™é”çš„ä»£ç -ğŸ‘©â€ğŸ’»"><a href="#ä½¿ç”¨è¯»å†™é”çš„ä»£ç -ğŸ‘©â€ğŸ’»" class="headerlink" title="ä½¿ç”¨è¯»å†™é”çš„ä»£ç  ğŸ‘©â€ğŸ’»"></a>ä½¿ç”¨è¯»å†™é”çš„ä»£ç  ğŸ‘©â€ğŸ’»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> ReadWriteLock rwLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨å†™&quot;</span> + key);</span><br><span class="line">            <span class="comment">//æš‚åœä¸€ä¼šå„¿çº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å®Œäº†&quot;</span> + key);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t æ­£åœ¨è¯»&quot;</span> + key);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            result = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å®Œäº†&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1 æ­£åœ¨å†™1</span><br><span class="line">1 å†™å®Œäº†1</span><br><span class="line"></span><br><span class="line">3 æ­£åœ¨å†™3</span><br><span class="line">3 å†™å®Œäº†3</span><br><span class="line"></span><br><span class="line">4 æ­£åœ¨å†™4</span><br><span class="line">4 å†™å®Œäº†4</span><br><span class="line"></span><br><span class="line">2 æ­£åœ¨å†™2</span><br><span class="line">2 å†™å®Œäº†2</span><br><span class="line"></span><br><span class="line">5 æ­£åœ¨å†™5</span><br><span class="line">5 å†™å®Œäº†5</span><br><span class="line"></span><br><span class="line">1 æ­£åœ¨è¯»1</span><br><span class="line">2 æ­£åœ¨è¯»2</span><br><span class="line">3 æ­£åœ¨è¯»3</span><br><span class="line">4 æ­£åœ¨è¯»4</span><br><span class="line">5 æ­£åœ¨è¯»5</span><br><span class="line">4 è¯»å®Œäº†4</span><br><span class="line">2 è¯»å®Œäº†2</span><br><span class="line">1 è¯»å®Œäº†1</span><br><span class="line">5 è¯»å®Œäº†5</span><br><span class="line">3 è¯»å®Œäº†3</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†è¯»å†™é”åï¼Œåœ¨å†™çš„æ—¶å€™æ²¡æœ‰è¢«æ‰“æ–­äº†ï¼Œä½†æ˜¯è¯»å’Œè¯»ä¹‹é—´å¯ä»¥éšæ„æ‰“æ–­</p><h2 id="BlockingQueue-é˜»å¡é˜Ÿåˆ—-â³"><a href="#BlockingQueue-é˜»å¡é˜Ÿåˆ—-â³" class="headerlink" title="BlockingQueue é˜»å¡é˜Ÿåˆ— â³"></a>BlockingQueue é˜»å¡é˜Ÿåˆ— â³</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-2"><a href="#æ˜¯ä»€ä¹ˆ-â“-2" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><p>è™½ç„¶è¯´ç¨‹åºè¿è¡Œä¸­é˜»å¡ä¸å¥½ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬å¿…é¡»ä½¿ç”¨é˜»å¡æ¥å®ŒæˆæŸäº›äº‹æƒ…</p><p><strong>é˜»å¡ï¼šå¿…é¡»è¦é˜»å¡/ä¸å¾—ä¸é˜»å¡</strong></p><p>é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­èµ·çš„ä½œç”¨å¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413170339956.png" alt="image-20210413170339956"></p><ul><li>å½“é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li><li>å½“é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä»é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li><li>è¯•å›¾ä»ç©ºçš„é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—æ’å…¥æ–°çš„å…ƒç´ </li><li>è¯•å›¾å‘å·²æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æˆ–è€…å®Œå…¨æ¸…ç©ºï¼Œä½¿é˜Ÿåˆ—å˜å¾—ç©ºé—²èµ·æ¥å¹¶åç»­æ–°å¢</li></ul><h3 id="é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„-ğŸ¤”"><a href="#é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„-ğŸ¤”" class="headerlink" title="é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„ ğŸ¤”"></a>é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„ ğŸ¤”</h3><ul><li>åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼š<ul><li>æ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼š<strong>æŒ‚èµ·çº¿ç¨‹</strong>ï¼ˆå³é˜»å¡ï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼š<strong>è‡ªåŠ¨è¢«å”¤èµ·</strong></li></ul></li><li>ä¸ºä»€ä¹ˆéœ€è¦ BlockingQueueï¼š<ul><li>å¥½å¤„æ˜¯æˆ‘ä»¬<strong>ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆæ—¶å€™éœ€è¦é˜»å¡çº¿ç¨‹</strong>ï¼Œ<strong>ä»€ä¹ˆæ—¶å€™éœ€è¦å”¤é†’çº¿ç¨‹</strong>ï¼Œå› ä¸ºè¿™ä¸€åˆ‡ BlockingQueue éƒ½ç»™ä½ ä¸€æ‰‹åŒ…åŠ</li><li>åœ¨ concurrent åŒ…å‘å¸ƒä»¥å‰ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬<strong>æ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»å»è‡ªå·±æ§åˆ¶è¿™äº›ç»†èŠ‚ï¼Œå°¤å…¶è¿˜è¦å…¼é¡¾æ•ˆç‡å’Œçº¿ç¨‹å®‰å…¨</strong>ï¼Œè€Œè¿™ä¼šç»™æˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥ä¸å°çš„å¤æ‚åº¦ã€‚</li></ul></li></ul><h3 id="æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ-ğŸ“š"><a href="#æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ-ğŸ“š" class="headerlink" title="æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ ğŸ“š"></a>æ¶æ„æ¢³ç†ã€ç§ç±»åˆ†æ ğŸ“š</h3><ul><li><p>æ¶æ„ä»‹ç»</p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192734518.png" alt="image-20210413192734518" style="zoom:200%;"></li><li><p>ç§ç±»åˆ†æ</p><ul><li>ArrayBlockingQueueï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li>LinkedBlockingQueueï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸º integer.MAX_VALUEï¼‰é˜»å¡é˜Ÿåˆ—ã€‚</li><li>PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li>DelayQueueï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li>SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ã€‚</li><li>LinkedTransferQueueï¼šç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li>LinkedBlockingDequeï¼šç”±é“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li></ul></li></ul><h3 id="BlockingQueue-æ ¸å¿ƒæ–¹æ³•-ğŸ’ "><a href="#BlockingQueue-æ ¸å¿ƒæ–¹æ³•-ğŸ’ " class="headerlink" title="BlockingQueue æ ¸å¿ƒæ–¹æ³• ğŸ’ "></a>BlockingQueue æ ¸å¿ƒæ–¹æ³• ğŸ’ </h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192944228.png" alt="image-20210413192944228"></p><table><thead><tr><th>æ–¹æ³•ç±»å‹</th><th align="center">è§£é‡Š</th></tr></thead><tbody><tr><td>æŠ›å‡ºå¼‚å¸¸</td><td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œ add æ’å…¥å…ƒç´ ä¼šæŠ› IllegalStateException:Queue full å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œ remove ç§»é™¤å…ƒç´ ä¼šæŠ› NoSuchElementException</td></tr><tr><td>ç‰¹æ®Šå€¼</td><td align="center">æ’å…¥æ–¹æ³•ï¼ŒæˆåŠŸ ture å¤±è´¥ false ç§»é™¤æ–¹æ³•ï¼ŒæˆåŠŸè¿”å›å‡ºé˜Ÿåˆ—çš„å…ƒç´ ï¼Œé˜Ÿåˆ—é‡Œæ²¡æœ‰å°±è¿”å› null</td></tr><tr><td>ä¸€ç›´é˜»å¡</td><td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç»§ç»­å¾€é˜Ÿåˆ—é‡Œ put å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ç›´åˆ° put æ•°æ® or å“åº”ä¸­æ–­é€€å‡º å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»é˜Ÿåˆ—é‡Œ take å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ç›´åˆ°é˜Ÿåˆ—å¯ç”¨</td></tr><tr><td>è¶…æ—¶é€€å‡º</td><td align="center">å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€å®šæ—¶é—´ï¼Œè¶…è¿‡é™æ—¶åç”Ÿäº§è€…çº¿ç¨‹ä¼šé€€å‡º</td></tr></tbody></table><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockingQueueDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//        List list = new ArrayList();</span></span><br><span class="line"></span><br><span class="line">        BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ç»„</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.element());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//System.out.println(blockingQueue.add(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//    ç¬¬äºŒç»„</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//    ç¬¬ä¸‰ç»„</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;a&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;c&quot;);</span></span><br><span class="line">        <span class="comment">//         //blockingQueue.put(&quot;x&quot;);</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//    ç¬¬å››ç»„</span></span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>,<span class="number">3L</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ThreadPool-çº¿ç¨‹æ± -ğŸŒŠ"><a href="#ThreadPool-çº¿ç¨‹æ± -ğŸŒŠ" class="headerlink" title="ThreadPool çº¿ç¨‹æ±  ğŸŒŠ"></a>ThreadPool çº¿ç¨‹æ±  ğŸŒŠ</h2><h3 id="ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ± -â“"><a href="#ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ± -â“" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ±  â“"></a>ä¸ºä»€ä¹ˆç”¨çº¿ç¨‹æ±  â“</h3><h4 id="ä¸¾ä¸ªæ —å­-ğŸŒ°-1"><a href="#ä¸¾ä¸ªæ —å­-ğŸŒ°-1" class="headerlink" title="ä¸¾ä¸ªæ —å­ ğŸŒ°"></a>ä¸¾ä¸ªæ —å­ ğŸŒ°</h4><ul><li>10 å¹´å‰å•æ ¸ CPU ç”µè„‘ï¼Œå‡çš„å¤šçº¿ç¨‹ï¼Œåƒé©¬æˆå›¢å°ä¸‘ç©å¤šä¸ªçƒï¼ŒCPU éœ€è¦æ¥å›åˆ‡æ¢ã€‚</li><li>ç°åœ¨æ˜¯å¤šæ ¸ç”µè„‘ï¼Œå¤šä¸ªçº¿ç¨‹å„è‡ªè·‘åœ¨ç‹¬ç«‹çš„ CPU ä¸Šï¼Œä¸ç”¨åˆ‡æ¢æ•ˆç‡é«˜ã€‚</li></ul><h4 id="çº¿ç¨‹æ± çš„ä¼˜åŠ¿-ğŸ‘"><a href="#çº¿ç¨‹æ± çš„ä¼˜åŠ¿-ğŸ‘" class="headerlink" title="çº¿ç¨‹æ± çš„ä¼˜åŠ¿ ğŸ‘"></a>çº¿ç¨‹æ± çš„ä¼˜åŠ¿ ğŸ‘</h4><blockquote><p>çº¿ç¨‹æ± åšçš„å·¥ä½œåªè¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œ<strong>å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</strong>ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œ<strong>å¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™</strong>ï¼Œç­‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</p></blockquote><p><strong>å®ƒçš„ä¸»è¦ç‰¹ç‚¹ä¸ºï¼š</strong></p><blockquote><ol><li><strong>çº¿ç¨‹å¤ç”¨</strong></li><li><strong>æ§åˆ¶æœ€å¤§å¹¶å‘æ•°</strong></li><li><strong>ç®¡ç†çº¿ç¨‹</strong></li></ol></blockquote><ul><li><strong>é™ä½èµ„æºæ¶ˆè€—ï¼š</strong>é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€è€—ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦ï¼š</strong>å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li><li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼š</strong>çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šé”€è€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li></ul><h3 id="æ€ä¹ˆç”¨-ğŸ¦¾"><a href="#æ€ä¹ˆç”¨-ğŸ¦¾" class="headerlink" title="æ€ä¹ˆç”¨ ğŸ¦¾"></a>æ€ä¹ˆç”¨ ğŸ¦¾</h3><h4 id="æ¶æ„è¯´æ˜"><a href="#æ¶æ„è¯´æ˜" class="headerlink" title="æ¶æ„è¯´æ˜"></a>æ¶æ„è¯´æ˜</h4><blockquote><p>Java ä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡<code>Executor</code>æ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº†<code>Executor</code>ï¼Œ<code>Executors</code>ï¼Œ<code>ExecutorService</code>ï¼Œ<code>ThreadPoolExecutor</code>è¿™å‡ ä¸ªç±»</p></blockquote><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618314213310.jpg" alt="graphic" style="zoom:200%;"><h4 id="ç¼–ç å®ç°"><a href="#ç¼–ç å®ç°" class="headerlink" title="ç¼–ç å®ç°"></a>ç¼–ç å®ç°</h4><ul><li><p><strong>FixedThreadPool</strong></p><p>å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </p><p><code>Executors.newFixedThreadPool(int)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>newFixedThreadPool</code>åˆ›å»ºçš„çº¿ç¨‹æ± <code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>å€¼æ˜¯ç›¸ç­‰çš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>LinkedBlockingQueue</code></p><p>æ‰§è¡Œé•¿æœŸä»»åŠ¡æ€§èƒ½å¥½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œ ä¸€æ± æœ‰ N ä¸ªå›ºå®šçš„çº¿ç¨‹ï¼Œæœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹</p></li><li><p><strong>SingleThreadExecutor</strong></p><p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œä¸€æ± ä¸€çº¿ç¨‹</p><p><code>Executors.newSingleThreadExecutor()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>newSingleThreadExecutor </code>åˆ›å»ºçš„çº¿ç¨‹æ± <code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>å€¼éƒ½æ˜¯ 1ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>LinkedBlockingQueue</code></p></li><li><p><strong>CachedThreadPool</strong></p><p>å¯ä»¥åŠ¨æ€ä¿®æ”¹çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± </p><p><code>Executors.newCachedThreadPool()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>newCachedThreadPool</code>åˆ›å»ºçš„çº¿ç¨‹æ± å°†<code>corePoolSize</code>è®¾ç½®ä¸º 0ï¼Œå°†<code>maximumPoolSize</code>è®¾ç½®ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<code>SynchronousQueue</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œï¼Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡ 60 ç§’ï¼Œå°±é”€æ¯çº¿ç¨‹ã€‚</p><p>æ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œ ä½†åœ¨å…ˆå‰æ„å»ºçš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚å¯æ‰©å®¹ï¼Œé‡å¼ºåˆ™å¼º</p></li><li><p><strong>ä¸¾ä¾‹ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//å›ºå®šæ•°çš„çº¿ç¨‹æ± ï¼Œä¸€æ± äº”çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ5ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ1ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        ExecutorService threadPool =  Executors.newCachedThreadPool(); <span class="comment">//ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œå¯æ‰©å±•å—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£"><a href="#ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£" class="headerlink" title="ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£"></a>ä½¿ç”¨<code>Executors</code>å·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± çš„è¯¦è§£</h4><blockquote><p>å…¶å®ä½¿ç”¨<code>Executors</code>å·¥å…·ç±»åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œå®é™…ä¸Šéƒ½æ˜¯æ“ä½œçš„<code>ThreadPoolExecutor</code>ç±»æ¥åˆ›å»ºçš„çº¿ç¨‹æ± </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413195750394.png" alt="image-20210413195750394"></p><h3 id="çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•°-ğŸ’¨"><a href="#çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•°-ğŸ’¨" class="headerlink" title="çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•° ğŸ’¨"></a>çº¿ç¨‹æ± å‡ ä¸ªé‡è¦å‚æ•° ğŸ’¨</h3><blockquote><p>å°±æ˜¯åˆ›å»º<code>ThreadPoolExecutor</code>ç±»æ‰€éœ€çš„ 7 ä¸ªå±æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ThreadPoolExecutorç±»çš„æ„é€ å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>corePoolSizeï¼š</strong>çº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°</li><li><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± ä¸­èƒ½å¤Ÿå®¹çº³åŒæ—¶ æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤å€¼å¿…é¡»å¤§äºç­‰äº 1</li><li><strong>keepAliveTime</strong>ï¼šå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ å½“å‰æ± ä¸­çº¿ç¨‹æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå½“ç©ºé—²æ—¶é—´ è¾¾åˆ° keepAliveTime æ—¶ï¼Œå¤šä½™çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ° åªå‰©ä¸‹ corePoolSize ä¸ªçº¿ç¨‹ä¸ºæ­¢</li><li><strong>unit</strong>ï¼škeepAliveTime çš„å•ä½</li><li><strong>workQueue</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡</li><li><strong>threadFactory</strong>ï¼šè¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œ ç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤çš„å³å¯</li><li><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ï¼Œè¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äº ç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰æ—¶å¦‚ä½•æ¥æ‹’ç» è¯·æ±‚æ‰§è¡Œçš„ runnable çš„ç­–ç•¥</li></ol><h3 id="çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†-ğŸ”"><a href="#çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†-ğŸ”" class="headerlink" title="çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç† ğŸ”"></a>çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç† ğŸ”</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001.jpg" alt="graphic"><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003.jpg" alt="graphic"></p><p>==<strong>ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â— ä»¥ä¸‹é‡è¦ â—</strong>==</p><ol><li>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œå¼€å§‹<strong>ç­‰å¾…è¯·æ±‚</strong>ã€‚</li><li>å½“è°ƒç”¨**<code>execute()</code><strong>æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå‡º</strong>å¦‚ä¸‹åˆ¤æ–­**ï¼š<ol><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„<strong>çº¿ç¨‹æ•°é‡å°äº <code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆ</strong>é©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡</strong>ï¼›</li><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„<strong>çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº<code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡</strong>æ”¾å…¥é˜Ÿåˆ—</strong>ï¼›</li><li>å¦‚æœè¿™ä¸ªæ—¶å€™<strong>é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äº<code>maximumPoolSize</code><strong>ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦</strong>åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡</strong>ï¼›</li><li>å¦‚æœ<strong>é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº<code>maximumPoolSize</code><strong>ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨</strong>é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œ</strong>ã€‚</li></ol></li><li>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼š<strong>ä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ</strong>ã€‚</li><li>å½“ä¸€ä¸ªçº¿ç¨‹<strong>æ— äº‹å¯åš</strong>è¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆ**<code>keepAliveTime</code>**ï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­ï¼š<ol><li>å¦‚æœå½“å‰<strong>è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº<code>corePoolSize</code><strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«</strong>åœæ‰</strong>ã€‚</li><li>æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°**<code>corePoolSize</code>**çš„å¤§å°ã€‚</li></ol></li></ol><h3 id="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥-â¸"><a href="#çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥-â¸" class="headerlink" title="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ â¸"></a>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ â¸</h3><h4 id="æ˜¯ä»€ä¹ˆ-â“-3"><a href="#æ˜¯ä»€ä¹ˆ-â“-3" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h4><blockquote><p><strong>ç­‰å¾…é˜Ÿåˆ—å·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†</strong>ã€‚åŒæ—¶ï¼Œ<strong>çº¿ç¨‹æ± ä¸­çš„ max çº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡</strong>ã€‚è¿™ä¸ªæ˜¯æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><ul><li>JDK å†…ç½®çš„æ‹’ç»ç­–ç•¥<ul><li><strong>AbortPolicy(é»˜è®¤)ï¼š</strong>ç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</li><li><strong>CallerRunsPolicyï¼š</strong>â€œè°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ã€‚</li><li><strong>DiscardOldestPolicyï¼š</strong>æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ äººé˜Ÿåˆ—ä¸­ å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li><li><strong>DiscardPolicyï¼š</strong>è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§ç­–ç•¥ã€‚</li></ul></li><li>ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº† <code>RejectedExecutionHandle</code>æ¥å£</li></ul><h3 id="çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜-â“"><a href="#çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜-â“" class="headerlink" title="çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜ â“"></a>çº¿ç¨‹æ± çš„ä¸€äº›é—®é¢˜ â“</h3><h4 id="åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘"><a href="#åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘" class="headerlink" title="åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘"></a>åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿè¶…çº§å¤§å‘</h4><p>==<strong>ç­”æ¡ˆæ˜¯ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œæˆ‘ä»¬å·¥ä½œä¸­åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„</strong>==</p><p>Executors ä¸­ JDK å·²ç»ç»™ä½ æä¾›äº†ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ï¼Ÿ</p><p>é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œä¸­è§„å®š</p><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413202451128.png" alt="image-20210413202451128"></p><h4 id="åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± "><a href="#åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± " class="headerlink" title="åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± "></a>åœ¨å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="number">5</span>,</span><br><span class="line">            <span class="number">2L</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">3</span>),</span><br><span class="line">            Executors.defaultThreadFactory(),</span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.AbortPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.CallerRunsPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.DiscardOldestPolicy()</span></span><br><span class="line">            <span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy()</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">threadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//å›ºå®šæ•°çš„çº¿ç¨‹æ± ï¼Œä¸€æ± äº”çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ5ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œ1ä¸ªå—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line">        ExecutorService threadPool = Executors.newCachedThreadPool(); <span class="comment">//ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ï¼Œå¯æ‰©å±•å—ç†ä¸šåŠ¡çš„çª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ”¯åˆå¹¶æ¡†æ¶-ğŸ”±"><a href="#åˆ†æ”¯åˆå¹¶æ¡†æ¶-ğŸ”±" class="headerlink" title="åˆ†æ”¯åˆå¹¶æ¡†æ¶ ğŸ”±"></a>åˆ†æ”¯åˆå¹¶æ¡†æ¶ ğŸ”±</h2><h3 id="æ˜¯ä»€ä¹ˆ-â“-4"><a href="#æ˜¯ä»€ä¹ˆ-â“-4" class="headerlink" title="æ˜¯ä»€ä¹ˆ â“"></a>æ˜¯ä»€ä¹ˆ â“</h3><blockquote><p>å¯ä»¥å°†ä»»åŠ¡è¿›è¡Œåˆ†å‘å¹¶å¯ç”¨ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œå¯ä»¥ç†è§£æˆå¤šçº¿ç¨‹ç‰ˆçš„é€’å½’,å› ä¸ºåœ¨æ‰§è¡Œæ¨¡å‹ä¸Šè¿˜æŒºåƒçš„</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413203059515.png" alt="image-20210413203059515"></p><p><strong>ä¸»è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</strong></p><ul><li>Forkï¼šæŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡è¿›è¡Œåˆ†æ‹†ï¼Œå¤§äº‹åŒ–å°</li><li>Joinï¼šæŠŠåˆ†æ‹†ä»»åŠ¡çš„ç»“æœè¿›è¡Œåˆå¹¶</li></ul><h3 id="ç›¸å…³ç±»-ğŸ™„"><a href="#ç›¸å…³ç±»-ğŸ™„" class="headerlink" title="ç›¸å…³ç±» ğŸ™„"></a>ç›¸å…³ç±» ğŸ™„</h3><h4 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001-1618317139087.jpg" alt="graphic"></p><p>åˆ†æ”¯åˆå¹¶æ±  ç±»æ¯”=&gt; çº¿ç¨‹æ± </p><h4 id="ForkJoinTask"><a href="#ForkJoinTask" class="headerlink" title="ForkJoinTask"></a>ForkJoinTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618317139089.jpg" alt="graphic"></p><p>ForkJoinTask ç±»æ¯”=&gt; FutureTask</p><h4 id="RecursiveTask"><a href="#RecursiveTask" class="headerlink" title="RecursiveTask"></a>RecursiveTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003-1618317139089.jpg" alt="graphic"></p><p>é€’å½’ä»»åŠ¡ï¼šç»§æ‰¿åå¯ä»¥å®ç°é€’å½’(è‡ªå·±è°ƒè‡ªå·±)è°ƒç”¨çš„ä»»åŠ¡</p><h3 id="ä»£ç ä¸¾ä¾‹-ğŸ‘©â€ğŸ’»"><a href="#ä»£ç ä¸¾ä¾‹-ğŸ‘©â€ğŸ’»" class="headerlink" title="ä»£ç ä¸¾ä¾‹ ğŸ‘©â€ğŸ’»"></a>ä»£ç ä¸¾ä¾‹ ğŸ‘©â€ğŸ’»</h3><h4 id="å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—"></a>å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> n;</span><br><span class="line">    Fibonacci(<span class="keyword">int</span> n) &#123; <span class="keyword">this</span>.n = n; &#125;</span><br><span class="line">    <span class="function">Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        Fibonacci f1 = <span class="keyword">new</span> Fibonacci(n - <span class="number">1</span>);</span><br><span class="line">        f1.fork();</span><br><span class="line">        Fibonacci f2 = <span class="keyword">new</span> Fibonacci(n - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> f2.compute() + f1.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ç°ä¸€åŠ åˆ°ä¸€ç™¾"><a href="#å®ç°ä¸€åŠ åˆ°ä¸€ç™¾" class="headerlink" title="å®ç°ä¸€åŠ åˆ°ä¸€ç™¾"></a>å®ç°ä¸€åŠ åˆ°ä¸€ç™¾</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ADJUST_VALUE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> begin;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.begin = begin;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((end - begin)&lt;=ADJUST_VALUE)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =begin;i &lt;= end;i++)&#123;</span><br><span class="line">                result = result + i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> middle = (begin + end)/<span class="number">2</span>;</span><br><span class="line">            MyTask task01 = <span class="keyword">new</span> MyTask(begin,middle);</span><br><span class="line">            MyTask task02 = <span class="keyword">new</span> MyTask(middle+<span class="number">1</span>,end);</span><br><span class="line">            task01.fork();</span><br><span class="line">            task02.fork();</span><br><span class="line">            result =  task01.join() + task02.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ”¯åˆå¹¶ä¾‹å­</span></span><br><span class="line"><span class="comment"> * ForkJoinPool</span></span><br><span class="line"><span class="comment"> * ForkJoinTask</span></span><br><span class="line"><span class="comment"> * RecursiveTask</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForkJoinDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyTask myTask = <span class="keyword">new</span> MyTask(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        ForkJoinTask&lt;Integer&gt; forkJoinTask = forkJoinPool.submit(myTask);</span><br><span class="line"></span><br><span class="line">        System.out.println(forkJoinTask.get());</span><br><span class="line"></span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼‚æ­¥å›è°ƒ-ğŸ”"><a href="#å¼‚æ­¥å›è°ƒ-ğŸ”" class="headerlink" title="å¼‚æ­¥å›è°ƒ ğŸ”"></a>å¼‚æ­¥å›è°ƒ ğŸ”</h2><blockquote><p>è¿™ä¸ªå¾ˆç®€å•å•¦,å°±æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¼‚æ­¥çš„è°ƒç”¨ä½ æ‰€å†™çš„æ–¹æ³•,åªä¸è¿‡å¯¹æ‰§è¡Œé€”ä¸­çš„å„ä¸ªç¯èŠ‚æœ‰æä¾›å›è°ƒ,å¯ä»¥çµæ´»çš„å¤„ç†,æ¯”å¦‚å‡ºç°å¼‚å¸¸ä¼šè°ƒç”¨<code>exceptionally</code>å‡½æ•°ä¸­ä¼ å…¥çš„å›è°ƒå‡½æ•°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413204257768.png" alt="image-20210413204257768"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œå¼‚æ­¥å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŒæ­¥</span></span><br><span class="line">        <span class="comment">//        CompletableFuture&lt;Void&gt; completableFuture1 = CompletableFuture.runAsync(()-&gt;&#123;</span></span><br><span class="line">        <span class="comment">//            System.out.println(Thread.currentThread().getName()+&quot;\t completableFuture1&quot;);</span></span><br><span class="line">        <span class="comment">//        &#125;);</span></span><br><span class="line">        <span class="comment">//        completableFuture1.get();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t completableFuture2&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        completableFuture2.whenComplete((t,u)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-------t=&quot;</span>+t);</span><br><span class="line">            System.out.println(<span class="string">&quot;-------u=&quot;</span>+u);</span><br><span class="line">        &#125;).exceptionally(f-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----exception:&quot;</span>+f.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">444</span>;</span><br><span class="line">        &#125;).get();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> JUC </category>
          
          <category> é«˜å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> JUC </tag>
            
            <tag> é«˜å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ å­¦ä¹ ç¬”è®°</title>
      <link href="2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/"/>
      <url>2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/</url>
      
        <content type="html"><![CDATA[<p>æ€ç»´å¯¼å›¾è½¬markdown å¾…æ•´ç†</p><span id="more"></span><h1 id="å¤§è¯æ•°æ®ç»“æ„"><a href="#å¤§è¯æ•°æ®ç»“æ„" class="headerlink" title="å¤§è¯æ•°æ®ç»“æ„"></a>å¤§è¯æ•°æ®ç»“æ„</h1><h2 id="ç¬¬ä¸€ç« -æ•°æ®ç»“æ„ç»ªè®ºï¼ˆP1ï¼‰"><a href="#ç¬¬ä¸€ç« -æ•°æ®ç»“æ„ç»ªè®ºï¼ˆP1ï¼‰" class="headerlink" title="ç¬¬ä¸€ç«  æ•°æ®ç»“æ„ç»ªè®ºï¼ˆP1ï¼‰"></a>ç¬¬ä¸€ç«  æ•°æ®ç»“æ„ç»ªè®ºï¼ˆP1ï¼‰</h2><h3 id="æ•°æ®ç»“æ„æ¦‚å¿µï¼šæ•°æ®ç»“æ„æ˜¯ä¸€é—¨ç ”ç©¶éæ•°å€¼è®¡ç®—çš„ç¨‹åºè®¾è®¡é—®é¢˜ä¸­çš„æ“ä½œå¯¹è±¡ï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»å’Œæ“ä½œç­‰ç›¸å…³é—®é¢˜çš„å­¦ç§‘ã€‚"><a href="#æ•°æ®ç»“æ„æ¦‚å¿µï¼šæ•°æ®ç»“æ„æ˜¯ä¸€é—¨ç ”ç©¶éæ•°å€¼è®¡ç®—çš„ç¨‹åºè®¾è®¡é—®é¢˜ä¸­çš„æ“ä½œå¯¹è±¡ï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»å’Œæ“ä½œç­‰ç›¸å…³é—®é¢˜çš„å­¦ç§‘ã€‚" class="headerlink" title="æ•°æ®ç»“æ„æ¦‚å¿µï¼šæ•°æ®ç»“æ„æ˜¯ä¸€é—¨ç ”ç©¶éæ•°å€¼è®¡ç®—çš„ç¨‹åºè®¾è®¡é—®é¢˜ä¸­çš„æ“ä½œå¯¹è±¡ï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»å’Œæ“ä½œç­‰ç›¸å…³é—®é¢˜çš„å­¦ç§‘ã€‚"></a>æ•°æ®ç»“æ„æ¦‚å¿µï¼šæ•°æ®ç»“æ„æ˜¯ä¸€é—¨ç ”ç©¶éæ•°å€¼è®¡ç®—çš„ç¨‹åºè®¾è®¡é—®é¢˜ä¸­çš„æ“ä½œå¯¹è±¡ï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»å’Œæ“ä½œç­‰ç›¸å…³é—®é¢˜çš„å­¦ç§‘ã€‚</h3><ul><li>éæ•°å€¼è®¡ç®—ï¼šæ—©æœŸäººä»¬è®¤ä¸ºè®¡ç®—æœºæ˜¯ç”¨æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥è®¡ç®—æœºè§£å†³é—®é¢˜ï¼Œåº”è¯¥æ˜¯å…ˆä»å…·ä½“é—®é¢˜ä¸­æŠ½è±¡å‡ºä¸€ä¸ªé€‚å½“çš„æ•°æ®æ¨¡å‹ï¼Œè®¾è®¡å‡ºä¸€ä¸ªè§£å†³æ­¤æ•°æ®æ¨¡å‹çš„ç®—æ³•ï¼Œç„¶åå†ç¼–å†™ç¨‹åºã€‚ä½†æ˜¯ç°å®ä¸­æˆ‘ä»¬æ›´å¤šçš„ä¸æ˜¯è§£å†³æ•°å€¼è®¡ç®—çš„é—®é¢˜ï¼Œè€Œæ˜¯éœ€è¦ä¸€äº›æ›´ç§‘å­¦æœ‰æ•ˆçš„æ‰‹æ®µ(æ¯”å¦‚è¡¨ã€æ ‘å’Œå›¾ç­‰æ•°æ®ç»“æ„)çš„å¸®åŠ©ï¼Œæ‰èƒ½æ›´å¥½åœ°å¤„ç†é—®é¢˜</li></ul><h3 id="åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­-ç¨‹åºè®¾è®¡-æ•°æ®ç»“æ„-ç®—æ³•"><a href="#åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­-ç¨‹åºè®¾è®¡-æ•°æ®ç»“æ„-ç®—æ³•" class="headerlink" title="åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­ ç¨‹åºè®¾è®¡=æ•°æ®ç»“æ„+ç®—æ³•"></a>åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­ ç¨‹åºè®¾è®¡=æ•°æ®ç»“æ„+ç®—æ³•</h3><ul><li><p>æ•°æ®ï¼šæ˜¯æè¿°å®¢è§‚äº‹ç‰©çš„ç¬¦å·ï¼Œæ˜¯è®¡ç®—æœºä¸­å¯ä»¥æ“ä½œçš„å¯¹è±¡ï¼Œæ˜¯èƒ½è¢«è®¡ç®—æœºè¯†åˆ«ï¼Œå¹¶è¾“å…¥ç»™è®¡ç®—æœºå¤„ç†çš„ç¬¦å·é›†åˆã€‚</p><ul><li><p>æ¯”å¦‚MP3æ˜¯å£°éŸ³æ•°æ®ï¼Œå›¾ç‰‡æ˜¯å›¾åƒæ•°æ®ã€‚æ•°æ®å°±æ˜¯ç¬¦å·ï¼Œè¿™äº›ç¬¦å·å¿…é¡»å…·å¤‡ä¸¤ä¸ªå‰æ</p><ul><li>å¯ä»¥è¾“å…¥åˆ°è®¡ç®—æœºä¸­</li><li>èƒ½è¢«è®¡ç®—æœºç¨‹åºå¤„ç†</li></ul></li><li><p>å¯¹äºå­—ç¬¦å‹æ•°æ®ç±»å‹å°±è¦è¿›è¡Œéæ•°å€¼çš„å¤„ç†ã€‚è€Œå£°éŸ³ã€å›¾ç‰‡ã€è§†é¢‘ç­‰å¯ä»¥é€šè¿‡ç¼–ç æ‰‹æ®µå˜æˆå­—ç¬¦æ•°æ®æ¥å¤„ç†</p></li></ul></li><li><p>æ•°æ®å…ƒç´ ï¼šæ˜¯ç»„æˆæ•°æ®çš„ã€æœ‰ä¸€å®šæ„ä¹‰çš„åŸºæœ¬å•ä½ï¼Œåœ¨è®¡ç®—æœºä¸­é€šå¸¸ä½œä¸ºæ•´ä½“å¤„ç†ã€‚ä¹Ÿè¢«æˆä¸ºè®°å½•</p><p>æ¯”å¦‚åœ¨äººç±»ä¸­äººå°±æ˜¯æ•°æ®å…ƒç´ ã€‚äººç±»å°±æ˜¯æ•°æ®ï¼Œè€Œäººå°±æ˜¯æ•°æ®å…ƒç´ <br>ç‰›ã€é©¬ã€ç¾Šã€é¸¡ã€çŒªã€ç‹—ç­‰åŠ¨ç‰©å½“ç„¶å°±æ˜¯ç¦½ç±»çš„æ•°æ®å…ƒç´ <br>æ•°æ®æ˜¯ä¸€ä¸ªæŠ½è±¡çš„è¡¨ç¤º<br>æ•°æ®å…ƒç´ æ˜¯æ•°æ®æ‰€æ‹¥æœ‰çš„â€œæ ‡ç­¾â€</p></li><li><p>æ•°æ®é¡¹ï¼šä¸€ä¸ªæ•°æ®å…ƒç´ å¯ä»¥ç”±è‹¥å¹²ä¸ªæ•°æ®é¡¹ç»„æˆ</p><p>æ¯”å¦‚äººè¿™ä¸ªæ•°æ®å…ƒç´ ï¼Œå¯ä»¥æœ‰çœ¼ã€è€³ã€å£ã€é¼»è¿™äº›æ•°æ®é¡¹ï¼Œä¹Ÿå¯ä»¥æœ‰å§“åã€å¹´é¾„ã€æ€§åˆ«è¿™äº›æ•°æ®é¡¹ï¼Œå…·ä½“æœ‰å“ªäº›æ•°æ®é¡¹æ˜¯æ ¹æ®ä½ åšçš„ç³»ç»Ÿæ¥å†³å®šçš„ã€‚</p><ul><li>æ•°æ®é¡¹æ˜¯æ•°æ®ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½</li></ul></li><li><p>æ•°æ®å¯¹è±¡ï¼šæ˜¯æ€§è´¨ç›¸åŒçš„æ•°æ®å…ƒç´ çš„é›†åˆï¼Œæ˜¯æ•°æ®çš„å­é›†</p><p>ä»€ä¹ˆå«æ€§è´¨ç›¸åŒå‘¢ï¼Ÿæ˜¯æŒ‡æ•°æ®å…ƒç´ å…·æœ‰ç›¸åŒæ•°é‡å’Œç±»å‹çš„æ•°æ®é¡¹ï¼Œæ¯”å¦‚äºº è¿™ä¸ªä¾‹å­ï¼Œéƒ½æœ‰å§“åã€ç”Ÿæ—¥ã€æ€§åˆ«ç­‰ç›¸åŒçš„æ•°æ®é¡¹ã€‚<br>æ—¢ç„¶æ•°æ®å¯¹è±¡æ˜¯æ•°æ®çš„å­é›†ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¤„ç†çš„æ•°æ®å…ƒç´ é€šå¸¸å…·æœ‰ç›¸åŒæ€§è´¨ï¼Œåœ¨ä¸äº§ç”Ÿæ··æ·†çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æ•°æ®å¯¹è±¡ç®€ç§°ä¸ºæ•°æ®ã€‚</p></li><li><p>æ•°æ®ç»“æ„ï¼šæ˜¯ç›¸äº’ä¹‹é—´å­˜åœ¨ä¸€ç§æˆ–å¤šç§ç‰¹å®šå…³ç³»çš„æ•°æ®å…ƒç´ çš„é›†åˆ</p><p>ç»“æ„ï¼Œç®€å•çš„ç†è§£å°±æ˜¯å…³ç³»ï¼Œæ¯”å¦‚åˆ†å­ç»“æ„ï¼Œå°±æ˜¯ç»„æˆåˆ†å­çš„åŸå­ä¹‹é—´çš„æ’åˆ—æ–¹å¼ã€‚ä¸¥æ ¼å¸¦ä½ è¯´ï¼Œç»“æ„æ˜¯æŒ‡å„ä¸ªç»„æˆéƒ¨åˆ†ç›¸äº’æ­é…çš„æ’åˆ—çš„æ–¹å¼ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œä¸åŒæ•°æ®å…ƒç´ ä¹‹é—´ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯å­˜åœ¨ç‰¹å®šçš„å…³ç³»ï¼Œæˆ‘ä»¬å°†è¿™äº›å…³ç³»æˆä¸º ç»“æ„ã€‚</p></li></ul><h3 id="é€»è¾‘ç»“æ„ä¸ç‰©ç†ç»“æ„"><a href="#é€»è¾‘ç»“æ„ä¸ç‰©ç†ç»“æ„" class="headerlink" title="é€»è¾‘ç»“æ„ä¸ç‰©ç†ç»“æ„"></a>é€»è¾‘ç»“æ„ä¸ç‰©ç†ç»“æ„</h3><ul><li><p>æ•°æ®ç»“æ„åˆ†ä¸ºé€»è¾‘ç»“æ„å’Œç‰©ç†ç»“æ„</p></li><li><p>é€»è¾‘ç»“æ„</p><p>æ˜¯æŒ‡æ•°æ®å¯¹è±¡ä¸­æ•°æ®å…ƒç´ ä¹‹é—´çš„ç›¸äº’å…³ç³»</p><ul><li>é›†åˆç»“æ„ï¼šé›†åˆç»“æ„ä¸­çš„æ•°æ®å…ƒç´ é™¤äº†åŒå±ä¸ä¸€ä¸ªé›†åˆå¤–ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…¶ä»–å…³ç³»</li><li>çº¿æ€§ç»“æ„ï¼šçº¿æ€§ç»“æ„ä¸­çš„æ•°æ®å…ƒç´ ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»</li><li>æ ‘å½¢ç»“æ„ï¼šæ ‘å½¢ç»“æ„ä¸­çš„æ•°æ®å…ƒç´ ä¹‹é—´å­˜åœ¨ä¸€ç§ä¸€å¯¹å¤šçš„å±‚æ¬¡å…³ç³»</li><li>å›¾å½¢ç»“æ„ï¼šå›¾å½¢ç»“æ„çš„æ•°æ®å…ƒç´ æ˜¯å¤šå¯¹å¤šçš„å…³ç³»</li></ul></li><li><p>ç‰©ç†ç»“æ„</p><p>ç‰©ç†ç»“æ„æ˜¯æŒ‡æ•°æ®çš„é€»è¾‘ç»“æ„åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨å½¢å¼</p><ul><li><p>é¡ºåºå‚¨å­˜ç»“æ„ï¼šæ˜¯æŠŠæ•°æ®å…ƒç´ å­˜æ”¾åœ¨åœ°å€è¿ç»­çš„å‚¨å­˜å•å…ƒé‡Œï¼Œå…¶æ•°æ®é—´çš„é€»è¾‘å…³ç³»å’Œç‰©ç†å…³ç³»æ˜¯ä¸€è‡´çš„</p><ul><li>å¥½å¤„ï¼šæŸ¥æ‰¾æ—¶æ€§èƒ½æŸè€—ä½</li><li>åå¤„ï¼šæ’å…¥æ—¶å¦‚æœæ˜¯æœ«å°¾æ’å…¥è¿˜è¡Œï¼Œä½†æ˜¯ä¸€æ—¦ç‰µæ‰¯åˆ°åœ¨æŸä¸ªå…ƒç´ å‰åè¿›è¡Œæ’å…¥ä¼šæ¯”è¾ƒéº»çƒ¦</li></ul></li><li><p>é“¾å¼å­˜å‚¨ç»“æ„ï¼šæ˜¯æŠŠæ•°æ®å…ƒç´ å­˜æ”¾åˆ°ä»»æ„çš„å­˜å‚¨å•å…ƒé‡Œï¼Œè¿™ç»„å­˜å‚¨å•å…ƒå¯ä»¥æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸è¿ç»­çš„</p><ul><li>å¥½å¤„ï¼šé“¾å¼å­˜å‚¨æ— éœ€é¡ºåºæ’åˆ—åªéœ€è¦æŒ‡å®šä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®å…ƒç´ å³å¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æ•°æ®ç»“æ„å¯¹æ’å…¥å’Œåˆ é™¤éå¸¸å‹å¥½ï¼Œæ’å…¥å’Œåˆ é™¤æ—¶åªéœ€è¦ä¿®æ”¹ç›¸é‚»æ•°æ®å…ƒç´ çš„æŒ‡é’ˆå³å¯ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦äº‹å…ˆæŒ‡å®šå¥½æ•°æ®é•¿åº¦</li><li>åå¤„ï¼šæŸ¥æ‰¾æ—¶æ€§èƒ½ä¸å¦‚é¡ºåºå‚¨å­˜ç»“æ„ï¼›å½“å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆå‡ºç°äº†å¼‚å¸¸è¿™ä¸ªé“¾å¼ç»“æ„ä¹Ÿå°±æ–­è£‚äº†</li></ul></li></ul></li></ul><h3 id="æŠ½è±¡æ•°æ®ç±»å‹"><a href="#æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="æŠ½è±¡æ•°æ®ç±»å‹"></a>æŠ½è±¡æ•°æ®ç±»å‹</h3><ul><li><p>æ•°æ®ç±»å‹ï¼šæ˜¯æŒ‡ä¸€ç»„æ€§è´¨ç›¸åŒçš„å€¼çš„é›†åˆåŠå®šä¹‰åœ¨æ­¤é›†åˆä¸Šçš„ä¸€äº›æ“ä½œçš„æ€»ç§°</p><ul><li><p>ç†è§£æˆjavaçš„æ•°æ®ç±»å‹</p><p>javaçš„æ•°æ®ç±»å‹å¯åˆ†ä¸ºï¼š<br>åŸºç¡€æ•°æ®ç±»å‹ï¼šæ˜¯ä¸å¯å†åˆ†è§£çš„åŸºç¡€æ•°æ®ç±»å‹ï¼Œå¦‚charã€int<br>å¼•ç”¨æ•°æ®ç±»å‹ï¼šæ˜¯ç”±è‹¥å¹²ä¸ªåŸºç¡€æ•°æ®ç±»å‹ç»„æˆçš„ï¼Œæ˜¯å¯å†åˆ†è§£çš„æ•°æ®ç±»å‹ï¼Œå¦‚å­—ç¬¦æ•°ç»„ã€æ•´å½¢æ•°ç»„</p></li></ul></li><li><p>æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆAbstract Data Type,ADTï¼‰ï¼šæ˜¯æŒ‡ä¸€ä¸ªæ•°å­¦æ¨¡å‹åŠå®šä¹‰åœ¨è¯¥æ¨¡å‹ä¸Šçš„ä¸€ç»„æ“ä½œ</p><ul><li><p>â€œæŠ½è±¡â€çš„æ„ä¹‰åœ¨äºæ•°æ®ç±»å‹çš„æ•°å­¦æŠ½è±¡ç‰¹æ€§</p><p>å„ä¸ªè®¡ç®—æœºï¼Œä¸ç®¡æ˜¯å¤§å‹æœºã€å°å‹æœºã€PCã€å¹³æ¿ç”šè‡³æ‰‹æœºéƒ½æœ‰â€œæ•´æ•°â€ç±»å‹ï¼Œä¹Ÿéœ€è¦æ•´æ•°é—´çš„è¿ç®—ï¼Œé‚£ä¹ˆæ•´æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªæŠ½è±¡æ•°æ®ç±»å‹ï¼Œå°½ç®¡åœ¨ä¸Šé¢æåˆ°çš„é‚£äº›è®¡ç®—æœºä¸­çš„å®ç°æ–¹æ³•ä¸å¤ªä¸€æ ·ï¼Œä½†ç”±äºå…¶æ•°å­¦ç‰¹æ€§ç›¸åŒï¼Œå› æ­¤åœ¨ç¼–ç¨‹è€…çœ‹æ¥å®ƒä»¬éƒ½æ˜¯ç›¸åŒçš„</p></li><li><p>æŠ½è±¡æ•°æ®ç±»å‹ä½“ç°äº†ç¨‹åºè®¾è®¡ä¸­é—®é¢˜çš„åˆ†è§£ã€æŠ½è±¡å’Œä¿¡æ¯éšè—çš„ç‰¹æ€§</p><p>æŠ½è±¡æ•°æ®ç±»å‹æŠŠå®é™…ç”Ÿæ´»ä¸­çš„é—®é¢˜åˆ†è§£æˆå¤šä¸ªæ¨¡å—å°ä¸”å®¹æ˜“å¤„ç†çš„é—®é¢˜ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªè®¡ç®—æœºèƒ½å¤„ç†çš„æ•°æ®æ¨¡å‹ï¼Œå¹¶æŠŠæ¯ä¸ªåŠŸèƒ½æ¨¡å—çš„å®ç°ç»†èŠ‚ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œä»è€Œæ˜¯å…·ä½“å®ç°è¿‡ç¨‹éšè—èµ·æ¥</p></li><li><p>æè¿°æŠ½è±¡æ•°æ®ç±»å‹çš„æ ‡å‡†æ ¼å¼</p><p>ADT æŠ½è±¡æ•°æ®ç±»å‹åç§°<br>Data</p><pre><code>æ•°æ®å…ƒç´ ä¹‹é—´é€»è¾‘å…³ç³»çš„å®šä¹‰</code></pre><p>Operation</p><pre><code>æ“ä½œ1    åˆå§‹æ¡ä»¶    æ“ä½œç»“æœæè¿°æ“ä½œ2    ...æ“ä½œn    ...</code></pre><p>endADT</p></li></ul></li></ul><h2 id="ç¬¬äºŒç« -ç®—æ³•ï¼ˆP17ï¼‰"><a href="#ç¬¬äºŒç« -ç®—æ³•ï¼ˆP17ï¼‰" class="headerlink" title="ç¬¬äºŒç«  ç®—æ³•ï¼ˆP17ï¼‰"></a>ç¬¬äºŒç«  ç®—æ³•ï¼ˆP17ï¼‰</h2><p>ç®—æ³•æ˜¯è§£å†³ç‰¹å®šé—®é¢˜æ±‚è§£æ­¥éª¤çš„æè¿°ï¼Œåœ¨è®¡ç®—æœºä¸­è¡¨ç°ä¸ºæŒ‡ä»¤çš„æœ‰é™åºåˆ—ï¼Œå¹¶ä¸”æ¯æ¡æŒ‡ä»¤è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œ</p><h3 id="æ•°æ®ç»“æ„ä¸ç®—æ³•å…³ç³»"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•å…³ç³»" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•å…³ç³»"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•å…³ç³»</h3><ul><li>æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯ç›¸è¾…ç›¸æˆçš„å…³ç³»ï¼Œæˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„éœ€è¦é€šè¿‡ç®—æ³•æ¥åŠ æ·±å°è±¡ï¼Œéœ€è¦é€šè¿‡ç®—æ³•æ¥ç†è§£æ•°æ®ç»“æ„</li></ul><h3 id="ç®—æ³•çš„ç‰¹æ€§"><a href="#ç®—æ³•çš„ç‰¹æ€§" class="headerlink" title="ç®—æ³•çš„ç‰¹æ€§"></a>ç®—æ³•çš„ç‰¹æ€§</h3><ul><li><p>è¾“å…¥è¾“å‡ºï¼šç®—æ³•å…·æœ‰é›¶ä¸ªæˆ–å¤šä¸ªè¾“å…¥ï¼Œç®—æ³•è‡³å°‘æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡º</p><ul><li>ç®—æ³•æ˜¯ä¸€å®šéœ€è¦è¾“å‡ºçš„ï¼Œä¸éœ€è¦è¾“å‡ºè¦ä½ ç”¨è¿™ä¸ªç®—æ³•å¹²å˜›ï¼Ÿ</li><li>è¾“å‡ºå¯ä»¥æ˜¯æ‰“å°è¾“å‡ºæˆ–è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</li></ul></li><li><p>æœ‰ç©·æ€§ï¼šæŒ‡ç®—æ³•åœ¨æ‰§è¡Œæœ‰é™çš„æ­¥éª¤ä¹‹åï¼Œè‡ªåŠ¨ç»“æŸè€Œä¸ä¼šå‡ºç°æ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ¯ä¸ªæ­¥éª¤åœ¨å¯æ¥å—çš„æ—¶é—´å®Œæˆ</p><ul><li><p>è¿™é‡Œçš„æœ‰ç©·æ€§ä¸æ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„ï¼Œè€Œæ˜¯å®é™…åº”ç”¨ä¸­åˆç†çš„ã€å¯ä»¥æ¥å—çš„â€œæœ‰è¾¹ç•Œâ€ã€‚</p><p>æ€»ä¸è‚¯è¯´ä½ å†™ä¸€ä¸ªç®—æ³•è®¡ç®—æœºè¦ç®—ä¸Š20å¹´ï¼Œä¸€å®šä¼šç»“æŸï¼Œåœ¨æ•°å­¦æ„ä¹‰ä¸Šæ˜¯æœ‰ç©·çš„ï¼Œå¯æ˜¯20å¹´ä¹Ÿå¤ªä¹…äº†å§ï¼Œé‚£ä¹ˆè¿™ä¸ªç®—æ³•çš„æ„ä¹‰ä¹Ÿå°±ä¸å¤§äº†</p></li></ul></li><li><p>ç¡®å®šæ€§ï¼šç®—æ³•çš„æ¯ä¸€ä¸ªæ­¥éª¤éƒ½å…·æœ‰ç¡®å®šçš„å«ä¹‰ï¼Œä¸ä¼šå‡ºç°äºŒä¹‰æ€§</p><p>ç®—æ³•åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œåªæœ‰ä¸€æ¡æ‰§è¡Œè·¯å¾„ï¼Œç›¸åŒçš„è¾“å…¥åªèƒ½æœ‰å”¯ä¸€çš„è¾“å‡ºç»“æœã€‚ç®—æ³•çš„æ¯ä¸ªæ­¥éª¤è¢«ç²¾ç¡®å®šä¹‰è€Œæ— æ­§ä¹‰</p></li><li><p>å¯è¡Œæ€§ï¼šç®—æ³•æ¯ä¸€æ­¥éƒ½å¿…é¡»æ˜¯å¯è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ­¥éƒ½èƒ½é€šè¿‡æ‰§è¡Œæœ‰é™æ¬¡æ•°å®Œæˆã€‚</p><p>å¯è¡Œæ€§æ„å‘³ç€ç®—æ³•å¯ä»¥è½¬æ¢ä¸ºç¨‹åºä¸Šæœºè¿è¡Œï¼Œå¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœ</p></li></ul><h3 id="ç®—æ³•è®¾è®¡çš„è¦æ±‚"><a href="#ç®—æ³•è®¾è®¡çš„è¦æ±‚" class="headerlink" title="ç®—æ³•è®¾è®¡çš„è¦æ±‚"></a>ç®—æ³•è®¾è®¡çš„è¦æ±‚</h3><ul><li><p>æ­£ç¡®æ€§ï¼šç®—æ³•çš„æ­£ç¡®æ€§æ˜¯æŒ‡ç®—æ³•è‡³å°‘åº”è¯¥å…·æœ‰è¾“å…¥ã€è¾“å‡ºå’ŒåŠ å·¥å¤„ç†æ— æ­§ä¹‰æ€§ã€èƒ½æ­£å¸¸åæ˜ é—®é¢˜çš„éœ€æ±‚ã€èƒ½å¤Ÿå¾—åˆ°é—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆã€‚</p><ul><li><p>ç®—æ³•çš„æ­£ç¡®æ€§å¤§ä½“åˆ†ä¸ºå››ä¸ªå±‚æ¬¡</p><ul><li>1ã€ç®—æ³•ç¨‹åºæ²¡æœ‰è¯­æ³•é”™è¯¯</li><li>2ã€ç®—æ³•ç¨‹åºå¯¹äºåˆæ³•çš„è¾“å…¥èƒ½å¤Ÿäº§ç”Ÿæ»¡è¶³è¦æ±‚çš„è¾“å‡ºç»“æœ</li><li>3ã€ç®—æ³•ç¨‹åºèƒ½å¯¹éæ³•çš„è¾“å…¥èƒ½å¤Ÿå¾—å‡ºæ»¡è¶³è§„æ ¼è¯´æ˜çš„è¾“å‡ºç»“æœ</li><li>4ã€ç®—æ³•ç¨‹åºå¯¹äºç²¾å¿ƒé€‰æ‹©çš„ï¼Œç”šè‡³åˆéš¾çš„æµ‹è¯•æ•°æ®éƒ½æœ‰æ»¡è¶³è¦æ±‚çš„è¾“å‡ºç»“æœã€‚</li></ul></li></ul></li><li><p>å¯è¯»æ€§ï¼šç®—æ³•è®¾è®¡çš„å¦ä¸€ç›®çš„æ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ã€ç†è§£å’Œäº¤æµ</p><ul><li>æˆ‘ä»¬åœ¨å†™ä»£ç çš„80%æ—¶é—´éƒ½èŠ±åœ¨é˜…è¯»å’Œç†è§£ä»£ç ä¸Šï¼Œæ‰€ä»¥å¯è¯»æ€§æ˜¯éå¸¸é‡è¦çš„</li></ul></li><li><p>å¥å£®æ€§ï¼šå½“è¾“å…¥æ•°æ®ä¸åˆæ³•æ—¶ï¼Œç®—æ³•ä¹Ÿèƒ½åšå‡ºç›¸å…³çš„å¤„ç†ï¼Œè€Œä¸æ˜¯äº§ç”Ÿå¼‚å¸¸æˆ–è«åå¥‡å¦™çš„ç»“æœã€‚</p><ul><li>æ‰€ä»¥åšå¥½è¾“å…¥æ ¡éªŒä¹Ÿæ˜¯å¿…è¦çš„</li></ul></li><li><p>æ—¶é—´æ•ˆç‡é«˜å’Œå‚¨å­˜é‡ä½</p><ul><li>æ—¶é—´æ•ˆç‡æŒ‡çš„æ˜¯ç®—æ³•ä»å¼€å§‹åˆ°ç»“æŸæ‰€æ¶ˆè€—çš„æœ€å¤§æ‰§è¡Œæ—¶é—´</li><li>å‚¨å­˜é‡æŒ‡çš„æ˜¯ç®—æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„æœ€å¤§å‚¨å­˜ç©ºé—´</li></ul></li></ul><h3 id="ç®—æ³•æ•ˆç‡çš„åº¦é‡æ–¹æ³•"><a href="#ç®—æ³•æ•ˆç‡çš„åº¦é‡æ–¹æ³•" class="headerlink" title="ç®—æ³•æ•ˆç‡çš„åº¦é‡æ–¹æ³•"></a>ç®—æ³•æ•ˆç‡çš„åº¦é‡æ–¹æ³•</h3><ul><li><p>äº‹åç»Ÿè®¡æ–¹æ³•</p><ul><li><p>è¿™ç§æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡è®¾è®¡å¥½çš„æµ‹è¯•ç¨‹åºå’Œæ•°æ®ï¼Œåˆ©ç”¨è®¡ç®—æœºè®¡æ—¶å™¨å¯¹ä¸åŒç®—æ³•ç¼–åˆ¶çš„ç¨‹åºçš„è¿è¡Œæ—¶é—´æ¯”è¾ƒï¼Œä»è€Œç¡®å®šç®—æ³•æ•ˆç‡é«˜ä½</p></li><li><p>ç¼ºé™·</p><ul><li>å¿…é¡»ä¾æ®ç®—æ³•äº‹å…ˆç¼–åˆ¶å¥½ç¨‹åºï¼Œè¿™é€šå¸¸éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›</li><li>æ—¶é—´çš„æ¯”è¾ƒä¾èµ–è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶ç­‰ç¯å¢ƒå› ç´ ï¼Œæœ‰æ—¶ä¼šæ©ç›–ç®—æ³•æœ¬èº«ä¼˜åŠ£</li><li>ç®—æ³•çš„æµ‹è¯•æ•°æ®è®¾è®¡å›°éš¾ï¼Œè€Œä¸”ç¨‹åºçš„è¿è¡Œæ—¶é—´å¾€å¾€è¿˜ä¸æµ‹è¯•æ•°æ®çš„è§„æ¨¡æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œæ•ˆç‡é«˜çš„ç®—æ³•ç¨‹åºåœ¨å°çš„æµ‹è¯•æ•°æ®é¢å‰å¾€å¾€å¾—ä¸åˆ°ä½“ç°ã€‚</li></ul></li></ul></li><li><p>äº‹å‰åˆ†æä¼°ç®—æ–¹æ³•</p><ul><li><p>åœ¨è®¡ç®—æœºç¨‹åºç¼–åˆ¶å‰ï¼Œä¾æ®ç»Ÿè®¡æ–¹æ³•å¯¹ç®—æ³•è¿›è¡Œä¼°ç®—</p></li><li><p>é«˜çº§ç¨‹åºè¯­è¨€ç¼–å†™çš„ç¨‹åºåœ¨è®¡ç®—æœºä¸Šè¿è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´å–å†³äºä¸‹åˆ—å› ç´ </p><ul><li><p>1ã€ç®—æ³•é‡‡ç”¨çš„ç­–ç•¥ã€æ–¹æ³•</p><ul><li>ç®—æ³•å¥½åçš„æ ¹æœ¬</li></ul></li><li><p>2ã€ç¼–è¯‘äº§ç”Ÿçš„ä»£ç è´¨é‡</p><ul><li>è¦ç”±è½¯ä»¶(ç¼–è¯‘å™¨)æ¥æ”¯æŒ</li></ul></li><li><p>3ã€é—®é¢˜è¾“å…¥çš„è§„æ¨¡</p><ul><li>é—®é¢˜çš„è¾“å…¥é‡çš„å¤šå°‘</li></ul></li><li><p>4ã€æœºå™¨æ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦</p><ul><li>è¦çœ‹ç¡¬ä»¶çš„æ€§èƒ½</li></ul></li></ul></li></ul></li></ul><h3 id="å‡½æ•°çš„æ¸è¿‘å¢é•¿"><a href="#å‡½æ•°çš„æ¸è¿‘å¢é•¿" class="headerlink" title="å‡½æ•°çš„æ¸è¿‘å¢é•¿"></a>å‡½æ•°çš„æ¸è¿‘å¢é•¿</h3><ul><li>ç»™å®šä¸¤ä¸ªå‡½æ•° f(n) å’Œ g(n) ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ•´æ•°Nï¼Œä½¿å¾—å¯¹äºæ‰€æœ‰ n &gt; Nï¼Œf(n) æ€»æ˜¯æ¯” g(n) å¤§ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬è¯´ f(n) çš„å¢é•¿æ¸è¿‘å¿«ä¸ g(n)</li></ul><h3 id="ç®—æ³•æ—¶é—´å¤æ‚åº¦"><a href="#ç®—æ³•æ—¶é—´å¤æ‚åº¦" class="headerlink" title="ç®—æ³•æ—¶é—´å¤æ‚åº¦"></a>ç®—æ³•æ—¶é—´å¤æ‚åº¦</h3><ul><li><p>åœ¨è¿›è¡Œç®—æ³•åˆ†ææ—¶ï¼Œè¯­å¥çš„æ‰§è¡Œæ¬¡æ•° T(n) æ˜¯å…³äºé—®é¢˜è§„æ¨¡ n çš„å‡½æ•°ï¼Œè¿›è€Œåˆ†æ T(n) éš n çš„å˜åŒ–æƒ…å†µå¹¶ç¡®å®š T(n) çš„æ•°é‡çº§ã€‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¹Ÿå°±æ˜¯ç®—æ³•çš„æ—¶é—´é‡åº¦ï¼Œè®°ä½œï¼šT(n) = O(f(n))ã€‚å®ƒè¡¨ç¤ºéšé—®é¢˜è§„æ¨¡ n çš„å¢å¤§ï¼Œç®—æ³•æ‰§è¡Œæ—¶é—´çš„å¢é•¿ç‡å’Œ f(n) çš„å¢é•¿ç‡ç›¸åŒï¼Œç§°ä½œç®—æ³•çš„æ¸è¿‘æ—¶é—´å¤æ‚åº¦ï¼Œç®€ç§°ä¸ºæ—¶é—´å¤æ‚åº¦ã€‚å…¶ä¸­ f(n) æ˜¯é—®é¢˜è§„æ¨¡nçš„æŸä¸ªå‡½æ•°ã€‚</p><ul><li>è¿™æ ·ç”¨å¤§å†™ O() æ¥ä½“ç°ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦çš„è®°æ³•ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¤§Oè®°æ³•ã€‚</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéšç€nçš„å¢å¤§ï¼ŒT(n)çš„å¢é•¿æœ€æ…¢çš„ç®—æ³•ä¸ºæœ€ä¼˜ç®—æ³•</li></ul></li><li><p>æ¨å¯¼å¤§Oé˜¶æ–¹æ³•</p><ul><li>1ã€ç”¨å¸¸æ•°1å–ä»£è¿è¡Œæ—¶é—´ä¸­æ‰€æœ‰åŠ æ³•å¸¸æ•°</li><li>2ã€åœ¨ä¿®æ”¹åçš„è¿è¡Œæ¬¡æ•°å‡½æ•°ä¸­ï¼Œåªä¿ç•™æœ€é«˜é˜¶</li><li>3ã€å¦‚æœæœ€é«˜é˜¶å­˜åœ¨ä¸”ä¸æ˜¯1ï¼Œåˆ™å»é™¤ä¸è¿™ä¸ªé¡¹ç›¸ä¹˜çš„å¸¸æ•°</li></ul></li><li><p>å¸¸è§çš„æ—¶é—´å¤æ‚åº¦</p><ul><li><p>å¸¸æ•°é˜¶ï¼šO(1)</p></li><li><p>çº¿æ€§é˜¶ï¼šO(n)</p></li><li><p>å¹³æ–¹é˜¶ï¼šO(n^2)</p></li><li><p>å¯¹æ•°é˜¶ï¼šO(long n)</p></li><li><p>nlogné˜¶ï¼šO(nlog n)</p></li><li><p>ç«‹æ–¹é˜¶ï¼šO(n^3)</p></li><li><p>æŒ‡æ•°é˜¶ï¼šO(2^n)</p></li><li><p>å¸¸è§çš„æ—¶é—´å¤æ‚åº¦æ‰€è€—è´¹æ—¶é—´ä»å°åˆ°å¤§ä¾æ¬¡æ˜¯</p><ul><li>å¸¸æ•°é˜¶ &lt; å¯¹æ•°é˜¶ &lt; çº¿æ€§é˜¶ &lt; nlogné˜¶ &lt; å¹³æ–¹é˜¶ &lt; ç«‹æ–¹é˜¶ &lt; æŒ‡æ•°é˜¶</li></ul></li></ul></li><li><p>æœ€åæƒ…å†µä¸å¹³å‡æƒ…å†µ</p><ul><li><p>æœ€åæƒ…å†µè¿è¡Œæ—¶é—´æ˜¯ä¸€ç§ä¿è¯ï¼Œé‚£å°±æ˜¯è¿è¡Œæ—¶é—´å°†ä¸ä¼šå†åäº†ã€‚åœ¨åº”ç”¨ä¸­ï¼Œè¿™æ˜¯ä¸€ç§é‡è¦çš„éœ€æ±‚ã€‚</p></li><li><p>å¹³å‡è¿è¡Œæ—¶é—´æ˜¯æ‰€æœ‰æƒ…å†µä¸­æœ€æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒæ˜¯æœŸæœ›çš„è¿è¡Œæ—¶é—´</p><ul><li>åœ¨ç°å®ä¸­ï¼Œå¹³å‡æ—¶é—´å¾ˆéš¾é€šè¿‡åˆ†æå¾—åˆ°ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡è¿è¡Œä¸€å®šæ•°é‡çš„å®éªŒæ•°æ®åä¼°ç®—å‡ºæ¥çš„</li></ul></li><li><p>ä¸€èˆ¬åœ¨æ²¡æœ‰ç‰¹æ®Šè¯´æ˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æåˆ°çš„è¿è¡Œæ—¶é—´éƒ½æ˜¯æœ€åæƒ…å†µçš„è¿è¡Œæ—¶é—´</p></li></ul></li></ul><h3 id="ç®—æ³•ç©ºé—´å¤æ‚åº¦"><a href="#ç®—æ³•ç©ºé—´å¤æ‚åº¦" class="headerlink" title="ç®—æ³•ç©ºé—´å¤æ‚åº¦"></a>ç®—æ³•ç©ºé—´å¤æ‚åº¦</h3><ul><li><p>æ—¶é—´å¤æ‚åº¦çš„è®¡ç®—å…¬å¼è®°ä½œï¼šS(n) = O(f(n)) ï¼Œå…¶ä¸­nä¸ºé—®é¢˜çš„è§„æ¨¡ï¼Œf (n) ä¸ºè¯­å¥å…³äºnæ‰€å å­˜å‚¨ç©ºé—´çš„å‡½æ•°</p></li><li><p>å¸¸è§çš„ç©ºé—´å¤æ‚åº¦</p><p>å¦‚æœéšç€è¾“å…¥å€¼ n çš„å¢å¤§ï¼Œç¨‹åºç”³è¯·çš„ä¸´æ—¶ç©ºé—´æˆçº¿æ€§å¢é•¿ï¼Œåˆ™ç¨‹åºçš„ç©ºé—´å¤æ‚åº¦ç”¨ O(n) è¡¨ç¤º;<br>å¦‚æœéšç€è¾“å…¥å€¼ n çš„å¢å¤§ï¼Œç¨‹åºç”³è¯·çš„ä¸´æ—¶ç©ºé—´æˆ n2Â å…³ç³»å¢é•¿ï¼Œåˆ™ç¨‹åºçš„ç©ºé—´å¤æ‚åº¦ç”¨ O(n2) è¡¨ç¤ºï¼›<br>å¦‚æœéšç€è¾“å…¥å€¼ n çš„å¢å¤§ï¼Œç¨‹åºç”³è¯·çš„ä¸´æ—¶ç©ºé—´æˆ n3Â å…³ç³»å¢é•¿ï¼Œåˆ™ç¨‹åºçš„ç©ºé—´å¤æ‚åº¦ç”¨ O(n3) è¡¨ç¤ºï¼›</p><ul><li><p>O(1)</p><p>å¦‚æœç®—æ³•æ‰§è¡Œæ‰€éœ€è¦çš„ä¸´æ—¶ç©ºé—´ä¸éšç€æŸä¸ªå˜é‡nçš„å¤§å°è€Œå˜åŒ–ï¼Œå³æ­¤ç®—æ³•ç©ºé—´å¤æ‚åº¦ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œå¯è¡¨ç¤ºä¸º O(1)<br>ä¸¾ä¾‹ï¼š<br>int i = 1;<br>int j = 2;<br>++i;<br>j++;<br>int m = i + j;</p></li><li><p>O(n)</p><p>int[] m = new int[n]<br>for(i=1; i&lt;=n; ++i)<br>{<br>   j = i;<br>   j++;<br>}<br>è¿™æ®µä»£ç ä¸­ï¼Œç¬¬ä¸€è¡Œnewäº†ä¸€ä¸ªæ•°ç»„å‡ºæ¥ï¼Œè¿™ä¸ªæ•°æ®å ç”¨çš„å¤§å°ä¸ºnï¼Œè¿™æ®µä»£ç çš„2-6è¡Œï¼Œè™½ç„¶æœ‰å¾ªç¯ï¼Œä½†æ²¡æœ‰å†åˆ†é…æ–°çš„ç©ºé—´ï¼Œå› æ­¤ï¼Œè¿™æ®µä»£ç çš„ç©ºé—´å¤æ‚åº¦ä¸»è¦çœ‹ç¬¬ä¸€è¡Œå³å¯ï¼Œå³ S(n) = O(n)</p></li><li><p>O(n^2)</p></li></ul></li></ul><h2 id="ç¬¬ä¸‰ç« -çº¿æ€§è¡¨ï¼ˆP41ï¼‰"><a href="#ç¬¬ä¸‰ç« -çº¿æ€§è¡¨ï¼ˆP41ï¼‰" class="headerlink" title="ç¬¬ä¸‰ç«  çº¿æ€§è¡¨ï¼ˆP41ï¼‰"></a>ç¬¬ä¸‰ç«  çº¿æ€§è¡¨ï¼ˆP41ï¼‰</h2><h3 id="3-2-çº¿æ€§è¡¨çš„å®šä¹‰ï¼ˆP42ï¼‰"><a href="#3-2-çº¿æ€§è¡¨çš„å®šä¹‰ï¼ˆP42ï¼‰" class="headerlink" title="3.2 çº¿æ€§è¡¨çš„å®šä¹‰ï¼ˆP42ï¼‰"></a>3.2 çº¿æ€§è¡¨çš„å®šä¹‰ï¼ˆP42ï¼‰</h3><ul><li><p>çº¿æ€§è¡¨ï¼šé›¶ä¸ªæˆ–å¤šä¸ªæ•°æ®å…ƒç´ çš„æœ‰é™åºåˆ—</p></li><li><p>çº¿æ€§è¡¨å…ƒç´ ä¹‹é—´æ˜¯æœ‰é¡ºåºçš„ï¼Œè‹¥å…ƒç´ å­˜åœ¨å¤šä¸ªï¼Œåˆ™ç¬¬ä¸€ä¸ªå…ƒç´ æ— å‰é©±ï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ— åç»§ï¼Œå…¶ä»–æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸”åªæœ‰ä¸€ä¸ªå‰èº¯å’Œåç»§ã€‚</p></li><li><p>çº¿æ€§è¡¨å…ƒç´ çš„ä¸ªæ•°nï¼ˆn &gt;= 0ï¼‰å®šä¹‰ä¸ºçº¿æ€§è¡¨çš„é•¿åº¦ï¼Œå½“n=0æ—¶ï¼Œç§°ä¸ºç©ºè¡¨ã€‚</p></li><li><p>åœ¨è¾ƒå¤æ‚çš„çº¿æ€§è¡¨ä¸­ï¼Œä¸€ä¸ªæ•°æ®å…ƒç´ å¯ä»¥ç”±è‹¥å¹²ä¸ªæ•°æ®é¡¹ç»„æˆã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªç­çº§çš„ç‚¹åè¡¨ï¼Œå®ƒæ˜¯æœ‰é¡ºåºä¸”æœ‰é™çš„åºåˆ—ï¼Œä½†æ˜¯å®ƒé‡Œé¢çš„æ²¡ä¸€ä¸ªæ•°æ®å…ƒç´ æ˜¯ç”±å¤šä¸ªæ•°æ®é¡¹ç»„æˆçš„</p><p>|    å­¦å·    |    å§“å    |    æ€§åˆ«    |    å‡ºç”Ÿå¹´æœˆ    |<br>|    1            |    å¼ ä¸‰    |    ç”·        |    1994.4        |<br>|    2            |    æå››    |    å¥³        |    1994.7        |<br>|    3            |    ç‹äº”    |    ç”·        |    1994.12        |</p></li><li><p>ç»„æˆçº¿æ€§è¡¨çš„æ•°æ®ç±»å‹éœ€è¦ç›¸åŒ</p><p>æ¯”å¦‚æ’é˜Ÿä¹°æ¼”å”±ä¼šé—¨ç¥¨ï¼Œå¦‚æœä½ å‰é¢æœ‰ä¸ªäººæ‹¿ç€ä¸‰ä¸ªä¹¦åŒ…ç”¨æ¥å ä½ï¼Œé‚£ä¹ˆä½ ä¸ä¹æ„ï¼Œä¹¦åŒ…æ€ä¹ˆèƒ½ç®—æ’é˜Ÿçš„äººå˜ï¼Œå¦‚æœè¿™éƒ½ç®—çš„è¯ï¼Œé‚£ä¹ˆæˆ‘å…¨èº«ä¸Šä¸‹çš„è¡£æœè£¤å­å²‚ä¸æ˜¯ä¹Ÿç®—åœ¨æ’é˜Ÿå—ã€‚è¿™é‡Œä½¿ç”¨çº¿æ€§è¡¨çš„å®šä¹‰æ¥è¯´ï¼Œå°±æ˜¯ç»„æˆçº¿æ€§è¡¨çš„æ•°æ®ç±»å‹éœ€è¦ç›¸åŒ</p></li></ul><h3 id="3-3-çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP45ï¼‰"><a href="#3-3-çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP45ï¼‰" class="headerlink" title="3.3 çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP45ï¼‰"></a>3.3 çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP45ï¼‰</h3><p>DAT çº¿æ€§è¡¨ (List)<br>Data<br>    çº¿æ€§è¡¨çš„æ•°æ®å¯¹è±¡é›†åˆä¸º{a1, a2, â€¦.., an}ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹å‡ä¸º        DataTypeã€‚å…¶ä¸­ï¼Œé™¤ç¬¬ä¸€ä¸ªå…ƒç´  a1 å¤–ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æœ‰ä¸”åªæœ‰ä¸€ä¸ªç›´æ¥å‰èº¯å…ƒç´ ï¼Œé™¤äº†æœ€åä¸€ä¸ªå…ƒç´  an å¤–ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æœ‰ä¸”åªæœ‰ä¸€ä¸ªç›´æ¥åç»§å…ƒç´ ã€‚æ•°æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚<br>Operation<br>    L InitList()ï¼š    åˆå§‹åŒ–æ“ä½œï¼Œå»ºç«‹ä¸€ä¸ªç©ºçš„çº¿æ€§è¡¨Lã€‚<br>    boolean ListEmpty(L)ï¼š                    è‹¥çº¿æ€§è¡¨ä¸ºç©ºï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚<br>    ClearList(L)ï¼š                                        å°†çº¿æ€§è¡¨æ¸…ç©ºã€‚<br>    e GetElem(L, i)ï¼š                                å°†çº¿æ€§è¡¨Lä¸­çš„ç¬¬iä¸ªä½ç½®çš„å…ƒç´ è¿”å›ç»™eã€‚<br>    int LocateElem(L, e)ï¼š                    åœ¨çº¿æ€§è¡¨Lä¸­æŸ¥æ‰¾ä¸ç»™å®šå€¼ e ç›¸ç­‰çš„å…ƒç´ ï¼Œå¦‚æœæŸ¥æ‰¾æˆåŠŸï¼Œè¿”å›è¯¥å…ƒç´ åœ¨è¡¨ä¸­çš„åºå·ï¼›å¦åˆ™ï¼Œè¿”å›0è¡¨ç¤ºå¤±è´¥<br>    ListInsert(L, i, e)ï¼š                            åœ¨çº¿æ€§è¡¨Lä¸­çš„ç¬¬iä¸ªä½ç½®æ’å…¥æ–°å…ƒç´ e<br>    e ListDelete(L, i)ï¼š                            åˆ é™¤çº¿æ€§è¡¨Lä¸­ç¬¬iä¸ªä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›å…¶å€¼ã€‚<br>    ListLength(L)ï¼š                                    è¿”å›çº¿æ€§è¡¨Lçš„å…ƒç´ ä¸ªæ•°</p><h3 id="3-4-çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆP47ï¼‰"><a href="#3-4-çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆP47ï¼‰" class="headerlink" title="3.4 çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆP47ï¼‰"></a>3.4 çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆP47ï¼‰</h3><ul><li><p>3.4.1 é¡ºåºå­˜å‚¨å®šä¹‰</p><ul><li><p>çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ŒæŒ‡çš„æ˜¯ç”¨ä¸€æ®µåœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¸€æ¬¡å­˜å‚¨çº¿æ€§è¡¨çš„æ•°æ®å…ƒç´ ã€‚</p><p>ç‰©ç†å­˜å‚¨ç»“æ„æ˜¯é¡ºåºå­˜å‚¨ç»“æ„<br>é€»è¾‘ç»“æ„æ˜¯çº¿æ€§ç»“æ„</p></li></ul></li><li><p>3.4.2 é¡ºåºå­˜å‚¨æ–¹å¼</p><ul><li>ä½¿ç”¨javaä¸€ç»´æ•°ç»„</li><li>æŠŠçº¿æ€§è¡¨ç¬¬ä¸€ä¸ªæ•°æ®å…ƒç´ å­˜æ”¾åˆ°æ•°ç»„ä¸‹æ ‡0çš„ä½ç½®ï¼Œå…¶ä»–çš„å…ƒç´ ä¾æ¬¡å­˜å‚¨åˆ°æ•°ç»„ä¸­</li></ul></li><li><p>3.4.3 æ•°ç»„é•¿åº¦å’Œçº¿æ€§è¡¨é•¿åº¦åŒºåˆ«</p><ul><li>æ•°ç»„é•¿åº¦æ˜¯å­˜æ”¾çº¿æ€§è¡¨çš„å‚¨å­˜ç©ºé—´é•¿åº¦ï¼Œæ•°ç»„é•¿åº¦å®šä¹‰å¥½ä¹‹åä¸€èˆ¬æ˜¯ä¸å˜çš„ã€‚</li><li>çº¿æ€§è¡¨é•¿åº¦æ˜¯çº¿æ€§è¡¨ä¸­æ•°æ®å…ƒç´ çš„ä¸ªæ•°ï¼Œéšç€çº¿æ€§è¡¨çš„å¢åŠ å’Œåˆ é™¤è¿™ä¸ªé•¿åº¦æ˜¯ä¼šå˜åŠ¨çš„</li><li>çº¿æ€§è¡¨é•¿åº¦ä¸å¯èƒ½è¶…è¿‡æ•°ç»„é•¿åº¦</li></ul></li><li><p>é¡ºåºå­˜å‚¨æ–¹å¼å®ç°</p><p>/**<br>Â * çº¿æ€§è¡¨æ•°æ®ç»“æ„-é¡ºåºå­˜å‚¨ç»“æ„å®ç°<br>Â * çº¿æ€§è¡¨é•¿åº¦ä»1å¼€å§‹<br>Â *<br>Â * @author llqwq<br>Â <em>/<br>public class SqList {<br>Â Â /*</em><br>Â Â Â * çº¿æ€§è¡¨æœ€å¤§é•¿åº¦<br>Â Â Â <em>/<br>Â Â private final int maxSize = 20;<br>Â Â /*</em><br>Â Â Â * ä½¿ç”¨æ•°ç»„æ¥å®ç°çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨<br>Â Â Â */<br>Â Â private int[] data = new int[maxSize];</p><p>Â Â /**<br>Â Â Â * çº¿æ€§è¡¨é•¿åº¦<br>Â Â Â */<br>Â Â private int length;</p><p>Â Â /**<br>Â Â Â * è‹¥çº¿æ€§è¡¨ä¸ºç©ºåˆ™è¿”å›falseï¼Œå¦åˆ™è¿”å›true<br>Â Â Â *<br>Â Â Â * @return çº¿æ€§è¡¨æ˜¯å¦ä¸ºç©º<br>Â Â Â */<br>Â Â public boolean listEmpty() {<br>Â Â Â Â return length &lt;= 0;<br>Â Â }</p><p>Â Â /**<br>Â Â Â * æ¸…ç©ºçº¿æ€§è¡¨<br>Â Â Â */<br>Â Â public void cleanList() {<br>Â Â Â Â length = 0;<br>Â Â }</p><p>Â Â public int[] getData() {<br>Â Â Â Â return data;<br>Â Â }</p><p>Â Â /**<br>Â Â Â * æŸ¥è¯¢çº¿æ€§è¡¨ä¸­çš„ç¬¬iä¸ªå…ƒç´ <br>Â Â Â *<br>Â Â Â * @param i ä»çº¿æ€§è¡¨ä¸­æŸ¥è¯¢çš„å…ƒç´ ä¸‹æ ‡<br>Â Â Â * @return çº¿æ€§è¡¨ä¸­ç¬¬iä¸ªä½ç½®çš„å…ƒç´ <br>Â Â Â */<br>Â Â public int getElem(int i) {<br>Â Â Â Â // æŸ¥è¯¢çš„å…ƒç´ ä¸‹æ ‡ i è¦åœ¨ å¤§äº 1 å°äº æœ€å¤§é•¿åº¦ï¼Œä¸”çº¿æ€§è¡¨ä¸­è¦æœ‰å…ƒç´ <br>Â Â Â Â if (length &lt;= 0 || i &lt; 1 || i &gt; length) {<br>Â Â Â Â Â Â throw new RuntimeException(â€œä¸‹æ ‡æº¢å‡ºâ€);<br>Â Â Â Â }<br>Â Â Â Â return data[i - 1];<br>Â Â }</p><p>Â Â /**<br>Â Â Â * åœ¨çº¿æ€§è¡¨ä¸­æŸ¥æ‰¾å’Œ el ç›¸ç­‰çš„å…ƒç´ <br>Â Â Â *<br>Â Â Â * @param el è¦æŸ¥æ‰¾çš„å…ƒç´ <br>Â Â Â * @return æŸ¥æ‰¾æˆåŠŸè¿”å›å…ƒç´ åœ¨çº¿æ€§è¡¨ä¸­çš„ä¸‹è¡¨ï¼ŒæŸ¥æ‰¾å¤±è´¥è¿”å›0<br>Â Â Â */<br>Â Â public int locateElem(int el) {<br>Â Â Â Â for (int i = 0; i &lt; data.length; i++) {<br>Â Â Â Â Â Â if (data[i] == el) {<br>Â Â Â Â Â Â Â Â return i + 1;<br>Â Â Â Â Â Â }<br>Â Â Â Â }<br>Â Â Â Â return 0;<br>Â Â }</p><p>Â Â /**<br>Â Â Â * åœ¨çº¿æ€§è¡¨ä¸­ç¬¬ index ä¸ªä½ç½®æ’å…¥å…ƒç´  el<br>Â Â Â *<br>Â Â Â * @param index å…ƒç´ åœ¨çº¿æ€§è¡¨ä¸­æ’å…¥çš„ä½ç½®<br>Â Â Â * @param elÂ Â è¦æ’å…¥çš„å…ƒç´ <br>Â Â Â */<br>Â Â public void listInsert(int index, int el) {<br>Â Â Â Â // å½“çº¿æ€§è¡¨æ»¡äº†æˆ–indexä¸å†çº¿æ€§è¡¨çš„èŒƒå›´å†…æŠ›å‡ºå¼‚å¸¸<br>Â Â Â Â assert !(length &gt;= maxSize || (index &lt; 1 || index &gt; length + 1)) : â€œä¸‹æ ‡æº¢å‡ºâ€;</p><p>Â Â Â Â // ä¸å†çº¿æ€§è¡¨å°¾éƒ¨æ’å…¥å…ƒç´ <br>Â Â Â Â if (index &lt;= length) {<br>Â Â Â Â Â Â // å°†ä»indexå¼€å§‹çš„å…ƒç´ å…¨éƒ½å‘åç§»åŠ¨ä¸€ä½<br>Â Â Â Â Â Â for (int i = length; i &gt;= index; iâ€“) {<br>Â Â Â Â Â Â Â Â data[i] = data[i - 1];<br>Â Â Â Â Â Â }<br>Â Â Â Â }</p><p>Â Â Â Â data[index - 1] = el;<br>Â Â Â Â length++;<br>Â Â }</p><p>Â Â /**<br>Â Â Â * åˆ é™¤çº¿æ€§è¡¨ä¸­ç¬¬iä¸ªä½ç½®çš„å…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ <br>Â Â Â *<br>Â Â Â * @param i<br>Â Â Â * @return<br>Â Â Â */<br>Â Â public int listDelete(int i) {<br>Â Â Â Â assert !(i &lt; 1 || i &gt; length) : â€œä¸‹æ ‡æº¢å‡ºâ€;</p><p>Â Â Â Â int el = data[i - 1];<br>Â Â Â Â data[i - 1] = 0;<br>Â Â Â Â // åˆ é™¤çš„å…ƒç´ ä¸åœ¨çº¿æ€§è¡¨æœ«å°¾<br>Â Â Â Â if (i &lt; length) {<br>Â Â Â Â Â Â // å°†ä»indexå¼€å§‹çš„å…ƒç´ å…¨éƒ½å‘å‰ç§»åŠ¨ä¸€ä½<br>Â Â Â Â Â Â for (; i &lt;= length; i++) {<br>Â Â Â Â Â Â Â Â data[i - 1] = data[i];<br>Â Â Â Â Â Â }<br>Â Â Â Â }<br>Â Â Â Â lengthâ€“;<br>Â Â Â Â return el;<br>Â Â }</p><p>Â Â public int listLength() {<br>Â Â Â Â return length;<br>Â Â }</p><p>}</p></li></ul><h3 id="3-5-é¡ºåºå­˜å‚¨ç»“æ„çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP50ï¼‰"><a href="#3-5-é¡ºåºå­˜å‚¨ç»“æ„çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP50ï¼‰" class="headerlink" title="3.5 é¡ºåºå­˜å‚¨ç»“æ„çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP50ï¼‰"></a>3.5 é¡ºåºå­˜å‚¨ç»“æ„çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP50ï¼‰</h3><ul><li><p>3.5.1 è·å–å…ƒç´ æ“ä½œ</p><ul><li>çº¿æ€§è¡¨ä¸‹æ ‡-1å°±æ˜¯è¯¥æ•°æ®å¯¹åº”åœ¨æ•°ç»„ä¸­çš„ä¸‹è¡¨</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(1)</li></ul></li><li><p>3.5.2 æ’å…¥æ“ä½œ</p><ul><li><p>å°†éœ€è¦æ’å…¥æ–°å…ƒç´ çš„ä½ç½®ç©ºå‡ºæ¥å³å¯ï¼Œä¹Ÿå°±æ˜¯è¯´å°†iä¹‹åçš„å…ƒç´ å…¨éƒ¨å¾€åç§»åŠ¨ä¸€ä½å°±å¥½äº†</p><p>iï¼šæ–°å…ƒç´ è¦æ’å…¥çš„ä¸‹æ ‡</p><p>å®ç°æ€è·¯ï¼š<br>æ ¡éªŒæ’å…¥ä½ç½®æ˜¯å¦åˆç†ï¼Œä¸åˆç†æŠ›å‡ºå¼‚å¸¸<br>ä»æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹å‘å‰éå†åˆ°ç¬¬iä¸ªä½ç½®ï¼Œåˆ†åˆ«å°†å®ƒä»¬éƒ½å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®<br>å°†è¦æ’å…¥çš„å…ƒç´ å¡«å…¥ä½ç½®i<br>è¡¨é•¿åŠ ä¸€</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li><li></li></ul></li><li><p>3.5.3 åˆ é™¤æ“ä½œ</p><ul><li><p>åˆ é™¤å…ƒç´ ç„¶åå°†åˆ é™¤å…ƒç´ ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ¨å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®å³å¯</p><p>å®ç°æ€è·¯ï¼š<br>å¦‚æœåˆ é™¤ä½ç½®ä¸åˆç†ï¼ŒæŠ›å‡ºå¼‚å¸¸<br>å–å‡ºå…ƒç´ <br>ä»åˆ é™¤ä½ç½®å¼€å§‹éå†åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«å°†å®ƒä»¬éƒ½å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®<br>è¡¨é•¿å‡ä¸€</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li><li></li></ul></li><li><p>3.5.4 çº¿æ€§è¡¨é¡ºåºå­˜å‚¨ç»“æ„çš„ä¼˜ç¼ºç‚¹</p><ul><li><p>ä¼˜ç‚¹</p><ul><li>æ— é¡»ä¸ºè¡¨ç¤ºè¡¨ä¸­å…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»è€Œå¢åŠ é¢å¤–çš„å­˜å‚¨ç©ºé—´</li><li>å¯ä»¥å¿«é€Ÿåœ°å­˜å–è¡¨ä¸­ä»»æ„ä½ç½®çš„å…ƒç´ </li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>æ’å…¥å’Œåˆ é™¤æ“ä½œéœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ </li><li>å½“çº¿æ€§è¡¨é•¿åº¦å˜åŒ–è¾ƒå¤§æ—¶ï¼Œéš¾ä»¥ç¡®å®šå­˜å‚¨ç©ºé—´çš„å®¹é‡</li><li>é€ æˆå­˜å‚¨ç©ºé—´çš„â€ç¢ç‰‡â€</li></ul></li></ul></li></ul><h3 id="3-6-çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼ˆP55ï¼‰"><a href="#3-6-çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼ˆP55ï¼‰" class="headerlink" title="3.6 çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼ˆP55ï¼‰"></a>3.6 çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼ˆP55ï¼‰</h3><ul><li><p>3.6.1 é¡ºåºå­˜å‚¨ç»“æ„ä¸è¶³çš„è§£å†³åŠæ³•</p><ul><li>åœ¨é¡ºåºå­˜å‚¨ç»“æ„ä¸­æ¯ä¸ªç›¸é‚»çš„å…ƒç´ éƒ½æ˜¯ç´§æŒ¨ç€ä¸€èµ·çš„æ‰€ä»¥æ‰å¯¼è‡´ä¿®æ”¹å…ƒç´ æ—¶éœ€è¦å¤§é‡ç§»åŠ¨å…ƒç´ ï¼Œé‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</li><li>è¦è§£å†³è¿™ä¸ªé—®é¢˜åªéœ€è¦è®©å…ƒç´ ä¸æŒ¨åœ¨ä¸€èµ·å°±å¥½äº†ï¼Œåªéœ€è¦è®©æ¯ä¸ªå…ƒç´ çŸ¥é“å®ƒè‡ªå·±çš„ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨å“ªå°±å¯ä»¥äº†</li></ul></li><li><p>3.6.2 çº¿æ€§è¡¨é“¾å¼å­˜å‚¨ç»“æ„å®šä¹‰</p><ul><li><p>é“¾å¼å­˜å‚¨ç»“æ„ä¸­çš„æ¯ä¸ªå…ƒç´ éœ€è¦çŸ¥é“è‡ªå·±çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æ¯ä¸ªå…ƒç´ ä¸­é™¤äº†å­˜å‚¨æ•°æ®ä¿¡æ¯å¤–ï¼Œè¿˜éœ€è¦å­˜å‚¨ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸ªå…ƒç´ çš„æŒ‡é’ˆ</p></li><li><p>æ¯ä¸ªå…ƒç´ éƒ½ç”±æ•°æ®ä¿¡æ¯å’ŒæŒ‡é’ˆè¿™ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬å°†é“¾å¼å­˜å‚¨ä¸­çš„æ¯ä¸ªæ•°æ®å…ƒç´ å«åšç»“ç‚¹(Node)</p><p>å…ƒç´ ä¸­å­˜æ”¾æ•°æ®ä¿¡æ¯çš„åœ°æ–¹å«åšæ•°æ®åŸŸï¼Œå­˜æ”¾æŒ‡é’ˆçš„åœ°æ–¹å«åšæŒ‡é’ˆåŸŸ</p></li><li><p>å› ä¸ºæ­¤é“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹åªå­˜å‚¨ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥å«åšå•é¡¹é“¾è¡¨</p></li><li><p>é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸€èˆ¬åªå­˜å‚¨ä¸€äº›å…¬å…±æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿç§°å®ƒä¸ºå¤´ç»“ç‚¹ï¼Œå¤´ç»“ç‚¹çš„æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</p></li><li><p>é“¾è¡¨ä¸­æœ€åä¸€ä¸ªç»“ç‚¹å«åšå°¾å…ƒç´ ï¼Œå…¶æŒ‡é’ˆæŒ‡å‘null</p></li><li><p>è‹¥é“¾è¡¨ä¸ºç©ºåˆ™å¤´ç»“ç‚¹çš„æŒ‡é’ˆåŸŸä¸ºç©º</p></li></ul></li><li><p>3.6.3 å¤´æŒ‡é’ˆä¸å¤´ç»“ç‚¹çš„å¼‚åŒ</p><ul><li><p>å¤´æŒ‡é’ˆ</p><p>åœ¨javaä¸­å¤´æŒ‡é’ˆå°±æ˜¯é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ªç»“ç‚¹çš„å¼•ç”¨</p><ul><li>å¤´æŒ‡é’ˆæ˜¯æŒ‡é“¾è¡¨æŒ‡å‘ç¬¬ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œè‹¥æœ‰å¤´ç»“ç‚¹åˆ™æ˜¯æŒ‡å‘å¤´ç»“ç‚¹</li><li>å¤´æŒ‡é’ˆå…·æœ‰æ ‡è¯†ä½œç”¨ï¼Œå¸¸ä»¥å¤´æŒ‡é’ˆå† ä»¥é“¾è¡¨çš„åå­—</li><li>æ— è®ºé“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¤´æŒ‡é’ˆå‡ä¸ä¸ºç©º</li><li>å¤´æŒ‡é’ˆæ˜¯é“¾è¡¨çš„å¿…è¦å…ƒç´ </li></ul></li><li><p>å¤´ç»“ç‚¹</p><ul><li>å¤´ç»“ç‚¹æ˜¯ä¸ºäº†æ“ä½œçš„ç»Ÿä¸€å’Œæ–¹ä¾¿è€Œè®¾ç«‹çš„ï¼Œæ”¾åœ¨ç¬¬ä¸€å…ƒç´ ç»“ç‚¹ä¹‹å‰ï¼Œå…¶æ•°æ®åŸŸä¸€èˆ¬æ²¡ä»€ä¹ˆç‰¹æ®Šæ„ä¹‰ï¼ˆä¹Ÿå¯ä»¥å­˜æ”¾å…¬å…±ä¿¡æ¯ï¼Œé“¾è¡¨é•¿åº¦ä¹‹ç±»çš„ï¼‰</li><li>å¤´ç»“ç‚¹ä¸æ˜¯é“¾è¡¨çš„å¿…é¡»è¦ç´ </li></ul></li></ul></li><li><p>çº¿æ€§è¡¨é“¾å¼å­˜å‚¨ç»“æ„ä»£ç å®ç°</p><p>/**</p><p>Â * çº¿æ€§è¡¨é“¾è¡¨å­˜å‚¨ç»“æ„å®ç°</p><p>Â * å…·æœ‰å¤´ç»“ç‚¹</p><p>Â *</p><p>Â * @author llqwq</p><p>Â */</p><p>public class LinkList<T> {</T></p><p>Â  /**</p><p>Â  Â * æ•°æ®ç»“ç‚¹</p><p>Â  Â *</p><p>Â  Â * @author llqwq</p><p>Â  Â */</p><p>Â  @Data</p><p>Â  @AllArgsConstructor</p><p>Â  @NoArgsConstructor</p><p>Â  private class Node<R> {</R></p><p>Â  Â  /**</p><p>Â  Â  Â * æ•°æ®åŸŸ</p><p>Â  Â  Â */</p><p>Â  Â  private R data;</p><p>Â  Â  /**</p><p>Â  Â  Â * æŒ‡é’ˆåŸŸ</p><p>Â  Â  Â */</p><p>Â  Â  private Node<R> next;</R></p><p>Â  }</p><p>Â  /**</p><p>Â  Â * å¤´æŒ‡é’ˆ</p><p>Â  Â */</p><p>Â  private Node<T> head;</T></p><p>Â  /**</p><p>Â  Â * å°¾æŒ‡é’ˆ</p><p>Â  Â */</p><p>Â  private Node<T> end;</T></p><p>Â  /**</p><p>Â  Â * çº¿æ€§è¡¨æ€»é•¿åº¦</p><p>Â  Â */</p><p>Â  private int length;</p><p>Â  /**</p><p>Â  Â * æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹</p><p>Â  Â */</p><p>Â  private boolean first = true;</p><p>Â  /**</p><p>Â  Â * å‘çº¿æ€§è¡¨æœ«å°¾å¢åŠ å€¼</p><p>Â  Â *</p><p>Â  Â * @param data éœ€è¦æ·»åŠ çš„å€¼</p><p>Â  Â */</p><p>Â  public LinkList<T> addNode(T data) {</T></p><p>Â  Â  Node<T> node = new Node&lt;&gt;();</T></p><p>Â  Â  node.setData(data);</p><p>Â  Â  // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¢åŠ ç»“ç‚¹å°±å°†é¦–å°¾æŒ‡é’ˆéƒ½æŒ‡å‘è¯¥ç»“ç‚¹</p><p>Â  Â  if (first) {</p><p>Â  Â  Â  head = end = node;</p><p>Â  Â  Â  first = false;</p><p>Â  Â  } else {</p><p>Â  Â  Â  // ä¸æ˜¯ç¬¬ä¸€æ¬¡å¢åŠ ç»“ç‚¹å°±å°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°æœ«å°¾ï¼Œå¹¶å°†å°¾æŒ‡é’ˆæŒ‡å‘è¯¥ç»“ç‚¹</p><p>Â  Â  Â  end.setNext(node);</p><p>Â  Â  Â  end = node;</p><p>Â  Â  }</p><p>Â  Â  length++;</p><p>Â  Â  return this;</p><p>Â  }</p><p>Â  /**</p><p>Â  Â * å‘çº¿æ€§è¡¨çš„ç¬¬iä¸ªä½ç½®æ’å…¥å€¼</p><p>Â  Â *</p><p>Â  Â * @param iÂ  éœ€è¦æ’å…¥å€¼çš„ä½ç½®</p><p>Â  Â * @param data éœ€è¦æ’å…¥çš„å€¼</p><p>Â  Â */</p><p>Â  public LinkList<T> listInsert(int i, T data) {</T></p><p>Â  Â  // 1. è·å¾—ç¬¬i-1ä¸ªä½ç½®å…ƒç´ çš„ç»“ç‚¹</p><p>Â  Â  // 2. å°†i-1çš„nextæŒ‡é’ˆèµ‹å€¼ç»™nodeçš„nextæŒ‡é’ˆ</p><p>Â  Â  // 3. å°†ç¬¬i-1çš„nextæŒ‡é’ˆæŒ‡å‘node</p><p>Â  Â  // æ ¡éªŒæ’å…¥ä½ç½®æ˜¯å¦åˆç†, 1 &lt;= i &lt;= count+1</p><p>Â  Â  assert i &gt;= 1 &amp;&amp; i &lt;= length + 1 : â€œæ’å…¥ä½ç½®ä¸åˆæ³•â€;</p><p>Â  Â  // æ’å…¥ä½ç½®æ˜¯é¦–å’Œå°¾</p><p>Â  Â  if (i == 1) {</p><p>Â  Â  Â  head = new Node&lt;&gt;(data, head);</p><p>Â  Â  Â  length++;</p><p>Â  Â  Â  return this;</p><p>Â  Â  }</p><p>Â  Â  if (i == length + 1) {</p><p>Â  Â  Â  addNode(data);</p><p>Â  Â  Â  return this;</p><p>Â  Â  }</p><p>Â  Â  // è·å–ç¬¬i-1ä¸ªå…ƒç´ </p><p>Â  Â  Node<T> nodePrev = head;</T></p><p>Â  Â  for (int j = 1; j &lt; i - 1; j++) {</p><p>Â  Â  Â  nodePrev = nodePrev.getNext();</p><p>Â  Â  }</p><p>Â  Â  Node<T> node = new Node&lt;&gt;(data, nodePrev.getNext());</T></p><p>Â  Â  nodePrev.setNext(node);</p><p>Â  Â  length++;</p><p>Â  Â  return this;</p><p>Â  }</p><p>Â  /**</p><p>Â  Â * åˆ é™¤çº¿æ€§è¡¨ä¸­ç¬¬iä¸ªä½ç½®çš„å…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ </p><p>Â  Â *</p><p>Â  Â * @param i</p><p>Â  Â * @return</p><p>Â  Â */</p><p>Â  public T listDelete(int i) {</p><p>Â  Â  // 1. è·å¾—ç¬¬i-1ä¸ªå…ƒç´ ä½ç½®çš„å…ƒç´ </p><p>Â  Â  // 2. å°†i-1çš„nextæŒ‡é’ˆæŒ‡å‘i+1ä¸ªä½ç½®çš„å…ƒç´ </p><p>Â  Â  // 3. å°†ç¬¬iä¸ªå…ƒç´ åˆ é™¤</p><p>Â  Â  // æ ¡éªŒåˆ é™¤ä½ç½®æ˜¯å¦åˆç†ï¼Œä½ç½®éœ€è¦åœ¨1åˆ°æœ€å¤§é•¿åº¦ä¹‹é—´</p><p>Â  Â  assert i &gt;= 1 &amp;&amp; i &lt;= length : â€œåˆ é™¤ä½ç½®ä¸åˆæ³•â€;</p><p>Â  Â  // åˆ é™¤ä½ç½®æ˜¯é¦–</p><p>Â  Â  if (i == 1) {</p><p>Â  Â  Â  Node<T> tempNode = head;</T></p><p>Â  Â  Â  T temp = tempNode.getData();</p><p>Â  Â  Â  tempNode = null;</p><p>Â  Â  Â  head = head.getNext();</p><p>Â  Â  Â  lengthâ€“;</p><p>Â  Â  Â  return temp;</p><p>Â  Â  }</p><p>Â  Â  // è·å¾—ç¬¬i-1ä¸ªç»“ç‚¹</p><p>Â  Â  Node<T> nodePrev = head;</T></p><p>Â  Â  for (int j = 2; j &lt; i; j++) {</p><p>Â  Â  Â  nodePrev = nodePrev.getNext();</p><p>Â  Â  }</p><p>Â  Â  // è·å–iè¿™ä¸ªä½ç½®çš„å…ƒç´ </p><p>Â  Â  Node<T> node = nodePrev.getNext();</T></p><p>Â  Â  // è·å–i+1ä¸ªä½ç½®çš„ç»“ç‚¹</p><p>Â  Â  Node<T> nodeNext = node.getNext();</T></p><p>Â  Â  // å½“iå°±æ˜¯æœ€åä¸€ä¸ªç»“ç‚¹æ—¶</p><p>Â  Â  if (nodeNext == null) {</p><p>Â  Â  Â  end = nodePrev;</p><p>Â  Â  }</p><p>Â  Â  // å°†i-1çš„æŒ‡é’ˆæŒ‡å‘i+1çš„ä½ç½®</p><p>Â  Â  nodePrev.setNext(nodeNext);</p><p>Â  Â  T temp = node.getData();</p><p>Â  Â  // å°†iè®¾ç½®ä¸ºnull,è™½ç„¶åœ¨javaä¸­ä¸å†™è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºæœ‰cg</p><p>Â  Â  node = null;</p><p>Â  Â  lengthâ€“;</p><p>Â  Â  return temp;</p><p>Â  }</p><p>Â  /**</p><p>Â  Â * æŸ¥è¯¢çº¿æ€§è¡¨æ‰€æœ‰æ•°æ®</p><p>Â  Â *</p><p>Â  Â * @return çº¿æ€§è¡¨ä¸­æ•°æ®è¿æ¥æˆçš„é“¾è¡¨ç»“æ„çš„å­—ç¬¦ä¸² 1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; null</p><p>Â  Â */</p><p>Â  public String listToString() {</p><p>Â  Â  StringBuilder listStr = new StringBuilder();</p><p>Â  Â  Node<T> node = head;</T></p><p>Â  Â  if (head == null) {</p><p>Â  Â  Â  return â€œâ€;</p><p>Â  Â  }</p><p>Â  Â  do {</p><p>Â  Â  Â  listStr.append(node.getData().toString()).append(â€œ -&gt; â€œ);</p><p>Â  Â  } while ((node = node.getNext()) != null);</p><p>Â  Â  return listStr.append(â€œnullâ€).toString();</p><p>Â  }</p><p>Â  public int getLength() {</p><p>Â  Â  return length;</p><p>Â  }</p><p>Â  public void setLength(int length) {</p><p>Â  Â  this.length = length;</p><p>Â  }</p><p>}</p></li></ul><h3 id="3-7-å•é“¾è¡¨çš„è¯»å–ï¼ˆP60ï¼‰"><a href="#3-7-å•é“¾è¡¨çš„è¯»å–ï¼ˆP60ï¼‰" class="headerlink" title="3.7 å•é“¾è¡¨çš„è¯»å–ï¼ˆP60ï¼‰"></a>3.7 å•é“¾è¡¨çš„è¯»å–ï¼ˆP60ï¼‰</h3><ul><li><p>ä»£ç å®ç°</p><p>/**<br>Â  Â  Â * è·å–ç¬¬iä¸ªä½ç½®çš„æ•°æ®å…ƒç´ çš„å€¼<br>Â  Â  Â *<br>Â  Â  Â * @param i æ•°æ®å…ƒç´ çš„ä½ç½®<br>Â  Â  Â * @return æ•°æ®å…ƒç´ çš„å€¼<br>Â  Â  Â */<br>Â  Â  public T getElem(int i) {</p><p>Â  Â  Â  Â  assert i &gt;= 1 &amp;&amp; i &lt;= length : â€œè¯¥ä½ç½®æ²¡æœ‰å…ƒç´ â€;<br>Â  Â  Â  Â  // å¦‚æœæ˜¯æŸ¥è¯¢æœ€åä¸€ä¸ªå…ƒç´ <br>Â  Â  Â  Â  if (i == length) {<br>Â  Â  Â  Â  Â  Â  return end.getData();<br>Â  Â  Â  Â  }</p><p>Â  Â  Â  Â  Node<T> node = head;<br>Â  Â  Â  Â  for (int j = 2; j &lt;= i &amp;&amp; node != null; j++) {<br>Â  Â  Â  Â  Â  Â  node = node.getNext();<br>Â  Â  Â  Â  }<br>Â  Â  Â  Â  return node.getData();<br>Â  Â  }</T></p></li><li><p>å·¥ä½œæŒ‡é’ˆåç§»</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul><h3 id="3-8-å•é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP61ï¼‰"><a href="#3-8-å•é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP61ï¼‰" class="headerlink" title="3.8 å•é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP61ï¼‰"></a>3.8 å•é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ï¼ˆP61ï¼‰</h3><ul><li><p>æ’å…¥</p><ul><li><p>ç®—æ³•æ€è·¯</p><ul><li>1ã€æ ¡éªŒæ’å…¥ä½ç½®iæ˜¯å¦åˆæ³•ï¼Œå³ 1 &lt;= i &lt;= é“¾è¡¨å½“å‰é•¿åº¦+1</li><li>2ã€éå†å¾—åˆ°åˆ°i-1ä½ç½®çš„ç»“ç‚¹</li><li>3ã€åˆ›å»ºä¸€ä¸ªç»“ç‚¹ç”¨äºæ’å…¥içš„ä½ç½®</li><li>3ã€å°†i-1çš„nextæŒ‡é’ˆèµ‹å€¼ç»™içš„next</li><li>4ã€å°†i-1çš„nextæŒ‡é’ˆæŒ‡å‘i</li></ul></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul></li><li><p>åˆ é™¤</p><ul><li><p>ç®—æ³•æ€è·¯</p><ul><li>1ã€æ ¡éªŒåˆ é™¤ä½ç½®iæ˜¯å¦åˆæ³•ï¼Œ1 &lt;= i &lt;= é“¾è¡¨å½“å‰é•¿åº¦</li><li>2ã€éå†é“¾è¡¨å¾—åˆ°i-1ä½ç½®çš„ç»“ç‚¹</li><li>3ã€å°†i-1ä½ç½®çš„ç»“ç‚¹çš„æŒ‡é’ˆæŒ‡å‘i+1ä½ç½®çš„ç»“ç‚¹</li><li>4ã€é‡Šæ”¾iä½ç½®çš„ç»“ç‚¹å…ƒç´ </li></ul></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul></li></ul><h3 id="3-9-å•é“¾è¡¨çš„æ•´è¡¨åˆ›å»ºï¼ˆP66ï¼‰"><a href="#3-9-å•é“¾è¡¨çš„æ•´è¡¨åˆ›å»ºï¼ˆP66ï¼‰" class="headerlink" title="3.9 å•é“¾è¡¨çš„æ•´è¡¨åˆ›å»ºï¼ˆP66ï¼‰"></a>3.9 å•é“¾è¡¨çš„æ•´è¡¨åˆ›å»ºï¼ˆP66ï¼‰</h3><ul><li><p>å¤´æ’æ³•</p><ul><li>è®©æ’å…¥çš„ç»“ç‚¹å§‹ç»ˆåœ¨é“¾è¡¨çš„ç¬¬ä¸€ä½</li></ul></li><li><p>å°¾æ’æ³•</p><ul><li>è®©æ’å…¥çš„ç»“ç‚¹å§‹ç»ˆåœ¨é“¾è¡¨çš„æœ«å°¾</li></ul></li></ul><h3 id="3-10-å•é“¾è¡¨çš„æ•´è¡¨åˆ é™¤ï¼ˆP69ï¼‰"><a href="#3-10-å•é“¾è¡¨çš„æ•´è¡¨åˆ é™¤ï¼ˆP69ï¼‰" class="headerlink" title="3.10 å•é“¾è¡¨çš„æ•´è¡¨åˆ é™¤ï¼ˆP69ï¼‰"></a>3.10 å•é“¾è¡¨çš„æ•´è¡¨åˆ é™¤ï¼ˆP69ï¼‰</h3><ul><li><p>åœ¨javaä¸­åªéœ€è¦å°†å¤´æŒ‡é’ˆä¸ºnullå³å¯ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å»æ¸…ç†</p></li><li><p>æ‰‹åŠ¨å›æ”¶</p><ul><li>éå†æ•´ä¸ªé“¾è¡¨ç„¶åé€ä¸ªè®¾ç½®ç»“ç‚¹ä¸ºnull</li></ul></li></ul><h3 id="3-11-å•é“¾è¡¨ç»“æ„ä¸é¡ºåºç»“æ„ä¼˜ç¼ºç‚¹ï¼ˆP70ï¼‰"><a href="#3-11-å•é“¾è¡¨ç»“æ„ä¸é¡ºåºç»“æ„ä¼˜ç¼ºç‚¹ï¼ˆP70ï¼‰" class="headerlink" title="3.11 å•é“¾è¡¨ç»“æ„ä¸é¡ºåºç»“æ„ä¼˜ç¼ºç‚¹ï¼ˆP70ï¼‰"></a>3.11 å•é“¾è¡¨ç»“æ„ä¸é¡ºåºç»“æ„ä¼˜ç¼ºç‚¹ï¼ˆP70ï¼‰</h3><ul><li><p>å­˜å‚¨æ–¹å¼</p><ul><li>é¡ºåºå­˜å‚¨ç»“æ„æ˜¯ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨çš„æ•°æ®å…ƒç´ </li><li>é“¾å¼å­˜å‚¨ç»“æ„æ˜¯ç”¨ä¸€ç»„ä»»æ„çš„å­˜å‚¨å•å…ƒæ¥å­˜å‚¨æ•°æ®å…ƒç´ </li></ul></li><li><p>æ—¶é—´æ€§èƒ½</p><ul><li><p>æŸ¥æ‰¾</p><ul><li><p>é¡ºåºå­˜å‚¨ç»“æ„</p><ul><li>O(1)</li></ul></li><li><p>å•é“¾è¡¨</p><ul><li>O(1)</li></ul></li></ul></li><li><p>æ’å…¥å’Œåˆ é™¤</p><ul><li><p>é¡ºåºå­˜å‚¨ç»“æ„</p><ul><li>å¹³å‡éœ€è¦ç§»åŠ¨è¡¨é•¿ä¸€åŠçš„å…ƒç´ ï¼ŒO(n)</li></ul></li><li><p>å•é“¾è¡¨</p><ul><li>åœ¨çº¿å‡ºæŸä½ç½®çš„æŒ‡é’ˆæ—¶ï¼ŒO(1)</li></ul></li></ul></li></ul></li><li><p>ç©ºé—´æ€§èƒ½</p><ul><li><p>é¡ºåºå­˜å‚¨ç»“æ„</p><ul><li>éœ€è¦é¢„åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œåˆ†å¤§äº†æµªè´¹ï¼Œåˆ†å°äº†å®¹æ˜“æº¢å‡º</li></ul></li><li><p>å•é“¾è¡¨</p><ul><li>ä¸éœ€è¦åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œå…ƒç´ ä¸ªæ•°ä¸å—é™åˆ¶</li></ul></li></ul></li></ul><h3 id="3-12-é™æ€é“¾è¡¨ï¼ˆP71ï¼‰"><a href="#3-12-é™æ€é“¾è¡¨ï¼ˆP71ï¼‰" class="headerlink" title="3.12 é™æ€é“¾è¡¨ï¼ˆP71ï¼‰"></a>3.12 é™æ€é“¾è¡¨ï¼ˆP71ï¼‰</h3><ul><li><p>ç”¨æ•°ç»„æè¿°çš„é“¾è¡¨å«é™æ€é“¾è¡¨</p><p>ä¸€äº›æ—©æœŸçš„é«˜çº§ç¼–ç¨‹è¯­è¨€å¹¶æ²¡æœ‰æŒ‡é’ˆæˆ–å¯¹è±¡å¼•ç”¨çš„æœºåˆ¶äºæ˜¯å°±æœ‰äººæƒ³å‡ºç”¨æ•°ç»„ä»£æ›¿æŒ‡é’ˆ</p></li><li><p>æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç»„æˆ</p><ul><li><p>æ•°æ®åŸŸï¼šdata</p><ul><li>å­˜å‚¨æ•°æ®ï¼Œå’Œå•é“¾è¡¨çš„æ•°æ®åŸŸä¸€è‡´</li></ul></li><li><p>æ¸¸æ ‡ï¼šcur</p><ul><li>ç›¸å½“äºnextæŒ‡é’ˆ</li></ul></li></ul></li><li><p>æ•°ç»„çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ </p><ul><li><p>ä½œä¸ºç‰¹æ®Šå…ƒç´ å¤„ç†ï¼Œä¸å­˜å‚¨æ•°æ®</p></li><li><p>æœªä½¿ç”¨çš„æ•°ç»„å…ƒç´ ç§°å¤‡ç”¨é“¾è¡¨</p></li><li><p>ç¬¬ä¸€ä¸ªå…ƒç´ </p><ul><li>curå­˜æ”¾å¤‡ç”¨é“¾è¡¨çš„ç¬¬ä¸€ä¸ªç»“ç‚¹çš„ä¸‹æ ‡ï¼Œå¤‡ç”¨é“¾è¡¨æœªç©ºå€¼ä¸º0</li></ul></li><li><p>æœ€åä¸€ä¸ªå…ƒç´ </p><ul><li>curå­˜æ”¾ç¬¬ä¸€ä¸ªæœ‰å€¼çš„ç»“ç‚¹ä¸‹æ ‡ï¼Œè‹¥ä¸ºç©ºé“¾è¡¨å€¼ä¸º0</li></ul></li></ul></li><li><p>åˆ›å»ºå’Œé‡Šæ”¾ç»“ç‚¹</p><ul><li><p>åˆ›å»º</p><ul><li><p>å®ç°æ€è·¯</p><ul><li>todo æ’å…¥å›¾ç‰‡</li></ul></li></ul></li><li><p>é‡Šæ”¾</p><ul><li>å®ç°æ€è·¯</li></ul></li></ul></li><li><p>é™æ€é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤</p><ul><li>æ’å…¥</li><li>åˆ é™¤</li></ul></li><li><p>é™æ€é“¾è¡¨çš„ä¼˜ç¼ºç‚¹</p><ul><li><p>ä¼˜ç‚¹</p><ul><li>æ’å…¥å’Œåˆ é™¤æ— éœ€ç§»åŠ¨å…ƒç´ ï¼Œæ”¹è¿›äº†é¡ºåºå­˜å‚¨ç»“æ„ä¿®æ”¹æ—¶éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ çš„ç¼ºé™·</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>æ²¡æœ‰è§£å†³è¿ç»­å­˜å‚¨åˆ†é…å¸¦æ¥çš„è¡¨é•¿æ— æ³•ç¡®å®šçš„é—®é¢˜</li><li>å¤±å»äº†é¡ºåºå­˜å‚¨ç»“æ„çš„éšæ—¶å­˜å–ç‰¹æ€§</li></ul></li></ul></li></ul><h3 id="3-13-å¾ªç¯é“¾è¡¨ï¼ˆP78ï¼‰"><a href="#3-13-å¾ªç¯é“¾è¡¨ï¼ˆP78ï¼‰" class="headerlink" title="3.13 å¾ªç¯é“¾è¡¨ï¼ˆP78ï¼‰"></a>3.13 å¾ªç¯é“¾è¡¨ï¼ˆP78ï¼‰</h3><ul><li><p>å®šä¹‰ï¼š</p><ul><li>å°†å•é“¾è¡¨ä¸­å°¾èŠ‚ç‚¹çš„æŒ‡é’ˆç”±ç©ºæ”¹ä¸ºæŒ‡å‘å¤´ç»“ç‚¹ï¼Œä½¿å¾—å•é“¾è¡¨å½¢æˆä¸€ä¸ªç¯ï¼Œè¿™ç§å¤´å°¾ç›¸æ¥çš„å•é“¾è¡¨ç§°ä¹‹ä¸ºå•å¾ªç¯é“¾è¡¨ï¼Œç®€ç§°å¾ªç¯é“¾è¡¨</li></ul></li><li><p>å•é“¾è¡¨çš„é—®é¢˜ï¼šåœ¨è·å¾—å°¾èŠ‚ç‚¹æ—¶éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æ</p><ul><li>è§£å†³ï¼šä½¿ç”¨å¾ªç¯é“¾è¡¨ï¼Œå¹¶å°†å¤´æŒ‡é’ˆæ”¹ç”¨å°¾æŒ‡é’ˆ</li></ul></li></ul><h3 id="3-14-åŒå‘é“¾è¡¨ï¼ˆP81ï¼‰"><a href="#3-14-åŒå‘é“¾è¡¨ï¼ˆP81ï¼‰" class="headerlink" title="3.14 åŒå‘é“¾è¡¨ï¼ˆP81ï¼‰"></a>3.14 åŒå‘é“¾è¡¨ï¼ˆP81ï¼‰</h3><ul><li><p>å®šä¹‰ï¼š</p><ul><li>åŒå‘é“¾è¡¨æ˜¯å°†å•é“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªç»“ç‚¹å†è®¾ç½®ä¸€ä¸ªæŒ‡å‘å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆ</li></ul></li><li><p>åŒå‘é“¾è¡¨çš„åˆ é™¤å’Œå¢åŠ </p><ul><li>ä¸å•é“¾è¡¨å·®ä¸å¤šï¼Œåªæ˜¯éœ€è¦å†æ“ä½œä¸€ä¸ªæŒ‡å‘å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆ</li></ul></li></ul><h2 id="ç¬¬å››ç« -æ ˆä¸é˜Ÿåˆ—ï¼ˆP87ï¼‰"><a href="#ç¬¬å››ç« -æ ˆä¸é˜Ÿåˆ—ï¼ˆP87ï¼‰" class="headerlink" title="ç¬¬å››ç«  æ ˆä¸é˜Ÿåˆ—ï¼ˆP87ï¼‰"></a>ç¬¬å››ç«  æ ˆä¸é˜Ÿåˆ—ï¼ˆP87ï¼‰</h2><h3 id="4-2-æ ˆçš„å®šä¹‰ï¼ˆP89ï¼‰"><a href="#4-2-æ ˆçš„å®šä¹‰ï¼ˆP89ï¼‰" class="headerlink" title="4.2 æ ˆçš„å®šä¹‰ï¼ˆP89ï¼‰"></a>4.2 æ ˆçš„å®šä¹‰ï¼ˆP89ï¼‰</h3><h3 id="4-3-æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP91ï¼‰"><a href="#4-3-æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP91ï¼‰" class="headerlink" title="4.3 æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP91ï¼‰"></a>4.3 æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP91ï¼‰</h3><h3 id="4-4-æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP92ï¼‰"><a href="#4-4-æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP92ï¼‰" class="headerlink" title="4.4 æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP92ï¼‰"></a>4.4 æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP92ï¼‰</h3><h3 id="4-5-ä¸¤æ ˆå…±äº«ç©ºé—´ï¼ˆP94ï¼‰"><a href="#4-5-ä¸¤æ ˆå…±äº«ç©ºé—´ï¼ˆP94ï¼‰" class="headerlink" title="4.5 ä¸¤æ ˆå…±äº«ç©ºé—´ï¼ˆP94ï¼‰"></a>4.5 ä¸¤æ ˆå…±äº«ç©ºé—´ï¼ˆP94ï¼‰</h3><h3 id="4-6-æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP97ï¼‰"><a href="#4-6-æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP97ï¼‰" class="headerlink" title="4.6 æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP97ï¼‰"></a>4.6 æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP97ï¼‰</h3><h3 id="4-7-æ ˆçš„ä½œç”¨ï¼ˆP100ï¼‰"><a href="#4-7-æ ˆçš„ä½œç”¨ï¼ˆP100ï¼‰" class="headerlink" title="4.7 æ ˆçš„ä½œç”¨ï¼ˆP100ï¼‰"></a>4.7 æ ˆçš„ä½œç”¨ï¼ˆP100ï¼‰</h3><h3 id="4-8-æ ˆçš„åº”ç”¨â€”â€”é€’å½’ï¼ˆP100ï¼‰"><a href="#4-8-æ ˆçš„åº”ç”¨â€”â€”é€’å½’ï¼ˆP100ï¼‰" class="headerlink" title="4.8 æ ˆçš„åº”ç”¨â€”â€”é€’å½’ï¼ˆP100ï¼‰"></a>4.8 æ ˆçš„åº”ç”¨â€”â€”é€’å½’ï¼ˆP100ï¼‰</h3><h3 id="4-9-æ ˆçš„åº”ç”¨â€”â€”å››åˆ™è¿ç®—è¡¨è¾¾å¼æ±‚å€¼ï¼ˆP104ï¼‰"><a href="#4-9-æ ˆçš„åº”ç”¨â€”â€”å››åˆ™è¿ç®—è¡¨è¾¾å¼æ±‚å€¼ï¼ˆP104ï¼‰" class="headerlink" title="4.9 æ ˆçš„åº”ç”¨â€”â€”å››åˆ™è¿ç®—è¡¨è¾¾å¼æ±‚å€¼ï¼ˆP104ï¼‰"></a>4.9 æ ˆçš„åº”ç”¨â€”â€”å››åˆ™è¿ç®—è¡¨è¾¾å¼æ±‚å€¼ï¼ˆP104ï¼‰</h3><h3 id="4-10-é˜Ÿåˆ—çš„å®šä¹‰ï¼ˆP111ï¼‰"><a href="#4-10-é˜Ÿåˆ—çš„å®šä¹‰ï¼ˆP111ï¼‰" class="headerlink" title="4.10 é˜Ÿåˆ—çš„å®šä¹‰ï¼ˆP111ï¼‰"></a>4.10 é˜Ÿåˆ—çš„å®šä¹‰ï¼ˆP111ï¼‰</h3><h3 id="4-11-é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP112ï¼‰"><a href="#4-11-é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP112ï¼‰" class="headerlink" title="4.11 é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP112ï¼‰"></a>4.11 é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP112ï¼‰</h3><h3 id="4-12-å¾ªç¯é˜Ÿåˆ—ï¼ˆP112ï¼‰"><a href="#4-12-å¾ªç¯é˜Ÿåˆ—ï¼ˆP112ï¼‰" class="headerlink" title="4.12 å¾ªç¯é˜Ÿåˆ—ï¼ˆP112ï¼‰"></a>4.12 å¾ªç¯é˜Ÿåˆ—ï¼ˆP112ï¼‰</h3><h3 id="4-13-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP117ï¼‰"><a href="#4-13-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP117ï¼‰" class="headerlink" title="4.13 é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP117ï¼‰"></a>4.13 é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°ï¼ˆP117ï¼‰</h3><h2 id="ç¬¬äº”ç« -ä¸²ï¼ˆP123ï¼‰"><a href="#ç¬¬äº”ç« -ä¸²ï¼ˆP123ï¼‰" class="headerlink" title="ç¬¬äº”ç«  ä¸²ï¼ˆP123ï¼‰"></a>ç¬¬äº”ç«  ä¸²ï¼ˆP123ï¼‰</h2><h3 id="5-2-ä¸²çš„å®šä¹‰ï¼ˆP124ï¼‰"><a href="#5-2-ä¸²çš„å®šä¹‰ï¼ˆP124ï¼‰" class="headerlink" title="5.2 ä¸²çš„å®šä¹‰ï¼ˆP124ï¼‰"></a>5.2 ä¸²çš„å®šä¹‰ï¼ˆP124ï¼‰</h3><h3 id="5-3-ä¸²çš„æ¯”è¾ƒï¼ˆP126ï¼‰"><a href="#5-3-ä¸²çš„æ¯”è¾ƒï¼ˆP126ï¼‰" class="headerlink" title="5.3 ä¸²çš„æ¯”è¾ƒï¼ˆP126ï¼‰"></a>5.3 ä¸²çš„æ¯”è¾ƒï¼ˆP126ï¼‰</h3><h3 id="5-4-ä¸²çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆ127ï¼‰"><a href="#5-4-ä¸²çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆ127ï¼‰" class="headerlink" title="5.4 ä¸²çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆ127ï¼‰"></a>5.4 ä¸²çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆ127ï¼‰</h3><h3 id="5-5-ä¸²çš„å­˜å‚¨ç»“æ„ï¼ˆP129ï¼‰"><a href="#5-5-ä¸²çš„å­˜å‚¨ç»“æ„ï¼ˆP129ï¼‰" class="headerlink" title="5.5 ä¸²çš„å­˜å‚¨ç»“æ„ï¼ˆP129ï¼‰"></a>5.5 ä¸²çš„å­˜å‚¨ç»“æ„ï¼ˆP129ï¼‰</h3><h3 id="5-6-æœ´ç´ çš„æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP131ï¼‰"><a href="#5-6-æœ´ç´ çš„æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP131ï¼‰" class="headerlink" title="5.6 æœ´ç´ çš„æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP131ï¼‰"></a>5.6 æœ´ç´ çš„æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP131ï¼‰</h3><h3 id="5-7-KMP-æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP135ï¼‰"><a href="#5-7-KMP-æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP135ï¼‰" class="headerlink" title="5.7 KMP æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP135ï¼‰"></a>5.7 KMP æ¨¡å¼åŒ¹é…ç®—æ³•ï¼ˆP135ï¼‰</h3><h2 id="ç¬¬å…­ç« -æ ‘ï¼ˆP149ï¼‰"><a href="#ç¬¬å…­ç« -æ ‘ï¼ˆP149ï¼‰" class="headerlink" title="ç¬¬å…­ç«  æ ‘ï¼ˆP149ï¼‰"></a>ç¬¬å…­ç«  æ ‘ï¼ˆP149ï¼‰</h2><h3 id="6-2-æ ‘çš„å®šä¹‰ï¼ˆP150ï¼‰"><a href="#6-2-æ ‘çš„å®šä¹‰ï¼ˆP150ï¼‰" class="headerlink" title="6.2 æ ‘çš„å®šä¹‰ï¼ˆP150ï¼‰"></a>6.2 æ ‘çš„å®šä¹‰ï¼ˆP150ï¼‰</h3><h3 id="6-3-æ ‘çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP154ï¼‰"><a href="#6-3-æ ‘çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP154ï¼‰" class="headerlink" title="6.3 æ ‘çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP154ï¼‰"></a>6.3 æ ‘çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP154ï¼‰</h3><h3 id="6-4-æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP155ï¼‰"><a href="#6-4-æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP155ï¼‰" class="headerlink" title="6.4 æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP155ï¼‰"></a>6.4 æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP155ï¼‰</h3><h3 id="6-5-äºŒå‰æ ‘çš„å®šä¹‰ï¼ˆP163ï¼‰"><a href="#6-5-äºŒå‰æ ‘çš„å®šä¹‰ï¼ˆP163ï¼‰" class="headerlink" title="6.5 äºŒå‰æ ‘çš„å®šä¹‰ï¼ˆP163ï¼‰"></a>6.5 äºŒå‰æ ‘çš„å®šä¹‰ï¼ˆP163ï¼‰</h3><h3 id="6-6-äºŒå‰æ ‘çš„æ€§è´¨ï¼ˆP169ï¼‰"><a href="#6-6-äºŒå‰æ ‘çš„æ€§è´¨ï¼ˆP169ï¼‰" class="headerlink" title="6.6 äºŒå‰æ ‘çš„æ€§è´¨ï¼ˆP169ï¼‰"></a>6.6 äºŒå‰æ ‘çš„æ€§è´¨ï¼ˆP169ï¼‰</h3><h3 id="6-7-äºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP172ï¼‰"><a href="#6-7-äºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP172ï¼‰" class="headerlink" title="6.7 äºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP172ï¼‰"></a>6.7 äºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„ï¼ˆP172ï¼‰</h3><h3 id="6-8-éå†äºŒå‰æ ‘ï¼ˆP174ï¼‰"><a href="#6-8-éå†äºŒå‰æ ‘ï¼ˆP174ï¼‰" class="headerlink" title="6.8 éå†äºŒå‰æ ‘ï¼ˆP174ï¼‰"></a>6.8 éå†äºŒå‰æ ‘ï¼ˆP174ï¼‰</h3><h3 id="6-9-äºŒå‰æ ‘çš„å»ºç«‹ï¼ˆP187ï¼‰"><a href="#6-9-äºŒå‰æ ‘çš„å»ºç«‹ï¼ˆP187ï¼‰" class="headerlink" title="6.9 äºŒå‰æ ‘çš„å»ºç«‹ï¼ˆP187ï¼‰"></a>6.9 äºŒå‰æ ‘çš„å»ºç«‹ï¼ˆP187ï¼‰</h3><h3 id="6-10-çº¿ç´¢äºŒå‰æ ‘ï¼ˆP188ï¼‰"><a href="#6-10-çº¿ç´¢äºŒå‰æ ‘ï¼ˆP188ï¼‰" class="headerlink" title="6.10 çº¿ç´¢äºŒå‰æ ‘ï¼ˆP188ï¼‰"></a>6.10 çº¿ç´¢äºŒå‰æ ‘ï¼ˆP188ï¼‰</h3><h3 id="6-11-æ ‘ã€æ£®æ—ã€äºŒå‰æ ‘çš„è½¬æ¢ï¼ˆP195ï¼‰"><a href="#6-11-æ ‘ã€æ£®æ—ã€äºŒå‰æ ‘çš„è½¬æ¢ï¼ˆP195ï¼‰" class="headerlink" title="6.11 æ ‘ã€æ£®æ—ã€äºŒå‰æ ‘çš„è½¬æ¢ï¼ˆP195ï¼‰"></a>6.11 æ ‘ã€æ£®æ—ã€äºŒå‰æ ‘çš„è½¬æ¢ï¼ˆP195ï¼‰</h3><h3 id="6-12-èµ«å¤«æ›¼æ ‘åŠå…¶åº”ç”¨ï¼ˆP200ï¼‰"><a href="#6-12-èµ«å¤«æ›¼æ ‘åŠå…¶åº”ç”¨ï¼ˆP200ï¼‰" class="headerlink" title="6.12 èµ«å¤«æ›¼æ ‘åŠå…¶åº”ç”¨ï¼ˆP200ï¼‰"></a>6.12 èµ«å¤«æ›¼æ ‘åŠå…¶åº”ç”¨ï¼ˆP200ï¼‰</h3><h2 id="ç¬¬ä¸ƒç« -å›¾ï¼ˆP211ï¼‰"><a href="#ç¬¬ä¸ƒç« -å›¾ï¼ˆP211ï¼‰" class="headerlink" title="ç¬¬ä¸ƒç«  å›¾ï¼ˆP211ï¼‰"></a>ç¬¬ä¸ƒç«  å›¾ï¼ˆP211ï¼‰</h2><h3 id="7-2-å›¾çš„å®šä¹‰ï¼ˆP213ï¼‰"><a href="#7-2-å›¾çš„å®šä¹‰ï¼ˆP213ï¼‰" class="headerlink" title="7.2 å›¾çš„å®šä¹‰ï¼ˆP213ï¼‰"></a>7.2 å›¾çš„å®šä¹‰ï¼ˆP213ï¼‰</h3><h3 id="7-3-å›¾çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP222ï¼‰"><a href="#7-3-å›¾çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP222ï¼‰" class="headerlink" title="7.3 å›¾çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP222ï¼‰"></a>7.3 å›¾çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆP222ï¼‰</h3><h3 id="7-4-å›¾çš„å­˜å‚¨ç»“æ„ï¼ˆP223ï¼‰"><a href="#7-4-å›¾çš„å­˜å‚¨ç»“æ„ï¼ˆP223ï¼‰" class="headerlink" title="7.4 å›¾çš„å­˜å‚¨ç»“æ„ï¼ˆP223ï¼‰"></a>7.4 å›¾çš„å­˜å‚¨ç»“æ„ï¼ˆP223ï¼‰</h3><h3 id="7-5-å›¾çš„éå†ï¼ˆP237ï¼‰"><a href="#7-5-å›¾çš„éå†ï¼ˆP237ï¼‰" class="headerlink" title="7.5 å›¾çš„éå†ï¼ˆP237ï¼‰"></a>7.5 å›¾çš„éå†ï¼ˆP237ï¼‰</h3><h3 id="7-6-æœ€å°ç”Ÿæˆæ ‘ï¼ˆP245ï¼‰"><a href="#7-6-æœ€å°ç”Ÿæˆæ ‘ï¼ˆP245ï¼‰" class="headerlink" title="7.6 æœ€å°ç”Ÿæˆæ ‘ï¼ˆP245ï¼‰"></a>7.6 æœ€å°ç”Ÿæˆæ ‘ï¼ˆP245ï¼‰</h3><h3 id="7-7-æœ€çŸ­è·¯å¾„ï¼ˆP257ï¼‰"><a href="#7-7-æœ€çŸ­è·¯å¾„ï¼ˆP257ï¼‰" class="headerlink" title="7.7 æœ€çŸ­è·¯å¾„ï¼ˆP257ï¼‰"></a>7.7 æœ€çŸ­è·¯å¾„ï¼ˆP257ï¼‰</h3><h3 id="7-8-æ‹“æ‰‘æ’åºï¼ˆ270ï¼‰"><a href="#7-8-æ‹“æ‰‘æ’åºï¼ˆ270ï¼‰" class="headerlink" title="7.8 æ‹“æ‰‘æ’åºï¼ˆ270ï¼‰"></a>7.8 æ‹“æ‰‘æ’åºï¼ˆ270ï¼‰</h3><h3 id="7-9-å…³é”®è·¯å¾„ï¼ˆ277ï¼‰"><a href="#7-9-å…³é”®è·¯å¾„ï¼ˆ277ï¼‰" class="headerlink" title="7.9 å…³é”®è·¯å¾„ï¼ˆ277ï¼‰"></a>7.9 å…³é”®è·¯å¾„ï¼ˆ277ï¼‰</h3><h2 id="ç¬¬å…«ç« -æŸ¥æ‰¾ï¼ˆP291ï¼‰"><a href="#ç¬¬å…«ç« -æŸ¥æ‰¾ï¼ˆP291ï¼‰" class="headerlink" title="ç¬¬å…«ç«  æŸ¥æ‰¾ï¼ˆP291ï¼‰"></a>ç¬¬å…«ç«  æŸ¥æ‰¾ï¼ˆP291ï¼‰</h2><h3 id="8-2-æŸ¥æ‰¾æ¦‚è®ºï¼ˆP293ï¼‰"><a href="#8-2-æŸ¥æ‰¾æ¦‚è®ºï¼ˆP293ï¼‰" class="headerlink" title="8.2 æŸ¥æ‰¾æ¦‚è®ºï¼ˆP293ï¼‰"></a>8.2 æŸ¥æ‰¾æ¦‚è®ºï¼ˆP293ï¼‰</h3><h3 id="8-3-é¡ºåºè¡¨æŸ¥æ‰¾ï¼ˆP295ï¼‰"><a href="#8-3-é¡ºåºè¡¨æŸ¥æ‰¾ï¼ˆP295ï¼‰" class="headerlink" title="8.3 é¡ºåºè¡¨æŸ¥æ‰¾ï¼ˆP295ï¼‰"></a>8.3 é¡ºåºè¡¨æŸ¥æ‰¾ï¼ˆP295ï¼‰</h3><h3 id="8-4-æœ‰åºè¡¨æŸ¥æ‰¾ï¼ˆP298ï¼‰"><a href="#8-4-æœ‰åºè¡¨æŸ¥æ‰¾ï¼ˆP298ï¼‰" class="headerlink" title="8.4 æœ‰åºè¡¨æŸ¥æ‰¾ï¼ˆP298ï¼‰"></a>8.4 æœ‰åºè¡¨æŸ¥æ‰¾ï¼ˆP298ï¼‰</h3><h3 id="8-5-çº¿æ€§ç´¢å¼•æŸ¥æ‰¾ï¼ˆP306ï¼‰"><a href="#8-5-çº¿æ€§ç´¢å¼•æŸ¥æ‰¾ï¼ˆP306ï¼‰" class="headerlink" title="8.5 çº¿æ€§ç´¢å¼•æŸ¥æ‰¾ï¼ˆP306ï¼‰"></a>8.5 çº¿æ€§ç´¢å¼•æŸ¥æ‰¾ï¼ˆP306ï¼‰</h3><h3 id="8-6-äºŒå‰æ’åºæ ‘ï¼ˆP313ï¼‰"><a href="#8-6-äºŒå‰æ’åºæ ‘ï¼ˆP313ï¼‰" class="headerlink" title="8.6 äºŒå‰æ’åºæ ‘ï¼ˆP313ï¼‰"></a>8.6 äºŒå‰æ’åºæ ‘ï¼ˆP313ï¼‰</h3><h3 id="8-7-å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰ï¼ˆP328ï¼‰"><a href="#8-7-å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰ï¼ˆP328ï¼‰" class="headerlink" title="8.7 å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰ï¼ˆP328ï¼‰"></a>8.7 å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰ï¼ˆP328ï¼‰</h3><h3 id="8-8-å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆBæ ‘ï¼‰ï¼ˆP341ï¼‰"><a href="#8-8-å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆBæ ‘ï¼‰ï¼ˆP341ï¼‰" class="headerlink" title="8.8 å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆBæ ‘ï¼‰ï¼ˆP341ï¼‰"></a>8.8 å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆBæ ‘ï¼‰ï¼ˆP341ï¼‰</h3><h3 id="8-9-æ•£åˆ—è¡¨æŸ¥æ‰¾ï¼ˆå“ˆå¸Œè¡¨ï¼‰æ¦‚è¿°ï¼ˆP353ï¼‰"><a href="#8-9-æ•£åˆ—è¡¨æŸ¥æ‰¾ï¼ˆå“ˆå¸Œè¡¨ï¼‰æ¦‚è¿°ï¼ˆP353ï¼‰" class="headerlink" title="8.9 æ•£åˆ—è¡¨æŸ¥æ‰¾ï¼ˆå“ˆå¸Œè¡¨ï¼‰æ¦‚è¿°ï¼ˆP353ï¼‰"></a>8.9 æ•£åˆ—è¡¨æŸ¥æ‰¾ï¼ˆå“ˆå¸Œè¡¨ï¼‰æ¦‚è¿°ï¼ˆP353ï¼‰</h3><h3 id="8-10-æ•£åˆ—å‡½æ•°çš„æ„é€ æ–¹æ³•ï¼ˆP356ï¼‰"><a href="#8-10-æ•£åˆ—å‡½æ•°çš„æ„é€ æ–¹æ³•ï¼ˆP356ï¼‰" class="headerlink" title="8.10 æ•£åˆ—å‡½æ•°çš„æ„é€ æ–¹æ³•ï¼ˆP356ï¼‰"></a>8.10 æ•£åˆ—å‡½æ•°çš„æ„é€ æ–¹æ³•ï¼ˆP356ï¼‰</h3><h3 id="8-11-å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼ˆP360ï¼‰"><a href="#8-11-å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼ˆP360ï¼‰" class="headerlink" title="8.11 å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼ˆP360ï¼‰"></a>8.11 å¤„ç†æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼ˆP360ï¼‰</h3><h3 id="8-12-æ•£åˆ—åˆ—è¡¨æŸ¥æ‰¾å®ç°ï¼ˆP365ï¼‰"><a href="#8-12-æ•£åˆ—åˆ—è¡¨æŸ¥æ‰¾å®ç°ï¼ˆP365ï¼‰" class="headerlink" title="8.12 æ•£åˆ—åˆ—è¡¨æŸ¥æ‰¾å®ç°ï¼ˆP365ï¼‰"></a>8.12 æ•£åˆ—åˆ—è¡¨æŸ¥æ‰¾å®ç°ï¼ˆP365ï¼‰</h3><h2 id="ç¬¬ä¹ç« -æ’åºï¼ˆP373ï¼‰"><a href="#ç¬¬ä¹ç« -æ’åºï¼ˆP373ï¼‰" class="headerlink" title="ç¬¬ä¹ç«  æ’åºï¼ˆP373ï¼‰"></a>ç¬¬ä¹ç«  æ’åºï¼ˆP373ï¼‰</h2><h3 id="9-2-æ’åºçš„åŸºæœ¬æ¦‚å¿µä¸åˆ†ç±»ï¼ˆP375ï¼‰"><a href="#9-2-æ’åºçš„åŸºæœ¬æ¦‚å¿µä¸åˆ†ç±»ï¼ˆP375ï¼‰" class="headerlink" title="9.2 æ’åºçš„åŸºæœ¬æ¦‚å¿µä¸åˆ†ç±»ï¼ˆP375ï¼‰"></a>9.2 æ’åºçš„åŸºæœ¬æ¦‚å¿µä¸åˆ†ç±»ï¼ˆP375ï¼‰</h3><h3 id="9-3-å†’æ³¡æ’åºï¼ˆP378ï¼‰"><a href="#9-3-å†’æ³¡æ’åºï¼ˆP378ï¼‰" class="headerlink" title="9.3 å†’æ³¡æ’åºï¼ˆP378ï¼‰"></a>9.3 å†’æ³¡æ’åºï¼ˆP378ï¼‰</h3><h3 id="9-4-ç®€å•é€‰æ‹©æ’åºï¼ˆP384ï¼‰"><a href="#9-4-ç®€å•é€‰æ‹©æ’åºï¼ˆP384ï¼‰" class="headerlink" title="9.4 ç®€å•é€‰æ‹©æ’åºï¼ˆP384ï¼‰"></a>9.4 ç®€å•é€‰æ‹©æ’åºï¼ˆP384ï¼‰</h3><h3 id="9-5-ç›´æ¥æ’å…¥æ’åºï¼ˆP386ï¼‰"><a href="#9-5-ç›´æ¥æ’å…¥æ’åºï¼ˆP386ï¼‰" class="headerlink" title="9.5 ç›´æ¥æ’å…¥æ’åºï¼ˆP386ï¼‰"></a>9.5 ç›´æ¥æ’å…¥æ’åºï¼ˆP386ï¼‰</h3><h3 id="9-6-å¸Œå°”æ’åºï¼ˆP389ï¼‰"><a href="#9-6-å¸Œå°”æ’åºï¼ˆP389ï¼‰" class="headerlink" title="9.6 å¸Œå°”æ’åºï¼ˆP389ï¼‰"></a>9.6 å¸Œå°”æ’åºï¼ˆP389ï¼‰</h3><h3 id="9-7-å †æ’åºï¼ˆP396ï¼‰"><a href="#9-7-å †æ’åºï¼ˆP396ï¼‰" class="headerlink" title="9.7 å †æ’åºï¼ˆP396ï¼‰"></a>9.7 å †æ’åºï¼ˆP396ï¼‰</h3><h3 id="9-8-å½’å¹¶æ’åºï¼ˆP406ï¼‰"><a href="#9-8-å½’å¹¶æ’åºï¼ˆP406ï¼‰" class="headerlink" title="9.8 å½’å¹¶æ’åºï¼ˆP406ï¼‰"></a>9.8 å½’å¹¶æ’åºï¼ˆP406ï¼‰</h3><h3 id="9-9-å¿«é€Ÿæ’åºï¼ˆP417ï¼‰"><a href="#9-9-å¿«é€Ÿæ’åºï¼ˆP417ï¼‰" class="headerlink" title="9.9 å¿«é€Ÿæ’åºï¼ˆP417ï¼‰"></a>9.9 å¿«é€Ÿæ’åºï¼ˆP417ï¼‰</h3>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
          <category> å¾…æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> å¾…æ•´ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rabbitMQ å­¦ä¹ ç¬”è®°</title>
      <link href="2020/10/21/MQ/RabbitMQ/RabbitMQ/"/>
      <url>2020/10/21/MQ/RabbitMQ/RabbitMQ/</url>
      
        <content type="html"><![CDATA[<h1 id="RabbitMQ-å®æˆ˜æ•™ç¨‹"><a href="#RabbitMQ-å®æˆ˜æ•™ç¨‹" class="headerlink" title="RabbitMQ å®æˆ˜æ•™ç¨‹"></a>RabbitMQ å®æˆ˜æ•™ç¨‹</h1><h2 id="1-MQå¼•è¨€"><a href="#1-MQå¼•è¨€" class="headerlink" title="1.MQå¼•è¨€"></a>1.MQå¼•è¨€</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯MQ"><a href="#1-1-ä»€ä¹ˆæ˜¯MQ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯MQ"></a>1.1 ä»€ä¹ˆæ˜¯MQ</h3><p><code>MQ</code>(Message Quene) :  ç¿»è¯‘ä¸º <code>æ¶ˆæ¯é˜Ÿåˆ—</code>,é€šè¿‡å…¸å‹çš„ <code>ç”Ÿäº§è€…</code>å’Œ<code>æ¶ˆè´¹è€…</code>æ¨¡å‹,ç”Ÿäº§è€…ä¸æ–­å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä¸æ–­çš„ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚å› ä¸ºæ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”åªå…³å¿ƒæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘çš„ä¾µå…¥,è½»æ¾çš„å®ç°ç³»ç»Ÿé—´è§£è€¦ã€‚åˆ«åä¸º <code>æ¶ˆæ¯ä¸­é—´ä»¶</code>    é€šè¿‡åˆ©ç”¨é«˜æ•ˆå¯é çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶è¿›è¡Œå¹³å°æ— å…³çš„æ•°æ®äº¤æµï¼Œå¹¶åŸºäºæ•°æ®é€šä¿¡æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é›†æˆã€‚</p><h3 id="1-2-MQæœ‰å“ªäº›"><a href="#1-2-MQæœ‰å“ªäº›" class="headerlink" title="1.2 MQæœ‰å“ªäº›"></a>1.2 MQæœ‰å“ªäº›</h3><p>å½“ä»Šå¸‚é¢ä¸Šæœ‰å¾ˆå¤šä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚è€ç‰Œçš„<code>ActiveMQ</code>ã€<code>RabbitMQ</code>ï¼Œç‚™æ‰‹å¯çƒ­çš„<code>Kafka</code>ï¼Œé˜¿é‡Œå·´å·´è‡ªä¸»å¼€å‘<code>RocketMQ</code>ç­‰ã€‚</p><h3 id="1-3-ä¸åŒMQç‰¹ç‚¹"><a href="#1-3-ä¸åŒMQç‰¹ç‚¹" class="headerlink" title="1.3 ä¸åŒMQç‰¹ç‚¹"></a>1.3 ä¸åŒMQç‰¹ç‚¹</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.ActiveMQ</span></span><br><span class="line"><span class="code">ActiveMQ æ˜¯Apacheå‡ºå“ï¼Œæœ€æµè¡Œçš„ï¼Œèƒ½åŠ›å¼ºåŠ²çš„å¼€æºæ¶ˆæ¯æ€»çº¿ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œå…¨æ”¯æŒJMSè§„èŒƒçš„çš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ä¸°å¯Œçš„API,å¤šç§é›†ç¾¤æ¶æ„æ¨¡å¼è®©ActiveMQåœ¨ä¸šç•Œæˆä¸ºè€ç‰Œçš„æ¶ˆæ¯ä¸­é—´ä»¶,åœ¨ä¸­å°å‹ä¼ä¸šé¢‡å—æ¬¢è¿!</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 2.Kafka</span></span><br><span class="line"><span class="code">Kafkaæ˜¯LinkedInå¼€æºçš„åˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œç›®å‰å½’å±äºApacheé¡¶çº§é¡¹ç›®ã€‚Kafkaä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºPullçš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œ</span></span><br><span class="line"><span class="code">è¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“ã€‚0.8ç‰ˆæœ¬å¼€å§‹æ”¯æŒå¤åˆ¶ï¼Œä¸æ”¯æŒäº‹åŠ¡ï¼Œå¯¹æ¶ˆæ¯çš„é‡å¤ã€ä¸¢å¤±ã€é”™è¯¯æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œ</span></span><br><span class="line"><span class="code">é€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 3.RocketMQ</span></span><br><span class="line"><span class="code">RocketMQæ˜¯é˜¿é‡Œå¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒæ˜¯çº¯Javaå¼€å‘ï¼Œå…·æœ‰é«˜ååé‡ã€é«˜å¯ç”¨æ€§ã€é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨çš„ç‰¹ç‚¹ã€‚RocketMQæ€è·¯èµ·</span></span><br><span class="line"><span class="code">æºäºKafkaï¼Œä½†å¹¶ä¸æ˜¯Kafkaçš„ä¸€ä¸ªCopyï¼Œå®ƒå¯¹æ¶ˆæ¯çš„å¯é ä¼ è¾“åŠäº‹åŠ¡æ€§åšäº†ä¼˜åŒ–ï¼Œç›®å‰åœ¨é˜¿é‡Œé›†å›¢è¢«å¹¿æ³›åº”ç”¨äºäº¤æ˜“ã€å……å€¼ã€æµè®¡ç®—ã€æ¶ˆ</span></span><br><span class="line"><span class="code">æ¯æ¨é€ã€æ—¥å¿—æµå¼å¤„ç†ã€binglogåˆ†å‘ç­‰åœºæ™¯ã€‚</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 4.RabbitMQ</span></span><br><span class="line"><span class="code">RabbitMQæ˜¯ä½¿ç”¨Erlangè¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ŒåŸºäºAMQPåè®®æ¥å®ç°ã€‚AMQPçš„ä¸»è¦ç‰¹å¾æ˜¯é¢å‘æ¶ˆæ¯ã€é˜Ÿåˆ—ã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œ</span></span><br><span class="line"><span class="code">å‘å¸ƒ/è®¢é˜…ï¼‰ã€å¯é æ€§ã€å®‰å…¨ã€‚AMQPåè®®æ›´å¤šç”¨åœ¨ä¼ä¸šç³»ç»Ÿå†…å¯¹æ•°æ®ä¸€è‡´æ€§ã€ç¨³å®šæ€§å’Œå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå¯¹æ€§èƒ½å’Œååé‡çš„è¦æ±‚è¿˜åœ¨</span></span><br><span class="line"><span class="code">å…¶æ¬¡ã€‚</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure><blockquote><p>RabbitMQæ¯”Kafkaå¯é ï¼ŒKafkaæ›´é€‚åˆIOé«˜ååçš„å¤„ç†ï¼Œä¸€èˆ¬åº”ç”¨åœ¨å¤§æ•°æ®æ—¥å¿—å¤„ç†æˆ–å¯¹å®æ—¶æ€§ï¼ˆå°‘é‡å»¶è¿Ÿï¼‰ï¼Œå¯é æ€§ï¼ˆå°‘é‡ä¸¢æ•°æ®ï¼‰è¦æ±‚ç¨ä½çš„åœºæ™¯ä½¿ç”¨ï¼Œæ¯”å¦‚ELKæ—¥å¿—æ”¶é›†ã€‚</p></blockquote><hr><h2 id="2-RabbitMQ-çš„å¼•è¨€"><a href="#2-RabbitMQ-çš„å¼•è¨€" class="headerlink" title="2.RabbitMQ çš„å¼•è¨€"></a>2.RabbitMQ çš„å¼•è¨€</h2><h3 id="2-1-RabbitMQ"><a href="#2-1-RabbitMQ" class="headerlink" title="2.1 RabbitMQ"></a>2.1 RabbitMQ</h3><blockquote><p>åŸºäº<code>AMQP</code>åè®®ï¼Œerlangè¯­è¨€å¼€å‘ï¼Œæ˜¯éƒ¨ç½²æœ€å¹¿æ³›çš„å¼€æºæ¶ˆæ¯ä¸­é—´ä»¶,æ˜¯æœ€å—æ¬¢è¿çš„å¼€æºæ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925215603036-9419777.png" alt="image-20190925215603036"></p><p><code>å®˜ç½‘</code>: <a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><p><code>å®˜æ–¹æ•™ç¨‹</code>: <a href="https://www.rabbitmq.com/#getstarted">https://www.rabbitmq.com/#getstarted</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># AMQP åè®®</span></span><br><span class="line"><span class="code">AMQPï¼ˆadvanced message queuing protocolï¼‰`åœ¨2003å¹´æ—¶è¢«æå‡ºï¼Œæœ€æ—©ç”¨äºè§£å†³é‡‘èé¢†ä¸åŒå¹³å°ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’äº¤äº’é—®é¢˜ã€‚é¡¾åæ€ä¹‰ï¼ŒAMQPæ˜¯ä¸€ç§åè®®ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯ä¸€ç§binary wire-level protocolï¼ˆé“¾æ¥åè®®ï¼‰ã€‚è¿™æ˜¯å…¶å’ŒJMSçš„æœ¬è´¨å·®åˆ«ï¼ŒAMQPä¸ä»APIå±‚è¿›è¡Œé™å®šï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰ç½‘ç»œäº¤æ¢çš„æ•°æ®æ ¼å¼ã€‚è¿™ä½¿å¾—å®ç°äº†AMQPçš„providerå¤©ç„¶æ€§å°±æ˜¯è·¨å¹³å°çš„ã€‚ä»¥ä¸‹æ˜¯AMQPåè®®æ¨¡å‹:</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200311182438041.png" alt="image-20200311182438041"></p><h3 id="2-2-RabbitMQ-çš„å®‰è£…"><a href="#2-2-RabbitMQ-çš„å®‰è£…" class="headerlink" title="2.2 RabbitMQ çš„å®‰è£…"></a>2.2 RabbitMQ çš„å®‰è£…</h3><h4 id="2-2-1-ä¸‹è½½"><a href="#2-2-1-ä¸‹è½½" class="headerlink" title="2.2.1 ä¸‹è½½"></a>2.2.1 ä¸‹è½½</h4><p><code>å®˜ç½‘ä¸‹è½½åœ°å€</code>: <a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a><br><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925220115235.png" alt="image-20190925220115235"></p><blockquote><p><code>æœ€æ–°ç‰ˆæœ¬</code>: 3.7.18</p></blockquote><h4 id="2-2-2-ä¸‹è½½çš„å®‰è£…åŒ…"><a href="#2-2-2-ä¸‹è½½çš„å®‰è£…åŒ…" class="headerlink" title="2.2.2 ä¸‹è½½çš„å®‰è£…åŒ…"></a>2.2.2 ä¸‹è½½çš„å®‰è£…åŒ…<img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925220343521.png" alt="image-20190925220343521"></h4><blockquote><p><code>æ³¨æ„</code>:è¿™é‡Œçš„å®‰è£…åŒ…æ˜¯centos7å®‰è£…çš„åŒ…</p></blockquote><h4 id="2-2-3-å®‰è£…æ­¥éª¤"><a href="#2-2-3-å®‰è£…æ­¥éª¤" class="headerlink" title="2.2.3 å®‰è£…æ­¥éª¤"></a>2.2.3 å®‰è£…æ­¥éª¤</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.å°†rabbitmqå®‰è£…åŒ…ä¸Šä¼ åˆ°linuxç³»ç»Ÿä¸­</span></span><br><span class="line"><span class="code">erlang-22.0.7-1.el7.x86_64.rpm</span></span><br><span class="line"><span class="code">rabbitmq-server-3.7.18-1.el7.noarch.rpm</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 2.å®‰è£…Erlangä¾èµ–åŒ…</span></span><br><span class="line"><span class="code">rpm -ivh erlang-22.0.7-1.el7.x86_64.rpm</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 3.å®‰è£…RabbitMQå®‰è£…åŒ…(éœ€è¦è”ç½‘)</span></span><br><span class="line"><span class="code">yum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm</span></span><br><span class="line"><span class="code">æ³¨æ„:é»˜è®¤å®‰è£…å®Œæˆåé…ç½®æ–‡ä»¶æ¨¡æ¿åœ¨:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.exampleç›®å½•ä¸­,éœ€è¦</span></span><br><span class="line"><span class="code">å°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°/etc/rabbitmq/ç›®å½•ä¸­,å¹¶ä¿®æ”¹åç§°ä¸ºrabbitmq.config</span></span><br><span class="line"><span class="code"># 4.å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="code">cp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 5.æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®</span></span><br><span class="line"><span class="code">ls /etc/rabbitmq/rabbitmq.config</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 6.ä¿®æ”¹é…ç½®æ–‡ä»¶(å‚è§ä¸‹å›¾:)</span></span><br><span class="line"><span class="code">vim /etc/rabbitmq/rabbitmq.config </span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925222230260-3836271.png" alt="image-20190925222230260"></p><p>å°†ä¸Šå›¾ä¸­é…ç½®æ–‡ä»¶ä¸­çº¢è‰²éƒ¨åˆ†å»æ‰<code>%%</code>,ä»¥åŠæœ€åçš„<code>,</code>é€—å· ä¿®æ”¹ä¸ºä¸‹å›¾:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925222329200-3836312.png" alt="image-20190925222329200"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 7.æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤,å¯åŠ¨rabbitmqä¸­çš„æ’ä»¶ç®¡ç†</span></span><br><span class="line"><span class="code">rabbitmq-plugins enable rabbitmq_management</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">å‡ºç°å¦‚ä¸‹è¯´æ˜:</span></span><br><span class="line"><span class="code">Enabling plugins on node rabbit@localhost:</span></span><br><span class="line"><span class="code">    rabbitmq_management</span></span><br><span class="line"><span class="code">    The following plugins have been configured:</span></span><br><span class="line"><span class="code">      rabbitmq_management</span></span><br><span class="line"><span class="code">      rabbitmq_management_agent</span></span><br><span class="line"><span class="code">      rabbitmq_web_dispatch</span></span><br><span class="line"><span class="code">    Applying plugin configuration to rabbit@localhost...</span></span><br><span class="line"><span class="code">    The following plugins have been enabled:</span></span><br><span class="line"><span class="code">      rabbitmq_management</span></span><br><span class="line"><span class="code">      rabbitmq_management_agent</span></span><br><span class="line"><span class="code">      rabbitmq_web_dispatch</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    set 3 plugins.</span></span><br><span class="line"><span class="code">    Offline change; changes will take effect at broker restart.</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 8.å¯åŠ¨RabbitMQçš„æœåŠ¡</span></span><br><span class="line"><span class="code">systemctl start rabbitmq-server</span></span><br><span class="line"><span class="code">systemctl restart rabbitmq-server</span></span><br><span class="line"><span class="code">systemctl stop rabbitmq-server</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 9.æŸ¥çœ‹æœåŠ¡çŠ¶æ€(è§ä¸‹å›¾:)</span></span><br><span class="line"><span class="code">systemctl status rabbitmq-server</span></span><br><span class="line"><span class="code">  â— rabbitmq-server.service - RabbitMQ broker</span></span><br><span class="line"><span class="code">     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)</span></span><br><span class="line"><span class="code">     Active: active (running) since ä¸‰ 2019-09-25 22:26:35 CST; 7s ago</span></span><br><span class="line"><span class="code">   Main PID: 2904 (beam.smp)</span></span><br><span class="line"><span class="code">     Status: &quot;Initialized&quot;</span></span><br><span class="line"><span class="code">     CGroup: /system.slice/rabbitmq-server.service</span></span><br><span class="line"><span class="code">             â”œâ”€2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -</span></span><br><span class="line"><span class="code">             MBlmbcs...</span></span><br><span class="line"><span class="code">             â”œâ”€3220 erl_child_setup 32768</span></span><br><span class="line"><span class="code">             â”œâ”€3243 inet_gethost 4</span></span><br><span class="line"><span class="code">             â””â”€3244 inet_gethost 4</span></span><br><span class="line"><span class="code">      .........</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190925222743776-3836511.png" alt="image-20190925222743776"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 10.å…³é—­é˜²ç«å¢™æœåŠ¡</span></span><br><span class="line"><span class="code">systemctl disable firewalld</span></span><br><span class="line"><span class="code">    Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span></span><br><span class="line"><span class="code">    Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span></span><br><span class="line"><span class="code">systemctl stop firewalld   </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 11.è®¿é—®webç®¡ç†ç•Œé¢</span></span><br><span class="line"><span class="code">http://10.15.0.8:15672/</span></span><br></pre></td></tr></table></figure><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190926194738708-3836601.png" alt="image-20190926194738708"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 12.ç™»å½•ç®¡ç†ç•Œé¢</span></span><br><span class="line"><span class="code">username:  guest</span></span><br><span class="line"><span class="code">password:  guest</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20190926194954822-3836665.png" alt="image-20190926194954822"></p><hr><h2 id="3-RabitMQ-é…ç½®"><a href="#3-RabitMQ-é…ç½®" class="headerlink" title="3. RabitMQ é…ç½®"></a>3. RabitMQ é…ç½®</h2><h3 id="3-1RabbitMQ-ç®¡ç†å‘½ä»¤è¡Œ"><a href="#3-1RabbitMQ-ç®¡ç†å‘½ä»¤è¡Œ" class="headerlink" title="3.1RabbitMQ ç®¡ç†å‘½ä»¤è¡Œ"></a>3.1RabbitMQ ç®¡ç†å‘½ä»¤è¡Œ</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.æœåŠ¡å¯åŠ¨ç›¸å…³</span></span><br><span class="line"><span class="code">systemctl start|restart|stop|status rabbitmq-server</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 2.ç®¡ç†å‘½ä»¤è¡Œ  ç”¨æ¥åœ¨ä¸ä½¿ç”¨webç®¡ç†ç•Œé¢æƒ…å†µä¸‹å‘½ä»¤æ“ä½œRabbitMQ</span></span><br><span class="line"><span class="code">rabbitmqctl  help  å¯ä»¥æŸ¥çœ‹æ›´å¤šå‘½ä»¤</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 3.æ’ä»¶ç®¡ç†å‘½ä»¤è¡Œ</span></span><br><span class="line"><span class="code">rabbitmq-plugins enable|list|disable </span></span><br></pre></td></tr></table></figure><h3 id="3-2-webç®¡ç†ç•Œé¢ä»‹ç»"><a href="#3-2-webç®¡ç†ç•Œé¢ä»‹ç»" class="headerlink" title="3.2 webç®¡ç†ç•Œé¢ä»‹ç»"></a>3.2 webç®¡ç†ç•Œé¢ä»‹ç»</h3><h4 id="3-2-1-overviewæ¦‚è§ˆ"><a href="#3-2-1-overviewæ¦‚è§ˆ" class="headerlink" title="3.2.1 overviewæ¦‚è§ˆ"></a>3.2.1 overviewæ¦‚è§ˆ</h4><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126162026720.png" alt="image-20191126162026720" style="zoom:200%;"><ul><li><p><code>connectionsï¼šæ— è®ºç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œéƒ½éœ€è¦ä¸RabbitMQå»ºç«‹è¿æ¥åæ‰å¯ä»¥å®Œæˆæ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹è¿æ¥æƒ…å†µ</code></p></li><li><p><code>channelsï¼šé€šé“ï¼Œå»ºç«‹è¿æ¥åï¼Œä¼šå½¢æˆé€šé“ï¼Œæ¶ˆæ¯çš„æŠ•é€’è·å–ä¾èµ–é€šé“ã€‚</code></p></li><li><p><code>Exchangesï¼šäº¤æ¢æœºï¼Œç”¨æ¥å®ç°æ¶ˆæ¯çš„è·¯ç”±</code></p></li><li><p><code>Queuesï¼šé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹ï¼Œæ¶ˆè´¹åè¢«ç§»é™¤é˜Ÿåˆ—ã€‚</code></p></li></ul><h4 id="3-2-2-Adminç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœºç®¡ç†"><a href="#3-2-2-Adminç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœºç®¡ç†" class="headerlink" title="3.2.2 Adminç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœºç®¡ç†"></a>3.2.2 Adminç”¨æˆ·å’Œè™šæ‹Ÿä¸»æœºç®¡ç†</h4><h5 id="1-æ·»åŠ ç”¨æˆ·"><a href="#1-æ·»åŠ ç”¨æˆ·" class="headerlink" title="1. æ·»åŠ ç”¨æˆ·"></a>1. æ·»åŠ ç”¨æˆ·</h5><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126162617280.png" alt="image-20191126162617280"></p><p>ä¸Šé¢çš„Tagsé€‰é¡¹ï¼Œå…¶å®æ˜¯æŒ‡å®šç”¨æˆ·çš„è§’è‰²ï¼Œå¯é€‰çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p><code>è¶…çº§ç®¡ç†å‘˜(administrator)</code></p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç”¨æˆ·ï¼Œç­–ç•¥(policy)è¿›è¡Œæ“ä½œã€‚</p></li><li><p><code>ç›‘æ§è€…(monitoring)</code></p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼ŒåŒæ—¶å¯ä»¥æŸ¥çœ‹rabbitmqèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(è¿›ç¨‹æ•°ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç£ç›˜ä½¿ç”¨æƒ…å†µç­‰)</p></li><li><p><code>ç­–ç•¥åˆ¶å®šè€…(policymaker)</code></p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°, åŒæ—¶å¯ä»¥å¯¹policyè¿›è¡Œç®¡ç†ã€‚ä½†æ— æ³•æŸ¥çœ‹èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(ä¸Šå›¾çº¢æ¡†æ ‡è¯†çš„éƒ¨åˆ†)ã€‚</p></li><li><p><code>æ™®é€šç®¡ç†è€…(management)</code></p><p>ä»…å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œæ— æ³•çœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¯¹ç­–ç•¥è¿›è¡Œç®¡ç†ã€‚</p></li><li><p><code>å…¶ä»–</code></p><p>æ— æ³•ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œé€šå¸¸å°±æ˜¯æ™®é€šçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p></li></ul><h5 id="2-åˆ›å»ºè™šæ‹Ÿä¸»æœº"><a href="#2-åˆ›å»ºè™šæ‹Ÿä¸»æœº" class="headerlink" title="2. åˆ›å»ºè™šæ‹Ÿä¸»æœº"></a>2. åˆ›å»ºè™šæ‹Ÿä¸»æœº</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line"><span class="code">ä¸ºäº†è®©å„ä¸ªç”¨æˆ·å¯ä»¥äº’ä¸å¹²æ‰°çš„å·¥ä½œï¼ŒRabbitMQæ·»åŠ äº†è™šæ‹Ÿä¸»æœºï¼ˆVirtual Hostsï¼‰çš„æ¦‚å¿µã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è®¿é—®è·¯å¾„ï¼Œä¸åŒç”¨æˆ·ä½¿ç”¨ä¸åŒè·¯å¾„ï¼Œå„è‡ªæœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€äº¤æ¢æœºï¼Œäº’ç›¸ä¸ä¼šå½±å“ã€‚</span></span><br></pre></td></tr></table></figure><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126163023153.png" alt="image-20191126163023153"></p><h5 id="3-ç»‘å®šè™šæ‹Ÿä¸»æœºå’Œç”¨æˆ·"><a href="#3-ç»‘å®šè™šæ‹Ÿä¸»æœºå’Œç”¨æˆ·" class="headerlink" title="3. ç»‘å®šè™šæ‹Ÿä¸»æœºå’Œç”¨æˆ·"></a>3. ç»‘å®šè™šæ‹Ÿä¸»æœºå’Œç”¨æˆ·</h5><p>åˆ›å»ºå¥½è™šæ‹Ÿä¸»æœºï¼Œæˆ‘ä»¬è¿˜è¦ç»™ç”¨æˆ·æ·»åŠ è®¿é—®æƒé™ï¼š</p><p>ç‚¹å‡»æ·»åŠ å¥½çš„è™šæ‹Ÿä¸»æœºï¼š</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126163506795.png" alt="image-20191126163506795"></p><p>è¿›å…¥è™šæ‹Ÿæœºè®¾ç½®ç•Œé¢:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126163631889.png" alt="image-20191126163631889"></p><hr><h2 id="4-RabbitMQ-çš„ç¬¬ä¸€ä¸ªç¨‹åº"><a href="#4-RabbitMQ-çš„ç¬¬ä¸€ä¸ªç¨‹åº" class="headerlink" title="4.RabbitMQ çš„ç¬¬ä¸€ä¸ªç¨‹åº"></a>4.RabbitMQ çš„ç¬¬ä¸€ä¸ªç¨‹åº</h2><h3 id="4-0-AMQPåè®®çš„å›é¡¾"><a href="#4-0-AMQPåè®®çš„å›é¡¾" class="headerlink" title="4.0 AMQPåè®®çš„å›é¡¾"></a>4.0 AMQPåè®®çš„å›é¡¾</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200312140114784.png" alt="image-20200312140114784"></p><h3 id="4-1-RabbitMQæ”¯æŒçš„æ¶ˆæ¯æ¨¡å‹"><a href="#4-1-RabbitMQæ”¯æŒçš„æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="4.1 RabbitMQæ”¯æŒçš„æ¶ˆæ¯æ¨¡å‹"></a>4.1 RabbitMQæ”¯æŒçš„æ¶ˆæ¯æ¨¡å‹</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126165434784.png" alt="image-20191126165434784"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126165459282.png" alt="image-20191126165459282"></p><h3 id="4-2-å¼•å…¥ä¾èµ–"><a href="#4-2-å¼•å…¥ä¾èµ–" class="headerlink" title="4.2 å¼•å…¥ä¾èµ–"></a>4.2 å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-3-ç¬¬ä¸€ç§æ¨¡å‹-ç›´è¿"><a href="#4-3-ç¬¬ä¸€ç§æ¨¡å‹-ç›´è¿" class="headerlink" title="4.3 ç¬¬ä¸€ç§æ¨¡å‹(ç›´è¿)"></a>4.3 ç¬¬ä¸€ç§æ¨¡å‹(ç›´è¿)</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126165840602.png" alt="image-20191126165840602"></p><p>åœ¨ä¸Šå›¾çš„æ¨¡å‹ä¸­ï¼Œæœ‰ä»¥ä¸‹æ¦‚å¿µï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åº</li><li>Cï¼šæ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥å—è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚</li><li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå›¾ä¸­çº¢è‰²éƒ¨åˆ†ã€‚ç±»ä¼¼ä¸€ä¸ªé‚®ç®±ï¼Œå¯ä»¥ç¼“å­˜æ¶ˆæ¯ï¼›ç”Ÿäº§è€…å‘å…¶ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä»å…¶ä¸­å–å‡ºæ¶ˆæ¯ã€‚</li></ul><h5 id="1-å¼€å‘ç”Ÿäº§è€…"><a href="#1-å¼€å‘ç”Ÿäº§è€…" class="headerlink" title="1. å¼€å‘ç”Ÿäº§è€…"></a>1. å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">connectionFactory.setHost(<span class="string">&quot;10.15.0.9&quot;</span>);</span><br><span class="line">connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">connectionFactory.setUsername(<span class="string">&quot;ems&quot;</span>);</span><br><span class="line">connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">connectionFactory.setVirtualHost(<span class="string">&quot;/ems&quot;</span>);</span><br><span class="line">Connection connection = connectionFactory.newConnection();</span><br><span class="line"><span class="comment">//åˆ›å»ºé€šé“</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//å‚æ•°1: æ˜¯å¦æŒä¹…åŒ–  å‚æ•°2:æ˜¯å¦ç‹¬å é˜Ÿåˆ— å‚æ•°3:æ˜¯å¦è‡ªåŠ¨åˆ é™¤  å‚æ•°4:å…¶ä»–å±æ€§</span></span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// å‚æ•°1ï¼šäº¤æ¢æœºåç§°ï¼Œæ²¡æœ‰å¯ä»¥ä¸å†™</span></span><br><span class="line"><span class="comment">// å‚æ•°2ï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">// å‚æ•°4ï¼šå‘é€æ¶ˆæ¯æ—¶çš„ä¸€äº›é¢å¤–å‚æ•°</span></span><br><span class="line"><span class="comment">// å‚æ•°3ï¼šæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;hello&quot;</span>, <span class="keyword">null</span>,<span class="string">&quot;hello rabbitmq&quot;</span>.getBytes());</span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h5 id="2-å¼€å‘æ¶ˆè´¹è€…"><a href="#2-å¼€å‘æ¶ˆè´¹è€…" class="headerlink" title="2. å¼€å‘æ¶ˆè´¹è€…"></a>2. å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">connectionFactory.setHost(<span class="string">&quot;10.15.0.9&quot;</span>);</span><br><span class="line">connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">connectionFactory.setUsername(<span class="string">&quot;ems&quot;</span>);</span><br><span class="line">connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">connectionFactory.setVirtualHost(<span class="string">&quot;/ems&quot;</span>);</span><br><span class="line">Connection connection = connectionFactory.newConnection();</span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">channel.basicConsume(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-å‚æ•°çš„è¯´æ˜"><a href="#3-å‚æ•°çš„è¯´æ˜" class="headerlink" title="3. å‚æ•°çš„è¯´æ˜"></a>3. å‚æ•°çš„è¯´æ˜</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="string">&#x27;å‚æ•°1&#x27;</span>:ç”¨æ¥å£°æ˜é€šé“å¯¹åº”çš„é˜Ÿåˆ—</span><br><span class="line"> <span class="string">&#x27;å‚æ•°2&#x27;</span>:ç”¨æ¥æŒ‡å®šæ˜¯å¦æŒä¹…åŒ–é˜Ÿåˆ—</span><br><span class="line"> <span class="string">&#x27;å‚æ•°3&#x27;</span>:ç”¨æ¥æŒ‡å®šæ˜¯å¦ç‹¬å é˜Ÿåˆ—</span><br><span class="line"> <span class="string">&#x27;å‚æ•°4&#x27;</span>:ç”¨æ¥æŒ‡å®šæ˜¯å¦è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—</span><br><span class="line"> <span class="string">&#x27;å‚æ•°5&#x27;</span>:å¯¹é˜Ÿåˆ—çš„é¢å¤–é…ç½®</span><br></pre></td></tr></table></figure><hr><h3 id="4-4-ç¬¬äºŒç§æ¨¡å‹-work-quene"><a href="#4-4-ç¬¬äºŒç§æ¨¡å‹-work-quene" class="headerlink" title="4.4 ç¬¬äºŒç§æ¨¡å‹(work quene)"></a>4.4 ç¬¬äºŒç§æ¨¡å‹(work quene)</h3><p><code>Work queues</code>ï¼Œä¹Ÿè¢«ç§°ä¸ºï¼ˆ<code>Task queues</code>ï¼‰ï¼Œä»»åŠ¡æ¨¡å‹ã€‚å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼š<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸€æ—¦æ¶ˆè´¹ï¼Œå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä»»åŠ¡æ˜¯ä¸ä¼šè¢«é‡å¤æ‰§è¡Œçš„ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200314221002008.png" alt="image-20200314221002008"></p><p>è§’è‰²ï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼šä»»åŠ¡çš„å‘å¸ƒè€…</li><li>C1ï¼šæ¶ˆè´¹è€…-1ï¼Œé¢†å–ä»»åŠ¡å¹¶ä¸”å®Œæˆä»»åŠ¡ï¼Œå‡è®¾å®Œæˆé€Ÿåº¦è¾ƒæ…¢</li><li>C2ï¼šæ¶ˆè´¹è€…-2ï¼šé¢†å–ä»»åŠ¡å¹¶å®Œæˆä»»åŠ¡ï¼Œå‡è®¾å®Œæˆé€Ÿåº¦å¿«</li></ul><h5 id="1-å¼€å‘ç”Ÿäº§è€…-1"><a href="#1-å¼€å‘ç”Ÿäº§è€…-1" class="headerlink" title="1. å¼€å‘ç”Ÿäº§è€…"></a>1. å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  channel.basicPublish(<span class="string">&quot;&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="keyword">null</span>, (i+<span class="string">&quot;====&gt;:æˆ‘æ˜¯æ¶ˆæ¯&quot;</span>).getBytes());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-å¼€å‘æ¶ˆè´¹è€…-1"><a href="#2-å¼€å‘æ¶ˆè´¹è€…-1" class="headerlink" title="2.å¼€å‘æ¶ˆè´¹è€…-1"></a>2.å¼€å‘æ¶ˆè´¹è€…-1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">channel.basicConsume(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-å¼€å‘æ¶ˆè´¹è€…-2"><a href="#3-å¼€å‘æ¶ˆè´¹è€…-2" class="headerlink" title="3.å¼€å‘æ¶ˆè´¹è€…-2"></a>3.å¼€å‘æ¶ˆè´¹è€…-2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">channel.basicConsume(<span class="string">&quot;hello&quot;</span>,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);   <span class="comment">//å¤„ç†æ¶ˆæ¯æ¯”è¾ƒæ…¢ ä¸€ç§’å¤„ç†ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2: &quot;</span>+<span class="keyword">new</span> String(body));  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="4-æµ‹è¯•ç»“æœ"><a href="#4-æµ‹è¯•ç»“æœ" class="headerlink" title="4.æµ‹è¯•ç»“æœ"></a>4.æµ‹è¯•ç»“æœ</h5><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200314223242058.png" alt="image-20200314223242058"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200314223302207.png" alt="image-20200314223302207"></p><blockquote><p><code>æ€»ç»“:é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQå°†æŒ‰é¡ºåºå°†æ¯ä¸ªæ¶ˆæ¯å‘é€ç»™ä¸‹ä¸€ä¸ªä½¿ç”¨è€…ã€‚å¹³å‡è€Œè¨€ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°ç›¸åŒæ•°é‡çš„æ¶ˆæ¯ã€‚è¿™ç§åˆ†å‘æ¶ˆæ¯çš„æ–¹å¼ç§°ä¸ºå¾ªç¯ã€‚</code></p></blockquote><h5 id="5-æ¶ˆæ¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶"><a href="#5-æ¶ˆæ¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶" class="headerlink" title="5.æ¶ˆæ¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶"></a>5.æ¶ˆæ¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶</h5><blockquote><p>Doing a task can take a few seconds. You may wonder what happens if one of the consumers starts a long task and dies with it only partly done. With our current code, once RabbitMQ delivers a message to the consumer it immediately marks it for deletion. In this case, if you kill a worker we will lose the message it was just processing. Weâ€™ll also lose all the messages that were dispatched to this particular worker but were not yet handled.</p><p>But we donâ€™t want to lose any tasks. If a worker dies, weâ€™d like the task to be delivered to another worker.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">channel.basicQos(<span class="number">1</span>);<span class="comment">//ä¸€æ¬¡åªæ¥å—ä¸€æ¡æœªç¡®è®¤çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">//å‚æ•°2:å…³é—­è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(<span class="string">&quot;hello&quot;</span>,<span class="keyword">false</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);<span class="comment">//æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>è®¾ç½®é€šé“ä¸€æ¬¡åªèƒ½æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯</p></li><li><p>å…³é—­æ¶ˆæ¯çš„è‡ªåŠ¨ç¡®è®¤,å¼€å¯æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200314230412178.png" alt="image-20200314230412178"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200314230423280.png" alt="image-20200314230423280"></p></li></ul><hr><h3 id="4-5-ç¬¬ä¸‰ç§æ¨¡å‹-fanout"><a href="#4-5-ç¬¬ä¸‰ç§æ¨¡å‹-fanout" class="headerlink" title="4.5 ç¬¬ä¸‰ç§æ¨¡å‹(fanout)"></a>4.5 ç¬¬ä¸‰ç§æ¨¡å‹(fanout)</h3><p><code>fanout æ‰‡å‡º ä¹Ÿç§°ä¸ºå¹¿æ’­</code></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126213115873.png" alt="image-20191126213115873"></p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li> å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…</li><li> æ¯ä¸ª<strong>æ¶ˆè´¹è€…æœ‰è‡ªå·±çš„queue</strong>ï¼ˆé˜Ÿåˆ—ï¼‰</li><li> æ¯ä¸ª<strong>é˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchange</strong>ï¼ˆäº¤æ¢æœºï¼‰</li><li><strong>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœº</strong>ï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®šã€‚</li><li> äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li> é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯ã€‚å®ç°ä¸€æ¡æ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</li></ul><h5 id="1-å¼€å‘ç”Ÿäº§è€…-2"><a href="#1-å¼€å‘ç”Ÿäº§è€…-2" class="headerlink" title="1. å¼€å‘ç”Ÿäº§è€…"></a>1. å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;fanout&quot;</span>);<span class="comment">//å¹¿æ’­ ä¸€æ¡æ¶ˆæ¯å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">//å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="keyword">null</span>,<span class="string">&quot;hello&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure><h5 id="2-å¼€å‘æ¶ˆè´¹è€…-1-1"><a href="#2-å¼€å‘æ¶ˆè´¹è€…-1-1" class="headerlink" title="2. å¼€å‘æ¶ˆè´¹è€…-1"></a>2. å¼€å‘æ¶ˆè´¹è€…-1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»‘å®šäº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//å°†ä¸´æ—¶é˜Ÿåˆ—ç»‘å®šexchange</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-å¼€å‘æ¶ˆè´¹è€…-2-1"><a href="#3-å¼€å‘æ¶ˆè´¹è€…-2-1" class="headerlink" title="3. å¼€å‘æ¶ˆè´¹è€…-2"></a>3. å¼€å‘æ¶ˆè´¹è€…-2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»‘å®šäº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//å°†ä¸´æ—¶é˜Ÿåˆ—ç»‘å®šexchange</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="4-å¼€å‘æ¶ˆè´¹è€…-3"><a href="#4-å¼€å‘æ¶ˆè´¹è€…-3" class="headerlink" title="4.å¼€å‘æ¶ˆè´¹è€…-3"></a>4.å¼€å‘æ¶ˆè´¹è€…-3</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»‘å®šäº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//å°†ä¸´æ—¶é˜Ÿåˆ—ç»‘å®šexchange</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…3: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="5-æµ‹è¯•ç»“æœ"><a href="#5-æµ‹è¯•ç»“æœ" class="headerlink" title="5. æµ‹è¯•ç»“æœ"></a>5. æµ‹è¯•ç»“æœ</h5><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200315180653207.png" alt="image-20200315180653207"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200315180708489.png" alt="image-20200315180708489"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200315180728035.png" alt="image-20200315180728035"></p><hr><h3 id="4-6-ç¬¬å››ç§æ¨¡å‹-Routing"><a href="#4-6-ç¬¬å››ç§æ¨¡å‹-Routing" class="headerlink" title="4.6 ç¬¬å››ç§æ¨¡å‹(Routing)"></a>4.6 ç¬¬å››ç§æ¨¡å‹(Routing)</h3><h4 id="4-6-1-Routing-ä¹‹è®¢é˜…æ¨¡å‹-Direct-ç›´è¿"><a href="#4-6-1-Routing-ä¹‹è®¢é˜…æ¨¡å‹-Direct-ç›´è¿" class="headerlink" title="4.6.1 Routing ä¹‹è®¢é˜…æ¨¡å‹-Direct(ç›´è¿)"></a>4.6.1 Routing ä¹‹è®¢é˜…æ¨¡å‹-Direct(ç›´è¿)</h4><p><code>åœ¨Fanoutæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°Directç±»å‹çš„Exchangeã€‚</code></p><p> åœ¨Directæ¨¡å‹ä¸‹ï¼š</p><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li><li>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p>æµç¨‹:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191126220145375.png" alt="image-20191126220145375"></p><p>å›¾è§£ï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œå‘Exchangeå‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting keyã€‚</li><li>Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ ä¸routing keyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—</li><li>C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º error çš„æ¶ˆæ¯</li><li>C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º infoã€errorã€warning çš„æ¶ˆæ¯</li></ul><h5 id="1-å¼€å‘ç”Ÿäº§è€…-3"><a href="#1-å¼€å‘ç”Ÿäº§è€…-3" class="headerlink" title="1. å¼€å‘ç”Ÿäº§è€…"></a>1. å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜äº¤æ¢æœº  å‚æ•°1:äº¤æ¢æœºåç§° å‚æ•°2:äº¤æ¢æœºç±»å‹ åŸºäºæŒ‡ä»¤çš„Routing keyè½¬å‘</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">String key = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">//å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;logs_direct&quot;</span>,key,<span class="keyword">null</span>,(<span class="string">&quot;æŒ‡å®šçš„route key&quot;</span>+key+<span class="string">&quot;çš„æ¶ˆæ¯&quot;</span>).getBytes());</span><br></pre></td></tr></table></figure><h5 id="2-å¼€å‘æ¶ˆè´¹è€…-1-2"><a href="#2-å¼€å‘æ¶ˆè´¹è€…-1-2" class="headerlink" title="2.å¼€å‘æ¶ˆè´¹è€…-1"></a>2.å¼€å‘æ¶ˆè´¹è€…-1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;info&quot;</span>);</span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;warn&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-å¼€å‘æ¶ˆè´¹è€…-2-2"><a href="#3-å¼€å‘æ¶ˆè´¹è€…-2-2" class="headerlink" title="3.å¼€å‘æ¶ˆè´¹è€…-2"></a>3.å¼€å‘æ¶ˆè´¹è€…-2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;logs_direct&quot;</span>,<span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="comment">//æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="4-æµ‹è¯•ç”Ÿäº§è€…å‘é€Route-keyä¸ºerrorçš„æ¶ˆæ¯æ—¶"><a href="#4-æµ‹è¯•ç”Ÿäº§è€…å‘é€Route-keyä¸ºerrorçš„æ¶ˆæ¯æ—¶" class="headerlink" title="4.æµ‹è¯•ç”Ÿäº§è€…å‘é€Route keyä¸ºerrorçš„æ¶ˆæ¯æ—¶"></a>4.æµ‹è¯•ç”Ÿäº§è€…å‘é€Route keyä¸ºerrorçš„æ¶ˆæ¯æ—¶</h5><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316102613933.png" alt="image-20200316102613933"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316102627912.png" alt="image-20200316102627912"></p><h5 id="5-æµ‹è¯•ç”Ÿäº§è€…å‘é€Route-keyä¸ºinfoçš„æ¶ˆæ¯æ—¶"><a href="#5-æµ‹è¯•ç”Ÿäº§è€…å‘é€Route-keyä¸ºinfoçš„æ¶ˆæ¯æ—¶" class="headerlink" title="5.æµ‹è¯•ç”Ÿäº§è€…å‘é€Route keyä¸ºinfoçš„æ¶ˆæ¯æ—¶"></a>5.æµ‹è¯•ç”Ÿäº§è€…å‘é€Route keyä¸ºinfoçš„æ¶ˆæ¯æ—¶</h5><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316102925740.png" alt="image-20200316102925740"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316102947326.png" alt="image-20200316102947326"></p><hr><h4 id="4-6-2-Routing-ä¹‹è®¢é˜…æ¨¡å‹-Topic"><a href="#4-6-2-Routing-ä¹‹è®¢é˜…æ¨¡å‹-Topic" class="headerlink" title="4.6.2 Routing ä¹‹è®¢é˜…æ¨¡å‹-Topic"></a>4.6.2 Routing ä¹‹è®¢é˜…æ¨¡å‹-Topic</h4><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼è¿™ç§æ¨¡å‹<code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€.â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20191127121900255.png" alt="image-20191127121900255"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># ç»Ÿé…ç¬¦</span></span><br><span class="line"><span class="bullet">*</span> (star) can substitute for exactly one word.    åŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</span><br><span class="line"><span class="code"># (hash) can substitute for zero or more words.  åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</span></span><br><span class="line"><span class="code"># å¦‚:</span></span><br><span class="line"><span class="code">audit.#    åŒ¹é…audit.irs.corporateæˆ–è€… audit.irs ç­‰</span></span><br><span class="line"><span class="code">    audit.*   åªèƒ½åŒ¹é… audit.irs</span></span><br></pre></td></tr></table></figure><h5 id="1-å¼€å‘ç”Ÿäº§è€…-4"><a href="#1-å¼€å‘ç”Ÿäº§è€…-4" class="headerlink" title="1.å¼€å‘ç”Ÿäº§è€…"></a>1.å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿå‘½äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹ topic ä½¿ç”¨åŠ¨æ€è·¯ç”±(é€šé…ç¬¦æ–¹å¼)</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">String routekey = <span class="string">&quot;user.save&quot;</span>;<span class="comment">//åŠ¨æ€è·¯ç”±key</span></span><br><span class="line"><span class="comment">//å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;topics&quot;</span>,routekey,<span class="keyword">null</span>,(<span class="string">&quot;è¿™æ˜¯è·¯ç”±ä¸­çš„åŠ¨æ€è®¢é˜…æ¨¡å‹,route key: [&quot;</span>+routekey+<span class="string">&quot;]&quot;</span>).getBytes());</span><br></pre></td></tr></table></figure><h5 id="2-å¼€å‘æ¶ˆè´¹è€…-1-3"><a href="#2-å¼€å‘æ¶ˆè´¹è€…-1-3" class="headerlink" title="2.å¼€å‘æ¶ˆè´¹è€…-1"></a>2.å¼€å‘æ¶ˆè´¹è€…-1</h5><p><code>Routing Keyä¸­ä½¿ç”¨*é€šé…ç¬¦æ–¹å¼</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//ç»‘å®šé˜Ÿåˆ—ä¸äº¤æ¢æœºå¹¶è®¾ç½®è·å–äº¤æ¢æœºä¸­åŠ¨æ€è·¯ç”±</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;user.*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-å¼€å‘æ¶ˆè´¹è€…-2-3"><a href="#3-å¼€å‘æ¶ˆè´¹è€…-2-3" class="headerlink" title="3.å¼€å‘æ¶ˆè´¹è€…-2"></a>3.å¼€å‘æ¶ˆè´¹è€…-2</h5><p><code>Routing Keyä¸­ä½¿ç”¨#é€šé…ç¬¦æ–¹å¼</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">String queue = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//ç»‘å®šé˜Ÿåˆ—ä¸äº¤æ¢æœºå¹¶è®¾ç½®è·å–äº¤æ¢æœºä¸­åŠ¨æ€è·¯ç”±</span></span><br><span class="line">channel.queueBind(queue,<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;user.#&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">channel.basicConsume(queue,<span class="keyword">true</span>,<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2: &quot;</span>+<span class="keyword">new</span> String(body));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="4-æµ‹è¯•ç»“æœ-1"><a href="#4-æµ‹è¯•ç»“æœ-1" class="headerlink" title="4.æµ‹è¯•ç»“æœ"></a>4.æµ‹è¯•ç»“æœ</h5><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316113935785.png" alt="image-20200316113935785"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200316114000459.png" alt="image-20200316114000459"></p><h2 id="5-SpringBootä¸­ä½¿ç”¨RabbitMQ"><a href="#5-SpringBootä¸­ä½¿ç”¨RabbitMQ" class="headerlink" title="5. SpringBootä¸­ä½¿ç”¨RabbitMQ"></a>5. SpringBootä¸­ä½¿ç”¨RabbitMQ</h2><h3 id="5-0-æ­å»ºåˆå§‹ç¯å¢ƒ"><a href="#5-0-æ­å»ºåˆå§‹ç¯å¢ƒ" class="headerlink" title="5.0 æ­å»ºåˆå§‹ç¯å¢ƒ"></a>5.0 æ­å»ºåˆå§‹ç¯å¢ƒ</h3><h5 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-é…ç½®é…ç½®æ–‡ä»¶"><a href="#2-é…ç½®é…ç½®æ–‡ä»¶" class="headerlink" title="2. é…ç½®é…ç½®æ–‡ä»¶"></a>2. é…ç½®é…ç½®æ–‡ä»¶</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springboot_rabbitmq</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">10.15</span><span class="number">.0</span><span class="number">.9</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">ems</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/ems</span></span><br></pre></td></tr></table></figure><p><code>RabbitTemplate</code>  ç”¨æ¥ç®€åŒ–æ“ä½œ     ä½¿ç”¨æ—¶å€™ç›´æ¥åœ¨é¡¹ç›®ä¸­æ³¨å…¥å³å¯ä½¿ç”¨</p><h3 id="5-1-ç¬¬ä¸€ç§hello-worldæ¨¡å‹ä½¿ç”¨"><a href="#5-1-ç¬¬ä¸€ç§hello-worldæ¨¡å‹ä½¿ç”¨" class="headerlink" title="5.1 ç¬¬ä¸€ç§hello worldæ¨¡å‹ä½¿ç”¨"></a>5.1 ç¬¬ä¸€ç§hello worldæ¨¡å‹ä½¿ç”¨</h3><ol><li><h5 id="å¼€å‘ç”Ÿäº§è€…"><a href="#å¼€å‘ç”Ÿäº§è€…" class="headerlink" title="å¼€å‘ç”Ÿäº§è€…"></a>å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">  rabbitTemplate.convertAndSend(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="å¼€å‘æ¶ˆè´¹è€…"><a href="#å¼€å‘æ¶ˆè´¹è€…" class="headerlink" title="å¼€å‘æ¶ˆè´¹è€…"></a>å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener(queuesToDeclare = @Queue(&quot;hello&quot;))</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloCustomer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="5-2-ç¬¬äºŒç§workæ¨¡å‹ä½¿ç”¨"><a href="#5-2-ç¬¬äºŒç§workæ¨¡å‹ä½¿ç”¨" class="headerlink" title="5.2 ç¬¬äºŒç§workæ¨¡å‹ä½¿ç”¨"></a>5.2 ç¬¬äºŒç§workæ¨¡å‹ä½¿ç”¨</h3><ol><li><h5 id="å¼€å‘ç”Ÿäº§è€…-1"><a href="#å¼€å‘ç”Ÿäº§è€…-1" class="headerlink" title="å¼€å‘ç”Ÿäº§è€…"></a>å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWork</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;work&quot;</span>,<span class="string">&quot;hello work!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="å¼€å‘æ¶ˆè´¹è€…-1"><a href="#å¼€å‘æ¶ˆè´¹è€…-1" class="headerlink" title="å¼€å‘æ¶ˆè´¹è€…"></a>å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkCustomer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queuesToDeclare = @Queue(&quot;work&quot;))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;work message1 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queuesToDeclare = @Queue(&quot;work&quot;))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;work message2 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>è¯´æ˜:é»˜è®¤åœ¨Spring AMQPå®ç°ä¸­Workè¿™ç§æ–¹å¼å°±æ˜¯å…¬å¹³è°ƒåº¦,å¦‚æœéœ€è¦å®ç°èƒ½è€…å¤šåŠ³éœ€è¦é¢å¤–é…ç½®</code></p></blockquote></li></ol><h3 id="5-3-Fanout-å¹¿æ’­æ¨¡å‹"><a href="#5-3-Fanout-å¹¿æ’­æ¨¡å‹" class="headerlink" title="5.3 Fanout å¹¿æ’­æ¨¡å‹"></a>5.3 Fanout å¹¿æ’­æ¨¡å‹</h3><ol><li><h5 id="å¼€å‘ç”Ÿäº§è€…-2"><a href="#å¼€å‘ç”Ÿäº§è€…-2" class="headerlink" title="å¼€å‘ç”Ÿäº§è€…"></a>å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFanout</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  rabbitTemplate.convertAndSend(<span class="string">&quot;logs&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;è¿™æ˜¯æ—¥å¿—å¹¿æ’­&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="å¼€å‘æ¶ˆè´¹è€…-2"><a href="#å¼€å‘æ¶ˆè´¹è€…-2" class="headerlink" title="å¼€å‘æ¶ˆè´¹è€…"></a>å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutCustomer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue,</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name=&quot;logs&quot;,type = &quot;fanout&quot;)</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message1 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue, //åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name=&quot;logs&quot;,type = &quot;fanout&quot;)  //ç»‘å®šäº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message2 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="5-4-Route-è·¯ç”±æ¨¡å‹"><a href="#5-4-Route-è·¯ç”±æ¨¡å‹" class="headerlink" title="5.4 Route è·¯ç”±æ¨¡å‹"></a>5.4 Route è·¯ç”±æ¨¡å‹</h3><ol><li><h5 id="å¼€å‘ç”Ÿäº§è€…-3"><a href="#å¼€å‘ç”Ÿäº§è€…-3" class="headerlink" title="å¼€å‘ç”Ÿäº§è€…"></a>å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDirect</span><span class="params">()</span></span>&#123;</span><br><span class="line">  rabbitTemplate.convertAndSend(<span class="string">&quot;directs&quot;</span>,<span class="string">&quot;error&quot;</span>,<span class="string">&quot;error çš„æ—¥å¿—ä¿¡æ¯&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="å¼€å‘æ¶ˆè´¹è€…-3"><a href="#å¼€å‘æ¶ˆè´¹è€…-3" class="headerlink" title="å¼€å‘æ¶ˆè´¹è€…"></a>å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectCustomer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings =&#123;</span></span><br><span class="line"><span class="meta">            @QueueBinding(</span></span><br><span class="line"><span class="meta">                    value = @Queue(),</span></span><br><span class="line"><span class="meta">                    key=&#123;&quot;info&quot;,&quot;error&quot;&#125;,</span></span><br><span class="line"><span class="meta">                    exchange = @Exchange(type = &quot;direct&quot;,name=&quot;directs&quot;)</span></span><br><span class="line"><span class="meta">            )&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message1 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings =&#123;</span></span><br><span class="line"><span class="meta">            @QueueBinding(</span></span><br><span class="line"><span class="meta">                    value = @Queue(),</span></span><br><span class="line"><span class="meta">                    key=&#123;&quot;error&quot;&#125;,</span></span><br><span class="line"><span class="meta">                    exchange = @Exchange(type = &quot;direct&quot;,name=&quot;directs&quot;)</span></span><br><span class="line"><span class="meta">            )&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message2 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-5-Topic-è®¢é˜…æ¨¡å‹-åŠ¨æ€è·¯ç”±æ¨¡å‹"><a href="#5-5-Topic-è®¢é˜…æ¨¡å‹-åŠ¨æ€è·¯ç”±æ¨¡å‹" class="headerlink" title="5.5 Topic è®¢é˜…æ¨¡å‹(åŠ¨æ€è·¯ç”±æ¨¡å‹)"></a>5.5 Topic è®¢é˜…æ¨¡å‹(åŠ¨æ€è·¯ç”±æ¨¡å‹)</h3><ol><li><h5 id="å¼€å‘ç”Ÿäº§è€…-4"><a href="#å¼€å‘ç”Ÿäº§è€…-4" class="headerlink" title="å¼€å‘ç”Ÿäº§è€…"></a>å¼€å‘ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//topic</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTopic</span><span class="params">()</span></span>&#123;</span><br><span class="line">  rabbitTemplate.convertAndSend(<span class="string">&quot;topics&quot;</span>,<span class="string">&quot;user.save.findAll&quot;</span>,<span class="string">&quot;user.save.findAll çš„æ¶ˆæ¯&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="å¼€å‘æ¶ˆè´¹è€…-4"><a href="#å¼€å‘æ¶ˆè´¹è€…-4" class="headerlink" title="å¼€å‘æ¶ˆè´¹è€…"></a>å¼€å‘æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopCustomer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(bindings = &#123;</span></span><br><span class="line"><span class="meta">            @QueueBinding(</span></span><br><span class="line"><span class="meta">                    value = @Queue,</span></span><br><span class="line"><span class="meta">                    key = &#123;&quot;user.*&quot;&#125;,</span></span><br><span class="line"><span class="meta">                    exchange = @Exchange(type = &quot;topic&quot;,name = &quot;topics&quot;)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message1 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = &#123;</span></span><br><span class="line"><span class="meta">            @QueueBinding(</span></span><br><span class="line"><span class="meta">                    value = @Queue,</span></span><br><span class="line"><span class="meta">                    key = &#123;&quot;user.#&quot;&#125;,</span></span><br><span class="line"><span class="meta">                    exchange = @Exchange(type = &quot;topic&quot;,name = &quot;topics&quot;)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;message2 = &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr></li></ol><h2 id="6-MQçš„åº”ç”¨åœºæ™¯"><a href="#6-MQçš„åº”ç”¨åœºæ™¯" class="headerlink" title="6. MQçš„åº”ç”¨åœºæ™¯"></a>6. MQçš„åº”ç”¨åœºæ™¯</h2><h3 id="6-1-å¼‚æ­¥å¤„ç†"><a href="#6-1-å¼‚æ­¥å¤„ç†" class="headerlink" title="6.1 å¼‚æ­¥å¤„ç†"></a>6.1 å¼‚æ­¥å¤„ç†</h3><p><code>åœºæ™¯è¯´æ˜ï¼šç”¨æˆ·æ³¨å†Œåï¼Œéœ€è¦å‘æ³¨å†Œé‚®ä»¶å’Œæ³¨å†ŒçŸ­ä¿¡,ä¼ ç»Ÿçš„åšæ³•æœ‰ä¸¤ç§ 1.ä¸²è¡Œçš„æ–¹å¼ 2.å¹¶è¡Œçš„æ–¹å¼</code></p><ul><li><code>ä¸²è¡Œæ–¹å¼:</code> å°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“å,å‘é€æ³¨å†Œé‚®ä»¶,å†å‘é€æ³¨å†ŒçŸ­ä¿¡,ä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆåæ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ è¿™æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯,é‚®ä»¶,çŸ­ä¿¡å¹¶ä¸æ˜¯å¿…é¡»çš„,å®ƒåªæ˜¯ä¸€ä¸ªé€šçŸ¥,è€Œè¿™ç§åšæ³•è®©å®¢æˆ·ç«¯ç­‰å¾…æ²¡æœ‰å¿…è¦ç­‰å¾…çš„ä¸œè¥¿. </li></ul><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/SouthEast-4860248.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><ul><li><code>å¹¶è¡Œæ–¹å¼: </code>å°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“å,å‘é€é‚®ä»¶çš„åŒæ—¶,å‘é€çŸ­ä¿¡,ä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å®Œæˆå,è¿”å›ç»™å®¢æˆ·ç«¯,å¹¶è¡Œçš„æ–¹å¼èƒ½æé«˜å¤„ç†çš„æ—¶é—´ã€‚ </li></ul><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/SouthEast-20191127211112660.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><ul><li><p><code>æ¶ˆæ¯é˜Ÿåˆ—:</code>å‡è®¾ä¸‰ä¸ªä¸šåŠ¡èŠ‚ç‚¹åˆ†åˆ«ä½¿ç”¨50ms,ä¸²è¡Œæ–¹å¼ä½¿ç”¨æ—¶é—´150ms,å¹¶è¡Œä½¿ç”¨æ—¶é—´100msã€‚è™½ç„¶å¹¶è¡Œå·²ç»æé«˜çš„å¤„ç†æ—¶é—´,ä½†æ˜¯,å‰é¢è¯´è¿‡,é‚®ä»¶å’ŒçŸ­ä¿¡å¯¹æˆ‘æ­£å¸¸çš„ä½¿ç”¨ç½‘ç«™æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰å¿…è¦ç­‰ç€å…¶å‘é€å®Œæˆæ‰æ˜¾ç¤ºæ³¨å†ŒæˆåŠŸ,åº”è¯¥æ˜¯å†™å…¥æ•°æ®åº“åå°±è¿”å›.  <code>æ¶ˆæ¯é˜Ÿåˆ—</code>: å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼ŒæŠŠå‘é€é‚®ä»¶,çŸ­ä¿¡ä¸æ˜¯å¿…é¡»çš„ä¸šåŠ¡é€»è¾‘å¼‚æ­¥å¤„ç† </p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/592892-20190520220249900-1679743651.jpg" alt="img"></p></li></ul><p>ç”±æ­¤å¯ä»¥çœ‹å‡º,å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç”¨æˆ·çš„å“åº”æ—¶é—´å°±ç­‰äºå†™å…¥æ•°æ®åº“çš„æ—¶é—´+å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´(å¯ä»¥å¿½ç•¥ä¸è®¡),å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åå¤„ç†å,å“åº”æ—¶é—´æ˜¯ä¸²è¡Œçš„3å€,æ˜¯å¹¶è¡Œçš„2å€ã€‚</p><h3 id="6-2-åº”ç”¨è§£è€¦"><a href="#6-2-åº”ç”¨è§£è€¦" class="headerlink" title="6.2 åº”ç”¨è§£è€¦"></a>6.2 åº”ç”¨è§£è€¦</h3><p><code>åœºæ™¯ï¼šåŒ11æ˜¯è´­ç‰©ç‹‚èŠ‚,ç”¨æˆ·ä¸‹å•å,è®¢å•ç³»ç»Ÿéœ€è¦é€šçŸ¥åº“å­˜ç³»ç»Ÿ,ä¼ ç»Ÿçš„åšæ³•å°±æ˜¯è®¢å•ç³»ç»Ÿè°ƒç”¨åº“å­˜ç³»ç»Ÿçš„æ¥å£. </code></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/SouthEast-20191127211247287.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>è¿™ç§åšæ³•æœ‰ä¸€ä¸ªç¼ºç‚¹:</p><p>å½“åº“å­˜ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶,è®¢å•å°±ä¼šå¤±è´¥ã€‚ è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿé«˜è€¦åˆ.  å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ— </p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/SouthEast-20191127211304085.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><ul><li><p><code>è®¢å•ç³»ç»Ÿ:</code>ç”¨æˆ·ä¸‹å•å,è®¢å•ç³»ç»Ÿå®ŒæˆæŒä¹…åŒ–å¤„ç†,å°†æ¶ˆæ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—,è¿”å›ç”¨æˆ·è®¢å•ä¸‹å•æˆåŠŸã€‚</p></li><li><p><code>åº“å­˜ç³»ç»Ÿ:</code>è®¢é˜…ä¸‹å•çš„æ¶ˆæ¯,è·å–ä¸‹å•æ¶ˆæ¯,è¿›è¡Œåº“æ“ä½œã€‚  å°±ç®—åº“å­˜ç³»ç»Ÿå‡ºç°æ•…éšœ,æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯çš„å¯é æŠ•é€’,ä¸ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±.</p></li></ul><h3 id="6-3-æµé‡å‰Šå³°"><a href="#6-3-æµé‡å‰Šå³°" class="headerlink" title="6.3 æµé‡å‰Šå³°"></a>6.3 æµé‡å‰Šå³°</h3><p> <code>åœºæ™¯:</code> ç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ä¼šå› ä¸ºæµé‡è¿‡å¤§ï¼Œå¯¼è‡´åº”ç”¨æŒ‚æ‰,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬åœ¨åº”ç”¨å‰ç«¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚  </p><p>  <code>ä½œç”¨:</code> </p><p>â€‹            1.å¯ä»¥æ§åˆ¶æ´»åŠ¨äººæ•°ï¼Œè¶…è¿‡æ­¤ä¸€å®šé˜€å€¼çš„è®¢å•ç›´æ¥ä¸¢å¼ƒ(æˆ‘ä¸ºä»€ä¹ˆç§’æ€ä¸€æ¬¡éƒ½æ²¡æœ‰æˆåŠŸè¿‡å‘¢^^) </p><p>â€‹            2.å¯ä»¥ç¼“è§£çŸ­æ—¶é—´çš„é«˜æµé‡å‹å®åº”ç”¨(åº”ç”¨ç¨‹åºæŒ‰è‡ªå·±çš„æœ€å¤§å¤„ç†èƒ½åŠ›è·å–è®¢å•) </p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/SouthEast-20191127211341601.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>1.ç”¨æˆ·çš„è¯·æ±‚,æœåŠ¡å™¨æ”¶åˆ°ä¹‹å,é¦–å…ˆå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—,åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦è¶…è¿‡æœ€å¤§å€¼,åˆ™ç›´æ¥æŠ›å¼ƒç”¨æˆ·è¯·æ±‚æˆ–è·³è½¬åˆ°é”™è¯¯é¡µé¢.  </p><p>2.ç§’æ€ä¸šåŠ¡æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ä¿¡æ¯ï¼Œå†åšåç»­å¤„ç†.</p><hr><h2 id="7-RabbitMQçš„é›†ç¾¤"><a href="#7-RabbitMQçš„é›†ç¾¤" class="headerlink" title="7. RabbitMQçš„é›†ç¾¤"></a>7. RabbitMQçš„é›†ç¾¤</h2><h3 id="7-1-é›†ç¾¤æ¶æ„"><a href="#7-1-é›†ç¾¤æ¶æ„" class="headerlink" title="7.1 é›†ç¾¤æ¶æ„"></a>7.1 é›†ç¾¤æ¶æ„</h3><h4 id="7-1-1-æ™®é€šé›†ç¾¤-å‰¯æœ¬é›†ç¾¤"><a href="#7-1-1-æ™®é€šé›†ç¾¤-å‰¯æœ¬é›†ç¾¤" class="headerlink" title="7.1.1 æ™®é€šé›†ç¾¤(å‰¯æœ¬é›†ç¾¤)"></a>7.1.1 æ™®é€šé›†ç¾¤(å‰¯æœ¬é›†ç¾¤)</h4><blockquote><p>All data/state required for the operation of a RabbitMQ broker is replicated across all nodes. An exception to this are message queues, which by default reside on one node, though they are visible and reachable from all nodes. To replicate queues across nodes in a cluster   â€“æ‘˜è‡ªå®˜ç½‘</p></blockquote><p><code>é»˜è®¤æƒ…å†µä¸‹:RabbitMQä»£ç†æ“ä½œæ‰€éœ€çš„æ‰€æœ‰æ•°æ®/çŠ¶æ€éƒ½å°†è·¨æ‰€æœ‰èŠ‚ç‚¹å¤åˆ¶ã€‚è¿™æ–¹é¢çš„ä¸€ä¸ªä¾‹å¤–æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä½äºä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå°½ç®¡å®ƒä»¬å¯ä»¥ä»æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°å’Œè®¿é—®</code></p><ol><li><h5 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h5></li></ol><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320094147471.png" alt="image-20200320094147471"></p><p>â€‹    æ ¸å¿ƒè§£å†³é—®é¢˜:  <code>å½“é›†ç¾¤ä¸­æŸä¸€æ—¶åˆ»masterèŠ‚ç‚¹å®•æœº,å¯ä»¥å¯¹Queneä¸­ä¿¡æ¯,è¿›è¡Œå¤‡ä»½</code></p><ol start="2"><li><h5 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 0.é›†ç¾¤è§„åˆ’</span></span><br><span class="line"><span class="code">node1: 10.15.0.3  mq1  master ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">node2: 10.15.0.4  mq2  repl1  å‰¯æœ¬èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">node3: 10.15.0.5  mq3  repl2  å‰¯æœ¬èŠ‚ç‚¹</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 1.å…‹éš†ä¸‰å°æœºå™¨ä¸»æœºåå’Œipæ˜ å°„</span></span><br><span class="line"><span class="code">vim /etc/hostsåŠ å…¥:</span></span><br><span class="line"><span class="code"> 10.15.0.3 mq1</span></span><br><span class="line"><span class="code">    10.15.0.4 mq2</span></span><br><span class="line"><span class="code">    10.15.0.5 mq3</span></span><br><span class="line"><span class="code">node1: vim /etc/hostname åŠ å…¥:  mq1</span></span><br><span class="line"><span class="code">node2: vim /etc/hostname åŠ å…¥:  mq2</span></span><br><span class="line"><span class="code">node3: vim /etc/hostname åŠ å…¥:  mq3</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 2.ä¸‰ä¸ªæœºå™¨å®‰è£…rabbitmq,å¹¶åŒæ­¥cookieæ–‡ä»¶,åœ¨node1ä¸Šæ‰§è¡Œ:</span></span><br><span class="line"><span class="code">scp /var/lib/rabbitmq/.erlang.cookie root@mq2:/var/lib/rabbitmq/</span></span><br><span class="line"><span class="code">scp /var/lib/rabbitmq/.erlang.cookie root@mq3:/var/lib/rabbitmq/</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 3.æŸ¥çœ‹cookieæ˜¯å¦ä¸€è‡´:</span></span><br><span class="line"><span class="code">node1: cat /var/lib/rabbitmq/.erlang.cookie </span></span><br><span class="line"><span class="code">node2: cat /var/lib/rabbitmq/.erlang.cookie </span></span><br><span class="line"><span class="code">node3: cat /var/lib/rabbitmq/.erlang.cookie </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 4.åå°å¯åŠ¨rabbitmqæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤,å¯åŠ¨æˆåŠŸè®¿é—®ç®¡ç†ç•Œé¢:</span></span><br><span class="line"><span class="code">rabbitmq-server -detached </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 5.åœ¨node2å’Œnode3æ‰§è¡ŒåŠ å…¥é›†ç¾¤å‘½ä»¤:</span></span><br><span class="line"><span class="code">1.å…³é—­       rabbitmqctl stop_app</span></span><br><span class="line"><span class="code">2.åŠ å…¥é›†ç¾¤    rabbitmqctl join_cluster rabbit@mq1</span></span><br><span class="line"><span class="code">3.å¯åŠ¨æœåŠ¡    rabbitmqctl start_app</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 6.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€,ä»»æ„èŠ‚ç‚¹æ‰§è¡Œ:</span></span><br><span class="line"><span class="code">rabbitmqctl cluster_status</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 7.å¦‚æœå‡ºç°å¦‚ä¸‹æ˜¾ç¤º,é›†ç¾¤æ­å»ºæˆåŠŸ:</span></span><br><span class="line"><span class="code">Cluster status of node rabbit@mq3 ...</span></span><br><span class="line"><span class="code">[&#123;nodes,[&#123;disc,[rabbit@mq1,rabbit@mq2,rabbit@mq3]&#125;]&#125;,</span></span><br><span class="line"><span class="code">&#123;running_nodes,[rabbit@mq1,rabbit@mq2,rabbit@mq3]&#125;,</span></span><br><span class="line"><span class="code">&#123;cluster_name,&lt;&lt;&quot;rabbit@mq1&quot;&gt;&gt;&#125;,</span></span><br><span class="line"><span class="code">&#123;partitions,[]&#125;,</span></span><br><span class="line"><span class="code">&#123;alarms,[&#123;rabbit@mq1,[]&#125;,&#123;rabbit@mq2,[]&#125;,&#123;rabbit@mq3,[]&#125;]&#125;]</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 8.ç™»å½•ç®¡ç†ç•Œé¢,å±•ç¤ºå¦‚ä¸‹çŠ¶æ€:</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320095613586.png" alt="image-20200320095613586"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 9.æµ‹è¯•é›†ç¾¤åœ¨node1ä¸Š,åˆ›å»ºé˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320095743935.png" alt="image-20200320095743935"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 10.æŸ¥çœ‹node2å’Œnode3èŠ‚ç‚¹:</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320095827688.png" alt="image-20200320095827688"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320095843370.png" alt="image-20200320095843370"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 11.å…³é—­node1èŠ‚ç‚¹,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤,æŸ¥çœ‹node2å’Œnode3:</span></span><br><span class="line"><span class="code">rabbitmqctl stop_app</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320100000347.png" alt="image-20200320100000347"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320100010968.png" alt="image-20200320100010968"></p><hr></li></ol><h4 id="7-1-2-é•œåƒé›†ç¾¤"><a href="#7-1-2-é•œåƒé›†ç¾¤" class="headerlink" title="7.1.2 é•œåƒé›†ç¾¤"></a>7.1.2 é•œåƒé›†ç¾¤</h4><blockquote><p>This guide covers mirroring (queue contents replication) of classic queues  â€“æ‘˜è‡ªå®˜ç½‘</p><p>By default, contents of a queue within a RabbitMQ cluster are located on a single node (the node on which the queue was declared). This is in contrast to exchanges and bindings, which can always be considered to be on all nodes. Queues can optionally be made <em>mirrored</em> across multiple nodes. â€“æ‘˜è‡ªå®˜ç½‘</p></blockquote><p><code>é•œåƒé˜Ÿåˆ—æœºåˆ¶å°±æ˜¯å°†é˜Ÿåˆ—åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¹‹é—´è®¾ç½®ä¸»ä»å…³ç³»ï¼Œæ¶ˆæ¯ä¼šåœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œè‡ªåŠ¨åŒæ­¥ï¼Œä¸”å¦‚æœå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±æˆ–æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼Œæå‡MQé›†ç¾¤çš„æ•´ä½“é«˜å¯ç”¨æ€§ã€‚</code></p><ol><li><h5 id="é›†ç¾¤æ¶æ„å›¾"><a href="#é›†ç¾¤æ¶æ„å›¾" class="headerlink" title="é›†ç¾¤æ¶æ„å›¾"></a>é›†ç¾¤æ¶æ„å›¾</h5><p><img src= "/img/loading.gif" data-lazy-src="/2020/10/21/MQ/RabbitMQ/RabbitMQ/image-20200320113423235.png" alt="image-20200320113423235"></p></li><li><h5 id="é…ç½®é›†ç¾¤æ¶æ„"><a href="#é…ç½®é›†ç¾¤æ¶æ„" class="headerlink" title="é…ç½®é›†ç¾¤æ¶æ„"></a>é…ç½®é›†ç¾¤æ¶æ„</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 0.ç­–ç•¥è¯´æ˜</span></span><br><span class="line"><span class="code">rabbitmqctl set_policy [-p &lt;vhost&gt;] [--priority &lt;priority&gt;] [--apply-to &lt;apply-to&gt;] &lt;name&gt; &lt;pattern&gt;  &lt;definition&gt;</span></span><br><span class="line"><span class="code">-p Vhostï¼š å¯é€‰å‚æ•°ï¼Œé’ˆå¯¹æŒ‡å®švhostä¸‹çš„queueè¿›è¡Œè®¾ç½®</span></span><br><span class="line"><span class="code">Name:     policyçš„åç§°</span></span><br><span class="line"><span class="code">Pattern: queueçš„åŒ¹é…æ¨¡å¼(æ­£åˆ™è¡¨è¾¾å¼)</span></span><br><span class="line"><span class="code">Definitionï¼šé•œåƒå®šä¹‰ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ha-mode, ha-params, ha-sync-mode</span></span><br><span class="line"><span class="code">           ha-mode:æŒ‡æ˜é•œåƒé˜Ÿåˆ—çš„æ¨¡å¼ï¼Œæœ‰æ•ˆå€¼ä¸º all/exactly/nodes</span></span><br><span class="line"><span class="code">                        allï¼šè¡¨ç¤ºåœ¨é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒ</span></span><br><span class="line"><span class="code">                        exactlyï¼šè¡¨ç¤ºåœ¨æŒ‡å®šä¸ªæ•°çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹çš„ä¸ªæ•°ç”±ha-paramsæŒ‡å®š</span></span><br><span class="line"><span class="code">                        nodesï¼šè¡¨ç¤ºåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹åç§°é€šè¿‡ha-paramsæŒ‡å®š</span></span><br><span class="line"><span class="code">             ha-paramsï¼šha-modeæ¨¡å¼éœ€è¦ç”¨åˆ°çš„å‚æ•°</span></span><br><span class="line"><span class="code">                ha-sync-modeï¼šè¿›è¡Œé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„åŒæ­¥æ–¹å¼ï¼Œæœ‰æ•ˆå€¼ä¸ºautomaticå’Œmanual</span></span><br><span class="line"><span class="code">                priorityï¼šå¯é€‰å‚æ•°ï¼Œpolicyçš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="code">                </span></span><br><span class="line"><span class="code">                 </span></span><br><span class="line"><span class="code"># 1.æŸ¥çœ‹å½“å‰ç­–ç•¥</span></span><br><span class="line"><span class="code">rabbitmqctl list_policies</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 2.æ·»åŠ ç­–ç•¥</span></span><br><span class="line"><span class="code">rabbitmqctl set_policy ha-all &#x27;^hello&#x27; &#x27;&#123;&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;&#125;&#x27; </span></span><br><span class="line"><span class="code">è¯´æ˜:ç­–ç•¥æ­£åˆ™è¡¨è¾¾å¼ä¸º â€œ^â€ è¡¨ç¤ºæ‰€æœ‰åŒ¹é…æ‰€æœ‰é˜Ÿåˆ—åç§°  ^hello:åŒ¹é…helloå¼€å¤´é˜Ÿåˆ—</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 3.åˆ é™¤ç­–ç•¥</span></span><br><span class="line"><span class="code">rabbitmqctl clear_policy ha-all</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"># 4.æµ‹è¯•é›†ç¾¤</span></span><br></pre></td></tr></table></figure><hr></li></ol>]]></content>
      
      
      <categories>
          
          <category> MQ </category>
          
          <category> rabbitMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQ </tag>
            
            <tag> rabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rabbitMQ é”™è¯¯è®°å½•</title>
      <link href="2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
      <url>2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Error-when-reading-var-lib-rabbitmq-erlang-cookie-eacces"><a href="#Error-when-reading-var-lib-rabbitmq-erlang-cookie-eacces" class="headerlink" title="Error when reading /var/lib/rabbitmq/.erlang.cookie: eacces"></a>Error when reading /var/lib/rabbitmq/.erlang.cookie: eacces</h1><p>ä¿®æ”¹æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown rabbitmq:rabbitmq .erlang.cookie</span><br><span class="line">chmod 400 .erlang.cookie</span><br></pre></td></tr></table></figure><h1 id="Error-unable-to-connect-to-node-rabbit-localhost-nodedown"><a href="#Error-unable-to-connect-to-node-rabbit-localhost-nodedown" class="headerlink" title="Error: unable to connect to node rabbit@localhost: nodedown"></a>Error: unable to connect to node rabbit@localhost: nodedown</h1><p>æ€è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -lnp | grep 25672</span><br><span class="line">kill -9 è¿›ç¨‹id</span><br></pre></td></tr></table></figure><h1 id="Node-rabbit-vmcluster110-thinks-it-39-s-clustered-with-node-rabbit-vmcluster114-but-rabbit-vmcluster114-disagrees"><a href="#Node-rabbit-vmcluster110-thinks-it-39-s-clustered-with-node-rabbit-vmcluster114-but-rabbit-vmcluster114-disagrees" class="headerlink" title="Node rabbit@vmcluster110 thinks it&#39;s clustered with node rabbit@vmcluster114, but rabbit@vmcluster114 disagrees"></a>Node rabbit@vmcluster110 thinks it&#39;s clustered with node rabbit@vmcluster114, but rabbit@vmcluster114 disagrees</h1><p>ä¿®æ”¹ä¸»æœºåå’Œhostsæ˜ å°„ï¼Œä¸»æœºåæœ«å°¾ä¸èƒ½æ˜¯0ã€‚ä¾‹ï¼švmcluster110 æ”¹ä¸ºvmcluster11</p>]]></content>
      
      
      <categories>
          
          <category> MQ </category>
          
          <category> rabbitMQ </category>
          
          <category> é”™è¯¯è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é”™è¯¯è®°å½• </tag>
            
            <tag> MQ </tag>
            
            <tag> rabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper å­¦ä¹ ç¬”è®°</title>
      <link href="2020/08/14/zookeeper/zookeeper/"/>
      <url>2020/08/14/zookeeper/zookeeper/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€zookeeperå®‰è£…"><a href="#ä¸€ã€zookeeperå®‰è£…" class="headerlink" title="ä¸€ã€zookeeperå®‰è£…"></a>ä¸€ã€zookeeperå®‰è£…</h1><h2 id="æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²"><a href="#æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²" class="headerlink" title="æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²"></a>æœ¬åœ°æ¨¡å¼å®‰è£…éƒ¨ç½²</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><blockquote><p>å®˜ç½‘åœ°å€ï¼š <a href="https://zookeeper.apache.org/">https://zookeeper.apache.org/</a> </p><p>å¦‚æœä¸Šé¢è®¿é—®ç•Œé¢å’Œä¸‹é¢çš„ä¸åŒï¼Œå°è¯•è®¿é—®ğŸ‘‰<a href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a></p></blockquote><p>ä¸‹è½½æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ³¨æ„==è¦==ä¸‹è½½åˆ°.binçš„(ä¸‹è½½æ‰“å‰çš„)</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200519194026801.png" alt="image-20200519194026801"></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å°†å®‰è£…åŒ…ä¸Šä¼ åˆ°linuxæœåŠ¡å™¨ä¸Š</p><p>è§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-zookeeper-3.6.1.tar.gz </span><br></pre></td></tr></table></figure><p>å°†è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ï¼Œä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r ./apache-zookeeper-3.6.1 /myzoopeeker/3.6.1</span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°confç›®å½•ä¸‹å°†zoo_sample.cfgæ”¹åä¸ºzoo.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure><p>è¿›å…¥zoo.cfgï¼Œä¿®æ”¹dataDirå±æ€§ã€‚å°†dataDirä¿®æ”¹ä¸º<code>å½“å‰zookeeperå®‰è£…ç›®å½•/zkData</code>ï¼Œä¾‹ï¼š<code>dataDir=/myzookeeper/3.6.1/zkData</code> (zkDataå¯ä»¥å†™æˆå…¶ä»–çš„æ–‡ä»¶å¤¹åç§°)</p><p>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹éœ€è¦åˆ›å»ºï¼Œåˆšè§£å‹å‡ºæ¥çš„å¹¶ä¸ä¼šè‡ªå¸¦ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir zkData</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨zookeeper"><a href="#å¯åŠ¨zookeeper" class="headerlink" title="å¯åŠ¨zookeeper"></a>å¯åŠ¨zookeeper</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin&#x2F;zkServer.sh start</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ"><a href="#æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ" class="headerlink" title="æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ"></a>æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkCli.sh # ç”¨zookeeperå®¢æˆ·ç«¯è¿æ¥ä¸‹æœåŠ¡ç«¯</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh status</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å®¢æˆ·ç«¯"><a href="#å¯åŠ¨å®¢æˆ·ç«¯" class="headerlink" title="å¯åŠ¨å®¢æˆ·ç«¯"></a>å¯åŠ¨å®¢æˆ·ç«¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkCli.sh</span><br></pre></td></tr></table></figure><h3 id="é€€å‡ºå®¢æˆ·ç«¯"><a href="#é€€å‡ºå®¢æˆ·ç«¯" class="headerlink" title="é€€å‡ºå®¢æˆ·ç«¯"></a>é€€å‡ºå®¢æˆ·ç«¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢zookeeper"><a href="#åœæ­¢zookeeper" class="headerlink" title="åœæ­¢zookeeper"></a>åœæ­¢zookeeper</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh stop</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å‚æ•°è§£è¯»"><a href="#é…ç½®å‚æ•°è§£è¯»" class="headerlink" title="é…ç½®å‚æ•°è§£è¯»"></a>é…ç½®å‚æ•°è§£è¯»</h2><table><thead><tr><th><strong>å‚æ•°å</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>clientPort</strong></td><td>å®¢æˆ·ç«¯è¿æ¥serverçš„ç«¯å£ï¼Œå³å¯¹å¤–æœåŠ¡ç«¯å£ï¼Œä¸€èˆ¬è®¾ç½®ä¸º2181å§ã€‚</td></tr><tr><td><strong>dataDir</strong></td><td>å­˜å‚¨å¿«ç…§æ–‡ä»¶snapshotçš„ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æ—¥å¿—ä¹Ÿä¼šå­˜å‚¨åœ¨è¿™é‡Œã€‚å»ºè®®åŒæ—¶é…ç½®å‚æ•°dataLogDir, äº‹åŠ¡æ—¥å¿—çš„å†™æ€§èƒ½ç›´æ¥å½±å“zkæ€§èƒ½ã€‚</td></tr><tr><td><strong>tickTime</strong></td><td>ZKä¸­çš„ä¸€ä¸ªæ—¶é—´å•å…ƒã€‚ZKä¸­æ‰€æœ‰æ—¶é—´éƒ½æ˜¯ä»¥è¿™ä¸ªæ—¶é—´å•å…ƒä¸ºåŸºç¡€ï¼Œè¿›è¡Œæ•´æ•°å€é…ç½®çš„ã€‚ä¾‹å¦‚ï¼Œsessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTimeã€‚</td></tr><tr><td><strong>dataLogDir</strong></td><td>äº‹åŠ¡æ—¥å¿—è¾“å‡ºç›®å½•ã€‚å°½é‡ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®å•ç‹¬çš„ç£ç›˜æˆ–æ˜¯æŒ‚è½½ç‚¹ï¼Œè¿™å°†æå¤§çš„æå‡ZKæ€§èƒ½ã€‚  ï¼ˆNo <a href="http://lib.csdn.net/base/17">Java</a> system propertyï¼‰</td></tr><tr><td><strong>globalOutstandingLimit</strong></td><td>æœ€å¤§è¯·æ±‚å †ç§¯æ•°ã€‚é»˜è®¤æ˜¯1000ã€‚ZKè¿è¡Œçš„æ—¶å€™ï¼Œ å°½ç®¡serverå·²ç»æ²¡æœ‰ç©ºé—²æ¥å¤„ç†æ›´å¤šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å…è®¸å®¢æˆ·ç«¯å°†è¯·æ±‚æäº¤åˆ°æœåŠ¡å™¨ä¸Šæ¥ï¼Œä»¥æé«˜ååæ€§èƒ½ã€‚å½“ç„¶ï¼Œä¸ºäº†é˜²æ­¢Serverå†…å­˜æº¢å‡ºï¼Œè¿™ä¸ªè¯·æ±‚å †ç§¯æ•°è¿˜æ˜¯éœ€è¦é™åˆ¶ä¸‹çš„ã€‚  (Java system property:<strong>zookeeper.globalOutstandingLimit.</strong> )</td></tr><tr><td><strong>preAllocSize</strong></td><td>é¢„å…ˆå¼€è¾Ÿç£ç›˜ç©ºé—´ï¼Œç”¨äºåç»­å†™å…¥äº‹åŠ¡æ—¥å¿—ã€‚é»˜è®¤æ˜¯64Mï¼Œæ¯ä¸ªäº‹åŠ¡æ—¥å¿—å¤§å°å°±æ˜¯64Mã€‚å¦‚æœZKçš„å¿«ç…§é¢‘ç‡è¾ƒå¤§çš„è¯ï¼Œå»ºè®®é€‚å½“å‡å°è¿™ä¸ªå‚æ•°ã€‚(Java system property:<strong>zookeeper.preAllocSize</strong> )</td></tr><tr><td><strong>snapCount</strong></td><td>æ¯è¿›è¡ŒsnapCountæ¬¡äº‹åŠ¡æ—¥å¿—è¾“å‡ºåï¼Œè§¦å‘ä¸€æ¬¡å¿«ç…§(snapshot), æ­¤æ—¶ï¼ŒZKä¼šç”Ÿæˆä¸€ä¸ªsnapshot.*æ–‡ä»¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶log.*ã€‚é»˜è®¤æ˜¯100000.ï¼ˆçœŸæ­£çš„ä»£ç å®ç°ä¸­ï¼Œä¼šè¿›è¡Œä¸€å®šçš„éšæœºæ•°å¤„ç†ï¼Œä»¥é¿å…æ‰€æœ‰æœåŠ¡å™¨åœ¨åŒä¸€æ—¶é—´è¿›è¡Œå¿«ç…§è€Œå½±å“æ€§èƒ½ï¼‰(Java system property:<strong>zookeeper.snapCount</strong> )</td></tr><tr><td><strong>traceFile</strong></td><td>ç”¨äºè®°å½•æ‰€æœ‰è¯·æ±‚çš„logï¼Œä¸€èˆ¬è°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚(Java system property:? <strong>requestTraceFile</strong> )</td></tr><tr><td><strong>maxClientCnxns</strong></td><td>å•ä¸ªå®¢æˆ·ç«¯ä¸å•å°æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ•°çš„é™åˆ¶ï¼Œæ˜¯ipçº§åˆ«çš„ï¼Œé»˜è®¤æ˜¯60ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆè¡¨æ˜ä¸ä½œä»»ä½•é™åˆ¶ã€‚è¯·æ³¨æ„è¿™ä¸ªé™åˆ¶çš„ä½¿ç”¨èŒƒå›´ï¼Œä»…ä»…æ˜¯å•å°å®¢æˆ·ç«¯æœºå™¨ä¸å•å°ZKæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ•°é™åˆ¶ï¼Œä¸æ˜¯é’ˆå¯¹æŒ‡å®šå®¢æˆ·ç«¯IPï¼Œä¹Ÿä¸æ˜¯ZKé›†ç¾¤çš„è¿æ¥æ•°é™åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•å°ZKå¯¹æ‰€æœ‰å®¢æˆ·ç«¯çš„è¿æ¥æ•°é™åˆ¶ã€‚æŒ‡å®šå®¢æˆ·ç«¯IPçš„é™åˆ¶ç­–ç•¥ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªpatchï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ï¼š<a href="http://rdc.taobao.com/team/jm/archives/1334%EF%BC%88No">http://rdc.taobao.com/team/jm/archives/1334ï¼ˆNo</a> Java system propertyï¼‰</td></tr><tr><td><strong>clientPortAddress</strong></td><td>å¯¹äºå¤šç½‘å¡çš„æœºå™¨ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªIPæŒ‡å®šä¸åŒçš„ç›‘å¬ç«¯å£ã€‚é»˜è®¤æƒ…å†µæ˜¯æ‰€æœ‰IPéƒ½ç›‘å¬ <strong>clientPort</strong> æŒ‡å®šçš„ç«¯å£ã€‚ <strong>New in 3.3.0</strong></td></tr><tr><td><strong>minSessionTimeoutmaxSessionTimeout</strong></td><td>Sessionè¶…æ—¶æ—¶é—´é™åˆ¶ï¼Œå¦‚æœå®¢æˆ·ç«¯è®¾ç½®çš„è¶…æ—¶æ—¶é—´ä¸åœ¨è¿™ä¸ªèŒƒå›´ï¼Œé‚£ä¹ˆä¼šè¢«å¼ºåˆ¶è®¾ç½®ä¸ºæœ€å¤§æˆ–æœ€å°æ—¶é—´ã€‚é»˜è®¤çš„Sessionè¶…æ—¶æ—¶é—´æ˜¯åœ¨2 * <strong>tickTime ~ 20 * tickTime è¿™ä¸ªèŒƒå›´ New in 3.3.0</strong></td></tr><tr><td><strong>fsync.warningthresholdms</strong></td><td>äº‹åŠ¡æ—¥å¿—è¾“å‡ºæ—¶ï¼Œå¦‚æœè°ƒç”¨fsyncæ–¹æ³•è¶…è¿‡æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤æ˜¯1000msã€‚(Java system property: <strong>fsync.warningthresholdms</strong> )<strong>New in 3.3.4</strong></td></tr><tr><td><strong>autopurge.purgeInterval</strong></td><td>åœ¨ä¸Šæ–‡ä¸­å·²ç»æåˆ°ï¼Œ3.4.0åŠä¹‹åç‰ˆæœ¬ï¼ŒZKæä¾›äº†è‡ªåŠ¨æ¸…ç†äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸ª1æˆ–æ›´å¤§çš„æ•´æ•°ï¼Œé»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ã€‚(No Java system property) <strong>New in 3.4.0</strong></td></tr><tr><td><strong>autopurge.snapRetainCount</strong></td><td>è¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ•°ç›®ã€‚é»˜è®¤æ˜¯ä¿ç•™3ä¸ªã€‚(No Java system property) <strong>New in 3.4.0</strong></td></tr><tr><td><strong>electionAlg</strong></td><td>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ è¿™ä¸ªå‚æ•°é…ç½®æ˜¯å…è®¸æˆ‘ä»¬é€‰æ‹©leaderé€‰ä¸¾<a href="http://lib.csdn.net/base/31">ç®—æ³•</a>ï¼Œä½†æ˜¯ç”±äºåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œåªä¼šç•™ä¸‹ä¸€ç§â€œTCP-based version of fast leader electionâ€ç®—æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°ç›®å‰çœ‹æ¥æ²¡æœ‰ç”¨äº†ï¼Œè¿™é‡Œä¹Ÿä¸è¯¦ç»†å±•å¼€è¯´äº†ã€‚(No Java system property)</td></tr><tr><td><strong>initLimit</strong></td><td>Followeråœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šä»LeaderåŒæ­¥æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œç„¶åç¡®å®šè‡ªå·±èƒ½å¤Ÿå¯¹å¤–æœåŠ¡çš„èµ·å§‹çŠ¶æ€ã€‚Leaderå…è®¸Fåœ¨ <strong>initLimit</strong> æ—¶é—´å†…å®Œæˆè¿™ä¸ªå·¥ä½œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ç”¨å¤ªåœ¨æ„è¿™ä¸ªå‚æ•°çš„è®¾ç½®ã€‚å¦‚æœZKé›†ç¾¤çš„æ•°æ®é‡ç¡®å®å¾ˆå¤§äº†ï¼ŒFåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä»Leaderä¸ŠåŒæ­¥æ•°æ®çš„æ—¶é—´ä¹Ÿä¼šç›¸åº”å˜é•¿ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦é€‚å½“è°ƒå¤§è¿™ä¸ªå‚æ•°äº†ã€‚(No Java system property)</td></tr><tr><td><strong>syncLimit</strong></td><td>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderè´Ÿè´£ä¸ZKé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é€šè¿‡ä¸€äº›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ¥æ£€æµ‹æœºå™¨çš„å­˜æ´»çŠ¶æ€ã€‚å¦‚æœLå‘å‡ºå¿ƒè·³åŒ…åœ¨syncLimitä¹‹åï¼Œè¿˜æ²¡æœ‰ä»Fé‚£é‡Œæ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªFå·²ç»ä¸åœ¨çº¿äº†ã€‚æ³¨æ„ï¼šä¸è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®å¾—è¿‡å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šæ©ç›–ä¸€äº›é—®é¢˜ã€‚(No Java system property)</td></tr><tr><td><strong>leaderServes</strong></td><td>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLeaderæ˜¯ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶æä¾›æ­£å¸¸çš„è¯»å†™æœåŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è®©Leaderä¸“æ³¨äºé›†ç¾¤ä¸­æœºå™¨çš„åè°ƒï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºnoï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¼šå¤§å¤§æé«˜å†™æ“ä½œçš„æ€§èƒ½ã€‚(Java system property: zookeeper. <strong>leaderServes</strong> )ã€‚</td></tr><tr><td><strong>server.x=[hostname]:nnnnn[:nnnnn]</strong></td><td>è¿™é‡Œçš„xæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸myidæ–‡ä»¶ä¸­çš„idæ˜¯ä¸€è‡´çš„ã€‚å³è¾¹å¯ä»¥é…ç½®ä¸¤ä¸ªç«¯å£ï¼Œç¬¬ä¸€ä¸ªç«¯å£ç”¨äºFå’ŒLä¹‹é—´çš„æ•°æ®åŒæ­¥å’Œå…¶å®ƒé€šä¿¡ï¼Œç¬¬äºŒä¸ªç«¯å£ç”¨äºLeaderé€‰ä¸¾è¿‡ç¨‹ä¸­æŠ•ç¥¨é€šä¿¡ã€‚  (No Java system property)</td></tr><tr><td><strong>group.x=nnnnn[:nnnnn]weight.x=nnnnn</strong></td><td>å¯¹æœºå™¨åˆ†ç»„å’Œæƒé‡è®¾ç½®ï¼Œå¯ä»¥ <a href="http://zookeeper.apache.org/doc/r3.4.3/zookeeperHierarchicalQuorums.html">å‚è§è¿™é‡Œ</a>(No Java system property)</td></tr><tr><td><strong>cnxTimeout</strong></td><td>Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯5sã€‚(Java system property: zookeeper. <strong>cnxTimeout</strong> )</td></tr><tr><td><strong>zookeeper.DigestAuthenticationProvider .superDigest</strong></td><td>ZKæƒé™è®¾ç½®ç›¸å…³ï¼Œå…·ä½“å‚è§ <a href="http://nileader.blog.51cto.com/1381108/930635">ã€Š <strong>ä½¿ç”¨super</strong> <strong>èº«ä»½å¯¹æœ‰æƒé™çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œ</strong> ã€‹ </a> å’Œ <a href="http://nileader.blog.51cto.com/1381108/795525">ã€Š <strong>ZooKeeper</strong>  <strong>æƒé™æ§åˆ¶</strong> ã€‹</a></td></tr><tr><td><strong>skipACL</strong></td><td>å¯¹æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚éƒ½ä¸ä½œACLæ£€æŸ¥ã€‚å¦‚æœä¹‹å‰èŠ‚ç‚¹ä¸Šè®¾ç½®æœ‰æƒé™é™åˆ¶ï¼Œä¸€æ—¦æœåŠ¡å™¨ä¸Šæ‰“å¼€è¿™ä¸ªå¼€å¤´ï¼Œé‚£ä¹ˆä¹Ÿå°†å¤±æ•ˆã€‚(Java system property: <strong>zookeeper.skipACL</strong> )</td></tr><tr><td><strong>forceSync</strong></td><td>è¿™ä¸ªå‚æ•°ç¡®å®šäº†æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ [FileChannel ](<a href="http://rdc.taobao.com/team///java//jdk1.6.0_22//jre//lib//rt.jar.force%E6%9D%A5%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%8C%E5%85%A8%E5%90%8C%E6%AD%A5%E5%88%B0%E7%A3%81%E7%9B%98%E3%80%82">http://rdc.taobao.com/team/\/java\/jdk1.6.0_22\/jre\/lib\/rt.jar.forceæ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚</a>(Java system property: **zookeeper.forceSync** )</td></tr><tr><td><strong>jute.maxbuffer</strong></td><td>æ¯ä¸ªèŠ‚ç‚¹æœ€<a href="http://lib.csdn.net/base/20">å¤§æ•°æ®</a>é‡ï¼Œæ˜¯é»˜è®¤æ˜¯1Mã€‚è¿™ä¸ªé™åˆ¶å¿…é¡»åœ¨serverå’Œclientç«¯éƒ½è¿›è¡Œè®¾ç½®æ‰ä¼šç”Ÿæ•ˆã€‚(Java system property: <strong>jute.maxbuffer</strong> )</td></tr></tbody></table><h1 id="äºŒã€Zookeeperå®æˆ˜"><a href="#äºŒã€Zookeeperå®æˆ˜" class="headerlink" title="äºŒã€Zookeeperå®æˆ˜"></a>äºŒã€Zookeeperå®æˆ˜</h1><h2 id="åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²"><a href="#åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²" class="headerlink" title="åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²"></a>åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²</h2><p>å®‰è£…å¥½zookeeperä¹‹åå†è¿›è¡Œè¿™ä¸€æ­¥</p><p>åœ¨zkDataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch myid</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘myidï¼Œåœ¨æ–‡ä»¶é‡Œé¢æ·»åŠ ä¸€ä¸ªç¼–å·1/2/3â€¦éƒ½å¯ä»¥ï¼Œä¾‹ï¼š1</p><p>å°†é…ç½®å¥½çš„zookeeperåŒæ­¥åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šå»</p><p>å°†å…¶ä»–æœåŠ¡å™¨ä¸ŠåŒæ­¥çš„myidæ–‡ä»¶ä¸­çš„å†…å®¹æ›´æ”¹ï¼Œåªéœ€è¦æ”¹æˆå’Œå…¶ä»–æœåŠ¡å™¨ä¸é‡åˆçš„æ•°å­—å°±å¥½äº†ï¼Œä¾‹ï¼šæœåŠ¡å™¨1ï¼š1, æœåŠ¡å™¨2ï¼š2, æœåŠ¡å™¨3ï¼š3</p><p><strong>==ä¸€å®šè¦æ›´æ”¹ï¼Œä¸èƒ½ç›¸åŒï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼==</strong></p><p><strong>ä¿®æ”¹zoo.cfgæ–‡ä»¶</strong></p><p>å‘é‡Œé¢æ·»åŠ </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.1</span>=<span class="string">vmcluster111:3888:2888</span></span><br><span class="line"><span class="meta">server.2</span>=<span class="string">vmcluster112:3888:2888</span></span><br><span class="line"><span class="meta">server.3</span>=<span class="string">vmcluster113:3888:2888</span></span><br></pre></td></tr></table></figure><p>åŒæ­¥ä¿®æ”¹åˆ°å…¶ä»–æœåŠ¡å™¨</p><p><strong>é…ç½®å‚æ•°è§£è¯»</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.A</span>=<span class="string">B:C:D</span></span><br></pre></td></tr></table></figure><p>A æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¿™è¡¨ç¤ºè¿™æ˜¯å‡ å·æœåŠ¡å™¨ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹é…ç½®çš„myidé‡Œé¢çš„å€¼å°±æ˜¯Açš„å€¼</p><p>B æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipï¼Œå› ä¸ºåœ¨hostsæ–‡ä»¶é‡Œé¢é…ç½®äº†ipæ˜ å°„ï¼Œæ‰€ä»¥è¿™é‡Œå†™çš„å¹¶ä¸æ˜¯å…·ä½“çš„ip</p><p>C æ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤çš„masteræœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£</p><p>D æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„masteræœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°é€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„masterï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æŒ‡å‘é€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šè®¯çš„ç«¯å£</p><h2 id="zookeeperå®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ"><a href="#zookeeperå®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="zookeeperå®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ"></a>zookeeperå®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</h2><h3 id="å¯åŠ¨å®¢æˆ·ç«¯-1"><a href="#å¯åŠ¨å®¢æˆ·ç«¯-1" class="headerlink" title="å¯åŠ¨å®¢æˆ·ç«¯:"></a>å¯åŠ¨å®¢æˆ·ç«¯:</h3><p>bin/zkCli.sh</p><h3 id="æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤"><a href="#æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤" class="headerlink" title="æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤:"></a>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤:</h3><p>help</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/70.png" alt="img"></p><h3 id="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¸­æ‰€åŒ…å«çš„å†…å®¹"><a href="#æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¸­æ‰€åŒ…å«çš„å†…å®¹" class="headerlink" title="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¸­æ‰€åŒ…å«çš„å†…å®¹:"></a>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¸­æ‰€åŒ…å«çš„å†…å®¹:</h3><p>ls /</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102134914.png" alt="image-20200521102134914"></p><h3 id="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å†…å®¹å’Œè¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å†…å®¹å’Œè¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å†…å®¹å’Œè¯¦ç»†ä¿¡æ¯:"></a>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å†…å®¹å’Œè¯¦ç»†ä¿¡æ¯:</h3><p>ls -s /</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102251080.png" alt="image-20200521102251080"></p><h3 id="è·å–èŠ‚ç‚¹çš„å€¼"><a href="#è·å–èŠ‚ç‚¹çš„å€¼" class="headerlink" title="è·å–èŠ‚ç‚¹çš„å€¼:"></a>è·å–èŠ‚ç‚¹çš„å€¼:</h3><p>get /èŠ‚ç‚¹å</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102620968.png" alt="image-20200521102620968"></p><h3 id="åˆ›å»ºæ™®é€šèŠ‚ç‚¹"><a href="#åˆ›å»ºæ™®é€šèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºæ™®é€šèŠ‚ç‚¹:"></a>åˆ›å»ºæ™®é€šèŠ‚ç‚¹:</h3><p>create  /èŠ‚ç‚¹å   å€¼</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102537012.png" alt="image-20200521102537012"></p><h3 id="åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹"><a href="#åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹:"></a>åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹:</h3><p>create -e /ys ysjh0014.cn</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102716819.png" alt="image-20200521102716819"></p><p>ä½¿ç”¨quité€€å‡ºå®¢æˆ·ç«¯åè¯¥èŠ‚ç‚¹å°±ä¼šè¢«åˆ é™¤</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102740469.png" alt="image-20200521102740469"></p><h3 id="åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹"><a href="#åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹:"></a>åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹:</h3><p>å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ ¹èŠ‚ç‚¹   create /qwq  qwq</p><p>ç„¶ååˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹      create -s /qwq/sub â€œqwqâ€</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521102925211.png" alt="image-20200521102925211"></p><h3 id="ä¿®æ”¹èŠ‚ç‚¹æ•°æ®"><a href="#ä¿®æ”¹èŠ‚ç‚¹æ•°æ®" class="headerlink" title="ä¿®æ”¹èŠ‚ç‚¹æ•°æ®:"></a>ä¿®æ”¹èŠ‚ç‚¹æ•°æ®:</h3><p>set /qwq qaq</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521103101017.png" alt="image-20200521103101017"></p><h3 id="åˆ é™¤èŠ‚ç‚¹"><a href="#åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤èŠ‚ç‚¹:"></a>åˆ é™¤èŠ‚ç‚¹:</h3><p>delete /qwq</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521103336031.png" alt="image-20200521103336031"></p><p>å¦‚æœæœ‰å­èŠ‚ç‚¹åˆ™ä¼šåˆ é™¤å¤±è´¥</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521103215784.png" alt="image-20200521103215784"></p><h3 id="é€’å½’åˆ é™¤èŠ‚ç‚¹-é€’å½’åˆ é™¤æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹"><a href="#é€’å½’åˆ é™¤èŠ‚ç‚¹-é€’å½’åˆ é™¤æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹" class="headerlink" title="é€’å½’åˆ é™¤èŠ‚ç‚¹:(é€’å½’åˆ é™¤æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹)"></a>é€’å½’åˆ é™¤èŠ‚ç‚¹:(é€’å½’åˆ é™¤æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹)</h3><p>deleteall /qwq</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521103438341.png" alt="image-20200521103438341"></p><h3 id="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€"><a href="#æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€:"></a>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€:</h3><p>stat  /csdn</p><p>å’Œ ls -s å‘½ä»¤ä¸€æ ·</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/14/zookeeper/zookeeper/image-20200521103603062.png" alt="image-20200521103603062"></p><h3 id="ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–"><a href="#ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–" class="headerlink" title="ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–:"></a>ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–:</h3><p>get  /ys/jh  watch             </p><p>è¿™é‡Œåªè¦è¿™ä¸ªèŠ‚ç‚¹å€¼å˜åŒ–ï¼Œå°±ä¼šå¾—åˆ°ç›¸åº”ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€æ¬¡å“åº”ï¼Œå³èŠ‚ç‚¹å€¼æ”¹å˜ä¸€æ¬¡ä¹‹åå°±ä¸ä¼šå†ç›‘å¬</p><h3 id="ç›‘å¬èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–-è·¯å¾„å˜åŒ–"><a href="#ç›‘å¬èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–-è·¯å¾„å˜åŒ–" class="headerlink" title="ç›‘å¬èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–(è·¯å¾„å˜åŒ–)"></a>ç›‘å¬èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–(è·¯å¾„å˜åŒ–)</h3><p>ls /path watch             </p><p>åªè¦è·¯å¾„å˜åŒ–å°±ä¼šç›¸åº”ï¼ŒåŒæ ·çš„åªä¼šå“åº”ä¸€æ¬¡</p><h2 id="statç»“æ„ä½“"><a href="#statç»“æ„ä½“" class="headerlink" title="statç»“æ„ä½“"></a>statç»“æ„ä½“</h2><ul><li><p>cZxid</p><ul><li>åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡zxidæ¯æ¬¡ä¿®æ”¹zookeeperçŠ¶æ€éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªzxidå½¢å¼çš„æ—¶é—´æˆ³,ä¹Ÿå°±æ˜¯zookeeperäº‹åŠ¡IDã€‚äº‹åŠ¡IDæ˜¯zookeeperä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯ä¸ªä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„zxid,å¦‚æœzxid1å°äºzxid,é‚£ä¹ˆzxidåœ¨zxid2ä¹‹å‰å‘ç”Ÿã€‚</li></ul></li><li><p>ctime</p><ul><li>znodeè¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li></ul></li><li><p>mZxid</p><ul><li>znodeæœ€åæ›´æ–°çš„äº‹åŠ¡zxid</li></ul></li><li><p>mtime</p><ul><li>znodeæœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li></ul></li><li><p>pZxid</p><ul><li>æœ€åæ›´æ–°çš„å­èŠ‚ç‚¹zxid</li></ul></li><li><p>cversion</p><ul><li>znodeå­èŠ‚ç‚¹å˜åŒ–å·,znodeå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</li></ul></li><li><p>dataversion</p><ul><li>znodeæ•°æ®å˜åŒ–å·</li></ul></li><li><p>aclVersion</p><ul><li>znodeè®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</li></ul></li><li><p>ephemeralOwner</p><ul><li>å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹,è¿™ä¸ªæ˜¯znodeæ‹¥æœ‰session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯0ã€‚</li></ul></li><li><p>dataLength</p><ul><li>znodeçš„æ•°æ®é•¿åº¦</li></ul></li><li><p>numChildren</p><ul><li>znodeå­èŠ‚ç‚¹æ•°é‡</li></ul></li></ul><h2 id="APIåº”ç”¨"><a href="#APIåº”ç”¨" class="headerlink" title="APIåº”ç”¨"></a>APIåº”ç”¨</h2><h3 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h3><ol><li><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;type&gt;pom&lt;/type&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä¸é…log4jä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯æ²¡æœ‰æ—¥å¿—è¾“å‡ºäº†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="åˆ›å»ºå­èŠ‚ç‚¹"><a href="#åˆ›å»ºå­èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºå­èŠ‚ç‚¹"></a>åˆ›å»ºå­èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">String connectString = <span class="string">&quot;192.168.1.107:2181,192.168.1.108:2181,192.168.1.109:2181&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> sessionTimeout = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    zooKeeper = <span class="keyword">new</span> ZooKeeper(connectString, sessionTimeout,</span><br><span class="line">                              (watchedEvent)-&gt;&#123;</span><br><span class="line"></span><br><span class="line">                              &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createsub</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// ZooDefs.Ids.OPEN_ACL_UNSAFE è¯¥èŠ‚ç‚¹ä¸éœ€è¦æƒé™</span></span><br><span class="line">    <span class="comment">// CreateMode.PERSISTENT åˆ›å»ºä¸€ä¸ªæ™®é€šçš„æŒä¹…çš„èŠ‚ç‚¹</span></span><br><span class="line">    String s = zooKeeper.create(<span class="string">&quot;/qaq&quot;</span>, <span class="string">&quot;qaq&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–å¹¶ç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–"><a href="#è·å–å¹¶ç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–" class="headerlink" title="è·å–å¹¶ç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–"></a>è·å–å¹¶ç›‘å¬èŠ‚ç‚¹çš„å˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZookeeperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String connectString = <span class="string">&quot;192.168.1.107:2181,192.168.1.108:2181,192.168.1.109:2181&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> sessionTimeout = <span class="number">2000</span>;</span><br><span class="line">    ZooKeeper zooKeeper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        zooKeeper = <span class="keyword">new</span> ZooKeeper(connectString, sessionTimeout,</span><br><span class="line">                (watchedEvent)-&gt;&#123;</span><br><span class="line">                    List&lt;String&gt; s = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        s = zooKeeper.getChildren(<span class="string">&quot;/&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNodeAndWatch</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException, IOException </span>&#123;</span><br><span class="line">        zooKeeper.getChildren(<span class="string">&quot;/&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"></a>æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exist</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">    Stat exists = zooKeeper.exists(<span class="string">&quot;/qwq2&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">    System.out.println(exists);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
          <category> zookeeper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>activeMQ å­¦ä¹ ç¬”è®°</title>
      <link href="2020/08/12/MQ/ActiveMQ/activeMQ/"/>
      <url>2020/08/12/MQ/ActiveMQ/activeMQ/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€å®‰è£…æ­¥éª¤"><a href="#ä¸€ã€å®‰è£…æ­¥éª¤" class="headerlink" title="ä¸€ã€å®‰è£…æ­¥éª¤"></a>ä¸€ã€å®‰è£…æ­¥éª¤</h1><ol><li><p>å®˜ç½‘<a href="http://activemq.apache.org/components/classic/download/">http://activemq.apache.org/components/classic/download/</a></p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/12/MQ/ActiveMQ/activeMQ/image-20200518092419727.png" alt="image-20200518092419727"></p></li><li><p>ä¸Šä¼ åˆ°linuxçš„/optç›®å½•ä¸‹</p></li><li><p>è§£å‹activemqï¼› <code>tar -zxvf apache-activemq-5.15.12-bin.tar.gz</code></p></li><li><p>åœ¨æ ¹ç›®å½•æ–°å»ºactivemqæ–‡ä»¶å¤¹ï¼Œå¹¶å°†è§£å‹å¥½çš„activemqç§»åŠ¨åˆ°é‡Œé¢ï¼›<code>cp -r apache-activemq-5.15.12 /myactivemq</code></p></li><li><p>å¯åŠ¨activemqï¼›åœ¨activemqçš„binç›®å½•é‡Œé¢å¯åŠ¨ï¼›<code>./activemq start</code></p></li><li><p>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸï¼›<code>ps -ef|grep activemq|grep -v grep</code>/ <code>netstat -anp|grep 61616</code> / <code>lsof -i:61616</code></p></li><li><p>å…³é—­activemqï¼›<code>./activemq stop</code></p></li><li><p>å¸¦æ—¥å¿—çš„å¯åŠ¨ï¼›<code>./activemq start &gt; /myactivemq/myrunmq.log</code></p></li><li><p>åœ¨å‰å°ä½¿ç”¨activemqï¼›å‰å°ç½‘é¡µè®¿é—®ip:8161</p></li></ol><h1 id="äºŒã€æ¶ˆæ¯ç”Ÿäº§è€…-amp-æ¶ˆè´¹è€…"><a href="#äºŒã€æ¶ˆæ¯ç”Ÿäº§è€…-amp-æ¶ˆè´¹è€…" class="headerlink" title="äºŒã€æ¶ˆæ¯ç”Ÿäº§è€…&amp;æ¶ˆè´¹è€…"></a>äºŒã€æ¶ˆæ¯ç”Ÿäº§è€…&amp;æ¶ˆè´¹è€…</h1><h2 id="é˜Ÿåˆ—ï¼ˆqueueï¼‰"><a href="#é˜Ÿåˆ—ï¼ˆqueueï¼‰" class="headerlink" title="é˜Ÿåˆ—ï¼ˆqueueï¼‰"></a>é˜Ÿåˆ—ï¼ˆqueueï¼‰</h2><h3 id="ç”Ÿäº§è€…ï¼š"><a href="#ç”Ÿäº§è€…ï¼š" class="headerlink" title="ç”Ÿäº§è€…ï¼š"></a>ç”Ÿäº§è€…ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMQMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">&quot;queue01&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºmqè¿æ¥å·¥å‚</span></span><br><span class="line">        ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        <span class="comment">// å¼€å¯è¿æ¥</span></span><br><span class="line">        connection.start();</span><br><span class="line"><span class="comment">// åˆ›å»ºsession</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"><span class="comment">// åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line">        <span class="comment">// åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class="line">        MessageProducer producer = session.createProducer(queue);</span><br><span class="line"><span class="comment">// å¾ªç¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">&quot;msg--&quot;</span>+i);</span><br><span class="line">            producer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">        producer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…ï¼š"><a href="#æ¶ˆè´¹è€…ï¼š" class="headerlink" title="æ¶ˆè´¹è€…ï¼š"></a>æ¶ˆè´¹è€…ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">&quot;queue01&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line"></span><br><span class="line">        MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼€å§‹æ¥æ”¶ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">        <span class="comment">/*while (true)&#123;</span></span><br><span class="line"><span class="comment">            TextMessage receive = (TextMessage) consumer.receive();</span></span><br><span class="line"><span class="comment">            if (receive != null)&#123;</span></span><br><span class="line"><span class="comment">                System.out.println(&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;+receive.getText());</span></span><br><span class="line"><span class="comment">            &#125;else&#123;</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºç›‘å¬å™¨</span></span><br><span class="line">        consumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">                TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¥å—æ¶ˆæ¯ = &quot;</span> + textMessage);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å¦‚æœä½¿ç”¨ç›‘å¬å™¨åˆ™ä¸éœ€è¦åœ¨è¿™é‡Œå…³é—­è¿æ¥ï¼Œè¿™æ ·ä¼šå¯¼è‡´è¿æ¥æ–­å¼€æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">// æˆ–è€…å†™ä¸Š</span></span><br><span class="line">        System.in.read(); <span class="comment">// å†™ä¸Šè¿™ä¸€è¡Œå¯ä»¥ä¿è¯ç¨‹åºä¸ä¼šè¢«å…³é—­</span></span><br><span class="line">        <span class="comment">// consumer.close();</span></span><br><span class="line">        <span class="comment">// session.close();</span></span><br><span class="line">        <span class="comment">// connection.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸»é¢˜ï¼ˆtopicï¼‰"><a href="#ä¸»é¢˜ï¼ˆtopicï¼‰" class="headerlink" title="ä¸»é¢˜ï¼ˆtopicï¼‰"></a>ä¸»é¢˜ï¼ˆtopicï¼‰</h2><p>ä¸»é¢˜å’Œé˜Ÿåˆ—çš„ç¼–å†™å‡ ä¹ä¸€è‡´ï¼Œåªéœ€è¦å°†å‘é€ä½ç½®æ”¹ä¸ºé˜Ÿåˆ—å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Topic topic = session.createTopic(TOPIC_NAME);</span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—å’Œä¸»é¢˜çš„åŒºåˆ«"><a href="#é˜Ÿåˆ—å’Œä¸»é¢˜çš„åŒºåˆ«" class="headerlink" title="é˜Ÿåˆ—å’Œä¸»é¢˜çš„åŒºåˆ«"></a>é˜Ÿåˆ—å’Œä¸»é¢˜çš„åŒºåˆ«</h2><table><thead><tr><th>æ¯”è¾ƒé¡¹ç›®</th><th>ä¸»é¢˜ï¼ˆtopicï¼‰</th><th>é˜Ÿåˆ—ï¼ˆqueueï¼‰</th></tr></thead><tbody><tr><td>å·¥ä½œæ¨¡å¼</td><td>â€œè®¢é˜…-å‘é€â€æ¨¡å¼ï¼Œåªæœ‰åœ¨æœ‰æ¶ˆè´¹è€…è®¢é˜…ä¹‹åäº§ç”Ÿçš„æ¶ˆæ¯æ‰èƒ½è¢«æ¶ˆè´¹è€…æ¥æ”¶åˆ°ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…é‚£ä¹ˆè¯¥æ¶ˆæ¯ä¸ºåºŸæ¶ˆæ¯</td><td>â€œè´Ÿè½½å‡è¡¡â€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆæ¯ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”ä¸€æ¡æ¶ˆæ¯åªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”è¦æ±‚æ¶ˆè´¹è€…ackæ¶ˆæ¯</td></tr><tr><td>æœ‰æ— çŠ¶æ€</td><td>æ— çŠ¶æ€</td><td>queueæ•°æ®é»˜è®¤ä¼šè¢«ä¿å­˜åœ¨mqæœåŠ¡å™¨ä¸Šï¼Œä»¥æ–‡ä»¶å½¢å¼ä¿å­˜ï¼Œä¸€èˆ¬ä¿å­˜åœ¨@AMQ_HOME\data\kr-store\dataä¸‹é¢ã€‚ä¹Ÿå¯ä»¥é…ç½®DBå­˜å‚¨</td></tr><tr><td>ä¼ é€’å®Œæ•´æ€§</td><td>å¦‚æœæ²¡æœ‰è®¢é˜…è€…æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</td><td>æ¶ˆæ¯ä¸ä¼šä¸¢å¼ƒ</td></tr><tr><td>å¤„ç†æ•ˆç‡</td><td>ç”±äºæ¶ˆæ¯è¦æŒ‰ç…§æ¶ˆè´¹è€…æ•°é‡è¿›è¡Œå¤åˆ¶ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šéšç€æ¶ˆè´¹è€…æ•°é‡çš„å¢åŠ è€Œæœ‰æ‰€é™ä½</td><td>ç”±äºä¸€æ¡æ¶ˆæ¯åªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å°±ç®—æ¶ˆè´¹è€…å†å¤šé™ä½ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½</td></tr></tbody></table><h1 id="ä¸‰ã€JSM-message"><a href="#ä¸‰ã€JSM-message" class="headerlink" title="ä¸‰ã€JSM message"></a>ä¸‰ã€JSM message</h1><h2 id="æ¶ˆæ¯å¤´ï¼š"><a href="#æ¶ˆæ¯å¤´ï¼š" class="headerlink" title="æ¶ˆæ¯å¤´ï¼š"></a>æ¶ˆæ¯å¤´ï¼š</h2><ul><li><p>JMSDestination</p><ul><li>jmsæ¶ˆæ¯å¤´ï¼›æ‰€æœ‰æ¶ˆæ¯çš„æ¶ˆæ¯å¤´éƒ½å…·ä½“ç›¸åŒçš„å­—æ®µï¼Œç”¨äº JMS Client ä»¥åŠ JMS Provider å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ«ä»¥åŠè¿›è¡Œæ¶ˆæ¯è·¯ç”±</li></ul></li><li><p>JMSDeliveryMode</p><ul><li><p>æŒ‡æ˜æ¶ˆæ¯çš„ä¼ è¾“æ¨¡å¼ï¼Œæœ‰ä¸¤ç§ï¼š</p><p>DeliveryMode.PERSISTENT ï¼šä¿è¯æ¶ˆæ¯ä»…ä¼ ä¸€æ¬¡ï¼Œ JMS Provider æœåŠ¡åœæ­¢åæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼›</p><p>DeliveryMode.NON_PERSISTENT ï¼šæ¶ˆæ¯æœ€å¤šä¼ ä¸€æ¬¡ï¼Œæ¶ˆæ¯ä¼šå›  JMS Provider åœæ­¢åä¸¢å¤±ï¼›</p></li></ul></li><li><p>JMSExpiration</p><ul><li>æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå…¶å€¼ä¸ºå½“å‰æ—¶é—´åŠ ä¸Šå­˜æ´»æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼›å½“å­˜æ´»æ—¶é—´è®¾ç½®ä¸º 0 æ—¶ï¼Œè¯¥å­—æ®µçš„å€¼ä¹Ÿè¢«è®¾ç½®ä¸º 0 ï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼›</li></ul></li><li><p>JMSPriority</p><ul><li><p>æ¶ˆæ¯çš„ä¼˜å…ˆçº§ï¼Œ 0 ä»£è¡¨æœ€ä½ä¼˜å…ˆçº§ï¼Œ 9 ä»£è¡¨æœ€é«˜ä¼˜å…ˆçº§ï¼›ä¸€èˆ¬ 0<del>4 ä¸ºæ™®é€šä¼˜å…ˆçº§ï¼Œ 5</del>9 ä¸ºåŠ å¿«ä¼˜å…ˆçº§</p><p>JMS è§„èŒƒé‡Œå¹¶æ²¡æœ‰è¦æ±‚ JMS Provider ä¸¥æ ¼æŒ‰è¿™ä¸ªä¼˜å…ˆçº§æ¥å®ç°ï¼Œä½†æ˜¯å°½å¯èƒ½å®ç°åŠ å¿«ä¼˜å…ˆçº§æ¶ˆæ¯çš„ä¼ è¾“åœ¨æ™®é€šæ¶ˆæ¯çš„å‰é¢</p><p>åŒ JMSDestination ä¸€æ ·ï¼Œè¯¥å­—æ®µåœ¨å‘é€å‰è¢«å¿½ç•¥ï¼Œåœ¨å‘é€å®Œæˆæ—¶é‡ç½®</p></li></ul></li><li><p>JMSMessageID</p><ul><li>ç”± JMS Provider æŒ‡å®šçš„æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼›åŒä¸Šé¢çš„å­—æ®µä¸€æ ·ï¼Œåœ¨å‘é€å‰è®¾ç½®çš„ä¼šè¢«å¿½ç•¥ï¼Œåœ¨å‘é€å®Œæˆæ—¶ï¼Œç”± JMS Provider é‡ç½®è¯¥å­—æ®µ</li></ul></li></ul><h2 id="æ¶ˆæ¯ä½“ï¼š"><a href="#æ¶ˆæ¯ä½“ï¼š" class="headerlink" title="æ¶ˆæ¯ä½“ï¼š"></a>æ¶ˆæ¯ä½“ï¼š</h2><ol><li>StreamMessage ï¼šæ¶ˆæ¯ä½“æ˜¯ Java æµï¼Œå†™å…¥å’Œè¯»å‡ºéƒ½æ˜¯é¡ºåºçš„</li><li>MapMessage ï¼šæ¶ˆæ¯ä½“åŒ…å« key-value å¯¹ï¼Œ key ä¸º String ï¼Œ value ä¸ºåŸºæœ¬ç±»å‹ï¼Œå¯ä»¥é€šè¿‡è¿­ä»£å™¨è®¿é—®</li><li>TextMessage ï¼šæ¶ˆæ¯ä½“æ˜¯ String</li><li>ObjectMessage ï¼šæ¶ˆæ¯ä½“æ˜¯å¯åºåˆ—åŒ–çš„ Java å¯¹è±¡</li><li>BytesMessage ï¼šæ¶ˆæ¯ä½“æ˜¯å­—èŠ‚æ•°ç»„</li></ol><p>å¯ä»¥é€šè¿‡ message.clearBody() æ¥æ¸…é™¤æ¶ˆæ¯ä½“ï¼›ä½†åœ¨æ¶ˆè´¹ç«¯ï¼Œæ¶ˆæ¯ä½“æ˜¯åªè¯»çš„ï¼Œé’ˆå¯¹æ¶ˆæ¯çš„å†™æ“ä½œéƒ½ä¼šæŠ›å‡º MessageNotWritableException å¼‚å¸¸</p><h2 id="æ¶ˆæ¯å±æ€§ï¼š"><a href="#æ¶ˆæ¯å±æ€§ï¼š" class="headerlink" title="æ¶ˆæ¯å±æ€§ï¼š"></a>æ¶ˆæ¯å±æ€§ï¼š</h2><p>JMS æ¶ˆæ¯è¿˜æä¾›äº†å¯¹â€œå±æ€§å€¼å¯¹â€çš„æ”¯æŒï¼Œä»¥å¯¹æ¶ˆæ¯å¤´è¿›è¡Œæ‰©å±•ï¼›æ¶ˆæ¯å±æ€§ä¸»è¦ç”¨äºæ¶ˆæ¯é€‰æ‹©å™¨</p><p>å±æ€§åï¼šå±æ€§åå¿…é¡»æœåŠ¡æ¶ˆæ¯é€‰æ‹©å™¨çš„å‘½åè§„åˆ™</p><p>å±æ€§å€¼ï¼šå¯ä»¥æ˜¯åŸºæœ¬ç±»å‹åŠå…¶å¯¹è±¡ç±»å‹ä»¥åŠ Map ã€ List å’Œ String</p><p>æ¸…é™¤å±æ€§ï¼šJMS ä¸èƒ½æ¸…é™¤å•ä¸ªå±æ€§ï¼Œä½†å¯ä»¥é€šè¿‡ Message.clearProperties() æ–¹æ³•æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯å±æ€§</p><h1 id="å››ã€æ¶ˆæ¯å¯é æ€§"><a href="#å››ã€æ¶ˆæ¯å¯é æ€§" class="headerlink" title="å››ã€æ¶ˆæ¯å¯é æ€§"></a>å››ã€æ¶ˆæ¯å¯é æ€§</h1><h2 id="4-1-æŒä¹…æ€§"><a href="#4-1-æŒä¹…æ€§" class="headerlink" title="4.1 æŒä¹…æ€§"></a>4.1 æŒä¹…æ€§</h2><p><strong>å‚æ•°è®¾ç½®è¯´æ˜</strong></p><p><strong>éæŒä¹…ï¼š</strong></p><p>MessageProducer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</p><p>å½“æœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</p><p><strong>æŒä¹…ï¼š</strong></p><p>MessageProducer.setDeliveryMode(DeliveryMode.PERSISTENT);</p><p>å½“æœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯ä¾ç„¶å­˜åœ¨ã€‚</p><p><strong>é»˜è®¤ä¸ºæŒä¹…çŠ¶æ€</strong></p><h2 id="æŒä¹…åŒ–çš„topic"><a href="#æŒä¹…åŒ–çš„topic" class="headerlink" title="æŒä¹…åŒ–çš„topic"></a>æŒä¹…åŒ–çš„topic</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TOPIC_NAME = <span class="string">&quot;topic01&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line"><span class="comment">// åŸæœ¬åœ¨è¿™ connection.start();ç§»åŠ¨åˆ°ä¸‹é¢äº†</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line">        MessageProducer producer = session.createProducer(topic);</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºæŒä¹…åŒ–</span></span><br><span class="line">        producer.setDeliveryMode(DeliveryMode.PERSISTENT);</span><br><span class="line">        connection.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">&quot;msg--&quot;</span>+i);</span><br><span class="line">            producer.send(textMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        producer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€åˆ°MQã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TOPIC_NAME = <span class="string">&quot;topic01&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;qwqå¼€å§‹æ¥æ”¶ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€ä¸ªèº«ä»½idè¯†åˆ«å·</span></span><br><span class="line">        connection.setClientID(<span class="string">&quot;qwq&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        Topic topic = session.createTopic(TOPIC_NAME);</span><br><span class="line"><span class="comment">// å°†æ¶ˆè´¹è€…MessageConsumerä¿®æ”¹ä¸ºè®¢é˜…è€…TopicSubscriber</span></span><br><span class="line">        TopicSubscriber topicSubscriber = session.createDurableSubscriber(topic, <span class="string">&quot;remark...&quot;</span>);</span><br><span class="line">        connection.start();</span><br><span class="line"><span class="comment">// å¼€å¯ç›‘å¬æ¶ˆæ¯</span></span><br><span class="line">        topicSubscriber.setMessageListener((message)-&gt;&#123;</span><br><span class="line">            TextMessage msg = (TextMessage) message;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span>+msg.getText());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.in.read();</span><br><span class="line">        topicSubscriber.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>ä¸€å®šè¦å…ˆè¿è¡Œä¸€æ¬¡è®¢é˜…è€…ï¼Œç›¸å½“äºå‘mqæ³¨å†Œå®ƒï¼Œç„¶åç”Ÿäº§è€…å†å‘é€æ¶ˆæ¯ï¼Œæ— è®ºè®¢é˜…è€…åœ¨ä¸åœ¨çº¿éƒ½ä¼šå‘é€ç»™å®ƒï¼Œå¦‚æœè®¢é˜…è€…ä¸åœ¨çº¿ä¸‹æ¬¡è¿æ¥çš„æ—¶å€™å°±ä¼šå°†æ¶ˆæ¯è¡¥å‘ç»™å®ƒ</strong></p></blockquote><h2 id="4-2-äº‹åŠ¡"><a href="#4-2-äº‹åŠ¡" class="headerlink" title="4.2 äº‹åŠ¡"></a>4.2 äº‹åŠ¡</h2><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Session session = connection.createSession(<span class="keyword">true</span>, Session.AUTO_ACKNOWLEDGE);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">producer.close();</span><br><span class="line">session.commit(); <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">session.close();</span><br><span class="line">connection.close();</span><br><span class="line">System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€åˆ°MQã€‚ã€‚ã€‚&quot;</span>);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºsessionæ—¶å°†äº‹åŠ¡å¼€å¯</p><p>å¼€å¯äº‹åŠ¡åï¼Œéœ€è¦åœ¨æ¶ˆæ¯sendä¹‹åè°ƒç”¨commit()å°†sessionæäº¤ï¼Œä¸ç„¶æ¶ˆæ¯ä¼šä¼ é€’å¤±è´¥ã€‚</p><p>è¿™ä¸ªäº‹åŠ¡ç±»ä¼¼äºjdbcçš„äº‹åŠ¡æ“ä½œ</p><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><p>æ¶ˆè´¹è€…å¼€å¯äº‹åŠ¡çš„æ–¹å¼ä¸ç”Ÿäº§è€…ä¸€è‡´ã€‚</p><p>ä½†æ˜¯å½“æ¶ˆè´¹è€…æ²¡æœ‰æäº¤sessionæ—¶mqä¼šè®¤ä¸ºæœ¬æ¬¡æ¶ˆè´¹æ— æ•ˆï¼Œæ¶ˆè´¹è€…ä¸‹æ¬¡æ¶ˆè´¹æ—¶ä¼šæ¶ˆè´¹åˆ°å’Œä¸Šæ¬¡ä¸€æ ·çš„æ¶ˆæ¯ã€‚è¿™æ ·å°±ä¼šå‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹</p><h2 id="4-3-ç­¾æ”¶"><a href="#4-3-ç­¾æ”¶" class="headerlink" title="4.3 ç­¾æ”¶"></a>4.3 ç­¾æ”¶</h2><h3 id="4-3-1-ç­¾æ”¶æ¨¡å¼ï¼š"><a href="#4-3-1-ç­¾æ”¶æ¨¡å¼ï¼š" class="headerlink" title="4.3.1 ç­¾æ”¶æ¨¡å¼ï¼š"></a>4.3.1 ç­¾æ”¶æ¨¡å¼ï¼š</h3><ul><li><p>Session.AUTO_ACKNOWLEDGE </p><ul><li>è‡ªåŠ¨ç­¾æ”¶ï¼ˆé»˜è®¤ï¼‰</li></ul></li><li><p>Session.CLIENT_ACKNOWLEDGE</p><ul><li><p>æ‰‹åŠ¨ç­¾æ”¶</p></li><li><p>è¦æ±‚æ¶ˆè´¹è€…æ‰‹åŠ¨è°ƒç”¨ackæ–¹æ³•ç­¾æ”¶ï¼Œå¦‚æœä¸æ‰‹åŠ¨ç­¾æ”¶ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯æœªè¢«æ¶ˆè´¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">topicSubscriber.setMessageListener((message)-&gt;&#123;</span><br><span class="line">    TextMessage msg = (TextMessage) message;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span>+msg.getText());</span><br><span class="line">        msg.acknowledge();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Session.DUPS_OK_ACKNOWLEDGE</p><ul><li>å…è®¸æ¶ˆæ¯é‡å¤</li></ul></li></ul><h3 id="4-3-2-äº‹åŠ¡ä¸ç­¾æ”¶çš„å…³ç³»"><a href="#4-3-2-äº‹åŠ¡ä¸ç­¾æ”¶çš„å…³ç³»" class="headerlink" title="4.3.2 äº‹åŠ¡ä¸ç­¾æ”¶çš„å…³ç³»"></a>4.3.2 äº‹åŠ¡ä¸ç­¾æ”¶çš„å…³ç³»</h3><p>äº‹åŠ¡å¼€å¯ç­¾æ”¶ä¸ºæ‰‹åŠ¨ç­¾æ”¶ï¼š</p><ul><li>å¦‚æœæ²¡å†™commit()ä½†å†™äº†ackæ–¹æ³•ï¼Œæ¶ˆæ¯ä¼šè®¤ä¸ºæœªè¢«å¤„ç†</li><li>å¦‚æœå†™äº†commit()ä½†æ²¡å†™ackæ–¹æ³•ï¼Œæ¶ˆæ¯ä¼šè®¤ä¸ºè¢«å¤„ç†äº†</li></ul><p>å¯ä»¥ç²—ç•¥çš„è®¤ä¸ºå¼€å¯äº†äº‹åŠ¡ç­¾æ”¶æ¨¡å¼å°±ä¸ºè‡ªåŠ¨ç­¾æ”¶</p><blockquote><p>åœ¨äº‹åŠ¡æ€§ä¼šè¯ä¸­ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸæäº¤åˆ™æ¶ˆæ¯è¢«è‡ªåŠ¨ç­¾æ”¶ã€‚å¦‚æœå›æ»šåˆ™æ¶ˆæ¯å†æ¬¡ä¼ é€</p><p>éäº‹åŠ¡æ€§ä¼šè¯ä¸­ï¼Œæ¶ˆæ¯ä½•æ—¶è¢«ç¡®è®¤(ç­¾æ”¶)å–å†³äºåˆ›å»ºä¼šè¯æ—¶çš„åº”ç­”æ¨¡å¼(ç­¾æ”¶æ¨¡å¼)</p></blockquote><h1 id="äº”ã€activemqçš„broker"><a href="#äº”ã€activemqçš„broker" class="headerlink" title="äº”ã€activemqçš„broker"></a>äº”ã€activemqçš„broker</h1><h2 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ç›¸å½“äºä¸€ä¸ªactivemqæœåŠ¡å™¨å®ä¾‹</p><p>brokerå…¶å®å°±æ˜¯å®ç°äº†ç”¨ä»£ç çš„å½¢å¼å¯åŠ¨activemqå°†mqåµŒå…¥åˆ°javaä»£ç ä¸­ï¼Œä»¥ä¾¿éšæ—¶å¯åŠ¨ï¼Œåœ¨ç”¨çš„ä½¿ç”¨å†å»å¯åŠ¨è¿™æ ·å°±èƒ½èŠ‚çœèµ„æºï¼Œä¹Ÿä¿è¯äº†å¯é æ€§</p><h2 id="ä½¿ç”¨ä¸åŒçš„confæ–‡ä»¶æ¥å¯åŠ¨ä¸åŒçš„activemqå®ä¾‹"><a href="#ä½¿ç”¨ä¸åŒçš„confæ–‡ä»¶æ¥å¯åŠ¨ä¸åŒçš„activemqå®ä¾‹" class="headerlink" title="ä½¿ç”¨ä¸åŒçš„confæ–‡ä»¶æ¥å¯åŠ¨ä¸åŒçš„activemqå®ä¾‹"></a>ä½¿ç”¨ä¸åŒçš„confæ–‡ä»¶æ¥å¯åŠ¨ä¸åŒçš„activemqå®ä¾‹</h2><p><code>./activemq start xbean:file:/activemqé…ç½®æ–‡ä»¶åœ°å€</code></p><p>ä¾‹ï¼š<code>./activemq start xbean:file:/activemq/conf/activemq02.xml</code></p><h2 id="åµŒå…¥å¼broker"><a href="#åµŒå…¥å¼broker" class="headerlink" title="åµŒå…¥å¼broker"></a>åµŒå…¥å¼broker</h2><ol><li><p>pomæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™javaä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mybroker</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BrokerService brokerService = <span class="keyword">new</span> BrokerService();</span><br><span class="line">        brokerService.setUseJmx(<span class="keyword">true</span>);</span><br><span class="line">        brokerService.addConnector(<span class="string">&quot;tcp://localhost:61616&quot;</span>);</span><br><span class="line">        brokerService.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="å…­ã€springæ•´åˆactivemq"><a href="#å…­ã€springæ•´åˆactivemq" class="headerlink" title="å…­ã€springæ•´åˆactivemq"></a>å…­ã€springæ•´åˆactivemq</h1><h2 id="pomæ–‡ä»¶"><a href="#pomæ–‡ä»¶" class="headerlink" title="pomæ–‡ä»¶"></a>pomæ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-02-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.jms<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- spring-jmsé€šä¿¡ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-oxm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- activemq --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.14.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿—ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;log4j&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.2.17&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.6.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.6.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--json--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="springé…ç½®æ–‡ä»¶"><a href="#springé…ç½®æ–‡ä»¶" class="headerlink" title="springé…ç½®æ–‡ä»¶"></a>springé…ç½®æ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans</span><br><span class="line">        xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">        xmlns:amq=&quot;http://activemq.apache.org/schema/core&quot;</span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">        xmlns:jms=&quot;http://www.springframework.org/schema/jms&quot;</span><br><span class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">         http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span><br><span class="line">         http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd</span><br><span class="line">         http://www.springframework.org/schema/context</span><br><span class="line">         http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">         http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-3.0.xsd&quot;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ll.activemq&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jmsFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.pool.PooledConnectionFactory&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;stop&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionFactory&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;brokerURL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxConnections&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;destinationQueue&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.command.ActiveMQQueue&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;amq-spring-queue&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;destinationTopic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.activemq.command.ActiveMQTopic&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;amq-spring-topic&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jsmTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.core.JmsTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jmsFactory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦‚æœéœ€è¦ä¿®æ”¹topicæˆ–è€…queueï¼Œå°†æ­¤å¤„çš„å¼•ç”¨ä¿®æ”¹å³å¯ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultDestination&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;destinationTopic&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jms.support.converter.SimpleMessageConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMQ_Produce</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring-activemq.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        SpringMQ_Produce produce = (SpringMQ_Produce) ctx.getBean(<span class="string">&quot;springMQ_Produce&quot;</span>);</span><br><span class="line"></span><br><span class="line">        produce.jmsTemplate.send(session -&gt; session.createTextMessage(<span class="string">&quot;qwq&quot;</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿäº§è€…äº§å‡ºæ¶ˆæ¯å®Œæ¯•ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMQ_Consumer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring-activemq.xml&quot;</span>);</span><br><span class="line">        SpringMQ_Consumer consumer = (SpringMQ_Consumer) ctx.getBean(<span class="string">&quot;springMQ_Consumer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String msg = (String) consumer.jmsTemplate.receiveAndConvert();</span><br><span class="line"></span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p>åªéœ€è¦å°†JmsTemplateçš„defaultDestinationå±æ€§çš„å¼•ç”¨ä¿®æ”¹ä¸ºtopicå³å¯</p><h2 id="é…ç½®æ¶ˆæ¯ç›‘å¬å™¨"><a href="#é…ç½®æ¶ˆæ¯ç›‘å¬å™¨" class="headerlink" title="é…ç½®æ¶ˆæ¯ç›‘å¬å™¨"></a>é…ç½®æ¶ˆæ¯ç›‘å¬å™¨</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;jmsContainer&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;connectionFactory&quot;</span> ref=<span class="string">&quot;jmsFactory&quot;</span>/&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;destination&quot;</span> ref=<span class="string">&quot;destinationTopic&quot;</span>/&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;messageListener&quot;</span> ref=<span class="string">&quot;myMessageListener&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        TextMessage textMessage = (TextMessage) message;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(textMessage.getText());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸ƒã€springbootæ•´åˆactivemq"><a href="#ä¸ƒã€springbootæ•´åˆactivemq" class="headerlink" title="ä¸ƒã€springbootæ•´åˆactivemq"></a>ä¸ƒã€springbootæ•´åˆactivemq</h1><h2 id="pomæ–‡ä»¶-1"><a href="#pomæ–‡ä»¶-1" class="headerlink" title="pomæ–‡ä»¶"></a>pomæ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################### common config : #################################### activemq-03-springboot</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">pub-sub-domain:</span> <span class="literal">false</span> <span class="comment"># è®¢é˜…-å‘é€æ¨¡å¼ false=queueï¼›true=topic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="attr">broker-url:</span> <span class="string">tcp://192.168.1.105:61616</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå·±å®šä¹‰çš„é…ç½®</span></span><br><span class="line"><span class="attr">my-config:</span></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="attr">queue-name:</span> <span class="string">amq-springboot-queue</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®bean"><a href="#é…ç½®bean" class="headerlink" title="é…ç½®bean"></a>é…ç½®bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMQConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my-config.activemq.queue-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String queueName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQQueue(queueName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—-1"><a href="#é˜Ÿåˆ—-1" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><h3 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><h4 id="å•ç‚¹æŠ•é€’"><a href="#å•ç‚¹æŠ•é€’" class="headerlink" title="å•ç‚¹æŠ•é€’"></a>å•ç‚¹æŠ•é€’</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueProduce</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Queue queue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QueueProduce</span><span class="params">(JmsMessagingTemplate jmsMessagingTemplate, Queue queue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jmsMessagingTemplate = jmsMessagingTemplate;</span><br><span class="line">        <span class="keyword">this</span>.queue = queue;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ¯è°ƒç”¨ä¸€æ¬¡å°±æŠ•é€’ä¸€æ¬¡æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">msgProduce</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        jmsMessagingTemplate.convertAndSend(queue, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šæ—¶æŠ•é€’"><a href="#å®šæ—¶æŠ•é€’" class="headerlink" title="å®šæ—¶æŠ•é€’"></a>å®šæ—¶æŠ•é€’</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨QueueProduceä¸­æ·»åŠ æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">// å®šæ—¶ä¸‰ç§’æŠ•é€’æ¶ˆæ¯ï¼Œæ³¨æ„ï¼š@Scheduledæ³¨è§£åªèƒ½ç”¨äºæ²¡æœ‰å‚æ•°çš„æ–¹æ³•ï¼›</span></span><br><span class="line"><span class="comment">// éœ€è¦åœ¨ä¸»é…ç½®ç±»ä¸Šæ ‡æ³¨@EnableSchedulingå®šæ—¶ä»»åŠ¡æ‰èƒ½ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@Scheduled(fixedDelay = 3000)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">msgProduceScheduled</span><span class="params">()</span></span>&#123;</span><br><span class="line">    jmsMessagingTemplate.convertAndSend(queue, UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">6</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;...å®šæ—¶å‘é€å•¦&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><p>springbootä¸ºæˆ‘ä»¬å°è£…çš„å¾ˆå¥½ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨éœ€è¦æ¥æ”¶æ¶ˆæ¯çš„æ–¹æ³•ä¸ŠåŠ ä¸Š<code>@JmsListener</code>å°±å¯ä»¥è‡ªåŠ¨ä¸ºæˆ‘ä»¬ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;$&#123;my-config.activemq.queue-name&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(TextMessage textMessage)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span>+textMessage.getText());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸»é¢˜-topic"><a href="#ä¸»é¢˜-topic" class="headerlink" title="ä¸»é¢˜(topic)"></a>ä¸»é¢˜(topic)</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">pub-sub-domain:</span> <span class="literal">true</span> <span class="comment"># å°†è¿™ä¿®æ”¹ä¸ºtrue</span></span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…-2"><a href="#æ¶ˆè´¹è€…-2" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;$&#123;my-config.activemq.topic-name&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(TextMessage textMessage)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span>+textMessage.getText());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMQConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my-config.activemq.topic-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String topicName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Topic <span class="title">topic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQTopic(topicName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicProduce</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Topic topic;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">msgProduce</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        jmsMessagingTemplate.convertAndSend(topic, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 3000)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">msgProduceScheduled</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jmsMessagingTemplate.convertAndSend(topic, UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">6</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;...å®šæ—¶å‘é€å•¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…«ã€ActiveMQçš„ä¼ è¾“åè®®"><a href="#å…«ã€ActiveMQçš„ä¼ è¾“åè®®" class="headerlink" title="å…«ã€ActiveMQçš„ä¼ è¾“åè®®"></a>å…«ã€ActiveMQçš„ä¼ è¾“åè®®</h1><table><thead><tr><th>åè®®</th><th>æè¿°</th></tr></thead><tbody><tr><td>TCP</td><td>é»˜è®¤çš„åè®®ï¼Œæ€§èƒ½ç›¸å¯¹å¯ä»¥</td></tr><tr><td>NIO</td><td>åŸºäºTCPåè®®ä¹‹ä¸Šçš„ï¼Œè¿›è¡Œäº†æ‰©å±•å’Œä¼˜åŒ–ï¼Œå…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§</td></tr><tr><td>UDP</td><td>æ€§èƒ½æ¯”TCPæ›´å¥½ï¼Œä½†æ˜¯ä¸å…·æœ‰å¯é æ€§</td></tr><tr><td>SSL</td><td>å®‰å…¨è¿æ¥</td></tr><tr><td>HTTP(S)</td><td>åŸºäºHTTPæˆ–è€…HTTPS</td></tr><tr><td>VM</td><td>VMæœ¬èº«ä¸æ˜¯åè®®ï¼Œå½“å®¢æˆ·ç«¯å’Œä»£ç†åœ¨åŒä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸­è¿è¡Œæ—¶ï¼Œä»–ä»¬ä¹‹é—´éœ€è¦é€šä¿¡ï¼Œä½†ä¸æƒ³å ç”¨ç½‘ç»œé€šé“ï¼Œè€Œæ˜¯ç›´æ¥é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹å¼</td></tr></tbody></table><h2 id="å¢åŠ nioåè®®å¹¶ä½¿ç”¨"><a href="#å¢åŠ nioåè®®å¹¶ä½¿ç”¨" class="headerlink" title="å¢åŠ nioåè®®å¹¶ä½¿ç”¨"></a>å¢åŠ nioåè®®å¹¶ä½¿ç”¨</h2><h3 id="ä¿®æ”¹activemqé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹activemqé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹activemqé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹activemqé…ç½®æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ·»åŠ è¿™ä¸ªæ ‡ç­¾åˆ°é…ç½®æ–‡ä»¶ä¸­--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;nio&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;nio://0.0.0.0:61618?trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»£ç "><a href="#ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»£ç " class="headerlink" title="ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»£ç "></a>ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»£ç </h3><p>åªéœ€è¦å°†<code>tcp://192.168.1.105:61616</code>æ›´æ”¹ä¸º<code>nio://192.168.1.105:61616</code></p><h2 id="nioå¢å¼º"><a href="#nioå¢å¼º" class="headerlink" title="nioå¢å¼º"></a>nioå¢å¼º</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;auto+nio&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;auto+nio://0.0.0.0:61608?maximumConnections=1000<span class="symbol">&amp;amp;</span>wireFormat.maxFrameSize=104857600<span class="symbol">&amp;amp;</span>org.apache.activemq.transport.nio.SelectorManager.corePoolSize=20<span class="symbol">&amp;amp;</span>org.apache.activemq.transport.nio.SelectorManager.maximumPoolSize=50&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿åœ¨æ”¯æŒå¤šç§åè®®çš„åŒæ—¶ä½¿ç”¨nioè¿›è¡Œä¼˜åŒ–</p><p>ä»£ç ä¸­åªéœ€è¦å°†ç«¯å£å·ä¿®æ”¹ä¸º61608å³å¯ï¼Œä¾‹: <code>tcp://192.168.1.105:61608</code>ï¼Œ<code>nio://192.168.1.105:61608</code></p><h1 id="ä¹ã€ActiveMQçš„å­˜å‚¨å’ŒæŒä¹…åŒ–"><a href="#ä¹ã€ActiveMQçš„å­˜å‚¨å’ŒæŒä¹…åŒ–" class="headerlink" title="ä¹ã€ActiveMQçš„å­˜å‚¨å’ŒæŒä¹…åŒ–"></a>ä¹ã€ActiveMQçš„å­˜å‚¨å’ŒæŒä¹…åŒ–</h1><h2 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¦‚æœéœ€è¦ä¿®æ”¹è¿æ¥æ± ï¼Œå°±å°†è¿™é‡Œçš„classä¿®æ”¹å³å¯ï¼Œä½†æ˜¯è¦è®°å¾—å¾€libåŒ…ä¸­æ·»åŠ å¯¹åº”çš„jaråŒ…--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mysql-ds&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!--è¿™é‡Œè®¾ç½®é©±åŠ¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.1.103:3306/activemq?relaxAutoCommit=true&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolPreparedStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªbeanè¦æ·»åŠ åˆ°ä¹‹åä¹‹å‰</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/12/MQ/ActiveMQ/activeMQ/image-20200519161307519.png" alt="image-20200519161307519"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å°†è¿™ä¸ªè¿™ä¸ªä¿®æ”¹ä¸ºä¸‹é¢çš„æ ·å­</span><br><span class="line"><span class="tag">&lt;<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kahaDB</span> <span class="attr">directory</span>=<span class="string">&quot;$&#123;activemq.data&#125;/kahadb&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">---------ä¿®æ”¹ä¹‹å</span><br><span class="line"><span class="tag">&lt;<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;kahaDB directory=&quot;$&#123;activemq.data&#125;/kahadb&quot;/&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--createTablesOnStartupï¼šæ¯æ¬¡å¯åŠ¨amqå°±åˆ›å»ºè¡¨ï¼Œé»˜è®¤ä¸ºtrueã€‚ç¬¬äºŒæ¬¡å¯åŠ¨è®°å¾—æ”¹ä¸ºfalse--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbcPersistenceAdapter</span> <span class="attr">dataSource</span>=<span class="string">&quot;#mysql-ds&quot;</span> <span class="attr">createTablesOnStartup</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistenceAdapter</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="mysqlçš„ä¸€äº›é…ç½®"><a href="#mysqlçš„ä¸€äº›é…ç½®" class="headerlink" title="mysqlçš„ä¸€äº›é…ç½®"></a>mysqlçš„ä¸€äº›é…ç½®</h2><p>å¦‚æœè¿æ¥ä¸ä¸Šè®°å¾—å°†mysqlå…è®¸è¿œç¨‹è¿æ¥å’Œå…è®¸æŒ‡å®šipçš„è¿æ¥</p><h2 id="ä¸‹åˆ’çº¿é—®é¢˜"><a href="#ä¸‹åˆ’çº¿é—®é¢˜" class="headerlink" title="ä¸‹åˆ’çº¿é—®é¢˜"></a>ä¸‹åˆ’çº¿é—®é¢˜</h2><p>å¦‚æœæ“ä½œç³»ç»Ÿè·¯å¾„é‡Œæœ‰<code>_</code>è®°å¾—æ”¹å</p><h2 id="jdbc-journal"><a href="#jdbc-journal" class="headerlink" title="jdbc journal"></a>jdbc journal</h2><p>è¿™æ˜¯ä¸€ä¸ªåœ¨æ•°æ®åº“å’Œamqçš„ä¸€ä¸ªç¼“å­˜ï¼Œmqä¼šå°†æ•°æ®å…ˆå­˜å‚¨åœ¨æœ¬åœ°çš„ç¼“å­˜ä¸­ï¼Œç„¶åå†æ…¢æ…¢çš„åŒæ­¥åˆ°æ•°æ®åº“ä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistenceFactory</span>&gt;</span></span><br><span class="line">&lt;journalPersistenceAdapterFactory</span><br><span class="line">                                      journalLogFiles=&quot;4&quot; </span><br><span class="line">                                      journalLogFileSize=&quot;32768&quot; </span><br><span class="line">                                      useJournal=&quot;true&quot; </span><br><span class="line">                                      useQuickJournal=&quot;true&quot;</span><br><span class="line">                                      dataSource=&quot;#mysql-ds&quot;</span><br><span class="line">                                      dataDirectory=&quot;activemq-data&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">persistenceFactory</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¦å°†<persistenceAdapter>æ³¨é‡Šæ‰</persistenceAdapter></p><p>psï¼šåˆ«çœ‹é”™äº†<persistenceAdapter>å’Œ<persistenceFactory>ä¸æ˜¯åŒä¸€ä¸ªæ ‡ç­¾ï¼Œä¸è¦æŠŠjournalPersistenceAdapterFactoryæ”¾åˆ°persistenceAdapteré‡Œé¢äº†</persistenceFactory></persistenceAdapter></p><h2 id="leveldb"><a href="#leveldb" class="headerlink" title="leveldb"></a>leveldb</h2><p>ä½¿ç”¨å¯å¤åˆ¶çš„leveldbå­˜å‚¨</p><ol><li><p>å®‰è£…å’Œé…ç½®å¥½zookeeperï¼Œzookeeperçš„å­¦ä¹ ç¬”è®°é‡Œé¢æœ‰</p></li><li><p>ä¿®æ”¹activemqçš„é…ç½®æ–‡ä»¶(activemq.xml)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line">    &lt;replicatedLevelDB</span><br><span class="line">          directory=&quot;$&#123;activemq.data&#125;/leveldb&quot;</span><br><span class="line">          replicas=&quot;3&quot;</span><br><span class="line">          bind=&quot;tcp://vmcluster110:63631&quot;</span><br><span class="line">          zkAddress=&quot;vmcluster111:2181,vmcluster112:2181,vmcluster113:2181&quot;</span><br><span class="line">          zkPath=&quot;/activemq/leveldb-stores&quot;</span><br><span class="line">          sync=&quot;local_disk&quot;</span><br><span class="line">          hostname=&quot;vmcluster110&quot;</span><br><span class="line">          /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">directoryï¼šå­˜å‚¨æ•°æ®çš„åœ°æ–¹</span></span><br><span class="line"><span class="comment">replicasï¼šé›†ç¾¤ä¸­å­˜åœ¨çš„èŠ‚ç‚¹æ•°</span></span><br><span class="line"><span class="comment">bindï¼šå½“è¢«é€‰ä¸¾æˆmasteræ—¶ï¼Œç”¨æ¥é€šè®¯çš„ip</span></span><br><span class="line"><span class="comment">zkAddressï¼šzookeeperé›†ç¾¤çš„ipå’Œç«¯å£å·</span></span><br><span class="line"><span class="comment">zkPathï¼šæ•°æ®å­˜æ”¾åœ¨zkçš„é‚£ä¸ªèŠ‚ç‚¹ä¸‹</span></span><br><span class="line"><span class="comment">syncï¼šåœ¨åŒæ­¥å®Œæˆä¹‹å‰åœ¨é‚£ä¸ªä½ç½®å­˜æ”¾æ•°æ®ï¼Œlocal_diskï¼šæœ¬åœ°ç£ç›˜</span></span><br><span class="line"><span class="comment">hostnameï¼šå½“è¯¥èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œç”¨äºæ’­å‘å¤åˆ¶æœåŠ¡çš„ä¸»æœºåã€‚è®¾ç½®æœ¬æœºçš„ipå°±å¥½äº†</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">broker</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://activemq.apache.org/schema/core&quot;</span> <span class="attr">brokerName</span>=<span class="string">&quot;llqwq&quot;</span> <span class="attr">dataDirectory</span>=<span class="string">&quot;$&#123;activemq.data&#125;&quot;</span>&gt;</span></span><br><span class="line">    æŠŠæ‰€æœ‰çš„activemqçš„brokerNameæ”¹æˆç›¸åŒçš„åç§°</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;failover:(&quot;</span> +</span><br><span class="line">            <span class="string">&quot;tcp://192.168.1.105:61616,&quot;</span> +</span><br><span class="line">            <span class="string">&quot;tcp://192.168.1.110:61616,&quot;</span> +</span><br><span class="line">            <span class="string">&quot;tcp://192.168.1.111:61616)?randomize=false&quot;</span>;</span><br></pre></td></tr></table></figure></li></ol><h1 id="åã€activemqè¡¥å……"><a href="#åã€activemqè¡¥å……" class="headerlink" title="åã€activemqè¡¥å……"></a>åã€activemqè¡¥å……</h1><h2 id="å¼‚æ­¥æŠ•é€’-Async-Send"><a href="#å¼‚æ­¥æŠ•é€’-Async-Send" class="headerlink" title="å¼‚æ­¥æŠ•é€’ Async Send"></a>å¼‚æ­¥æŠ•é€’ Async Send</h2><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯åœ¨æ²¡æœ‰å¼€å¯äº‹åŠ¡å¹¶ä¸”æ˜¯ä¸æŒä¹…åŒ–çš„çŠ¶æ€ä¸‹ï¼Œé»˜è®¤æ˜¯åŒæ­¥çš„ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå¼‚æ­¥çš„æ–¹å¼æ¥æ”¹å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_URL = <span class="string">&quot;tcp://192.168.1.105:61616&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">&quot;autonio&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ActiveMQConnectionFactory..setUseAsyncSend(true);æ¥è®¾ç½®å¼‚æ­¥å‘é€</span></span><br><span class="line">        connectionFactory.setUseAsyncSend(<span class="keyword">true</span>);</span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        connection.start();</span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"></span><br><span class="line">        Queue queue = session.createQueue(QUEUE_NAME);</span><br><span class="line">        <span class="comment">// è¿™é‡Œä¸å†æ˜¯MessageProduceräº†</span></span><br><span class="line">        ActiveMQMessageProducer activeMQMessageProducer = (ActiveMQMessageProducer) session.createProducer(queue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">            TextMessage textMessage = session.createTextMessage(<span class="string">&quot;msg--&quot;</span>+i);</span><br><span class="line">            String msgId = UUID.randomUUID().toString()+<span class="string">&quot;---qwq&quot;</span>;</span><br><span class="line">            <span class="comment">// è®¾ç½®msgid</span></span><br><span class="line">            textMessage.setJMSMessageID(msgId);</span><br><span class="line">            <span class="comment">// ç”±äºæŒ‡å®šä¸ºå¼‚æ­¥çŠ¶æ€äº†ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°æ¥è¿›è¡Œå›è°ƒ</span></span><br><span class="line">            activeMQMessageProducer.send(textMessage, <span class="keyword">new</span> AsyncCallback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    System.out.println(msgId + <span class="string">&quot;æˆåŠŸå‘é€ï¼&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(JMSException e)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// è¿™é‡Œæ˜¯å‘é€å¤±è´¥çš„çŠ¶æ€</span></span><br><span class="line">                    System.out.println(msgId + <span class="string">&quot;å‘é€å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç”±äºæ˜¯å¼‚æ­¥çš„ï¼Œè¿™å¥æ‰“å°å¯èƒ½ä¼šåœ¨æ¶ˆæ¯å‘é€ä¹‹å‰æ‰“å°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€å®Œæˆã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">        activeMQMessageProducer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å»¶æ—¶é—´éš”æŠ•é€’"><a href="#å»¶æ—¶é—´éš”æŠ•é€’" class="headerlink" title="å»¶æ—¶é—´éš”æŠ•é€’"></a>å»¶æ—¶é—´éš”æŠ•é€’</h2><p>åœ¨activemq.xmlçš„brokerä¸­è®¾ç½®schedulerSupport=â€trueâ€</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/12/MQ/ActiveMQ/activeMQ/image-20200521184707949.png" alt="image-20200521184707949"></p><p>ç¼–å†™ä»£ç </p><p>åªéœ€è¦ä¸ºæ¶ˆæ¯è®¾ç½®å±æ€§å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TextMessage textMessage = session.createTextMessage(<span class="string">&quot;msg--&quot;</span>+i);</span><br><span class="line">String msgId = UUID.randomUUID().toString()+<span class="string">&quot;---qwq&quot;</span>;</span><br><span class="line">textMessage.setJMSMessageID(msgId);</span><br><span class="line"><span class="comment">// ScheduledMessage.AMQ_SCHEDULED_DELAY å»¶è¿Ÿæ—¶é—´ï¼Œå»¶è¿Ÿå¤šå°‘æ¯«ç§’æŠ•é€’</span></span><br><span class="line"><span class="comment">// ScheduledMessage.AMQ_SCHEDULED_PERIOD é—´éš”æ—¶é—´,é‡å¤æŠ•é€’çš„æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">// ScheduledMessage.AMQ_SCHEDULED_REPEAT æŠ•é€’æ¬¡æ•°</span></span><br><span class="line">textMessage.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, <span class="number">3000L</span>);</span><br><span class="line">textMessage.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_PERIOD, <span class="number">4000L</span>);</span><br><span class="line">textMessage.setIntProperty(ScheduledMessage.AMQ_SCHEDULED_REPEAT, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯é‡å‘ç­–ç•¥"><a href="#æ¶ˆæ¯é‡å‘ç­–ç•¥" class="headerlink" title="æ¶ˆæ¯é‡å‘ç­–ç•¥"></a>æ¶ˆæ¯é‡å‘ç­–ç•¥</h2><p><a href="http://activemq.apache.org/message-redelivery-and-dlq-handling.html">å®˜ç½‘ä»‹ç»</a></p><p>åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸­ï¼Œæ¶ˆæ¯ä¼šè¢«å†æ¬¡ä¼ é€ç»™æ¶ˆè´¹è€…ï¼š</p><p>1ï¼åœ¨ä½¿ç”¨äº‹åŠ¡çš„Sessionä¸­ï¼Œè°ƒç”¨rollback()æ–¹æ³•ï¼›</p><p>2ï¼åœ¨ä½¿ç”¨äº‹åŠ¡çš„Sessionä¸­ï¼Œè°ƒç”¨commit()æ–¹æ³•ä¹‹å‰å°±å…³é—­äº†Session;</p><p>3ï¼åœ¨Sessionä¸­ä½¿ç”¨CLIENT_ACKNOWLEDGEç­¾æ”¶æ¨¡å¼ï¼Œå¹¶ä¸”è°ƒç”¨äº†recover()æ–¹æ³•ã€‚</p><p>é»˜è®¤ä¼šé‡å‘6æ¬¡ï¼Œå½“è¶…è¿‡å…­æ¬¡æ—¶ä¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—(ActiveMQ.DLQ)ï¼Œå¯ä»¥ä½¿ç”¨RedeliveryPolicy ç±»æ¥ä¿®æ”¹é»˜è®¤çš„é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(CONNECTION_URL);</span><br><span class="line">RedeliveryPolicy policy = connectionFactory.getRedeliveryPolicy();</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§é‡å‘æ¬¡æ•°ä¸º3æ¬¡</span></span><br><span class="line">policy.setMaximumRedeliveries(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>RedeliveryPolicyçš„ä¸€äº›å…¶ä»–è®¾ç½®</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/08/12/MQ/ActiveMQ/activeMQ/image-20200521191415684.png" alt="image-20200521191415684"></p>]]></content>
      
      
      <categories>
          
          <category> MQ </category>
          
          <category> activeMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQ </tag>
            
            <tag> activeMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxé”™è¯¯è®°å½•</title>
      <link href="2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
      <url>2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="vmè™šæ‹Ÿæœºä¸­æ¡¥æ¥æ¨¡å¼ä¸‹è™šæ‹Ÿæœºå’Œç‰©ç†æœºç½‘æ®µä¸åŒè§£å†³åŠæ³•"><a href="#vmè™šæ‹Ÿæœºä¸­æ¡¥æ¥æ¨¡å¼ä¸‹è™šæ‹Ÿæœºå’Œç‰©ç†æœºç½‘æ®µä¸åŒè§£å†³åŠæ³•" class="headerlink" title="vmè™šæ‹Ÿæœºä¸­æ¡¥æ¥æ¨¡å¼ä¸‹è™šæ‹Ÿæœºå’Œç‰©ç†æœºç½‘æ®µä¸åŒè§£å†³åŠæ³•"></a>vmè™šæ‹Ÿæœºä¸­æ¡¥æ¥æ¨¡å¼ä¸‹è™šæ‹Ÿæœºå’Œç‰©ç†æœºç½‘æ®µä¸åŒè§£å†³åŠæ³•</h1><ol><li><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE.png" alt="image-20200514182233038"></p><p>ç‚¹å‡»è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20200514182434873.png" alt="image-20200514182434873"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20200514182617703.png" alt="image-20200514182617703"></p><p>å°†è‡ªåŠ¨æ”¹ä¸ºç‰©ç†æœºä¸­æœ¬åœ°ç½‘å¡çš„åç§°</p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20200514182823994.png" alt="image-20200514182823994"></p><p>ä¿®æ”¹ä¸ºæ¡¥æ¥æ¨¡å¼</p></li><li><p>åœ¨è™šæ‹Ÿæœºä¸­ä¿®æ”¹ip</p><ol><li>æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ /etc/sysconfig/network-scripts/ifcfg-ç½‘å¡å</li><li>ä¿®æ”¹<code>BOOTPROTO</code>å±æ€§ä¸º<code>static</code>ï¼Œé»˜è®¤ä¸º<code>dhcp</code></li><li>ä¿®æ”¹IPADDR(ipåœ°å€),  PREFIX(å­ç½‘æ©ç ),  GATEWAY(ç½‘å…³)ã€‚å°†IPADDRè®¾ç½®æˆä¸ç‰©ç†ä¸»æœºç›¸åŒç½‘æ®µçš„ipï¼Œå­ç½‘æ©ç å’Œç½‘å…³è®¾ç½®æˆå’Œç‰©ç†ä¸»æœºç›¸åŒçš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸‰ä¸ªå±æ€§å°±æ·»åŠ </li><li>é‡å¯ç½‘å¡  <code>systemctl restart network</code> </li></ol></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TYPE</span>=<span class="string">&quot;Ethernet&quot;</span></span><br><span class="line"><span class="attr">PROXY_METHOD</span>=<span class="string">&quot;none&quot;</span></span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=<span class="string">&quot;static&quot;</span></span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="attr">IPV6_AUTOCONF</span>=<span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="attr">IPV6_DEFROUTE</span>=<span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="attr">IPV6_FAILURE_FATAL</span>=<span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="attr">IPV6_ADDR_GEN_MODE</span>=<span class="string">&quot;stable-privacy&quot;</span></span><br><span class="line"><span class="attr">NAME</span>=<span class="string">&quot;ens33&quot;</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="string">&quot;192.168.1.104&quot;</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="string">&quot;192.168.1.1&quot;</span></span><br><span class="line"><span class="attr">UUID</span>=<span class="string">&quot;faf9b428-5baa-4620-9801-2f608fefc9a8&quot;</span></span><br><span class="line"><span class="attr">DEVICE</span>=<span class="string">&quot;ens33&quot;</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="string">&quot;yes&quot;</span></span><br></pre></td></tr></table></figure><h1 id="å¼€æ”¾ç«¯å£æ— æ•ˆ"><a href="#å¼€æ”¾ç«¯å£æ— æ•ˆ" class="headerlink" title="å¼€æ”¾ç«¯å£æ— æ•ˆ"></a>å¼€æ”¾ç«¯å£æ— æ•ˆ</h1><p>é—®é¢˜æè¿°ï¼šcentos7é‡Œé¢å¼€æ”¾æŒ‡å®šç«¯å£æ— æ•ˆä½†æ˜¯å…³é—­é˜²ç«å¢™å¯ä»¥è®¿é—®</p><p>è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„åŸŸ</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> firewall-cmd --get-active-zones</span>                             </span><br><span class="line">external</span><br><span class="line">  interfaces: eth0</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šåœ¨è¿™ä¸ªåŸŸä¸­å¼€å¯ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=external --add-port=8080/tcp --permanent</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡å™¨è¿˜è¦å»å®‰å…¨ç»„é‡Œé¢åŠ å…¥å¼€æ”¾ç«¯å£</p></blockquote><h1 id="pingä¸é€šç™¾åº¦"><a href="#pingä¸é€šç™¾åº¦" class="headerlink" title="pingä¸é€šç™¾åº¦"></a>pingä¸é€šç™¾åº¦</h1><p>é—®é¢˜æè¿°ï¼šcentos7 ping ç™¾åº¦ç­‰ç½‘å€æ—¶å‡ºç°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7node112 network-scripts]# ping baidu.com           </span><br><span class="line">ping: baidu.com: åŸŸåè§£ææš‚æ—¶å¤±è´¥</span><br><span class="line">[root@centos7node112 network-scripts]# ping baidu.com</span><br><span class="line">ping: baidu.com: åŸŸåè§£ææš‚æ—¶å¤±è´¥</span><br></pre></td></tr></table></figure><p>é—®é¢˜è§£å†³ï¼š</p><ol><li><p>è®¾ç½®dnsåŸŸåè§£æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘åŸŸåè§£æé…ç½®</span></span><br><span class="line">vim /etc/resolv.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†é˜¿é‡Œäº‘çš„dnsæœåŠ¡å™¨æ·»åŠ åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">nameserver 223.5.5.5</span><br><span class="line">nameserver 223.6.6.6</span><br></pre></td></tr></table></figure></li></ol><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20201001095810858.png" alt="image-20201001095810858"></p><blockquote><p>å¦‚æœè¿˜æ˜¯ä¸è¡Œå°±æ‰§è¡Œä¸‹é¢çš„æ“ä½œ</p></blockquote><ol><li><p>æŸ¥çœ‹è™šæ‹Ÿæœºä¸­ç½‘å…³çš„ip</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20201001094817488.png" alt="image-20201001094817488"></p></li><li><p>æŸ¥çœ‹è™šæ‹Ÿæœºä¸­çš„ç½‘å¡è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥ç½‘å¡é…ç½®æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line">cd /etc/sysconfig/network-scripts</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç½‘å¡é…ç½®</span></span><br><span class="line">cat ifcfg-ç½‘å¡çš„åç§°</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœä¸çŸ¥é“ç½‘å¡çš„åç§°æ˜¯å•¥å°±ä½¿ç”¨ifconfig æˆ– ip addr æŸ¥çœ‹</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/23/Linux/Linux%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/image-20201001095434901.png" alt="image-20201001095434901"></p></li><li><p>ä¿®æ”¹ä¹‹åå°±å¯ä»¥pingé€šäº†ï¼Œ</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
          <category> Linux </category>
          
          <category> é”™è¯¯è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> Linux </tag>
            
            <tag> é”™è¯¯è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud å­¦ä¹ ç¬”è®°</title>
      <link href="2020/07/05/spring-cloud/spring-cloud/"/>
      <url>2020/07/05/spring-cloud/spring-cloud/</url>
      
        <content type="html"><![CDATA[<p><a href="https://spring.io/projects/spring-boot">spring-boot å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://spring.io/projects/spring-cloud">spring-cloud å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md">spring-cloudä¸­æ–‡æ–‡æ¡£</a></p><h1 id="ä¸€ã€é¡¹ç›®æ­å»º"><a href="#ä¸€ã€é¡¹ç›®æ­å»º" class="headerlink" title="ä¸€ã€é¡¹ç›®æ­å»º"></a>ä¸€ã€é¡¹ç›®æ­å»º</h1><h2 id="project"><a href="#project" class="headerlink" title="project"></a>project</h2><h3 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®ï¼ˆmavn-archetype-siteï¼‰"><a href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®ï¼ˆmavn-archetype-siteï¼‰" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®ï¼ˆmavn-archetype-siteï¼‰"></a>åˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®ï¼ˆmavn-archetype-siteï¼‰</h3><p>åˆ›å»ºçš„è¿‡ç¨‹ä¸­è¯·ä½¿ç”¨3.5ä»¥ä¸Šçš„mavenï¼Œä¸è¦ä½¿ç”¨ideaè‡ªå¸¦çš„</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523123547798.png" alt="image-20200523123547798"></p><h3 id="è®¾ç½®å­—ç¬¦ç¼–ç "><a href="#è®¾ç½®å­—ç¬¦ç¼–ç " class="headerlink" title="è®¾ç½®å­—ç¬¦ç¼–ç "></a>è®¾ç½®å­—ç¬¦ç¼–ç </h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523124518170.png" alt="image-20200523124518170"></p><h3 id="æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»"><a href="#æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»" class="headerlink" title="æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»"></a>æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»</h3><p>æ‰“å¼€enable annotation processorsé€‰é¡¹</p><p>defaulté‡Œé¢çš„enable annotation processorsé€‰é¡¹ä¹Ÿè¦âˆš</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523124807004.png" alt="image-20200523124807004"></p><h3 id="è®¾ç½®java8"><a href="#è®¾ç½®java8" class="headerlink" title="è®¾ç½®java8"></a>è®¾ç½®java8</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523125155066.png" alt="image-20200523125155066"></p><h3 id="File-Type-è¿‡æ»¤ã€å¯é€‰ã€‘"><a href="#File-Type-è¿‡æ»¤ã€å¯é€‰ã€‘" class="headerlink" title="File Type è¿‡æ»¤ã€å¯é€‰ã€‘"></a>File Type è¿‡æ»¤ã€å¯é€‰ã€‘</h3><p>å°†ä¸éœ€è¦çœ‹åˆ°çš„æ–‡ä»¶æ·»åŠ åˆ°ä¸‹é¢é‚£ä¸ªæ¡†é‡Œé¢å°±å¥½äº†</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523125416059.png" alt="image-20200523125416059"></p><h2 id="æ­å»ºçˆ¶å·¥ç¨‹pom"><a href="#æ­å»ºçˆ¶å·¥ç¨‹pom" class="headerlink" title="æ­å»ºçˆ¶å·¥ç¨‹pom"></a>æ­å»ºçˆ¶å·¥ç¨‹pom</h2><p>åˆ é™¤srcæ–‡ä»¶ï¼Œå› ä¸ºè¿™æ˜¯çˆ¶å·¥ç¨‹ï¼Œä¸éœ€è¦srcæ–‡ä»¶</p><h3 id="pomæ–‡ä»¶"><a href="#pomæ–‡ä»¶" class="headerlink" title="pomæ–‡ä»¶"></a>pomæ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬+å­moduleä¸ç”¨è°¢groupIdå’Œversion--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-project-info-reports-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring cloud é˜¿é‡Œå·´å·´--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- druid--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--log4j--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å…³é—­å•å…ƒæµ‹è¯•"><a href="#å…³é—­å•å…ƒæµ‹è¯•" class="headerlink" title="å…³é—­å•å…ƒæµ‹è¯•"></a>å…³é—­å•å…ƒæµ‹è¯•</h3><p>è¿™ä¸€æ­¥åªæ˜¯ä¸ºäº†æ‰“åŒ…èŠ‚çœæ—¶é—´</p><p>çœ‹åˆ°testæŒ‡ä»¤è¢«åˆ’äº†æ¨ªçº¿å°±å¥½äº†</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523131615272.png" alt="image-20200523131615272"></p><h3 id="æµ‹è¯•æ˜¯å¦æ­å»ºæˆåŠŸ"><a href="#æµ‹è¯•æ˜¯å¦æ­å»ºæˆåŠŸ" class="headerlink" title="æµ‹è¯•æ˜¯å¦æ­å»ºæˆåŠŸ"></a>æµ‹è¯•æ˜¯å¦æ­å»ºæˆåŠŸ</h3><p>è¿è¡Œmavençš„installå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å‡ºç°äº†<code>BUILD SUCCESS</code></p><p>æµ‹è¯•å®Œäº†ä¹‹åæ‰§è¡ŒcleanæŒ‡ä»¤åˆ é™¤åˆšåˆšç¼–è¯‘çš„é¡¹ç›®jaråŒ…</p><h2 id="Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º"><a href="#Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º" class="headerlink" title="Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º"></a>Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º</h2><h3 id="åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavenå·¥ç¨‹ã€cloud-provider-payment8001ã€‘"><a href="#åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavenå·¥ç¨‹ã€cloud-provider-payment8001ã€‘" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavenå·¥ç¨‹ã€cloud-provider-payment8001ã€‘"></a>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavenå·¥ç¨‹ã€cloud-provider-payment8001ã€‘</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523133057294.png" alt="image-20200523133057294"></p><h4 id="æ·»åŠ pomä¾èµ–"><a href="#æ·»åŠ pomä¾èµ–" class="headerlink" title="æ·»åŠ pomä¾èµ–"></a>æ·»åŠ pomä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¦‚æœæ²¡æœ‰ç”¨åˆ°å°±ä¸è¦å¯¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¦‚æœæ²¡æœ‰ç”¨åˆ°å°±ä¸è¦å¯¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¦‚æœæ²¡æœ‰ç”¨åˆ°å°±ä¸è¦å¯¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¦‚æœæ²¡æœ‰ç”¨åˆ°å°±ä¸è¦å¯¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å†™application-yml"><a href="#å†™application-yml" class="headerlink" title="å†™application.yml"></a>å†™application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2020?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.ll.springcloud.entities</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8001</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»"><a href="#ä¸šåŠ¡ç±»" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><h5 id="å»ºè¡¨sql"><a href="#å»ºè¡¨sql" class="headerlink" title="å»ºè¡¨sql"></a>å»ºè¡¨sql</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `payment` (</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> auto_increment COMMENT <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">`serial` <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span>(<span class="string">&#x27;&#x27;</span>),</span><br><span class="line"><span class="keyword">primary</span> key (`id`)</span><br><span class="line">)ENGINE<span class="operator">=</span>INNODB auto_increment<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> charset<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ç±»å»çœ‹é¡¹ç›®é‡Œé¢çš„ä»£ç </p><h3 id="çƒ­éƒ¨ç½²-Devtools"><a href="#çƒ­éƒ¨ç½²-Devtools" class="headerlink" title="çƒ­éƒ¨ç½² Devtools"></a>çƒ­éƒ¨ç½² Devtools</h3><h4 id="æ·»åŠ devtools-jaråŒ…"><a href="#æ·»åŠ devtools-jaråŒ…" class="headerlink" title="æ·»åŠ devtools jaråŒ…"></a>æ·»åŠ devtools jaråŒ…</h4><p>è¿™ä¸ªè¦æ·»åŠ åˆ°å­å·¥ç¨‹é‡Œé¢</p><p>å¦‚æœæ˜¯æ‹·è´çš„ä¹‹å‰åˆ›å»º8001å·¥ç¨‹çš„pomæ–‡ä»¶ï¼Œè¿™ä¸ªå°±ä¸ç”¨æ‹·äº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ æ’ä»¶åˆ°çˆ¶å·¥ç¨‹"><a href="#æ·»åŠ æ’ä»¶åˆ°çˆ¶å·¥ç¨‹" class="headerlink" title="æ·»åŠ æ’ä»¶åˆ°çˆ¶å·¥ç¨‹"></a>æ·»åŠ æ’ä»¶åˆ°çˆ¶å·¥ç¨‹</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹"><a href="#å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹" class="headerlink" title="å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹"></a>å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹</h4><p>å‹¾ä¸Šï¼Œautomaticallyçš„é‚£ä¸ªä¹Ÿè¦å‹¾</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523155942164.png" alt="image-20200523155942164"></p><p>æŒ‰ä½<code>ctrl+shift+alt+/</code>,ç‚¹å‡»ç¬¬ä¸€ä¸ª</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523160233748.png" alt="image-20200523160233748"></p><p>å‹¾ä¸Šä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼ˆå¯ä»¥æœç´¢ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523160509841.png" alt="image-20200523160509841"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523160603567.png" alt="image-20200523160603567"></p><h4 id="é‡å¯idea"><a href="#é‡å¯idea" class="headerlink" title="é‡å¯idea"></a>é‡å¯idea</h4><h3 id="åˆ›å»ºæ¶ˆè´¹è€…ã€cloud-customer-order80ã€‘"><a href="#åˆ›å»ºæ¶ˆè´¹è€…ã€cloud-customer-order80ã€‘" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…ã€cloud-customer-order80ã€‘"></a>åˆ›å»ºæ¶ˆè´¹è€…ã€cloud-customer-order80ã€‘</h3><p>æ²¡ä»€ä¹ˆéœ€è¦è®°çš„ï¼Œå’Œåˆ›å»ºpaymenté¡¹ç›®çš„æ­¥éª¤ä¸€æ ·ï¼Œå°±æ˜¯ä¸éœ€è¦çš„ä¾èµ–è®°å¾—ç§»é™¤ï¼Œä»£ç çœ‹é¡¹ç›®</p><h3 id="é¡¹ç›®é‡æ„"><a href="#é¡¹ç›®é‡æ„" class="headerlink" title="é¡¹ç›®é‡æ„"></a>é¡¹ç›®é‡æ„</h3><p>ç”±äºä¹‹å‰çš„é¡¹ç›®ä¸­æœ‰ä»£ç ç›¸åŒçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥å°†ä»–ä»¬å…¨éƒ½æå–å‡ºæ¥ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ªé¡¹ç›®ã€cloud-api-commonsã€‘</p><h1 id="äºŒã€eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#äºŒã€eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="äºŒã€eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>äºŒã€eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h1><h2 id="å•æœºeurekaæ„å»ºæ­¥éª¤"><a href="#å•æœºeurekaæ„å»ºæ­¥éª¤" class="headerlink" title="å•æœºeurekaæ„å»ºæ­¥éª¤"></a>å•æœºeurekaæ„å»ºæ­¥éª¤</h2><h3 id="eurekaServerç«¯"><a href="#eurekaServerç«¯" class="headerlink" title="eurekaServerç«¯"></a>eurekaServerç«¯</h3><h5 id="å»ºmavenå·¥ç¨‹"><a href="#å»ºmavenå·¥ç¨‹" class="headerlink" title="å»ºmavenå·¥ç¨‹"></a>å»ºmavenå·¥ç¨‹</h5><h5 id="ä¿®æ”¹pomæ–‡ä»¶"><a href="#ä¿®æ”¹pomæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹pomæ–‡ä»¶"></a>ä¿®æ”¹pomæ–‡ä»¶</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--boot web actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523192756143.png" alt="image-20200523192756143"></p><h5 id="å†™yml"><a href="#å†™yml" class="headerlink" title="å†™yml"></a>å†™yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤æŒ‡å‘å…¶å®ƒeureka</span></span><br><span class="line">      <span class="comment">#defaultZone: http://eureka7002.com:7002/eureka/</span></span><br><span class="line">      <span class="comment">#å•æœºå°±æ˜¯7001è‡ªå·±</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><h5 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h5><p>åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ @EnableEurekaServeræ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaMain7001</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h5><p>æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€<a href="http://localhost:7001/">http://localhost:7001/</a></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523193945664.png" alt="image-20200523193945664"></p><p><strong>å¦‚æœå‡ºç°ä¸‹å›¾ä¸­çš„çº¢è‰²è­¦å‘Šï¼Œåˆ«æ…Œï¼Œè¿™æ˜¯eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œåé¢ä¼šè¯´çš„</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523205708198.png" alt="image-20200523205708198"></p><h2 id="å°†cloud-provider-payment8001æ³¨å†Œè¿›eurekaä¸­"><a href="#å°†cloud-provider-payment8001æ³¨å†Œè¿›eurekaä¸­" class="headerlink" title="å°†cloud-provider-payment8001æ³¨å†Œè¿›eurekaä¸­"></a>å°†cloud-provider-payment8001æ³¨å†Œè¿›eurekaä¸­</h2><p>ä»¥ä¸‹ä¿®æ”¹éƒ½æ˜¯å¯¹cloud-provider-payment8001é¡¹ç›®è¿›è¡Œçš„ä¿®æ”¹</p><h3 id="æ·»åŠ eureka-clientä¾èµ–"><a href="#æ·»åŠ eureka-clientä¾èµ–" class="headerlink" title="æ·»åŠ eureka-clientä¾èµ–"></a>æ·»åŠ eureka-clientä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹yml"><a href="#ä¿®æ”¹yml" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h3><p>æ·»åŠ ä»¥ä¸‹é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ä¸»å…¥å£ç±»"><a href="#ä¿®æ”¹ä¸»å…¥å£ç±»" class="headerlink" title="ä¿®æ”¹ä¸»å…¥å£ç±»"></a>ä¿®æ”¹ä¸»å…¥å£ç±»</h3><p>æ·»åŠ @EnableEurekaClientæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8001</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>è¿˜æ˜¯è¾“å…¥eurekaçš„ç½‘å€<a href="http://localhost:7001/">http://localhost:7001/</a></p><p>å¯ä»¥çœ‹åˆ°å·²ç»å‡ºç°äº†åˆšåˆšæ³¨å†Œè¿›å»çš„æœåŠ¡ï¼ŒæœåŠ¡çš„åç§°å°±æ˜¯åœ¨application.ymlä¸­é…ç½®çš„<code>spring.application.name</code>,è¿™ä¸ªåç§°æœ€å¥½ä¸è¦éšæ„æ”¹åŠ¨</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523200046599.png" alt="image-20200523200046599"></p><h2 id="å°†cloud-customer-order80ä¹Ÿæ³¨å†Œåˆ°eurekaä¸­"><a href="#å°†cloud-customer-order80ä¹Ÿæ³¨å†Œåˆ°eurekaä¸­" class="headerlink" title="å°†cloud-customer-order80ä¹Ÿæ³¨å†Œåˆ°eurekaä¸­"></a>å°†cloud-customer-order80ä¹Ÿæ³¨å†Œåˆ°eurekaä¸­</h2><p>æ­¥éª¤å’Œä¿®æ”¹å’Œä¸Šé¢çš„ä¸€è‡´</p><p>æˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°å°±è¢«æ³¨å†Œåˆ°eurekaä¸­äº†</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523201616980.png" alt="image-20200523201616980"></p><h2 id="é›†ç¾¤Eurekaæ­å»ºæ­¥éª¤"><a href="#é›†ç¾¤Eurekaæ­å»ºæ­¥éª¤" class="headerlink" title="é›†ç¾¤Eurekaæ­å»ºæ­¥éª¤"></a>é›†ç¾¤Eurekaæ­å»ºæ­¥éª¤</h2><h3 id="eurekaé›†ç¾¤åŸç†è¯´æ˜"><a href="#eurekaé›†ç¾¤åŸç†è¯´æ˜" class="headerlink" title="eurekaé›†ç¾¤åŸç†è¯´æ˜"></a>eurekaé›†ç¾¤åŸç†è¯´æ˜</h3><p>åˆ«é—®ï¼Œé—®å°±æ˜¯å·æ‡’o(Â´^ï½€)o</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523202335326.png" alt="image-20200523202335326"></p><h3 id="å†æ„å»ºä¸€ä¸ªeureka-serveré¡¹ç›®"><a href="#å†æ„å»ºä¸€ä¸ªeureka-serveré¡¹ç›®" class="headerlink" title="å†æ„å»ºä¸€ä¸ªeureka-serveré¡¹ç›®"></a>å†æ„å»ºä¸€ä¸ªeureka-serveré¡¹ç›®</h3><p>å‚è€ƒeurekaServer-7001çš„é‚£ä¸ªï¼Œå»ºå®Œä¹‹åçœ‹ä¸‹é¢çš„ã€‚å…ˆä¸è¦ç€æ€¥æµ‹è¯•</p><h3 id="ä¿®æ”¹hostsæ–‡ä»¶"><a href="#ä¿®æ”¹hostsæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹hostsæ–‡ä»¶"></a>ä¿®æ”¹hostsæ–‡ä»¶</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># æ·»åŠ ä»¥ä¸‹æ˜ å°„</span></span><br><span class="line">127.0.0.1 eureka7001</span><br><span class="line">127.0.0.1 eureka7002</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ˜¯ä¸¤å°eurekaçš„ipæ˜ å°„ï¼Œå› ä¸ºç»ƒä¹ cloudæ‰€ä»¥å°±å…±ç”¨ä¸€å°ç‰©ç†æœºï¼Œä½¿ç”¨æ˜ å°„çš„æ–¹å¼åŒºåˆ†ä¸€ä¸‹ã€‚</p><p>å½“ç„¶ä¸é…ç½®è¿™ä¸ªä¹Ÿå¯ä»¥</p></blockquote><h4 id="ä¿®æ”¹yml-1"><a href="#ä¿®æ”¹yml-1" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h4><p>7002çš„ymlï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7002</span> <span class="comment"># eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001:7001/eureka/</span> <span class="comment"># å› ä¸ºæ˜¯ç›¸äº’å®ˆæœ›ã€ç›¸äº’æ³¨å†Œï¼Œæ‰€ä»¥è¿™é‡Œè¦å¡«7001çš„æ³¨å†Œåœ°å€</span></span><br></pre></td></tr></table></figure><p>7001çš„ymlï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002:7002/eureka/</span> <span class="comment"># ä¸è§£é‡Šäº†ï¼Œä¸Šé¢è§£é‡Šè¿‡äº†</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>è®¿é—®7001å’Œ7002</p><p>å¦‚æœåƒä¸‹å›¾ä¸€æ ·ï¼Œ7001ä¸­çš„DS Replicasä¸­çš„æ˜¯7002ï¼Œ7002ä¸­çš„æ˜¯7001ï¼Œå°±æˆåŠŸå•¦|à¥‚ï½¥Ï‰ï½¥` )</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523205332154.png" alt="image-20200523205332154"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523210126006.png" alt="image-20200523210126006"></p><h3 id="å°†è®¢å•80å’Œè®¢å•æœåŠ¡æä¾›è€…8001æ³¨å†Œåˆ°eurekaä¸­"><a href="#å°†è®¢å•80å’Œè®¢å•æœåŠ¡æä¾›è€…8001æ³¨å†Œåˆ°eurekaä¸­" class="headerlink" title="å°†è®¢å•80å’Œè®¢å•æœåŠ¡æä¾›è€…8001æ³¨å†Œåˆ°eurekaä¸­"></a>å°†è®¢å•80å’Œè®¢å•æœåŠ¡æä¾›è€…8001æ³¨å†Œåˆ°eurekaä¸­</h3><p>è¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹80å’Œ8001çš„ymlé…ç½®æ–‡ä»¶å³å¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span></span><br><span class="line">      <span class="comment"># å°†defaultZoneä¿®æ”¹ä¸ºå¤šä¸ªæ³¨å†Œåœ°å€å³å¯ï¼Œå½“ç„¶åªå¡«ä¸€ä¸ªä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºeurekaé›†ç¾¤ä¼šäº’ç›¸å¤åˆ¶ï¼Œä½†æ˜¯å¦‚æœåˆšå¥½å¡«çš„é‚£ä¸€ä¸ªeurekaåˆšå¥½æ²¡å¯åŠ¨ï¼ŒæœåŠ¡å°±æ³¨å†Œä¸ä¸Šå»äº†</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ç½‘å€è¾“å…¥<a href="http://localhost:7001å’Œhttp://localhost:7002">http://localhost:7001å’Œhttp://localhost:7002</a></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523211213776.png" alt="image-20200523211213776"></p><h3 id="è®¢å•æœåŠ¡æä¾›è€…8001çš„é›†ç¾¤é…ç½®"><a href="#è®¢å•æœåŠ¡æä¾›è€…8001çš„é›†ç¾¤é…ç½®" class="headerlink" title="è®¢å•æœåŠ¡æä¾›è€…8001çš„é›†ç¾¤é…ç½®"></a>è®¢å•æœåŠ¡æä¾›è€…8001çš„é›†ç¾¤é…ç½®</h3><h4 id="æ–°å»º8002"><a href="#æ–°å»º8002" class="headerlink" title="æ–°å»º8002"></a>æ–°å»º8002</h4><p>å‚è€ƒ8001</p><h4 id="ä¿®æ”¹yml-2"><a href="#ä¿®æ”¹yml-2" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span> <span class="comment"># åªéœ€è¦ä¿®æ”¹ç«¯å£å·</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆä¸ä¿®æ”¹spring.application.name?</p><p>ä¸ä»…ä¸è¦ä¿®æ”¹ï¼Œåç§°è¿˜å¿…é¡»ä¸€è‡´ã€‚å› ä¸º8001å’Œ8002çš„æœåŠ¡æä¾›éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœåç§°ä¸ä¸€è‡´é‚£ä¹ˆå°±åšä¸åˆ°è´Ÿè½½å‡è¡¡äº†</p></blockquote><h4 id="æµ‹è¯•-4"><a href="#æµ‹è¯•-4" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¦‚æœé…ç½®æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢å‡ºç°äº†8001å’Œ8002</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523214156853.png" alt="image-20200523214156853"></p><h3 id="ä½¿ç”¨ä¸‹å•æœåŠ¡80å»è®¿é—®è®¢å•æœåŠ¡é›†ç¾¤"><a href="#ä½¿ç”¨ä¸‹å•æœåŠ¡80å»è®¿é—®è®¢å•æœåŠ¡é›†ç¾¤" class="headerlink" title="ä½¿ç”¨ä¸‹å•æœåŠ¡80å»è®¿é—®è®¢å•æœåŠ¡é›†ç¾¤"></a>ä½¿ç”¨ä¸‹å•æœåŠ¡80å»è®¿é—®è®¢å•æœåŠ¡é›†ç¾¤</h3><p>å› ä¸ºè®¢å•æœåŠ¡å·²ç»æ˜¯é›†ç¾¤äº†ï¼Œå¹¶ä¸”æ³¨å†Œåˆ°äº†eurekaä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦è®¿é—®è®¢å•æœåŠ¡åç§°(<strong>CLOUD-PAYMENT-SERVICE</strong>)å³å¯</p><blockquote><p>ç”±äºè¿™é‡Œå†™æ­»çš„ç½‘å€æ˜¯é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;my-config.cloud-payment-url&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String PAYMENT_URL;</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my-config:</span></span><br><span class="line">  <span class="attr">cloud-payment-url:</span> <span class="string">http://CLOUD-PAYMENT-SERVICE</span> <span class="comment"># ä¿®æ”¹ä¸ºæœåŠ¡åç§°</span></span><br></pre></td></tr></table></figure></blockquote><p>è¿™é‡Œå‡ºç°äº†ä»¥ä¸‹é”™è¯¯ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯RestTemplateçš„è´Ÿè½½å‡è¡¡èƒ½åŠ›</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523214619780.png" alt="image-20200523214619780"></p><p><strong>å¼€å¯æ–¹æ³•ï¼š</strong></p><p>åœ¨ä¹‹å‰çš„é…ç½®ç±»ä¸­åŠ å…¥@LoadBalancedæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><p>åœ¨8001å’Œ8002çš„controlleråŠ ä¸€ä¸ªæ ‡è¯†ï¼Œæ–¹ä¾¿æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æˆåŠŸ,serverPost:&quot;</span>+port, i);</span><br><span class="line"><span class="comment">// åœ¨è¿”å›jsonä¸²çš„æ—¶å€™åŠ å…¥ä¸€ä¸‹port</span></span><br></pre></td></tr></table></figure><p>è®¿é—®80çš„è¯·æ±‚åœ°å€ï¼Œè¿ç»­å¤šè®¿é—®å‡ æ¬¡ï¼Œå¦‚æœè¿”å›çš„jsonä¸²ä¸­çš„portä¸€ç›´åœ¨åˆ‡æ¢ï¼Œé‚£å°±æˆåŠŸå•¦ï¼ï¼ï¼</p><p>å› ä¸ºé»˜è®¤æ˜¯ä½¿ç”¨è½®è¯¢çš„æ–¹å¼å®Œæˆçš„è´Ÿè½½å‡è¡¡</p><h2 id="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h2><h3 id="å¾®æœåŠ¡åç§°ä¿®æ”¹"><a href="#å¾®æœåŠ¡åç§°ä¿®æ”¹" class="headerlink" title="å¾®æœåŠ¡åç§°ä¿®æ”¹"></a>å¾®æœåŠ¡åç§°ä¿®æ”¹</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523220413283.png" alt="image-20200523220413283"></p><p>ä¿®æ”¹è¿™é‡Œçš„åç§°ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„ä¸»æœºåï¼Œè¿™ä¹ˆæ˜¾ç¤ºä¸€èˆ¬ä¸å¤ªå¥½</p><p><strong>ä¿®æ”¹ymlæ–‡ä»¶</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8002</span> <span class="comment"># æ·»åŠ è¿™ä¸ªå±æ€§</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523220814238.png" alt="image-20200523220814238"></p><p>è¿™æ ·å°±æ”¹æ‰äº†</p><h3 id="ipæ˜¾ç¤º"><a href="#ipæ˜¾ç¤º" class="headerlink" title="ipæ˜¾ç¤º"></a>ipæ˜¾ç¤º</h3><p>å½“é¼ æ ‡æ”¾åˆ°å¾®æœåŠ¡åç§°è¿æ¥ä¸Šæ—¶ï¼Œä¸ä¼šå‡ºç°ipåœ°å€ï¼Œè¿™æ ·ä¸åˆ©äºè°ƒè¯•æ’é”™</p><p><strong>ä¿®æ”¹ymlæ–‡ä»¶</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8002</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># æ·»åŠ è¿™ä¸ª æ˜¾ç¤ºipåœ°å€</span></span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡å‘ç°Disovery"><a href="#æœåŠ¡å‘ç°Disovery" class="headerlink" title="æœåŠ¡å‘ç°Disovery"></a>æœåŠ¡å‘ç°Disovery</h2><p>å¯é€šè¿‡DiscoveryClientç±»æ¥è·å–æœåŠ¡çš„ä¿¡æ¯</p><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discovery;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/discovery&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">discovery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;String&gt; services = discovery.getServices(); <span class="comment">// è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°eurekaä¸­æ³¨å†Œçš„æ‰€æœ‰æœåŠ¡çš„åç§°</span></span><br><span class="line">    services.forEach((i)-&gt;&#123;</span><br><span class="line">        log.info(<span class="string">&quot;*********element&quot;</span>+i);</span><br><span class="line">    &#125;);</span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discovery.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>); <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥è·å–æŒ‡å®šæœåŠ¡åç§°ä¸­çš„æœåŠ¡ï¼Œå› ä¸ºæœåŠ¡æœ‰å¯èƒ½æ˜¯å¤šä¸ªï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line">    instances.forEach((i)-&gt;&#123;</span><br><span class="line">        log.info(i.getServiceId()+<span class="string">&quot;, &quot;</span>+i.getHost()+<span class="string">&quot;, &quot;</span>+i.getPort()+<span class="string">&quot;, &quot;</span>+i.getUri());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.discovery;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨ä¸»é…ç½®ç±»ä¸­åŠ å…¥@EnableDiscoveryClientæ³¨è§£ï¼Œå¼€å¯åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8002</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8002.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰“å°ç»“æœ</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523223307895.png" alt="image-20200523223307895"></p><h2 id="Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶åŸç†"><a href="#Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶åŸç†" class="headerlink" title="Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶åŸç†"></a>Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶åŸç†</h2><h3 id="æ•…éšœç°è±¡"><a href="#æ•…éšœç°è±¡" class="headerlink" title="æ•…éšœç°è±¡"></a>æ•…éšœç°è±¡</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523223453312.png" alt="image-20200523223453312"></p><h3 id="å¯¼è‡´åŸå› "><a href="#å¯¼è‡´åŸå› " class="headerlink" title="å¯¼è‡´åŸå› "></a>å¯¼è‡´åŸå› </h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523223834549.png" alt="image-20200523223834549"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523223858560.png" alt="image-20200523223858560"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523224153468.png" alt="image-20200523224153468"></p><h3 id="æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"><a href="#æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"></a>æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</h3><p>ä¿®æ”¹eureka7001çš„ymlæ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>     <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># defaultZone: http://eureka7002:7002/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001:7001/eureka/</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">      <span class="comment">#å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤ æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªå±æ€§</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span> <span class="comment"># æ”¶å¿ƒè·³åŒ…çš„é—´éš”æ—¶é—´ ms</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹8001çš„yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line"><span class="comment">#      defaultZone: http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># æ˜¾ç¤ºipåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªå±æ€§</span></span><br><span class="line">    <span class="comment">#Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’)</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">#EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><p>å…³é—­ä¹‹åå†è®¿é—®eureka7001å°±ä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼Œæé†’è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶å·²ç»å…³é—­äº†</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200523225802348.png" alt="image-20200523225802348"></p><p>å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶åï¼Œå¦‚æœ8001å‡ºç°å®•æœºæˆ–è€…ç½‘ç»œå»¶è¿Ÿè¾ƒä¹…çš„è¯ï¼Œ7001å°±ä¼šç«‹åˆ»åˆ é™¤è¿™ä¸ªæœåŠ¡</p><h1 id="ä¸‰ã€zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#ä¸‰ã€zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="ä¸‰ã€zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>ä¸‰ã€zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°</h1><h2 id="ä½¿ç”¨zookeeperä»£æ›¿eureka"><a href="#ä½¿ç”¨zookeeperä»£æ›¿eureka" class="headerlink" title="ä½¿ç”¨zookeeperä»£æ›¿eureka"></a>ä½¿ç”¨zookeeperä»£æ›¿eureka</h2><h3 id="å°†è®¢å•æœåŠ¡æä¾›è€…æ³¨å†Œè¿›zookeeper"><a href="#å°†è®¢å•æœåŠ¡æä¾›è€…æ³¨å†Œè¿›zookeeper" class="headerlink" title="å°†è®¢å•æœåŠ¡æä¾›è€…æ³¨å†Œè¿›zookeeper"></a>å°†è®¢å•æœåŠ¡æä¾›è€…æ³¨å†Œè¿›zookeeper</h3><h4 id="å¯åŠ¨zookeeper"><a href="#å¯åŠ¨zookeeper" class="headerlink" title="å¯åŠ¨zookeeper"></a>å¯åŠ¨zookeeper</h4><p>çœ‹ä¹‹å‰çš„zookeeperç¬”è®°</p><h4 id="æ–°å»ºcloud-provider-payment8004"><a href="#æ–°å»ºcloud-provider-payment8004" class="headerlink" title="æ–°å»ºcloud-provider-payment8004"></a>æ–°å»ºcloud-provider-payment8004</h4><p>å‚è€ƒ8001</p><h4 id="ä¿®æ”¹pomæ–‡ä»¶-åŠ å…¥zookeeperçš„jaråŒ…"><a href="#ä¿®æ”¹pomæ–‡ä»¶-åŠ å…¥zookeeperçš„jaråŒ…" class="headerlink" title="ä¿®æ”¹pomæ–‡ä»¶, åŠ å…¥zookeeperçš„jaråŒ…"></a>ä¿®æ”¹pomæ–‡ä»¶, åŠ å…¥zookeeperçš„jaråŒ…</h4><p><strong>æ³¨æ„ï¼šå› ä¸ºspring-cloud-starter-zookeeper-discoveryä¸­ä¼šè‡ªå¸¦zookeeper3.5.3çš„jaråŒ…ï¼Œå¦‚æœæµ‹è¯•çš„æ—¶å€™å‡ºç°é”™è¯¯ï¼Œè¯·æ’é™¤æ‰å®ƒè‡ªå¸¦çš„é‚£ä¸ªjaråŒ…ï¼Œæ·»åŠ ä¸€ä¸ªå’Œå®‰è£…çš„zookeeperç‰ˆæœ¬ç›¸åŒçš„jaråŒ…</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ·»åŠ zookeeper3.6.1ç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml"><a href="#yml" class="headerlink" title="yml"></a><strong>yml</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.108</span><span class="string">:2181</span> <span class="comment"># è¿æ¥zookeeperçš„ipå’Œç«¯å£å·</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-5"><a href="#æµ‹è¯•-5" class="headerlink" title="æµ‹è¯•"></a><strong>æµ‹è¯•</strong></h4><p>ä½¿ç”¨zkCliè¿æ¥ï¼ŒæŸ¥çœ‹æ ¹èŠ‚ç‚¹ä¸‹æ˜¯å¦å‡ºç°äº†servicesèŠ‚ç‚¹ï¼ŒservicesèŠ‚ç‚¹ä¸‹æ˜¯å¦å‡ºç°äº†åˆšåˆšæ³¨å†Œçš„æœåŠ¡åç§°ï¼ŒæœåŠ¡åç§°ä¸‹åº”è¯¥è¿˜ä¼šæœ‰ä¸€ä¸ªåºåˆ—å·ï¼ŒæŸ¥çœ‹åºåˆ—å·é‡Œçš„å†…å®¹ï¼Œå¦‚æœé‡Œé¢çš„å†…å®¹å’Œé…ç½®å¯¹çš„ä¸Šå°±okå•¦ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524100642945.png" alt="image-20200524100642945"></p><h3 id="å°†æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œåˆ°zookeeperä¸­"><a href="#å°†æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œåˆ°zookeeperä¸­" class="headerlink" title="å°†æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œåˆ°zookeeperä¸­"></a>å°†æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œåˆ°zookeeperä¸­</h3><h4 id="åˆ›å»ºcloud-customer-zk-order80"><a href="#åˆ›å»ºcloud-customer-zk-order80" class="headerlink" title="åˆ›å»ºcloud-customer-zk-order80"></a>åˆ›å»ºcloud-customer-zk-order80</h4><p>å‚è€ƒ80</p><p>å…¶ä»–æ­¥éª¤å‚è€ƒ8004å’Œä»£ç ï¼Œæºœäº†</p><p>æµ‹è¯•æˆåŠŸåznodeé‡Œé¢ä¼šå‡ºç°æ³¨å†Œè¿›å»çš„æœåŠ¡</p><h1 id="å››ã€consulæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#å››ã€consulæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="å››ã€consulæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>å››ã€consulæœåŠ¡æ³¨å†Œä¸å‘ç°</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><h3 id="å®˜ç½‘"><a href="#å®˜ç½‘" class="headerlink" title="å®˜ç½‘"></a>å®˜ç½‘</h3><p><a href="https://www.consul.io/">https://www.consul.io/</a></p><p><a href="https://www.springcloud.cc/spring-cloud-consul.html">ä¸­æ–‡æ–‡æ¡£</a></p><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524103853662.png" alt="image-20200524103853662"></p><h3 id="èƒ½å¹²å˜›"><a href="#èƒ½å¹²å˜›" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524104040484.png" alt="image-20200524104040484"></p><h3 id="å»å“ªä¸‹"><a href="#å»å“ªä¸‹" class="headerlink" title="å»å“ªä¸‹"></a>å»å“ªä¸‹</h3><p><a href="https://www.consul.io/downloads">https://www.consul.io/downloads</a></p><h2 id="å®‰è£…å¹¶è¿è¡Œconsul"><a href="#å®‰è£…å¹¶è¿è¡Œconsul" class="headerlink" title="å®‰è£…å¹¶è¿è¡Œconsul"></a>å®‰è£…å¹¶è¿è¡Œconsul</h2><p>ä¸‹è½½liunxæˆ–windowsç‰ˆçš„consul</p><p>æ­¥éª¤éƒ½ä¸€æ ·</p><ul><li><p>è§£å‹æ–‡ä»¶</p><ul><li>linuxè§£å‹å‘½ä»¤: <code>unzip zipæ–‡ä»¶</code></li></ul></li><li><p>æ”¾åˆ°ä¸€ä¸ªå…¨è‹±æ–‡çš„è·¯å¾„é‡Œé¢å»</p></li><li><p>æ§åˆ¶å°è¾“å…¥ ./consul â€“version æŸ¥çœ‹æ˜¯å¦æˆåŠŸ</p></li><li><p>å¯åŠ¨ï¼š<code>./consul agent -dev</code></p></li></ul><p>ps: windowsçš„å°±ä¸è¦./äº†</p><p>å¯åŠ¨ä¹‹åè¾“å…¥ip:8500å°±okå•¦</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524110833439.png" alt="image-20200524110833439"></p><h2 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h2><h3 id="æ–°å»ºcloud-provider-payment8006"><a href="#æ–°å»ºcloud-provider-payment8006" class="headerlink" title="æ–°å»ºcloud-provider-payment8006"></a>æ–°å»ºcloud-provider-payment8006</h3><p>å‚è€ƒ8004</p><h3 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h3><p>æ³¨æ„ï¼šspring-boot-starter-actuatorä¸€å®šè¦å¯¼å…¥ï¼Œä¸ç„¶ä¼šæœ‰ä¸€ä¸ªçº¢å‰å‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yml-1"><a href="#yml-1" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-6"><a href="#æµ‹è¯•-6" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524113640405.png" alt="image-20200524113640405"></p><h2 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h2><p>å‚è€ƒzookeeperçš„80ï¼Œå…·ä½“çš„çœ‹ä»£ç ï¼Œè¿™é‡Œå°±ä¸å†™äº†</p><h3 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h3><p>å’Œ8006çš„ä¸€æ ·</p><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">my-config:</span></span><br><span class="line">  <span class="attr">cloud-payment-url:</span> <span class="string">http://cloud-payment-service</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹"><a href="#ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹" class="headerlink" title="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹"></a>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524125743220.png" alt="image-20200524125743220"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524125945132.png" alt="image-20200524125945132"></p><h1 id="äº”ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨"><a href="#äº”ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨" class="headerlink" title="äº”ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨"></a>äº”ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="æ˜¯ä»€ä¹ˆ-1"><a href="#æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524130743392.png" alt="image-20200524130743392"></p><h2 id="æ ¸å¿ƒç»„ä»¶IRule"><a href="#æ ¸å¿ƒç»„ä»¶IRule" class="headerlink" title="æ ¸å¿ƒç»„ä»¶IRule"></a>æ ¸å¿ƒç»„ä»¶IRule</h2><p>IRuleç®—æ³•ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524132523252.png" alt="image-20200524132523252"></p><h2 id="å¦‚ä½•æ›¿æ¢"><a href="#å¦‚ä½•æ›¿æ¢" class="headerlink" title="å¦‚ä½•æ›¿æ¢"></a>å¦‚ä½•æ›¿æ¢</h2><p>æµ‹è¯•å‰æï¼šè¦è®¢å•æœåŠ¡æä¾›è€…çš„é›†ç¾¤ï¼Œä¸ç„¶çœ‹ä¸å‡ºæ•ˆæœ</p><h3 id="ä¿®æ”¹order80"><a href="#ä¿®æ”¹order80" class="headerlink" title="ä¿®æ”¹order80"></a>ä¿®æ”¹order80</h3><p>æ·»åŠ ä¸€ä¸ªé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySelfRule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">iRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule(); <span class="comment">// å®šä¹‰ä¸ºéšæœº</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªç±»ä¸èƒ½è¢«@ComponentScanç»™æ‰«æåˆ°ï¼Œå¦åˆ™è¿™ä¸ªè§„åˆ™ä¼šè¢«æ‰€æœ‰çš„ribbonç»™æ‰«æåˆ°ï¼Œå°±è¾¾ä¸åˆ°ç§æœ‰åŒ–å®šåˆ¶çš„ç›®çš„äº†</p><p>è¯´äººè¯å°±æ˜¯ï¼šä¸è¦æ”¾åœ¨ä¸»é…ç½®ç±»ä¸‹é¢ï¼ˆå› ä¸º@SpringBootApplicationé‡Œé¢å°±æœ‰@ComponentScanï¼‰</p></blockquote><p>åƒè¿™æ ·ï¼Œæ”¾åœ¨ä¸»é…ç½®ç±»å¤–é¢ï¼Œä¸è¦å’Œä»–åŒåŒ…ï¼Œä¹Ÿä¸è¦æ”¾åœ¨åŒåŒ…çš„å­åŒ…é‡Œé¢</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524135705933.png" alt="image-20200524135705933"></p><p>æœ€åç»™ä¸»é…ç½®ç±»åŠ ä¸Šå¦‚ä¸‹æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">// åŠ æˆ‘åŠ æˆ‘ï¼Œçœ‹çœ‹å­©å­ï¼›nameæ˜¯éœ€è¦å®šåˆ¶è§„åˆ™çš„é‚£ä¸ªæœåŠ¡åç§°ï¼Œconfigurationå°±æ˜¯è‡ªå®šä¹‰çš„è§„åˆ™ç±»</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;, configuration = MySelfRule.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMain80</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è‡ªå·±æµ‹ï¼Œå¦‚æœ8001å’Œ8002çš„æ ‡è¯†ï¼ˆæ ‡è¯†å‰é¢åŠ è¿‡äº†ï¼‰éšæœºå‡ºç°å°±å¯¹äº†</p><h2 id="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"></a>Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524140916349.png" alt="image-20200524140916349"></p><h1 id="å…­ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"><a href="#å…­ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨" class="headerlink" title="å…­ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"></a>å…­ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="æ˜¯ä»€ä¹ˆ-2"><a href="#æ˜¯ä»€ä¹ˆ-2" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524144034245.png" alt="image-20200524144034245"></p><h3 id="èƒ½å¹²å˜›-1"><a href="#èƒ½å¹²å˜›-1" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524144259064.png" alt="image-20200524144259064"></p><h3 id="OpenFeginå’ŒFeginä¸¤è€…ä¹‹é—´çš„åŒºåˆ«"><a href="#OpenFeginå’ŒFeginä¸¤è€…ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="OpenFeginå’ŒFeginä¸¤è€…ä¹‹é—´çš„åŒºåˆ«"></a>OpenFeginå’ŒFeginä¸¤è€…ä¹‹é—´çš„åŒºåˆ«</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524144717167.png" alt="image-20200524144717167"></p><h2 id="OpenFeignä½¿ç”¨æ­¥éª¤"><a href="#OpenFeignä½¿ç”¨æ­¥éª¤" class="headerlink" title="OpenFeignä½¿ç”¨æ­¥éª¤"></a>OpenFeignä½¿ç”¨æ­¥éª¤</h2><h3 id="æ–°å»ºcloud-customer-openfeign-order80"><a href="#æ–°å»ºcloud-customer-openfeign-order80" class="headerlink" title="æ–°å»ºcloud-customer-openfeign-order80"></a>æ–°å»ºcloud-customer-openfeign-order80</h3><p>å‚è€ƒcloud-customer-order80</p><h4 id="pom-2"><a href="#pom-2" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml-2"><a href="#yml-2" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span> <span class="comment"># ä¹Ÿå¯ä»¥ä¸é…é›†ç¾¤</span></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ ä¸€ä¸ªservice"><a href="#æ·»åŠ ä¸€ä¸ªservice" class="headerlink" title="æ·»åŠ ä¸€ä¸ªservice"></a>æ·»åŠ ä¸€ä¸ªservice</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// æ ‡æ³¨æ˜¯å“ªä¸ªæœåŠ¡é‡Œé¢çš„</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentFeignService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/&#123;id&#125;&quot;)</span> <span class="comment">// è¿™ä¸ªéœ€è¦å’Œè®¢å•æä¾›è€…çš„è¯·æ±‚åœ°å€ä¸€æ ·</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPlaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹controller"><a href="#ä¿®æ”¹controller" class="headerlink" title="ä¿®æ”¹controller"></a>ä¿®æ”¹controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/payment/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥è°ƒç”¨service</span></span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPlaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ä¸»é…ç½®ç±»"><a href="#ä¿®æ”¹ä¸»é…ç½®ç±»" class="headerlink" title="ä¿®æ”¹ä¸»é…ç½®ç±»"></a>ä¿®æ”¹ä¸»é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// åŠ æˆ‘(*^â–½^*)å¼€å¯åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFeignMain80</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-7"><a href="#æµ‹è¯•-7" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·æµ‹ä¸€ä¸‹æ¥å£èƒ½ä¸èƒ½è®¿é—®å¾—åˆ°å°±å¥½å•¦</p><h2 id="OpenFeignè¶…æ—¶æ§åˆ¶"><a href="#OpenFeignè¶…æ—¶æ§åˆ¶" class="headerlink" title="OpenFeignè¶…æ—¶æ§åˆ¶"></a>OpenFeignè¶…æ—¶æ§åˆ¶</h2><p>openFeigné»˜è®¤è¶…æ—¶æ—¶é—´ä¸º1ç§’é’Ÿï¼Œå¦‚æœè¶…æ—¶å°±ä¼šæŠ¥é”™ã€‚è¿™é‡Œåœ¨è®¢å•æœåŠ¡æä¾›æ–¹é‚£é‡Œå†™äº†ä¸ªç­‰å¾…3ç§’çš„æ–¹æ³•ã€‚å…·ä½“çš„çœ‹ä»£ç </p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524153136502.png" alt="image-20200524153136502"></p><h3 id="æ€ä¹ˆè§£å†³"><a href="#æ€ä¹ˆè§£å†³" class="headerlink" title="æ€ä¹ˆè§£å†³"></a>æ€ä¹ˆè§£å†³</h3><p>ç”±äºopenfeignåº•å±‚æ˜¯ä½¿ç”¨çš„ribbonæ¥åšçš„ç®¡ç†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡é…ç½®ribbonæ¥è§£å†³</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨80çš„ymlä¸­åŠ å…¥ä»¥ä¸‹é…ç½®</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span> <span class="comment"># å› ä¸º8001å»¶è¿Ÿä¸‰ç§’ï¼Œæ‰€ä»¥è¿™è¾¹ä¹ŸåŠ é•¿ä¸€ç‚¹</span></span><br><span class="line">  <span class="comment"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h2 id="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"><a href="#OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½" class="headerlink" title="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"></a>OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½</h2><h3 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524154834154.png" alt="image-20200524154834154"></p><h3 id="å¼€å¯æ­¥éª¤"><a href="#å¼€å¯æ­¥éª¤" class="headerlink" title="å¼€å¯æ­¥éª¤"></a>å¼€å¯æ­¥éª¤</h3><p>ä»¥ä¸‹ä¿®æ”¹éƒ½æ˜¯åœ¨80é‡Œé¢ä¿®æ”¹çš„</p><h3 id="å‘å®¹å™¨ä¸­æ³¨å…¥Logger-Level"><a href="#å‘å®¹å™¨ä¸­æ³¨å…¥Logger-Level" class="headerlink" title="å‘å®¹å™¨ä¸­æ³¨å…¥Logger.Level"></a>å‘å®¹å™¨ä¸­æ³¨å…¥Logger.Level</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfig</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.<span class="function">Level <span class="title">feignLoggerLevel</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹yml-3"><a href="#ä¿®æ”¹yml-3" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹é…ç½®</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span></span><br><span class="line">    <span class="attr">com.ll.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524155826147.png" alt="image-20200524155826147"></p><h1 id="ä¸ƒã€Hystrix"><a href="#ä¸ƒã€Hystrix" class="headerlink" title="ä¸ƒã€Hystrix"></a>ä¸ƒã€Hystrix</h1><h2 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524160650509.png" alt="image-20200524160650509"></p><h3 id="æ˜¯ä»€ä¹ˆ-3"><a href="#æ˜¯ä»€ä¹ˆ-3" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200524160815102.png" alt="image-20200524160815102"></p><h2 id="star2-Hystrixé‡è¦æ¦‚å¿µ"><a href="#star2-Hystrixé‡è¦æ¦‚å¿µ" class="headerlink" title=":star2:Hystrixé‡è¦æ¦‚å¿µ"></a>:star2:Hystrixé‡è¦æ¦‚å¿µ</h2><h3 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h3><blockquote><p>  æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œ fallback</p></blockquote><p><strong>å“ªäº›æƒ…å†µä¼šå‡ºç°æœåŠ¡é™çº§</strong></p><ul><li><p>  ç¨‹åºè¿è¡Œå¼‚å¸¸</p></li><li><p>  è¶…æ—¶</p></li><li><p>  æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</p></li><li><p>  çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</p></li></ul><h3 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h3><blockquote><p>  ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º</p><p>  æœåŠ¡çš„é™çº§ -&gt; è¿›è€Œç†”æ–­ -&gt;æ¢å¤è°ƒç”¨é“¾è·¯</p></blockquote><h3 id="æœåŠ¡é™æµ"><a href="#æœåŠ¡é™æµ" class="headerlink" title="æœåŠ¡é™æµ"></a>æœåŠ¡é™æµ</h3><h2 id="star2-Hystrixæ¡ˆä¾‹"><a href="#star2-Hystrixæ¡ˆä¾‹" class="headerlink" title=":star2:Hystrixæ¡ˆä¾‹"></a>:star2:Hystrixæ¡ˆä¾‹</h2><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><h4 id="åˆ›å»ºcloud-provider-hystrix-payment8001"><a href="#åˆ›å»ºcloud-provider-hystrix-payment8001" class="headerlink" title="åˆ›å»ºcloud-provider-hystrix-payment8001"></a>åˆ›å»ºcloud-provider-hystrix-payment8001</h4><p>å‚è€ƒ8001</p><h4 id="pom-3"><a href="#pom-3" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml-3"><a href="#yml-3" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line"><span class="comment">#      defaultZone: http://localhost:7001/eureka/,http://eureka7002:7002/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># æ˜¾ç¤ºipåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-8"><a href="#æµ‹è¯•-8" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>è®°å¾—å†™controllerå†æµ‹è¯•ï¼Œåªè¦èƒ½è®¿é—®æˆåŠŸå°±å¥½å•¦:laughing:</p><h3 id="é«˜å¹¶å‘æµ‹è¯•"><a href="#é«˜å¹¶å‘æµ‹è¯•" class="headerlink" title="é«˜å¹¶å‘æµ‹è¯•"></a>é«˜å¹¶å‘æµ‹è¯•</h3><h4 id="jmeterå‹æµ‹æµ‹è¯•"><a href="#jmeterå‹æµ‹æµ‹è¯•" class="headerlink" title="jmeterå‹æµ‹æµ‹è¯•"></a>jmeterå‹æµ‹æµ‹è¯•</h4><p>ç”¨jmeteræµ‹è¯•ï¼Œä½¿ç”¨200ä¸ªçº¿ç¨‹è®¿é—®100æ¬¡ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸‡ä¸ªè¯·æ±‚å»è®¿é—®8001ï¼Œè¿™æ—¶å€™å†åœ¨ç½‘é¡µä¸Šå‘èµ·è¯·æ±‚å¯ä»¥çœ‹åˆ°æœ‰æ˜æ˜¾çš„å¡é¡¿äº†</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/1.gif"></p><h4 id="çœ‹çƒ­é—¹ä¸å«Œäº‹å¤§ï¼ŒåŠ å…¥80"><a href="#çœ‹çƒ­é—¹ä¸å«Œäº‹å¤§ï¼ŒåŠ å…¥80" class="headerlink" title="çœ‹çƒ­é—¹ä¸å«Œäº‹å¤§ï¼ŒåŠ å…¥80"></a>çœ‹çƒ­é—¹ä¸å«Œäº‹å¤§ï¼ŒåŠ å…¥80</h4><h5 id="æ–°å»ºä¸€ä¸ªcloud-consumer-feign-hystrix-order80"><a href="#æ–°å»ºä¸€ä¸ªcloud-consumer-feign-hystrix-order80" class="headerlink" title="æ–°å»ºä¸€ä¸ªcloud-consumer-feign-hystrix-order80"></a>æ–°å»ºä¸€ä¸ªcloud-consumer-feign-hystrix-order80</h5><p>å‚è€ƒä¹‹å‰çš„80</p><h5 id="pom-4"><a href="#pom-4" class="headerlink" title="pom"></a>pom</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="yml-4"><a href="#yml-4" class="headerlink" title="yml"></a>yml</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure><p>controlleré‡Œé¢è®¿é—®8001ï¼Œå…·ä½“çš„çœ‹ä»£ç </p><p>å°†80å¯åŠ¨ï¼Œæˆ‘ä»¬å†å¯åŠ¨jmeterå»å‹æµ‹8001ï¼ŒåŒæ—¶æˆ‘ä»¬åœ¨ç½‘é¡µå»è®¿é—®80ï¼Œå› ä¸º80è°ƒç”¨äº†8001ï¼Œæ‰€ä»¥80çš„è°ƒ8001çš„é‚£ä¸ªæœåŠ¡å“åº”çš„æ—¶é—´ä¹Ÿå˜æ…¢äº†ï¼Œå¦‚æœè¿æ°”å¥½çš„è¯è¿˜å¯èƒ½ä¼šç¢°åˆ°è¶…æ—¶ï¼Œå› ä¸ºfeigné»˜è®¤æ˜¯è¶…æ—¶æ—¶é—´æ˜¯1ç§’</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525084915511.png" alt="image-20200525084915511"></p><h3 id="æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› "><a href="#æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› " class="headerlink" title="æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› "></a>æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› </h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525085220088.png" alt="image-20200525085220088"></p><h3 id="ä¸Šè¿°ç»“è®º"><a href="#ä¸Šè¿°ç»“è®º" class="headerlink" title="ä¸Šè¿°ç»“è®º"></a>ä¸Šè¿°ç»“è®º</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525090403534.png" alt="image-20200525090403534"></p><h3 id="å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚"><a href="#å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚" class="headerlink" title="å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚"></a>å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525090301764.png" alt="image-20200525090301764"></p><h3 id="star-æœåŠ¡é™çº§"><a href="#star-æœåŠ¡é™çº§" class="headerlink" title=":star:æœåŠ¡é™çº§"></a>:star:æœåŠ¡é™çº§</h3><h4 id="é™çº§é…ç½®"><a href="#é™çº§é…ç½®" class="headerlink" title="é™çº§é…ç½®"></a>é™çº§é…ç½®</h4><p>ä½¿ç”¨@HystrixCommand</p><h4 id="8001è‡ªèº«"><a href="#8001è‡ªèº«" class="headerlink" title="8001è‡ªèº«"></a>8001è‡ªèº«</h4><p>è®¾ç½®è‡ªèº«è¶…æ—¶æ—¶é—´å³°å€¼ï¼Œå³°å€¼å†…æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•æ–¹æ¡ˆï¼ŒåšæœåŠ¡é™çº§fallbake</p><h4 id="8001fallback"><a href="#8001fallback" class="headerlink" title="8001fallback"></a>8001fallback</h4><p>ä¿®æ”¹service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨@HystrixCommandæ¥æŒ‡å®šå…œåº•æ–¹æ¡ˆï¼Œå½“å‘ç”Ÿå¼‚å¸¸ä¼šè‡ªåŠ¨è°ƒç”¨timeoutHandle</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;timeoutHandle&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        // è¿™é‡Œè®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">timeout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> timeout = <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ•…æ„å¼„ä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è¶…æ—¶5ç§’</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(timeout);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString()+<span class="string">&quot;  è¶…æ—¶&quot;</span>+timeout+<span class="string">&quot;ç§’&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">timeoutHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å‘œå‘œå‘œï¼Œç³»ç»Ÿç¹å¿™&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ok</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok   &quot;</span>+UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä½¿ç”¨@HystrixCommandéœ€è¦åœ¨ä¸»é…ç½®ç±»ä¸­æ·»åŠ @EnableCircuitBreakeræ³¨è§£å¼€å¯åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentHystrisMain8001</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrisMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="80fallbake"><a href="#80fallbake" class="headerlink" title="80fallbake"></a>80fallbake</h4><h5 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h5><p>æˆ‘ä»¬è‡ªå·±é…ç½®è¿‡çš„çƒ­éƒ¨ç½²æ–¹å¼å¯¹avaä»£ç çš„æ”¹åŠ¨æ˜æ˜¾ï¼Œ</p><p>ä½†å¯¹ï¼ Hystrix Commandå†…å±æ€§çš„ä¿®æ”¹å»ºè®®é‡å¯å¾®æœåŠ¡</p><h5 id="ä¸šåŠ¡ç±»-1"><a href="#ä¸šåŠ¡ç±»-1" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/order/payment/timeout&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;timeoutHandle&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">    @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;2000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">timeout</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> paymentFeignService.timeout();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">timeoutHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;qwq&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸»é…ç½®ç±»"><a href="#ä¸»é…ç½®ç±»" class="headerlink" title="ä¸»é…ç½®ç±»"></a>ä¸»é…ç½®ç±»</h5><p>æ·»åŠ @EnableHystrixæ³¨è§£ï¼Œå¼€å¯åŠŸèƒ½</p><h4 id="ç›®å‰é—®é¢˜"><a href="#ç›®å‰é—®é¢˜" class="headerlink" title="ç›®å‰é—®é¢˜"></a>ç›®å‰é—®é¢˜</h4><p>æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€</p><p>ç»Ÿä¸€å’Œè‡ªå®šä¹‰çš„åˆ†å¼€</p><h4 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h4><h5 id="æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€"><a href="#æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€" class="headerlink" title="æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€"></a>æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€</h5><p><strong>ï¼ Default Propertiesï¼ˆdefaultFallback=â€œâ€œï¼‰</strong></p><p><strong>è¯´æ˜ï¼š</strong></p><blockquote><p>  1:1æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªæœåŠ¡é™çº§æ–¹æ³•ï¼ŒæŠ€æœ¯ä¸Šå¯ä»¥ï¼Œå®é™…ä¸Šå‚»X</p><p>  1:Né™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±ï¼Œå…¶å®ƒæ™®é€šçš„å¯ä»¥é€šè¿‡ï¼  DefaultPropertiesï¼ˆdefault Fallback=â€œï¼‰ç»Ÿä¸€è·³è½¬åˆ°ç»Ÿâ€”å¤„ç†ç»“æœé¡µé¢</p><p>  é€šç”¨çš„å’Œç‹¬äº«çš„å„è‡ªåˆ†å¼€ï¼Œé¿å…”äº†ä»£ç è†¨èƒ€ï¼Œåˆç†å‡å°‘äº†ä»£ç é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">// åŠ ä¸Šè¿™ä¸ªæ³¨è§£é…ç½®å…¨å±€å±æ€§ï¼Œè¿™é‡Œé…ç½®äº†ä¸€ä¸ªé»˜è®¤çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;globalHandle&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/payment/ok&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ok</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/payment/timeout&quot;)</span></span><br><span class="line"><span class="comment">//    @HystrixCommand(fallbackMethod = &quot;timeoutHandle&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="comment">//            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;2000&quot;)</span></span><br><span class="line"><span class="comment">//    &#125;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand</span> <span class="comment">// å½“æœªæŒ‡å®šfallbackMethodçš„æ—¶å€™å°±ä¼šè°ƒç”¨é»˜è®¤çš„</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">timeout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.timeout();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">timeoutHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;qwq&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">globalHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…¨å±€å¤„ç†å¼‚å¸¸&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±"><a href="#å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±" class="headerlink" title="å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±"></a>å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±</h5><ul><li><p>  æœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­</p></li><li><p>æœ¬æ¬¡æ¡ˆä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»</p><p>  åªéœ€è¦ä¸º Feignå®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦</p></li><li><p>æœªæ¥æˆ‘ä»¬è¦é¢å¯¹çš„å¼‚å¸¸</p><ul><li>  è¿è¡Œ</li><li>  è¶…æ—¶</li><li>  å®•æœº</li></ul></li></ul><p><strong>ä¿®æ”¹cloud-consumer-feign-hystrix-order80</strong></p><blockquote><p>  æ ¹æ®cloud-consumer-feign-hystrix-order80å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±»ï¼ˆ <strong>PaymentFallbackService</strong>ï¼‰å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†</p></blockquote><ul><li><p><strong>yml</strong></p><ul><li>```yml<br>  feign:<pre><code>hystrix:  enabled: true # å¼€å¯feignå¯¹hystrixçš„æ”¯æŒ</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+   PaymentFallbackService</span><br><span class="line"></span><br><span class="line">    +   &#96;&#96;&#96;java</span><br><span class="line">        @Component</span><br><span class="line">        public class PaymentFallbackService implements PaymentFeignService &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String ok() &#123;</span><br><span class="line">                return &quot;not ok!!! qwq&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">            @Override</span><br><span class="line">            public String timeout() &#123;</span><br><span class="line">                return &quot;timeout qwq&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>PaymentFeignServiceæ¥å£</p><ul><li>```java<br>  @Component<br>  // æ·»åŠ ä¸€ä¸ªfallbackå±æ€§ï¼ŒæŒ‡å®šå‡ºç°å¼‚å¸¸æ—¶çš„å…œåº•æ–¹æ¡ˆ<br>  @FeignClient(value = â€œCLOUD-PAYMENT-SERVICEâ€, fallback = PaymentFallbackService.class)<br>  public interface PaymentFeignService {<pre><code>  @GetMapping(&quot;/payment/ok&quot;)  String ok();  @GetMapping(&quot;/payment/timeout&quot;)  String timeout();</code></pre>  }  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### :star:æœåŠ¡ç†”æ–­</span><br><span class="line"></span><br><span class="line">#### æ˜¯ä»€ä¹ˆ</span><br><span class="line"></span><br><span class="line">&gt;   ç†”æ–­æœºåˆ¶æ¦‚è¿°</span><br><span class="line">&gt;</span><br><span class="line">&gt;   ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å²€é“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…æ™Œåº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œ</span><br><span class="line">&gt;</span><br><span class="line">&gt;   ä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚</span><br><span class="line">&gt;</span><br><span class="line">&gt;   å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯</span><br><span class="line">&gt;</span><br><span class="line">&gt;   åœ¨ Spring Cloudæ¡†æ¶é‡Œï¼Œç†”æ–­æœºåˆ¶é€šè¿‡ Hystrixå®ç°ã€‚ Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œ</span><br><span class="line">&gt;</span><br><span class="line">&gt;   å½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯ï¼ HystrixCommandã€‚</span><br><span class="line"></span><br><span class="line">#### å®æ“</span><br><span class="line"></span><br><span class="line">**ä¿®æ”¹coud-provider-hystrix-payment8001**</span><br><span class="line"></span><br><span class="line">+   PaymentService</span><br><span class="line"></span><br><span class="line">    åœ¨PaymentServiceæ·»åŠ ä»¥ä¸‹æ–¹æ³•</span><br><span class="line"></span><br><span class="line">    &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F;--------æœåŠ¡ç†”æ–­</span><br><span class="line">    @HystrixCommand(fallbackMethod &#x3D; &quot;paymentCircuitBreaker_fallback&quot;,commandProperties &#x3D; &#123;</span><br><span class="line">        @HystrixProperty(name &#x3D; &quot;circuitBreaker.enabled&quot;,value &#x3D; &quot;true&quot;),&#x2F;&#x2F; æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span><br><span class="line">        @HystrixProperty(name &#x3D; &quot;circuitBreaker.requestVolumeThreshold&quot;,value &#x3D; &quot;10&quot;),&#x2F;&#x2F; è¯·æ±‚æ¬¡æ•°</span><br><span class="line">        @HystrixProperty(name &#x3D; &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value &#x3D; &quot;10000&quot;), &#x2F;&#x2F; æ—¶é—´çª—å£æœŸ</span><br><span class="line">        @HystrixProperty(name &#x3D; &quot;circuitBreaker.errorThresholdPercentage&quot;,value &#x3D; &quot;60&quot;),&#x2F;&#x2F; å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span><br><span class="line">    &#125;)</span><br><span class="line">    public String paymentCircuitBreaker(Integer id)</span><br><span class="line">    &#123;</span><br><span class="line">        if(id &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new RuntimeException(&quot;******id ä¸èƒ½è´Ÿæ•°&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        String serialNumber &#x3D; IdUtil.simpleUUID();</span><br><span class="line">    </span><br><span class="line">        return Thread.currentThread().getName()+&quot;\t&quot;+&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot; + serialNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    public String paymentCircuitBreaker_fallback(Integer id)</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ&#x2F;(ã„’oã„’)&#x2F;~~   id: &quot; +id;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>PaymentController</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/break/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">breaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> paymentService.paymentCircuitBreaker(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>  æµ‹è¯•ï¼šåœ¨10æ¬¡è¯·æ±‚ä¸­å¦‚æœæœ‰6æ¬¡åŠä»¥ä¸Šçš„é”™è¯¯ï¼Œå°±ä¼šè§¦å‘ç†”æ–­ï¼Œè¿™æ—¶å†æ¬¡å‘é€æ­£ç¡®çš„è¯·æ±‚ä¹Ÿä¼šè¿”å›fallbakeæç¤º</p></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>ç†”æ–­ç±»å‹ï¼š</strong></p><ul><li><p>  ç†”æ–­æ‰“å¼€ï¼šè¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½©æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTRï¼ˆå¹³å‡æ•…éšœå¤„ç†æ—¶é—´ï¼‰ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥åŠç†”æ–­çŠ¶æ€</p></li><li><p>  ç†”æ–­å…³é—­ï¼šç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</p></li><li><p>  ç†”æ–­åŠå¼€ï¼šéƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­</p></li></ul><h4 id="å®˜ç½‘æ–­è·¯å™¨æµç¨‹"><a href="#å®˜ç½‘æ–­è·¯å™¨æµç¨‹" class="headerlink" title="å®˜ç½‘æ–­è·¯å™¨æµç¨‹"></a>å®˜ç½‘æ–­è·¯å™¨æµç¨‹</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525113443796.png" alt="image-20200525113443796"></p><h5 id="æ–­è·¯å™¨åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹èµ·ä½œç”¨"><a href="#æ–­è·¯å™¨åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹èµ·ä½œç”¨" class="headerlink" title="æ–­è·¯å™¨åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹èµ·ä½œç”¨"></a>æ–­è·¯å™¨åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹èµ·ä½œç”¨</h5><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525113549607.png" alt="image-20200525113549607"></p><h5 id="æ–­è·¯å™¨å¼€å¯æˆ–å…³é—­çš„æ¡ä»¶"><a href="#æ–­è·¯å™¨å¼€å¯æˆ–å…³é—­çš„æ¡ä»¶" class="headerlink" title="æ–­è·¯å™¨å¼€å¯æˆ–å…³é—­çš„æ¡ä»¶"></a>æ–­è·¯å™¨å¼€å¯æˆ–å…³é—­çš„æ¡ä»¶</h5><ol><li><p> å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°ï¼‰</p></li><li><p> å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50ï¼…çš„è¯·æ±‚å¤±è´¥ï¼‰</p></li><li><p> åˆ°è¾¾ä»¥ä¸Šé˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯</p></li><li><p> å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘</p></li><li><p> ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚</p></li><li><p> å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤4å’Œ5</p></li></ol><h5 id="æ–­è·¯å™¨æ‰“å¼€ä¹‹å"><a href="#æ–­è·¯å™¨æ‰“å¼€ä¹‹å" class="headerlink" title="æ–­è·¯å™¨æ‰“å¼€ä¹‹å"></a>æ–­è·¯å™¨æ‰“å¼€ä¹‹å</h5><ol><li><p> å†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§ fallbackã€‚é€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘æ™Œåº”å»¶è¿Ÿçš„æ•ˆæœ</p></li><li><p>åŸæ¥çš„ä¸»é€»è¾‘è¦å¦‚ä½•æ¢å¤å‘¢ï¼Ÿ</p><p> å¯¹äºè¿™ä¸€é—®é¢˜ï¼Œ hystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œ hystrixä¼šå¯åŠ¨â€”ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ä¼šé—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œå¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚</p></li></ol><h3 id="æœåŠ¡ç›‘æ§-hystrixDashboard"><a href="#æœåŠ¡ç›‘æ§-hystrixDashboard" class="headerlink" title="æœåŠ¡ç›‘æ§ hystrixDashboard"></a>æœåŠ¡ç›‘æ§ hystrixDashboard</h3><h4 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><blockquote><p>  é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–, Hystriâ…¸è¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§( Hystrix Dashboard), Hystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡ Hystâ…¸å‘  èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯,å¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·,åŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸ,å¤šå°‘å¤±è´¥ç­‰ã€‚ Netflixé€šè¿‡  hystrix-metrIcs-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚ Spring Cloudä¹Ÿæä¾›äº† Hystrix Dashboardçš„æ•´åˆ,å¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚</p></blockquote><h4 id="ä»ªè¡¨ç›˜9001"><a href="#ä»ªè¡¨ç›˜9001" class="headerlink" title="ä»ªè¡¨ç›˜9001"></a>ä»ªè¡¨ç›˜9001</h4><ol><li><p><strong>æ–°å»ºcloud-consumer-hystrixdashboard9001</strong></p><ol><li><p>```xml</p> <dependency>     <groupId>org.springframework.cloud</groupId>     <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId> </dependency> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2.  &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port: 9001</span><br></pre></td></tr></table></figure></li><li><p>```java<br> @SpringBootApplication<br> // ä½¿ç”¨è¿™ä¸ªæ³¨è§£å¼€å¯Hystrixå›¾å½¢ç›‘æ§åŠŸèƒ½<br> @EnableHystrixDashboard<br> public class HystrixDashboardMain9001 {</p><pre><code> public static void main(String[] args) &#123;     SpringApplication.run(HystrixDashboardMain9001.class, args); &#125;</code></pre><p> }</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    4.  è®¿é—®ï¼šhttp:&#x2F;&#x2F;localhost:9001&#x2F;hystrix</span><br><span class="line"></span><br><span class="line">        å¦‚æœå‡ºç°ä»¥ä¸‹ç•Œé¢åˆ™æˆåŠŸ</span><br><span class="line"></span><br><span class="line">        ![image-20200525155420212](README.assets&#x2F;image-20200525155420212.png)</span><br><span class="line"></span><br><span class="line">#### æ–­è·¯å™¨æ¼”ç¤º(æœåŠ¡ç›‘æ§ hystrixDashboard)</span><br><span class="line"></span><br><span class="line">#### 9001ç›‘æ§8001</span><br><span class="line"></span><br><span class="line">**ä¿®æ”¹8001**</span><br><span class="line"></span><br><span class="line">&gt;   æ·»åŠ è¿™ä¸ªç»„ä»¶åˆ°å®¹å™¨é‡Œé¢</span><br><span class="line">&gt;</span><br><span class="line">&gt;   &#96;&#96;&#96;java</span><br><span class="line">&gt;   &#x2F;**</span><br><span class="line">&gt;        *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span><br><span class="line">&gt;        *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;&#x2F;hystrix.stream&quot;ï¼Œ</span><br><span class="line">&gt;        *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span><br><span class="line">&gt;        *&#x2F;</span><br><span class="line">&gt;   @Bean</span><br><span class="line">&gt;   public ServletRegistrationBean getServlet() &#123;</span><br><span class="line">&gt;       HystrixMetricsStreamServlet streamServlet &#x3D; new HystrixMetricsStreamServlet();</span><br><span class="line">&gt;       ServletRegistrationBean registrationBean &#x3D; new ServletRegistrationBean(streamServlet);</span><br><span class="line">&gt;       registrationBean.setLoadOnStartup(1);</span><br><span class="line">&gt;       registrationBean.addUrlMappings(&quot;&#x2F;hystrix.stream&quot;);</span><br><span class="line">&gt;       registrationBean.setName(&quot;HystrixMetricsStreamServlet&quot;);</span><br><span class="line">&gt;       return registrationBean;</span><br><span class="line">&gt;   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>  å¦‚æœä¸åŠ å°±ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯<code>Unable to connect to Command Metric Stream.</code></p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525162858622.png" alt="image-20200525162858622"></p><p>  æµ‹è¯•ï¼šåœ¨æ¡†æ¡†é‡Œè¾“å…¥è¦ç›‘æ§çš„å¾®æœåŠ¡ï¼Œhttp://å¾®æœåŠ¡åœ°å€/hystrix.stream</p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525163340606.png" alt="image-20200525163340606"></p><p>  æˆåŠŸä¹‹åå°±ä¼šè¿›å…¥åˆ°ä»ªè¡¨ç›˜çš„ç•Œé¢ï¼š</p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525163637779.png" alt="image-20200525163637779"></p></blockquote></li></ol></li></ol><h5 id="å¦‚ä½•çœ‹"><a href="#å¦‚ä½•çœ‹" class="headerlink" title="å¦‚ä½•çœ‹"></a>å¦‚ä½•çœ‹</h5><h6 id="ä¸€åœˆ"><a href="#ä¸€åœˆ" class="headerlink" title="ä¸€åœˆ"></a>ä¸€åœˆ</h6><blockquote><p>  å®å¿ƒåœ†:å…±æœ‰ä¸¤ç§å«ä¹‰ã€‚å®ƒé€šè¿‡é¢œè‰²çš„å˜åŒ–ä»£è¡¨äº†å®ä¾‹çš„å¥åº·ç¨‹åº¦,å®ƒçš„å¥åº·åº¦ä»ç»¿è‰²&lt;é»„è‰²&lt;æ©™è‰²&lt;çº¢è‰²é€’å‡ </p><p>  è¯¥å®å¿ƒåœ†é™¤äº†é¢œè‰²çš„å˜åŒ–ä¹‹å¤–,å®ƒçš„å¤§å°ä¹Ÿä¼šæ ¹æ®å®ä¾‹çš„è¯·æ±‚æµé‡å‘ç”Ÿå˜åŒ–,æµé‡è¶Šå¤§è¯¥å®å¿ƒåœ†å°±è¶Šå¤§ã€‚æ‰€ä»¥é€šè¿‡è¯¥å®å¿ƒåœ†çš„å±•ç¤º,å°±  å¯ä»¥åœ¨å¤§é‡çš„å®ä¾‹ä¸­å¿«é€Ÿçš„å‘ç°<strong>æ•…éšœå®ä¾‹å’Œé«˜å‹åŠ›å®ä¾‹ã€‚</strong></p></blockquote><h6 id="ä¸€çº¿"><a href="#ä¸€çº¿" class="headerlink" title="ä¸€çº¿"></a>ä¸€çº¿</h6><p>æ›²çº¿ï¼šç”¨æ¥è®°å½•2åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–,å¯ä»¥é€šè¿‡å®ƒæ¥è§‚å¯Ÿåˆ°æµé‡çš„ä¸Šå‡å’Œä¸‹é™è¶‹åŠ¿ã€‚</p><h6 id="æ•´å›¾è¯´æ˜"><a href="#æ•´å›¾è¯´æ˜" class="headerlink" title="æ•´å›¾è¯´æ˜"></a>æ•´å›¾è¯´æ˜</h6><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525161705175.png" alt="image-20200525161705175"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525161722240.png" alt="image-20200525161722240"></p><h3 id="star-æœåŠ¡é™æµ"><a href="#star-æœåŠ¡é™æµ" class="headerlink" title=":star:æœåŠ¡é™æµ"></a>:star:æœåŠ¡é™æµ</h3><h1 id="å…«ã€GateWayæ–°ä¸€ä»£ç½‘å…³"><a href="#å…«ã€GateWayæ–°ä¸€ä»£ç½‘å…³" class="headerlink" title="å…«ã€GateWayæ–°ä¸€ä»£ç½‘å…³"></a>å…«ã€GateWayæ–°ä¸€ä»£ç½‘å…³</h1><h2 id="æ¦‚è¿°ç®€ä»‹"><a href="#æ¦‚è¿°ç®€ä»‹" class="headerlink" title="æ¦‚è¿°ç®€ä»‹"></a>æ¦‚è¿°ç®€ä»‹</h2><h3 id="æ˜¯ä»€ä¹ˆ-4"><a href="#æ˜¯ä»€ä¹ˆ-4" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p>  Gatewayæ˜¯åœ¨ Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APç½‘å…³æœåŠ¡,åŸºäº Spring5, Spring Boot2å’Œ Project Reactorç­‰æŠ€æœ¯  Gatewayæ—¨åœ¨æä¾›_ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APè¿›è¡Œè·¯ç”±,ä»¥æä¾›äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½,ä¾‹å¦‚:ç†”æ–­ã€é™æµã€é‡è¯•ç­‰</p><p>  SpringCloud Gateway æ˜¯Spring Cloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäºSpring 5.0+Spring Boot 2.0å’ŒProject Reactor ç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p><p>  Spring Cloud Gatewayä½œä¸º Spring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³,ç›®æ ‡æ˜¯æ›¿ä»£zuul,åœ¨ Spring Cloud2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­,æ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„zuul2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆ,ä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„zuul 1.xé Reactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½, SpringCloud Gatewayæ˜¯åŸºäº WebFluxlæ¡†æ¶å®ç°çš„,è€Œ WebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„ Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Netty</p><p>  Spring Cloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½,ä¾‹å¦‚:å®‰å…¨,ç›‘æ§/æŒ‡æ ‡,å’Œé™æµ</p></blockquote><p><strong>ä¸€å¥è¯ï¼š</strong> Spring Cloud Gatewayä½¿ç”¨çš„ Webfluxä¸­çš„reactor-nettyå“åº”å¼ç¼–ç¨‹ç»„ä»¶,åº•å±‚ä½¿ç”¨äº† Netty é€šè®¯æ¡†æ¶ã€‚</p><h3 id="èƒ½å¹²å˜›-2"><a href="#èƒ½å¹²å˜›-2" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><ul><li>  åå‘ä»£ç†</li><li>  é‰´æƒ</li><li>  æµé‡</li><li>  æ§åˆ¶</li><li>  ç†”æ–­</li><li>  æ—¥å¿—ç›‘æ§</li><li>  ã€‚ã€‚ã€‚</li></ul><h3 id="å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³åœ¨å“ªé‡Œ"><a href="#å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³åœ¨å“ªé‡Œ" class="headerlink" title="å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³åœ¨å“ªé‡Œ"></a>å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³åœ¨å“ªé‡Œ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525170114159.png" alt="image-20200525170114159"></p><h2 id="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="Route-è·¯ç”±"><a href="#Route-è·¯ç”±" class="headerlink" title="Route(è·¯ç”±)"></a>Route(è·¯ç”±)</h3><p>è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—,å®ƒç”±ID,ç›®æ ‡URI,ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆ,å¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</p><h3 id="Predicate-æ–­è¨€"><a href="#Predicate-æ–­è¨€" class="headerlink" title="Predicate(æ–­è¨€)"></a>Predicate(æ–­è¨€)</h3><p>å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicate<br>å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</p><h3 id="Filter-è¿‡æ»¤"><a href="#Filter-è¿‡æ»¤" class="headerlink" title="Filter(è¿‡æ»¤)"></a>Filter(è¿‡æ»¤)</h3><p>æŒ‡çš„æ˜¯ Springæ¡†æ¶ä¸­ Gateway Filterçš„å®ä¾‹,ä½¿ç”¨è¿‡æ»¤å™¨,å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="æ€»ä½“"><a href="#æ€»ä½“" class="headerlink" title="æ€»ä½“"></a>æ€»ä½“</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525171426906.png" alt="image-20200525171426906"></p><p>webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­¢çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚<br>predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚æœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº†</p><h2 id="Gatewayå·¥ä½œæµç¨‹"><a href="#Gatewayå·¥ä½œæµç¨‹" class="headerlink" title="Gatewayå·¥ä½œæµç¨‹"></a>Gatewayå·¥ä½œæµç¨‹</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200525171907990.png" alt="image-20200525171907990"></p><blockquote><p>  å®¢æˆ·ç«¯å‘ Spring Cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±,å°†å…¶å‘é€åˆ° Gateway  Web Handler.      </p><p>  Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘,ç„¶åè¿”å›ã€‚  </p><p>  è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰(â€œpreâ€)æˆ–ä¹‹å(postâ€)æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚      </p><p>  Filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰,  åœ¨â€œpostç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹,æ—¥å¿—çš„è¾“å‡º,æµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p></blockquote><p><strong>æ ¸å¿ƒé€»è¾‘ï¼š</strong> è·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p><h2 id="å…¥é—¨é…ç½®"><a href="#å…¥é—¨é…ç½®" class="headerlink" title="å…¥é—¨é…ç½®"></a>å…¥é—¨é…ç½®</h2><h3 id="æ–°å»º-Module"><a href="#æ–°å»º-Module" class="headerlink" title="æ–°å»º Module"></a>æ–°å»º Module</h3><p>cloud-gateway-gateway9527</p><h4 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h4><p><strong>æ³¨æ„ï¼šgatewayä¸éœ€è¦webå’ŒactuatoråŒ…</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--gateway--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="YML"><a href="#YML" class="headerlink" title="YML"></a>YML</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»-2"><a href="#ä¸šåŠ¡ç±»-2" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><p>ç½‘å…³è«å¾—ä¸šåŠ¡ï¼Œå˜¿å˜¿å˜¿:laughing:</p><h4 id="ä¸»å¯åŠ¨ç±»-2"><a href="#ä¸»å¯åŠ¨ç±»-2" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayMain9527</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GatewayMain9527.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9527ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„é‚£"><a href="#9527ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„é‚£" class="headerlink" title="9527ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„é‚£??"></a>9527ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„é‚£??</h4><p>8001 çš„ controller çš„ä¸¤ä¸ªè¯·æ±‚è·¯å¾„/payment/okå’Œ/payment/break</p><p>æˆ‘ä»¬ç›®å‰ä¸æƒ³æš´éœ²8001ç«¯å£,å¸Œæœ›åœ¨8001å¤–é¢å¥—ä¸€å±‚9527</p><p>çœ‹ä¸‹é¢çš„é…ç½®:arrow_double_down:</p><h4 id="YMLæ–°å¢ç½‘å…³é…ç½®"><a href="#YMLæ–°å¢ç½‘å…³é…ç½®" class="headerlink" title="YMLæ–°å¢ç½‘å…³é…ç½®"></a>YMLæ–°å¢ç½‘å…³é…ç½®</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">    <span class="comment">#----------ä»è¿™é‡Œå¼€å§‹å°±æ˜¯å¯¹è·¯ç”±çš„é…ç½®å•¦</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>          <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">            <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/ok</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>          <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">            <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/break/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-9"><a href="#æµ‹è¯•-9" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><h4 id="YMLé…ç½®è¯´æ˜"><a href="#YMLé…ç½®è¯´æ˜" class="headerlink" title="YMLé…ç½®è¯´æ˜"></a>YMLé…ç½®è¯´æ˜</h4><p>gatewayçš„ç½‘å…³è·¯ç”±é…ç½®æ–¹å¼æœ‰ä¸¤ç§</p><ul><li><p>ç¬¬ä¸€ç§æ˜¯yamlé…ç½®</p><ul><li>  çœ‹å‰é¢çš„é…ç½®ğŸ˜’</li></ul></li><li><p>ç¬¬äºŒç§æ˜¯ä»£ç ä¸­æ³¨å…¥Routelocatorçš„Bean</p><ul><li>```java<br>  // è¾“å…¥<a href="http://localhost:9527/guonei%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8F%91%E5%88%B0http://news.baidu.com/guonei">http://localhost:9527/guoneiä¼šè‡ªåŠ¨è½¬å‘åˆ°http://news.baidu.com/guonei</a><br>  @Configuration<br>  public class GateWayConfig<br>  {<pre><code>  @Bean  public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder)  &#123;      RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes();      routes.route(&quot;path_route_atguigu&quot;,              r -&gt; r.path(&quot;/guonei&quot;)                      .uri(&quot;http://news.baidu.com/guonei&quot;)).build();      return routes.build();  &#125;</code></pre>  }  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    +   &lt;img src&#x3D;&quot;README.assets&#x2F;2.gif&quot; alt&#x3D;&quot;qwq&quot; style&#x3D;&quot;zoom:200%;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</span><br><span class="line"></span><br><span class="line">&gt;   é»˜è®¤æƒ…å†µä¸‹ Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨,  ä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘,ä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">æµ‹è¯•æ¡ä»¶ï¼š7001å’Œ8001ã€8002</span><br><span class="line"></span><br><span class="line">**yml**</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;yaml</span><br><span class="line">server:</span><br><span class="line">  port: 9527</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-gateway</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      discovery:</span><br><span class="line">        locator:</span><br><span class="line">          enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span><br><span class="line">      routes:</span><br><span class="line">      - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span><br><span class="line">        uri: lb:&#x2F;&#x2F;cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span><br><span class="line">        predicates:</span><br><span class="line">        - Path&#x3D;&#x2F;payment&#x2F;ok         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span><br><span class="line"></span><br><span class="line">      - id: payment_routh2 #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span><br><span class="line">        uri: lb:&#x2F;&#x2F;cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span><br><span class="line">        predicates:</span><br><span class="line">        - Path&#x3D;&#x2F;payment&#x2F;timeout         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: cloud-gateway-service</span><br><span class="line">  client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span><br><span class="line">    service-url:</span><br><span class="line">      register-with-eureka: true</span><br><span class="line">      fetch-registry: true</span><br><span class="line">      defaultZone: http:&#x2F;&#x2F;eureka7001:7001&#x2F;eureka</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>æµ‹è¯•</strong></p><p>ç½‘å€è¾“å…¥ï¼š<a href="http://localhost:9527/payment/ok">http://localhost:9527/payment/ok</a></p><p>çœ‹çœ‹æœ‰æ²¡æœ‰äº¤æ›¿å‡ºç°8001å’Œ8002çš„ç«¯å£å·</p><h2 id="Predicateçš„ä½¿ç”¨"><a href="#Predicateçš„ä½¿ç”¨" class="headerlink" title="Predicateçš„ä½¿ç”¨"></a>Predicateçš„ä½¿ç”¨</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/20190422215919986.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="AfterRoutePredicateFactory"><a href="#AfterRoutePredicateFactory" class="headerlink" title="AfterRoutePredicateFactory"></a>AfterRoutePredicateFactory</h3><p>â€ƒæ—¶é—´ç±»å‹çš„Predicate ï¼ˆAfterRoutePredicateFactory BeforeRoutePredicateFactory BetweenRoutePredicateFactoryï¼‰ï¼Œå½“åªæœ‰æ»¡è¶³ç‰¹å®šæ—¶é—´è¦æ±‚çš„è¯·æ±‚ä¼šè¿›å…¥åˆ°æ­¤predicateä¸­ï¼Œå¹¶äº¤ç”±routerå¤„ç†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">after_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">After=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br></pre></td></tr></table></figure><p>predicatesï¼š</p><p><code>- After=2017-01-20T17:42:47.789-07:00[America/Denver]</code> ä¼šè¢«è§£ææˆPredicateDefinitionå¯¹è±¡ <code>ï¼ˆname =After ï¼Œargs= 2017-01-20T17:42:47.789-07:00[America/Denver]ï¼‰</code>ã€‚predicatesçš„é…ç½®ï¼Œéµå¾ªçš„çº¦å®šå¤§äºé…ç½®çš„æ€æƒ³ï¼Œè¿™ä¸ªAfterå°±æ˜¯æŒ‡å®šäº†å®ƒçš„å¤„ç†ç±»ä¸ºAfterRoutePredicateFactoryï¼ŒåŒç†ï¼Œå…¶ä»–ç±»å‹çš„predicateä¹Ÿéµå¾ªè¿™ä¸ªè§„åˆ™ã€‚</p><p>å½“è¯·æ±‚çš„æ—¶é—´åœ¨è¿™ä¸ªé…ç½®çš„æ—¶é—´ä¹‹åï¼Œè¯·æ±‚ä¼šè¢«è·¯ç”±åˆ° <a href="http://example.org/">http://example.org</a></p><p>â€ƒå¯åŠ¨å·¥ç¨‹ï¼Œåœ¨æµè§ˆå™¨ä¸Šè®¿é—® <a href="http://localhost:8081/%EF%BC%8C%E4%BC%9A%E6%98%BE%E7%A4%BA">http://localhost:8081/ï¼Œä¼šæ˜¾ç¤º</a> <a href="http://example.org/">http://example.org</a> è¿”å›çš„ç»“æœï¼Œæ­¤æ—¶gatewayè·¯ç”±åˆ°äº†é…ç½®çš„uriã€‚å¦‚æœæˆ‘ä»¬å°†é…ç½®çš„æ—¶é—´è®¾ç½®åˆ°å½“å‰æ—¶ä¹‹åï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤º404ï¼Œæ­¤æ—¶è¯æ˜æ²¡æœ‰è·¯ç”±åˆ°é…ç½®çš„uriã€‚</p><h3 id="CookieRoutePredicateFactory"><a href="#CookieRoutePredicateFactory" class="headerlink" title="CookieRoutePredicateFactory"></a>CookieRoutePredicateFactory</h3><p>â€ƒcookieç±»å‹çš„<code>CookieRoutePredicateFactory</code>ï¼ŒæŒ‡å®šçš„cookieæ»¡è¶³æ­£åˆ™åŒ¹é…ï¼Œæ‰ä¼šè¿›å…¥æ­¤routerã€‚<br>CookieRoute <code>PredicateFactory</code>éœ€è¦2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯cookieåå­—ï¼Œå¦ä¸€ä¸ªæ˜¯å€¼ä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒç”¨äºåŒ¹é…è¯·æ±‚ä¸­ï¼Œå¸¦æœ‰è¯¥åç§°çš„cookieå’ŒcookieåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„è¯·æ±‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cookie_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Cookie=name,</span> <span class="string">forezp</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œè¯·æ±‚å¸¦æœ‰cookieåä¸ºname, cookieå€¼ä¸ºforezp çš„è¯·æ±‚å°†éƒ½ä¼šè½¬å‘åˆ°uriä¸º <a href="http://example.org/">http://example.org</a> çš„åœ°å€ä¸Šã€‚</p><p>ä½¿ç”¨curlå‘½ä»¤è¿›è¡Œè¯·æ±‚ï¼Œåœ¨è¯·æ±‚ä¸­å¸¦ä¸Š cookieï¼Œä¼šè¿”å›æ­£ç¡®çš„ç»“æœï¼Œå¦åˆ™ï¼Œè¯·æ±‚æŠ¥404é”™è¯¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -H <span class="string">&#x27;Cookie:name=forezp&#x27;</span> localhost:8081</span></span><br></pre></td></tr></table></figure><h3 id="HeaderRoutePredicateFactory"><a href="#HeaderRoutePredicateFactory" class="headerlink" title="HeaderRoutePredicateFactory"></a>HeaderRoutePredicateFactory</h3><p>â€ƒ<code>HeaderRoutePredicateFactory</code>éœ€è¦2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯headeråï¼Œå¦å¤–ä¸€ä¸ªheaderå€¼ï¼Œè¯¥å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚å½“æ­¤æ–­è¨€åŒ¹é…äº†è¯·æ±‚çš„headeråå’Œå€¼æ—¶ï¼Œæ–­è¨€é€šè¿‡ï¼Œè¿›å…¥åˆ°routerçš„è§„åˆ™ä¸­å»ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">header_route</span></span><br><span class="line">         <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">         <span class="attr">predicates:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><p>â€ƒåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå½“è¯·æ±‚çš„Headerä¸­æœ‰X-Request-Idçš„headeråï¼Œä¸”headerå€¼ä¸ºæ•°å­—æ—¶ï¼Œè¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°é…ç½®çš„ uri. ä½¿ç”¨curlæ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -H <span class="string">&#x27;X-Request-Id:1&#x27;</span> localhost:8081</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤åï¼Œä¼šæ­£ç¡®çš„è¿”å›è¯·æ±‚ç»“æœã€‚å¦‚æœåœ¨è¯·æ±‚ä¸­æ²¡æœ‰å¸¦ä¸ŠX-Request-Idçš„headeråï¼Œå¹¶ä¸”å€¼ä¸ä¸ºæ•°å­—æ—¶ï¼Œè¯·æ±‚å°±ä¼šæŠ¥404ï¼Œè·¯ç”±æ²¡æœ‰è¢«æ­£ç¡®è½¬å‘ã€‚</p><h3 id="HostRoutePredicateFactory"><a href="#HostRoutePredicateFactory" class="headerlink" title="HostRoutePredicateFactory"></a>HostRoutePredicateFactory</h3><p>â€ƒ<code>HostRoutePredicateFactory</code>éœ€è¦ä¸€ä¸ªå‚æ•°å³hostnameï¼Œå®ƒå¯ä»¥ä½¿ç”¨. * ç­‰å»åŒ¹é…hostã€‚è¿™ä¸ªå‚æ•°ä¼šåŒ¹é…è¯·æ±‚å¤´ä¸­çš„hostçš„å€¼ï¼Œä¸€è‡´ï¼Œåˆ™è¯·æ±‚æ­£ç¡®è½¬å‘ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Host=**.somehost.org</span></span><br></pre></td></tr></table></figure><p>â€ƒåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œè¯·æ±‚å¤´ä¸­å«æœ‰Hostä¸ºsomehost.orgçš„è¯·æ±‚å°†ä¼šè¢«è·¯ç”±è½¬å‘è½¬å‘åˆ°é…ç½®çš„uriã€‚ å¯åŠ¨å·¥ç¨‹ï¼Œæ‰§è¡Œä»¥ä¸‹çš„curlå‘½ä»¤ï¼Œè¯·æ±‚ä¼šè¿”å›æ­£ç¡®çš„è¯·æ±‚ç»“æœï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">curl</span> <span class="string">-H</span> <span class="string">&#x27;Host:www.somehost.org&#x27;</span> <span class="string">localhost:8081</span></span><br></pre></td></tr></table></figure><h3 id="MethodRoutePredicateFactory"><a href="#MethodRoutePredicateFactory" class="headerlink" title="MethodRoutePredicateFactory"></a>MethodRoutePredicateFactory</h3><p>â€ƒ<code>MethodRoutePredicateFactory</code> éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œå³è¯·æ±‚çš„ç±»å‹ã€‚æ¯”å¦‚GETç±»å‹çš„è¯·æ±‚éƒ½è½¬å‘åˆ°æ­¤è·¯ç”±ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure><p>â€ƒåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæ‰€æœ‰çš„GETç±»å‹çš„è¯·æ±‚éƒ½ä¼šè·¯ç”±è½¬å‘åˆ°é…ç½®çš„uriã€‚ä½¿ç”¨ curlå‘½ä»¤æ¨¡æ‹Ÿ getç±»å‹çš„è¯·æ±‚ï¼Œä¼šå¾—åˆ°æ­£ç¡®çš„è¿”å›ç»“æœã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl localhost:8081</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ curlå‘½ä»¤æ¨¡æ‹Ÿ postè¯·æ±‚ï¼Œåˆ™è¿”å›404ç»“æœã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST localhost:8081</span></span><br></pre></td></tr></table></figure><h3 id="PathRoutePredicateFactory"><a href="#PathRoutePredicateFactory" class="headerlink" title="PathRoutePredicateFactory"></a>PathRoutePredicateFactory</h3><p>â€ƒ<code>PathRoutePredicateFactory</code> éœ€è¦ä¸€ä¸ªå‚æ•°: ä¸€ä¸ªspelè¡¨è¾¾å¼ï¼Œåº”ç”¨åŒ¹é…è·¯å¾„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/foo/&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><p>â€ƒåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæ‰€æœ‰çš„è¯·æ±‚è·¯å¾„æ»¡è¶³/foo/{segment}çš„è¯·æ±‚å°†ä¼šåŒ¹é…å¹¶è¢«è·¯ç”±ï¼Œæ¯”å¦‚/foo/1 ã€/foo/barçš„è¯·æ±‚ï¼Œå°†ä¼šå‘½ä¸­åŒ¹é…ï¼Œå¹¶æˆåŠŸè½¬å‘ã€‚<br>â€ƒä½¿ç”¨curlæ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚localhost:8081/foo/dewï¼Œæ‰§è¡Œä¹‹åä¼šè¿”å›æ­£ç¡®çš„è¯·æ±‚ç»“æœã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl localhost:8081/foo/dew</span></span><br></pre></td></tr></table></figure><h3 id="QueryRoutePredicateFactory"><a href="#QueryRoutePredicateFactory" class="headerlink" title="QueryRoutePredicateFactory"></a>QueryRoutePredicateFactory</h3><p>â€ƒ<code>QueryRoutePredicateFactory</code> éœ€è¦2ä¸ªå‚æ•°:ä¸€ä¸ªå‚æ•°åå’Œä¸€ä¸ªå‚æ•°å€¼çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">query_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Query=foo,</span> <span class="string">ba.</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®äº†è¯·æ±‚ä¸­å«æœ‰å‚æ•°fooï¼Œå¹¶ä¸”fooçš„å€¼åŒ¹é…ba.ï¼Œåˆ™è¯·æ±‚å‘½ä¸­è·¯ç”±ï¼Œæ¯”å¦‚ä¸€ä¸ªè¯·æ±‚ä¸­å«æœ‰å‚æ•°åä¸ºfooï¼Œå€¼çš„ä¸ºbarï¼Œèƒ½å¤Ÿè¢«æ­£ç¡®è·¯ç”±è½¬å‘ã€‚<br>â€ƒæ¨¡æ‹Ÿè¯·æ±‚çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl localhost:8081?foo=bar</span></span><br></pre></td></tr></table></figure><p>â€ƒ<code>QueryRoutePredicateFactory</code>ä¹Ÿå¯ä»¥åªå¡«ä¸€ä¸ªå‚æ•°ï¼Œå¡«ä¸€ä¸ªå‚æ•°æ—¶ï¼Œåˆ™åªåŒ¹é…å‚æ•°åï¼Œå³è¯·æ±‚çš„å‚æ•°ä¸­å«æœ‰é…ç½®çš„å‚æ•°åï¼Œåˆ™å‘½ä¸­è·¯ç”±ã€‚<br>â€ƒæ¯”å¦‚ä»¥ä¸‹çš„é…ç½®ä¸­ï¼Œé…ç½®äº†è¯·æ±‚å‚æ•°ä¸­å«æœ‰å‚æ•°åä¸ºfoo çš„å‚æ•°å°†ä¼šè¢«è¯·æ±‚è½¬å‘åˆ°uriä¸º <a href="http://example.org/">http://example.org</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">query_route</span></span><br><span class="line">         <span class="attr">uri:</span> <span class="string">http://example.org</span></span><br><span class="line">         <span class="attr">predicates:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">Query=foo</span></span><br></pre></td></tr></table></figure><p>â€ƒæ€»ä¹‹æ¯ä¸€ç§predicateéƒ½ä¼šå¯¹å½“å‰çš„å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œåˆ¤æ–­ï¼Œæ˜¯å¦æ»¡è¶³å½“å‰çš„è¦æ±‚ï¼Œå¦‚æœæ»¡è¶³åˆ™äº¤ç»™å½“å‰è¯·æ±‚å¤„ç†ã€‚å¦‚æœæœ‰å¾ˆå¤šä¸ªPredicateï¼Œå¹¶ä¸”ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªPredicateï¼Œåˆ™æŒ‰ç…§é…ç½®çš„é¡ºåºç¬¬ä¸€ä¸ªç”Ÿæ•ˆã€‚å…·ä½“çš„å¯ä»¥åœ¨å®˜ç½‘æ–‡æ¡£æŸ¥çœ‹ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RC3/single/spring-cloud-gateway.html#gateway-starter">SpringCloudGateWayå®˜ç½‘åœ°å€</a></p><h2 id="Filterçš„ä½¿ç”¨"><a href="#Filterçš„ä½¿ç”¨" class="headerlink" title="Filterçš„ä½¿ç”¨"></a>Filterçš„ä½¿ç”¨</h2><h3 id="æ˜¯ä»€ä¹ˆ-5"><a href="#æ˜¯ä»€ä¹ˆ-5" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p>  è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚</p><p>  Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ</p></blockquote><h3 id="spring-cloud-gateway-çš„-filter"><a href="#spring-cloud-gateway-çš„-filter" class="headerlink" title="spring cloud gateway çš„ filter"></a>spring cloud gateway çš„ filter</h3><p>spring cloud gateway çš„ filteréƒ½åªæœ‰ä¸¤ç§</p><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><ul><li>  pre</li><li>  post</li></ul><h4 id="ç§ç±»"><a href="#ç§ç±»" class="headerlink" title="ç§ç±»"></a>ç§ç±»</h4><ul><li><p>Gateway Filter</p><blockquote><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>  åœ¨<a href="http://cloud.spring.io/spring-cloud-gateway/single/spring-cloud-gateway.html#_gatewayfilter_factories">ã€spring cloud gatewayã€‘</a>çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ˜¯è¿™æ ·è¯´æ˜GatewayFilterFactoryçš„ï¼š</p><blockquote><p>  <strong>Route filters allow the modification of the incoming HTTP request or outgoing HTTP response in some manner. Route filters are scoped to a particular route. Spring Cloud Gateway includes many built-in GatewayFilter Factories.</strong></p></blockquote><ul><li>  è·¯ç”±è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„HTTPè¯·æ±‚æˆ–ä¼ å‡ºçš„HTTPå“åº”ï¼›</li><li>  GatewayFilterä¸åŒäºGlobalFilterï¼Œå®ƒåªä½œç”¨äºæŒ‡å®šçš„è·¯ç”±ï¼›</li><li>  spring cloud gatewayä¸­å†…ç½®äº†å¤§é‡çš„ç½‘å…³è¿‡æ»¤å™¨å·¥å‚ï¼›</li></ul><h2 id="2-åˆ†ç±»"><a href="#2-åˆ†ç±»" class="headerlink" title="2. åˆ†ç±»"></a>2. åˆ†ç±»</h2><p>  å†…ç½®çš„è¿‡æ»¤å™¨å·¥å‚ä¸€å…±æœ‰22ä¸ªï¼Œä½äº <code>org.springframework.cloud.gateway.filter.factory</code>åŠ<code>org.springframework.cloud.gateway.filter.factory.rewrite</code>åŒ…ä¸­</p><h3 id="2-1-æ ¹æ®ç”¨é€”åˆ’åˆ†"><a href="#2-1-æ ¹æ®ç”¨é€”åˆ’åˆ†" class="headerlink" title="2.1 æ ¹æ®ç”¨é€”åˆ’åˆ†"></a>2.1 æ ¹æ®ç”¨é€”åˆ’åˆ†</h3><p>  æ ¹æ®è¿‡æ»¤å™¨å·¥å‚çš„ç”¨é€”ï¼Œå¯ä»¥åˆ’åˆ†ä¸º <code>Header</code>ã€<code>Parameter</code>ã€<code>Path</code>ã€<code>Body</code>ã€<code>Status</code>ã€<code>Session</code>ã€<code>Redirect</code>ã€<code>Retry</code>ã€<code>RateLimiter</code>å’Œ<code>Hystrix</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><strong>Header</strong><ul><li>  <code>AddRequestHeaderGatewayFilterFactory</code></li><li>  <code>RemoveRequestHeaderGatewayFilterFactory</code></li><li>  <code>AddResponseHeaderGatewayFilterFactory</code></li><li>  <code>RemoveResponseHeaderGatewayFilterFactory</code></li><li>  <code>SetRequestHeaderGatewayFilterFactory</code></li><li>  <code>SetResponseHeaderGatewayFilterFactory</code></li><li>  <code>PreserveHostHeaderGatewayFilterFactory</code></li><li>  <code>RequestHeaderToRequestUriGatewayFilterFactory</code></li><li>  <code>SecureHeadersGatewayFilterFactory</code></li></ul></li><li><strong>Parameter</strong><ul><li>  <code>AddRequestParameterGatewayFilterFactory</code></li></ul></li><li><strong>Path</strong><ul><li>  <code>PrefixPathGatewayFilterFactory</code></li><li>  <code>RewritePathGatewayFilterFactory</code></li><li>  <code>SetPathGatewayFilterFactory</code></li><li>  <code>StripPrefixGatewayFilterFactory</code></li></ul></li><li><strong>Body</strong><ul><li>  <code>ModifyRequestBodyGatewayFilterFactory</code></li><li>  <code>ModifyResponseBodyGatewayFilterFactory</code></li></ul></li><li><strong>Status</strong><ul><li>  <code>SetStatusGatewayFilterFactory</code></li></ul></li><li><strong>Session</strong><ul><li>  <code>SaveSessionGatewayFilterFactory</code></li></ul></li><li><strong>Redirect</strong><ul><li>  <code>RedirectToGatewayFilterFactory</code></li></ul></li><li><strong>Retry</strong><ul><li>  <code>RetryGatewayFilterFactory</code></li></ul></li><li><strong>RateLimiter</strong><ul><li>  <code>RequestRateLimiterGatewayFilterFactory</code></li></ul></li><li><strong>Hystrix</strong><ul><li>  <code>HystrixGatewayFilterFactory</code></li></ul></li></ul><h3 id="2-2-æ ¹æ®ä½œç”¨åŸŸåˆ’åˆ†"><a href="#2-2-æ ¹æ®ä½œç”¨åŸŸåˆ’åˆ†" class="headerlink" title="2.2 æ ¹æ®ä½œç”¨åŸŸåˆ’åˆ†"></a>2.2 æ ¹æ®ä½œç”¨åŸŸåˆ’åˆ†</h3><p>  æ ¹æ®è¿‡æ»¤å™¨å·¥å‚çš„ä½œç”¨åŸŸåˆ’åˆ†ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä½œç”¨äº <code>request</code>ï¼Œå¦ä¸€ç±»æ˜¯ä½œç”¨äº <code>response</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><strong>Request</strong><ul><li>  <code>AddRequestHeaderGatewayFilterFactory</code></li><li>  <code>RemoveRequestHeaderGatewayFilterFactory</code></li><li>  <code>SetRequestHeaderGatewayFilterFactory</code></li><li>  <code>PreserveHostHeaderGatewayFilterFactory</code></li><li>  <code>RequestHeaderToRequestUriGatewayFilterFactory</code></li><li>  <code>AddRequestParameterGatewayFilterFactory</code></li><li>  <code>PrefixPathGatewayFilterFactory</code></li><li>  <code>RewritePathGatewayFilterFactory</code></li><li>  <code>SetPathGatewayFilterFactory</code></li><li>  <code>StripPrefixGatewayFilterFactory</code></li><li>  <code>ModifyRequestBodyGatewayFilterFactory</code></li><li>  <code>SaveSessionGatewayFilterFactory</code></li><li>  <code>RequestRateLimiterGatewayFilterFactory</code></li><li>  <code>HystrixGatewayFilterFactory</code></li></ul></li><li><strong>Response</strong><ul><li>  <code>AddResponseHeaderGatewayFilterFactory</code></li><li>  <code>RemoveResponseHeaderGatewayFilterFactory</code></li><li>  <code>SetResponseHeaderGatewayFilterFactory</code></li><li>  <code>SecureHeadersGatewayFilterFactory</code></li><li>  <code>ModifyResponseBodyGatewayFilterFactory</code></li><li>  <code>SetStatusGatewayFilterFactory</code></li><li>  <code>RedirectToGatewayFilterFactory</code></li><li>  <code>RetryGatewayFilterFactory</code></li></ul></li></ul></blockquote></li><li><p>Global Filter</p><p>  åœ¨é¡¹ç›®ä¸­æ·»åŠ filter.MyLogFilter</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLogFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;************  qwq  *************&quot;</span>);</span><br><span class="line">        String uname = exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uname == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            log.info(<span class="string">&quot;*******ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼Œo(â•¥ï¹â•¥)o&quot;</span>);</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="ä¹ã€Spring-Cloud-Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"><a href="#ä¹ã€Spring-Cloud-Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ" class="headerlink" title="ä¹ã€Spring Cloud Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"></a>ä¹ã€Spring Cloud Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</h1><h2 id="star-æ¦‚è¿°"><a href="#star-æ¦‚è¿°" class="headerlink" title=":star:æ¦‚è¿°"></a>:star:æ¦‚è¿°</h2><h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜</h3><blockquote><p>  å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡,æ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°,å› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œ,æ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>  SpringCloudæä¾›äº†ConfigServeræ¥è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ª application.yymlä¸Šç™¾ä¸ªé…ç½®æ–‡ä»¶çš„ç®¡ç†â€¦.  /(ToT)~~ </p></blockquote><h3 id="æ˜¯ä»€ä¹ˆ-6"><a href="#æ˜¯ä»€ä¹ˆ-6" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527085525733.png" alt="image-20200527085525733"></p><p><strong>æ˜¯ä»€ä¹ˆ</strong></p><blockquote><p>  SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›<strong>é›†ä¸­åŒ–</strong>çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ª<strong>ä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®</strong>ã€‚</p></blockquote><p><strong>æ€ä¹ˆç©</strong></p><blockquote><p>  Spring Cloud Configåˆ†ä¸º<strong>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†</strong></p><p>  æœåŠ¡ç«¯ä¹Ÿç§°ä¸º<strong>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</strong>,å®ƒæ˜¯â€”ä¸ª<strong>ç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨</strong>,ç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯,åŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£</p><p>  å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æº,ä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹,å¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯ï¼Œé…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯,è¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†,å¹¶ä¸”å¯ä»¥é€šè¿‡gtå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹</p></blockquote><h3 id="èƒ½å¹²å˜›-3"><a href="#èƒ½å¹²å˜›-3" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><ul><li>  é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶</li><li>  ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼ŒåŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚dev/test/prod/beta/release</li><li>  è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯</li><li>  å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®</li><li>  å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²</li></ul><h3 id="å®˜ç½‘-1"><a href="#å®˜ç½‘-1" class="headerlink" title="å®˜ç½‘"></a>å®˜ç½‘</h3><p><a href="https://spring.io/projects/spring-cloud-config">https://spring.io/projects/spring-cloud-config</a></p><h2 id="star-ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•"><a href="#star-ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•" class="headerlink" title=":star:ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•"></a>:star:ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•</h2><h3 id="åˆ›å»ºcloud-config-center3344"><a href="#åˆ›å»ºcloud-config-center3344" class="headerlink" title="åˆ›å»ºcloud-config-center3344"></a>åˆ›å»ºcloud-config-center3344</h3><p>å‚è€ƒå…¶ä»–çš„é¡¹ç›®</p><h3 id="pom-5"><a href="#pom-5" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥config-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yml-5"><a href="#yml-5" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span>  <span class="string">cloud-config-center</span> <span class="comment">#æ³¨å†Œè¿›EurekaæœåŠ¡å™¨çš„å¾®æœåŠ¡å</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/LLQWQ/cloud-config.git</span> <span class="comment">#GitHubä¸Šé¢çš„gitä»“åº“åå­—</span></span><br><span class="line">          <span class="comment">####æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cloud-config</span></span><br><span class="line">      <span class="comment">####è¯»å–åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> <code>spring.cloud.config.server.git.uri</code>è¿™ä¸ªå±æ€§å¯ä»¥é€šè¿‡sshå’Œhttpsçš„æ–¹å¼è¿æ¥åˆ°gitä»“åº“ã€‚å¦‚æœä½¿ç”¨sshè¿æ¥çš„æ–¹å¼ï¼Œåœ¨ç”µè„‘æ²¡æœ‰ä¿å­˜ç§˜é’¥çš„æƒ…å†µä¸‹éœ€è¦è‡ªå·±æŒ‡å®šã€‚ä½¿ç”¨<code>spring.cloud.config.server.git.privateKey</code>æ¥æŒ‡å®šç§˜é’¥ï¼Œå¹¶ä¸”å°†<code>spring.cloud.config.server.git.ignoreLocalSshSettings</code>è®¾ä¸ºtrue</p><h3 id="ä¸»é…ç½®ç±»-1"><a href="#ä¸»é…ç½®ç±»-1" class="headerlink" title="ä¸»é…ç½®ç±»"></a>ä¸»é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span> <span class="comment">// åŠ ä¸Šè¿™ä¸ªæ³¨è§£å¼€å¯åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigCenterMain3344</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigCenterMain3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-10"><a href="#æµ‹è¯•-10" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æµ‹è¯•å‰è®°å¾—åˆ›å»ºä¸€ä¸ªä»“åº“</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527101835804.png" alt="image-20200527101835804"></p><p>åœ¨ç½‘é¡µä¸­è¾“å…¥ï¼š<a href="http://localhost:3344/config-test.yml">http://localhost:3344/config-test.yml</a></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527102056673.png" alt="image-20200527102056673"></p><p><strong>è®¿é—®è§„åˆ™ï¼š</strong></p><blockquote><p>  {application}ï¼šå¾®æœåŠ¡åº”ç”¨çš„åç§°<br>  {profile}ï¼šç¯å¢ƒ<br>  {label}ï¼šå“ªä¸ªåˆ†æ”¯</p><ul><li>/{application}/{profile}[/{label}]<ul><li>ä½¿ç”¨è¿™ç§æ–¹å¼è¯»å–å‡ºæ¥çš„æ˜¯ä¸€ä¸ªjsonä¸²<ul><li><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527103503753.png" alt="image-20200527103503753" style="zoom:200%;"></li></ul></li><li><a href="http://localhost:3344/config/dev/master">http://localhost:3344/config/dev/master</a></li><li><a href="http://localhost:3344/order/test/qwq">http://localhost:3344/order/test/qwq</a></li></ul></li><li>/{application}-{profile}.yml</li><li>/{label}/{application}-{profile}.yml</li><li>/{application}-{profile}.properties</li><li>/{label}/{application}-{profile}.properties</li></ul></blockquote><h2 id="star-Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"><a href="#star-Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•" class="headerlink" title=":star:Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"></a>:star:Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•</h2><h3 id="æ–°å»ºcloud-config-client3355"><a href="#æ–°å»ºcloud-config-client3355" class="headerlink" title="æ–°å»ºcloud-config-client3355"></a>æ–°å»ºcloud-config-client3355</h3><h3 id="pom-6"><a href="#pom-6" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ·»åŠ config-client --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h3><h4 id="æ˜¯ä»€ä¹ˆ-7"><a href="#æ˜¯ä»€ä¹ˆ-7" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h4><blockquote><p>  applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹</p><p>  bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„,ä¼˜å…ˆçº§æ›´åŠ é«˜</p><p>  Spring Cloudä¼šåˆ›å»ºä¸€ä¸ªâ€œBootstrap Contextâ€ï¼Œä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒBootstrap Context è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„â€™Environmentâ€™ã€‚</p><p>  Bootstrapå±æ€§æœ‰é«˜ä¼˜å…ˆçº§,é»˜è®¤æƒ…å†µä¸‹,å®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚ Bootstrap contextâ€™å’Œ Application Contextæœ‰ç€ä¸åŒçš„çº¦å®š  ,æ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶,ä¿è¯ Bootstrap Contextâ€™Application  Contextâ€™é…ç½®çš„åˆ†ç¦»ã€‚</p><p>  è¦å°† Clientæ¨¡å—ä¸‹çš„ application.ymlæ–‡ä»¶æ”¹ä¸º bootstrap.ymlè¿™æ˜¯å¾ˆå…³é”®çš„,  å› ä¸º bootstrap.ymlæ˜¯æ¯” application.ymlå…ˆåŠ è½½çš„ã€‚ bootstrap.ymlä¼˜å…ˆçº§é«˜äº application.yml</p></blockquote><h4 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#åˆ†æ”¯åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span> <span class="comment">#è¯»å–åç¼€åç§°   ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€k</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h3 id="Controler"><a href="#Controler" class="headerlink" title="Controler"></a>Controler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸»é…ç½®ç±»-2"><a href="#ä¸»é…ç½®ç±»-2" class="headerlink" title="ä¸»é…ç½®ç±»"></a>ä¸»é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientMain3355</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigClientMain3355.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-11"><a href="#æµ‹è¯•-11" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åœ¨æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527110632378.png" alt="image-20200527110632378"></p><p>è¾“å‡ºäº†gitä¸Šé¢çš„é…ç½®æ–‡ä»¶çš„å†…å®¹</p><h2 id="star-Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"><a href="#star-Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°" class="headerlink" title=":star:Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"></a>:star:Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°</h2><h3 id="ä¿®æ”¹Controller"><a href="#ä¿®æ”¹Controller" class="headerlink" title="ä¿®æ”¹Controller"></a>ä¿®æ”¹Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸‹é¢è¿™ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹yml-4"><a href="#ä¿®æ”¹yml-4" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-12"><a href="#æµ‹è¯•-12" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä¿®æ”¹gitä»“åº“é‡Œé¢çš„é…ç½®å†…å®¹</p><p>ç½‘é¡µåˆ·æ–°<a href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a></p><p>è¿™æ—¶å€™ä½ ä¼šå‘ç°å¹¶æ²¡æœ‰å¾—åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦å‘3355å‘é€ä¸€ä¸ªpostè¯·æ±‚æ¥åˆ·æ–°<code>curl -X POST &quot;http://localhost:3355/actuator/refresh&quot;</code></p><p>è¿™æ—¶å€™å†å»åˆ·æ–°ç½‘é¡µå°±ä¼šå‘ç°å·²ç»åŒæ­¥è¿‡æ¥äº†</p><p>ä½†æ˜¯è¿™ç§æ–¹æ³•è¿˜ä¸æ˜¯ç‰¹åˆ«è‡ªåŠ¨ï¼Œç®—ä¸ªåŠè‡ªåŠ¨ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åŠ å…¥rabbitmqæ¥å®ç°gitæäº¤ä¿®æ”¹åè‡ªåŠ¨åŒæ­¥é…ç½®</p><h1 id="åã€Spring-Cloud-Bus-æ¶ˆæ¯æ€»çº¿"><a href="#åã€Spring-Cloud-Bus-æ¶ˆæ¯æ€»çº¿" class="headerlink" title="åã€Spring Cloud Bus æ¶ˆæ¯æ€»çº¿"></a>åã€Spring Cloud Bus æ¶ˆæ¯æ€»çº¿</h1><h2 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="æ˜¯ä»€ä¹ˆ-8"><a href="#æ˜¯ä»€ä¹ˆ-8" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p>Busæ”¯æŒä¸¤ç§æ¶ˆæ¯ä»£ç†: Rabbitmqå’Œ Kafka</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527123547367.png" alt="image-20200527123547367"></p><h3 id="èƒ½å¹²å˜›-4"><a href="#èƒ½å¹²å˜›-4" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><p>Spring Cloud Busèƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯,å°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨,å¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ã€äº‹ä»¶æ¨é€ç­‰,ä¹Ÿå¯ä»¥å½“ä½œå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“</p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527123827334.png" alt="image-20200527123827334" style="zoom:200%;"><h3 id="ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿"><a href="#ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿" class="headerlink" title="ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿"></a>ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527124031110.png" alt="image-20200527124031110"></p><h2 id="RabbitMQç¯å¢ƒé…ç½®"><a href="#RabbitMQç¯å¢ƒé…ç½®" class="headerlink" title="RabbitMQç¯å¢ƒé…ç½®"></a>RabbitMQç¯å¢ƒé…ç½®</h2><p>å‚è€ƒrabbitmqçš„ç¬”è®°</p><h2 id="SpringCloud-BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­"><a href="#SpringCloud-BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­" class="headerlink" title="SpringCloud BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­"></a>SpringCloud BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­</h2><p><strong>å¿…é¡»å…ˆå…·å¤‡è‰¯å¥½çš„RabbitMQç¯å¢ƒå…ˆ</strong></p><h3 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h3><ol><li> åˆ©ç”¨æ¶ˆæ¯æ€»çº¿<strong>è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯</strong>/bus/refreshè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®    </li><li> åˆ©ç”¨æ¶ˆæ¯æ€»çº¿<strong>è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯</strong> Config Serverlçš„/bus/refreshç«¯ç‚¹, è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®    </li></ol><p><strong>ç¬¬äºŒç§çš„æ¶æ„æ˜¾ç„¶æ›´åŠ é€‚åˆ,ç¬¬ä¸€ç§ä¸é€‚åˆçš„åŸå› å¦‚ä¸‹ï¼š</strong></p><ul><li><p>  æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§,å› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—,å®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚</p></li><li><p>  ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚</p></li><li><p>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚,å¾®æœåŠ¡åœ¨è¿ç§»æ—¶,å®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–,æ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°,é‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹</p></li></ul><h3 id="æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366"><a href="#æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366" class="headerlink" title="æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366"></a>æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366</h3><p>å‚è€ƒ3355</p><h3 id="ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"><a href="#ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ" class="headerlink" title="ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"></a>ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</h3><p><strong>pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span>  <span class="string">cloud-config-center</span> <span class="comment">#æ³¨å†Œè¿›EurekaæœåŠ¡å™¨çš„å¾®æœåŠ¡å</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/LLQWQ/cloud-config.git</span> <span class="comment">#GitHubä¸Šé¢çš„gitä»“åº“åå­—</span></span><br><span class="line">          <span class="comment">####æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cloud-config</span></span><br><span class="line">      <span class="comment">####è¯»å–åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#rabbitmqç›¸å…³é…ç½® -------------</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##rabbitmqç›¸å…³é…ç½®,æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ -------------</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span> <span class="comment">#æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;bus-refresh&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"><a href="#ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ" class="headerlink" title="ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"></a>ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</h3><p>==3366ä¹Ÿæ˜¯ä¸€æ ·çš„==</p><p><strong>pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-13"><a href="#æµ‹è¯•-13" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li> å°†7001ã€3344ã€3355ã€3366ä¾æ¬¡è¿è¡Œèµ·æ¥ï¼Œ3344å…ˆè‡ªæµ‹ä¸€ä¸‹åº·åº·èƒ½ä¸èƒ½è·å–åˆ°é…ç½®ä¿¡æ¯</li><li> ä¿®æ”¹gitä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯</li><li> çœ‹çœ‹3344æœ‰æ²¡æœ‰æ›´æ–°ï¼Œç„¶åå†æŸ¥çœ‹3355å’Œ3366ï¼Œè¿™ä¸ªæ—¶å€™3355å’Œ3366åº”è¯¥æ˜¯æ²¡æœ‰æ›´æ–°çš„</li><li> å‘3344å‘é€ä¸€ä¸ªpostè¯·æ±‚<code>curl -X POST &quot;http://localhost:3344/actuator/bus-refresh&quot;</code></li><li> å†æ¬¡æŸ¥çœ‹3355å’Œ3366ï¼Œç°åœ¨åº”è¯¥æ˜¯æ›´æ–°äº†</li></ol><p><strong>è¿™æ ·å°±åšåˆ°äº†ï¼Œä¸€æ¬¡ä¿®æ”¹ï¼Œå¹¿æ’­é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆ</strong></p><h2 id="SpringCloud-BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥"><a href="#SpringCloud-BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥" class="headerlink" title="SpringCloud BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥"></a>SpringCloud BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥</h2><p><strong>æµ‹è¯•åœºæ™¯ï¼š</strong> ä¿®æ”¹gitä»“åº“ä¸­çš„é…ç½®ï¼Œåªåˆ·æ–°3355ä¸åˆ·æ–°3366</p><p>å®Œæˆä»¥ä¸Šåœºæ™¯ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹é…ç½®ï¼Œåªéœ€è¦å°†åˆ·æ–°çš„postä¿®æ”¹ä¸€ä¸‹å³å¯</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/&#123;destination&#125;`</span></span><br><span class="line"></span><br><span class="line">&#123;destination&#125;ï¼šéœ€è¦é€šçŸ¥æ›´æ–°çš„æœåŠ¡</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸Šé¢çš„æ ¼å¼ï¼Œåªéœ€è¦åœ¨ä¿®æ”¹å®Œgitä»“åº“çš„é…ç½®ä¹‹åä½¿ç”¨<code>curl -X POST &quot;http://localhost:3344/actuator/bus-refresh/config-client:3355&quot;</code>æ¥é€šçŸ¥3344å³å¯åšåˆ°åªé€šçŸ¥3355è€Œä¸é€šçŸ¥3366çš„åŠŸèƒ½</p><p>psï¼šå¦‚æœä¸å†™ç«¯å£å·åˆ™è¡¨ç¤ºé€šçŸ¥åœ¨eurekaä¸Šæ³¨å†Œçš„æ‰€æœ‰æœåŠ¡åå«config-clientçš„æœåŠ¡</p><h1 id="åä¸€ã€Spring-Cloud-Stream-æ¶ˆæ¯é©±åŠ¨"><a href="#åä¸€ã€Spring-Cloud-Stream-æ¶ˆæ¯é©±åŠ¨" class="headerlink" title="åä¸€ã€Spring Cloud Stream æ¶ˆæ¯é©±åŠ¨"></a>åä¸€ã€Spring Cloud Stream æ¶ˆæ¯é©±åŠ¨</h1><h2 id="ä¸­æ–‡æŒ‡å¯¼æ‰‹å†Œ"><a href="#ä¸­æ–‡æŒ‡å¯¼æ‰‹å†Œ" class="headerlink" title="ä¸­æ–‡æŒ‡å¯¼æ‰‹å†Œ"></a>ä¸­æ–‡æŒ‡å¯¼æ‰‹å†Œ</h2><p><a href="https://m.wang1314.com/doc/webapp/topic/20971999.html">https://m.wang1314.com/doc/webapp/topic/20971999.html</a></p><h2 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527141810648.png" alt="image-20200527141810648"></p><p>ä¸€å¥è¯ï¼šå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚é™ä½åˆ‡æ¢æˆæœ¬,ç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹</p><h3 id="ç¼–ç apiçš„å¸¸ç”¨æ³¨è§£"><a href="#ç¼–ç apiçš„å¸¸ç”¨æ³¨è§£" class="headerlink" title="ç¼–ç apiçš„å¸¸ç”¨æ³¨è§£"></a>ç¼–ç apiçš„å¸¸ç”¨æ³¨è§£</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527143009336.png" alt="image-20200527143009336"></p><h2 id="æ¡ˆä¾‹è¯´æ˜"><a href="#æ¡ˆä¾‹è¯´æ˜" class="headerlink" title="æ¡ˆä¾‹è¯´æ˜"></a>æ¡ˆä¾‹è¯´æ˜</h2><p>rabbitmqç¯å¢ƒå·²ç»æ­å»ºå¥½äº†</p><p>å·¥ç¨‹ä¸­æ–°å»ºä¸‰ä¸ªå­æ¨¡å—</p><ul><li>  cloud-stream-rabbitmq-provider8801 æ¶ˆæ¯å‘é€æ¨¡å—</li><li>  cloud-stream-rabbitmq-consumer8802 æ¶ˆæ¯æ¥æ”¶æ¨¡å—</li><li>  cloud-stream-rabbitmq-consumer8803 æ¶ˆæ¯æ¥æ”¶æ¨¡å—</li></ul><h2 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><h3 id="åˆ›å»ºcloud-stream-rabbitmq-provider8801"><a href="#åˆ›å»ºcloud-stream-rabbitmq-provider8801" class="headerlink" title="åˆ›å»ºcloud-stream-rabbitmq-provider8801"></a>åˆ›å»ºcloud-stream-rabbitmq-provider8801</h3><h3 id="pom-7"><a href="#pom-7" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥stream-rabbit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŸºç¡€é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yml-6"><a href="#yml-6" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">output:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">send-8801.com</span>  <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span></span><br></pre></td></tr></table></figure><h3 id="ä¸»é…ç½®ç±»-3"><a href="#ä¸»é…ç½®ç±»-3" class="headerlink" title="ä¸»é…ç½®ç±»"></a>ä¸»é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// @EnableEurekaClient ä¸ä½¿ç”¨è¿™ä¸ªæ³¨è§£ä¹Ÿå¯ä»¥æ³¨å†Œåˆ°eurekaä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQProviderMain8801</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(RabbitMQProviderMain8801.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡å±‚"><a href="#ä¸šåŠ¡å±‚" class="headerlink" title="ä¸šåŠ¡å±‚"></a>ä¸šåŠ¡å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMessageProvider</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.springframework.cloud.stream.messaging.Source; æ³¨æ„sourceä¸è¦å¯¼é”™åŒ…äº†</span></span><br><span class="line"><span class="meta">@EnableBinding(Source.class)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageProviderImpl</span> <span class="keyword">implements</span> <span class="title">IMessageProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String uuid = UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(uuid).build());</span><br><span class="line">        log.info(<span class="string">&quot;==============uuid: &quot;</span>+uuid);</span><br><span class="line">        <span class="keyword">return</span> uuid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageProviderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IMessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/message/send&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageProvider.send();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-14"><a href="#æµ‹è¯•-14" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li><p> æ‰“å¼€rabbitmqçš„webæ§åˆ¶ç•Œé¢</p></li><li><p> æŸ¥çœ‹æ˜¯å¦å­˜åœ¨åç§°ä¸ºstudyExchangeçš„äº¤æ¢æœºï¼Œè¿™ä¸ªåç§°æ˜¯ä¹‹å‰åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„äº¤æ¢æœºåç§°</p></li><li><p> æµè§ˆå™¨è¾“å…¥ç½‘å€ï¼š<a href="http://localhost:8801/message/send">http://localhost:8801/message/send</a>  (å¤šç‚¹å‡ æ¬¡)</p></li><li><p>æŸ¥çœ‹äº¤æ¢æœºçš„å›¾å½¢ç•Œé¢æœ‰æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼Œçœ‹é‚£ä¸ªè§†å›¾æœ‰æ²¡æœ‰å˜åŠ¨</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527155914627.png" alt="image-20200527155914627"></p></li></ol><h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><h3 id="åˆ›å»ºcloud-stream-rabbitmq-consumer8802"><a href="#åˆ›å»ºcloud-stream-rabbitmq-consumer8802" class="headerlink" title="åˆ›å»ºcloud-stream-rabbitmq-consumer8802"></a>åˆ›å»ºcloud-stream-rabbitmq-consumer8802</h3><p>å‚è€ƒ8801</p><h3 id="pom-8"><a href="#pom-8" class="headerlink" title="pom"></a>pom</h3><p>å’Œ8001ä¸€æ ·</p><h3 id="yml-7"><a href="#yml-7" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">input:</span> <span class="comment"># &lt;---------------è¿™é‡Œæ”¹æˆinput------------------- </span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span>  <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span></span><br></pre></td></tr></table></figure><h3 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// import org.springframework.cloud.stream.messaging.Sink;</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiveController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Message&lt;String&gt; message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…qwq(&quot;</span>+port+<span class="string">&quot;)æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š &quot;</span> + message.getPayload());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸»å¯åŠ¨ç±»-3"><a href="#ä¸»å¯åŠ¨ç±»-3" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h3><p>å’Œ8001ä¸€æ ·</p><h3 id="æµ‹è¯•-15"><a href="#æµ‹è¯•-15" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li><p> å¯åŠ¨rabbitmqçš„webæ§åˆ¶ç•Œé¢</p></li><li><p> å¯åŠ¨7001,8001,8002ï¼ˆå¦‚æœæ²¡ç”¨åˆ°eurekaçš„è¯7001éƒ½å¯ä»¥ä¸ç”¨å¯åŠ¨ï¼‰</p></li><li><p> æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8801/message/send">http://localhost:8801/message/send</a></p></li><li><p> æŸ¥çœ‹8002çš„æ§åˆ¶å°æœ‰æ²¡æœ‰æ‰“å°å‡ºå¯¹åº”çš„æ¶ˆæ¯</p></li><li><p>æŸ¥çœ‹åç§°ä¸ºstudyExchangeçš„äº¤æ¢æœºæœ‰æ²¡æœ‰è®¢é˜…è€…å’Œæµé‡çš„å˜åŒ–</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527162558243.png" alt="image-20200527162558243"></p></li></ol><h2 id="åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"><a href="#åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–" class="headerlink" title="åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"></a>åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</h2><h3 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h3><blockquote><p>  streamçš„æ¶ˆè´¹è€…åœ¨æ²¡æŒ‡å®šåˆ†ç»„æ—¶ä¼šé»˜è®¤åˆ†é…åœ¨ä¸€ä¸ªå”¯ä¸€çš„ç»„ä¸­ï¼Œå¹¶ä¸”streamçš„æ¯ä¸ªç»„éƒ½èƒ½æ¶ˆè´¹åˆ°ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚è¿™ç§æƒ…å†µå°±æ˜¯è®¢é˜…å‘å¸ƒæ¨¡å¼ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªç»„ä¸­æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ­¤æ—¶è¿™å¤šä¸ªæ¶ˆè´¹è€…å°±æ˜¯ç«äº‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ä¸€äººæ¶ˆè´¹ä¸€æ¡ã€‚ï¼ˆè¯´ç«äº‰å…³ç³»å¯èƒ½ä¸å¤ªå¯¹ï¼Œåº”è¯¥æ˜¯è½®è¯¢çš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼‰</p><p>  ä¸€å¥è¯ï¼šä¸åŒç»„é‡å¤æ¶ˆè´¹ï¼ŒåŒä¸€ç»„è½®è¯¢</p></blockquote><p>ä¸ºäº†æµ‹è¯•æ•ˆæœå…ˆåˆ›å»ºä¸€ä¸ª8003</p><h4 id="åˆ›å»ºcloud-stream-rabbitmq-consumer8803"><a href="#åˆ›å»ºcloud-stream-rabbitmq-consumer8803" class="headerlink" title="åˆ›å»ºcloud-stream-rabbitmq-consumer8803"></a>åˆ›å»ºcloud-stream-rabbitmq-consumer8803</h4><p>å‚è€ƒ8002ï¼ˆå°±æ˜¯ç›´æ¥clone 8002 æ”¹ä¸€ä¸‹é…ç½®ï¼‰</p><h4 id="ä¿®æ”¹yml-5"><a href="#ä¿®æ”¹yml-5" class="headerlink" title="ä¿®æ”¹yml"></a>ä¿®æ”¹yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">bindings:</span> </span><br><span class="line">        <span class="attr">input:</span> </span><br><span class="line">          <span class="attr">group:</span> <span class="string">qwq</span> <span class="comment"># æ·»åŠ è¿™ä¸ªå°±å¥½äº†ï¼Œ8002å’Œ8003å†™ä¸€æ ·çš„ç»„åå°±å¥½å•¦</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-16"><a href="#æµ‹è¯•-16" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li> æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8801/message/send">http://localhost:8801/message/send</a></li><li> æŸ¥çœ‹8002å’Œ8003çš„æ§åˆ¶å°ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°é‡å¤çš„æ¶ˆæ¯å°±å¯¹å•¦:laughing:</li></ol><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p><strong>é—®é¢˜ï¼š</strong>å½“8002å’Œ8003å®•æœºäº†ï¼Œä½†æ˜¯8001åœ¨å®ƒä»¬å®•æœºä¹‹åå‘é€äº†äº”æ¡æ¶ˆæ¯ï¼Œå½“8002å’Œ8003å†æ¬¡ä¸Šçº¿è¿˜ä¼šä¸ä¼šæ”¶åˆ°8001åœ¨å½“å‰åå‘é€çš„5æ¡æ¶ˆæ¯ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æ”¶å¾—åˆ°ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªå‰æï¼š</p><ul><li>  8002å’Œ8003æŒ‡å®šäº†åˆ†ç»„çš„å±æ€§</li><li>  8002å’Œ8003çš„å®•æœºå‰çš„åˆ†ç»„å±æ€§å’Œé‡æ–°ä¸Šçº¿åçš„åˆ†ç»„å±æ€§çš„å€¼å¿…é¡»æ˜¯ä¸€æ ·çš„</li></ul><p>æ‹¿8002ä¸¾ä¾‹ï¼Œå‡è®¾å®ƒå®•æœºå‰çš„åˆ†ç»„å±æ€§çš„å€¼æ˜¯qwqï¼Œå®•æœºåä¹Ÿå¿…é¡»æ˜¯ä»¥qwqçš„åˆ†ç»„ç™»å½•çš„æ‰èƒ½æ”¶åˆ°è¡¥å‘çš„æ¶ˆæ¯ã€‚</p><p>å› ä¸ºstreamåœ¨8002ç¬¬ä¸€æ¬¡ç™»å½•æ—¶ä¼šè®°å½•åˆ†ç»„ï¼Œå½“ä»–ä¸‹çº¿äº†ï¼Œåœ¨å®ƒä¸‹çº¿çš„è¿™æ®µæ—¶é—´æ‰€å‘é€çš„æ¶ˆæ¯ä¼šåœ¨å®ƒå†æ¬¡ä»¥qwqä¸Šçº¿çš„æ—¶å€™è¡¥å‘ç»™å®ƒï¼Œä¹Ÿå°±ç›¸å½“äºqwqè¢«æ³¨å†Œåˆ°äº†streamé‡Œé¢ã€‚</p><h1 id="åäºŒã€Spring-Cloud-Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"><a href="#åäºŒã€Spring-Cloud-Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª" class="headerlink" title="åäºŒã€Spring Cloud Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"></a>åäºŒã€Spring Cloud Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</h1><h2 id="æ¦‚è¿°-6"><a href="#æ¦‚è¿°-6" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³é‚£äº›é—®é¢˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³é‚£äº›é—®é¢˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³é‚£äº›é—®é¢˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³é‚£äº›é—®é¢˜ï¼Ÿ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527172421771.png"></p><p>åœ¨è°ƒç”¨é“¾è·¯å°‘çš„æƒ…å†µå¯ä»¥ä¸ç”¨å¼•ç”¨ï¼Œä½†æ˜¯å½“é“¾è·¯å¾ˆé•¿çš„æ—¶å€™å°±å¾ˆæœ‰å¿…è¦å¯¹å…¶è¿›è¡Œç›‘æ§äº†ï¼Œæ¯”å¦‚ä¸‹å›¾è¿™ç§æƒ…å†µ</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527172550577.png" alt="image-20200527172550577"></p><h3 id="æ˜¯ä»€ä¹ˆ-9"><a href="#æ˜¯ä»€ä¹ˆ-9" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p><a href="https://github.com/spring-cloud/spring-cloud-sleuth">https://github.com/spring-cloud/spring-cloud-sleuth</a></p><blockquote><p>  Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ</p><p>  åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº† zipkin</p></blockquote><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>å®ƒä¼šå°†è°ƒç”¨é“¾è·¯è®°å½•ä¸‹æ¥ï¼Œå¯ä»¥ä»¥webçš„ç•Œé¢å±•ç°å‡ºæ¥</p><h2 id="æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤"><a href="#æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤" class="headerlink" title="æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤"></a>æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤</h2><h3 id="zipkin"><a href="#zipkin" class="headerlink" title="zipkin"></a>zipkin</h3><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><p><a href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/</a></p><p>zipkin-server-2.12.9-exec.jar</p><p>ä¸‹è½½ä»¥execç»“å°¾çš„jaråŒ…</p><h4 id="è¿è¡Œjar"><a href="#è¿è¡Œjar" class="headerlink" title="è¿è¡Œjar"></a>è¿è¡Œjar</h4><p>ä½¿ç”¨<code>java -jar zipkin-server-2.12.9-exec.jar</code>æ¥è¿è¡Œï¼Œå‡ºç°è¿™ä¸ªæ ‡å¿—è¯´æ˜æˆåŠŸå•¦</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527175700308.png" alt="image-20200527175700308"></p><h4 id="è¿è¡Œæ§åˆ¶å°"><a href="#è¿è¡Œæ§åˆ¶å°" class="headerlink" title="è¿è¡Œæ§åˆ¶å°"></a>è¿è¡Œæ§åˆ¶å°</h4><p><a href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527175752803.png" alt="image-20200527175752803"></p><h4 id="å®Œæ•´çš„è°ƒç”¨é“¾è·¯"><a href="#å®Œæ•´çš„è°ƒç”¨é“¾è·¯" class="headerlink" title="å®Œæ•´çš„è°ƒç”¨é“¾è·¯"></a>å®Œæ•´çš„è°ƒç”¨é“¾è·¯</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527174038626.png" alt="image-20200527174038626"></p><p>ç²¾ç®€ç‰ˆï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527174102677.png" alt="image-20200527174102677"></p><h4 id="åç§°è§£é‡Š"><a href="#åç§°è§£é‡Š" class="headerlink" title="åç§°è§£é‡Š"></a>åç§°è§£é‡Š</h4><ul><li>  <strong>Trace:</strong>  ç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆï¼Œè¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯ï¼Œå­˜åœ¨å”¯ä¸€æ ‡è¯†</li><li>  <strong>span:</strong>  è¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æºï¼Œé€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</li></ul><h3 id="æœåŠ¡æä¾›è€…å’Œè°ƒç”¨è€…"><a href="#æœåŠ¡æä¾›è€…å’Œè°ƒç”¨è€…" class="headerlink" title="æœåŠ¡æä¾›è€…å’Œè°ƒç”¨è€…"></a>æœåŠ¡æä¾›è€…å’Œè°ƒç”¨è€…</h3><p>ä¿®æ”¹cloud-provider-payment8001å’Œcloud-customer-openfeign-order80</p><h4 id="pom-9"><a href="#pom-9" class="headerlink" title="pom"></a>pom</h4><p>æ·»åŠ è¿™ä¸ªä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŒ…å«äº†sleuth+zipkin--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml-8"><a href="#yml-8" class="headerlink" title="yml"></a>yml</h4><p>æ·»åŠ ä»¥ä¸‹é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">        <span class="comment">#é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›† </span></span><br><span class="line">        <span class="comment"># é¡¹ç›®ä¸­ä¸€èˆ¬å†™0.5</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-17"><a href="#æµ‹è¯•-17" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li><p> å¯åŠ¨zipkin-server</p></li><li><p> æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost/order/payment/ok">http://localhost/order/payment/ok</a></p></li><li><p>æŸ¥çœ‹zipkin-serverçš„æ§åˆ¶ç•Œé¢</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200527190516542.png" alt="image-20200527190516542"></p></li></ol><h1 id="åä¸‰ã€Spring-Cloud-Alibaba-å…¥é—¨ç®€ä»‹"><a href="#åä¸‰ã€Spring-Cloud-Alibaba-å…¥é—¨ç®€ä»‹" class="headerlink" title="åä¸‰ã€Spring Cloud Alibaba å…¥é—¨ç®€ä»‹"></a>åä¸‰ã€Spring Cloud Alibaba å…¥é—¨ç®€ä»‹</h1><p>è§è„‘å›¾</p><h1 id="star2-åå››ã€SpringCloud-Alibaba-NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"><a href="#star2-åå››ã€SpringCloud-Alibaba-NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="headerlink" title=":star2:åå››ã€SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"></a>:star2:åå››ã€SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</h1><h2 id="Nacosç®€ä»‹"><a href="#Nacosç®€ä»‹" class="headerlink" title="Nacosç®€ä»‹"></a>Nacosç®€ä»‹</h2><h3 id="ä¸ºä»€ä¹ˆå«Nacos"><a href="#ä¸ºä»€ä¹ˆå«Nacos" class="headerlink" title="ä¸ºä»€ä¹ˆå«Nacos"></a>ä¸ºä»€ä¹ˆå«Nacos</h3><blockquote><p>  å‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºService</p></blockquote><h3 id="æ˜¯ä»€ä¹ˆ-10"><a href="#æ˜¯ä»€ä¹ˆ-10" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†ä¸­å¿ƒ<br>Nacosï¼šDynamic Naming and Configuration Service<br>Nacoså°±æ˜¯æ³¨å†Œä¸­å¿ƒ+é…ç½®ä¸­å¿ƒçš„ç»„åˆ ç­‰ä»·äº <code>Nacos = Eureka+Config+Bus</code></p></blockquote><h3 id="èƒ½å¹²å˜›-5"><a href="#èƒ½å¹²å˜›-5" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><blockquote><p>  æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒ</p><p>  æ›¿ä»£ConfigåšæœåŠ¡é…ç½®ä¸­å¿ƒ</p></blockquote><h3 id="å»å“ªä¸‹-1"><a href="#å»å“ªä¸‹-1" class="headerlink" title="å»å“ªä¸‹"></a>å»å“ªä¸‹</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">gitä»“åº“</span>](<span class="link">https://github.com/alibaba/Nacos</span>)</span><br><span class="line"><span class="section"># å®˜ç½‘æ–‡æ¡£</span></span><br><span class="line"><span class="bullet">+</span> https://nacos.io/zh-cn/index.html</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span> https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#<span class="emphasis">_spring_</span>cloud<span class="emphasis">_alibaba_</span>nacos<span class="emphasis">_discovery</span></span><br></pre></td></tr></table></figure><h3 id="å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ"><a href="#å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ" class="headerlink" title="å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ"></a>å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528084720925.png" alt="image-20200528084720925"></p><p><strong>æ®è¯´Nacosåœ¨é˜¿é‡Œå·´å·´å†…éƒ¨æœ‰è¶…è¿‡10ä¸‡çš„å®ä¾‹è¿è¡Œ,å·²ç»è¿‡äº†ç±»ä¼¼åŒåä¸€ç­‰å„ç§å¤§å‹æµé‡çš„è€ƒéªŒ</strong></p><h2 id="å®‰è£…å¹¶è¿è¡ŒNacos"><a href="#å®‰è£…å¹¶è¿è¡ŒNacos" class="headerlink" title="å®‰è£…å¹¶è¿è¡ŒNacos"></a>å®‰è£…å¹¶è¿è¡ŒNacos</h2><ol><li><p> æœ¬åœ°Java8+Mavenç¯å¢ƒå·²ç»OK</p></li><li><p>å…ˆä»å®˜ç½‘ä¸‹è½½Nacos</p><p> <a href="https://github.com/alibaba/nacos/releases/tag/1.1.4">https://github.com/alibaba/nacos/releases/tag/1.1.4</a></p></li><li><p> è§£å‹å®‰è£…åŒ…ï¼Œç›´æ¥è¿è¡Œbinç›®å½•ä¸‹çš„startup.cmd</p></li><li><p>å‘½ä»¤è¿è¡ŒæˆåŠŸåç›´æ¥è®¿é—®<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></p><p> é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯nacos</p></li><li><p>ç»“æœé¡µé¢</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528085646074.png" alt="image-20200528085646074"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528085801217.png" alt="image-20200528085801217"></p></li></ol><h2 id="Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"><a href="#Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"></a>Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º</h2><h3 id="å®˜ç½‘æ–‡æ¡£"><a href="#å®˜ç½‘æ–‡æ¡£" class="headerlink" title="å®˜ç½‘æ–‡æ¡£"></a><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">å®˜ç½‘æ–‡æ¡£</a></h3><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html</a></p><p><a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">ä¸­æ–‡å®˜ç½‘</a></p><h3 id="åŸºäºNacosçš„æœåŠ¡æä¾›è€…"><a href="#åŸºäºNacosçš„æœåŠ¡æä¾›è€…" class="headerlink" title="åŸºäºNacosçš„æœåŠ¡æä¾›è€…"></a>åŸºäºNacosçš„æœåŠ¡æä¾›è€…</h3><h4 id="æ–°å»ºModule"><a href="#æ–°å»ºModule" class="headerlink" title="æ–°å»ºModule"></a>æ–°å»ºModule</h4><p>â€‹            cloudalibaba-provider-payment9001</p><h4 id="POM-1"><a href="#POM-1" class="headerlink" title="POM"></a>POM</h4><p><strong>çˆ¶POM</strong></p><p>æ·»åŠ å¦‚ä¸‹ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud é˜¿é‡Œå·´å·´--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æœ¬æ¨¡å—POM</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="YML-1"><a href="#YML-1" class="headerlink" title="YML"></a>YML</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain9001</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»-3"><a href="#ä¸šåŠ¡ç±»-3" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/port&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPort</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;port: &quot;</span> + port + <span class="string">&quot;, uuid: &quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-18"><a href="#æµ‹è¯•-18" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li> è®¿é—®nacosæ§åˆ¶å°ï¼Œçœ‹æœåŠ¡åˆ—è¡¨é‡Œé¢æœ‰æ²¡æœ‰åˆšåˆšæ³¨å†Œçš„æœåŠ¡</li></ol><p>â€‹            <a href="http://localhost:8848/nacos/index.html#/serviceManagement">http://localhost:8848/nacos/index.html#/serviceManagement</a></p><p>â€‹            <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528113404419.png" alt="image-20200528113404419"></p><blockquote><p>  ä¸ºäº†ä¸‹ä¸€ç« èŠ‚æ¼”ç¤ºnacosçš„è´Ÿè½½å‡è¡¡ï¼Œå‚ç…§9001æ–°å»º9002</p></blockquote><p>å¦‚æœæƒ³å·æ‡’çš„è¯å°±ã€‚ã€‚ã€‚çœ‹ä¸‹å›¾ï¼ˆè¿™ç§æ–¹å¼å¯ä»¥å¤åˆ¶ä¸€ä¸ªæœåŠ¡ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528111505861.png" alt="image-20200528111505861"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528111829900.png" alt="image-20200528111829900"></p><h3 id="åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"><a href="#åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"></a>åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…</h3><h4 id="æ–°å»ºModule-1"><a href="#æ–°å»ºModule-1" class="headerlink" title="æ–°å»ºModule"></a>æ–°å»ºModule</h4><p>â€‹            cloudalibaba-consumer-nacos-order83</p><h4 id="POM-2"><a href="#POM-2" class="headerlink" title="POM"></a>POM</h4><p>å’Œ9001ä¸€æ ·</p><h4 id="yml-9"><a href="#yml-9" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-consumer-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">myConfig:</span> <span class="comment"># è¿™é‡Œæ˜¯è‡ªå·±å†™çš„é…ç½®</span></span><br><span class="line">  <span class="attr">serverUrl:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨-1"><a href="#ä¸»å¯åŠ¨-1" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><p>å’Œ9001ä¸€æ ·</p><h4 id="ä¸šåŠ¡ç±»-4"><a href="#ä¸šåŠ¡ç±»-4" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;myConfig.serverUrl&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/port&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProviderPort</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverUrl+<span class="string">&quot;/payment/port&quot;</span>, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-19"><a href="#æµ‹è¯•-19" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li><p>è®¿é—®nacosæ§åˆ¶å°</p><p> <a href="http://localhost:8848/nacos/index.html#/serviceManagement">http://localhost:8848/nacos/index.html#/serviceManagement</a></p></li><li><p>83è®¿é—®9001/9002ï¼Œè½®è¯¢è´Ÿè½½OK</p><p> å°±æ˜¯çœ‹åˆ°9001å’Œ9002çš„ç«¯å£äº¤æ›¿å‡ºç°</p></li></ol><h4 id="ä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡"><a href="#ä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡"></a>ä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528131821302.png" alt="image-20200528131821302"></p><p>å› ä¸ºnacosæ•´åˆäº†ribbon</p><h3 id="æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a>æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h3><h4 id="Nacoså’ŒCAP"><a href="#Nacoså’ŒCAP" class="headerlink" title="Nacoså’ŒCAP"></a>Nacoså’ŒCAP</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528132152933.png" alt="image-20200528132152933"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528132134012.png" alt="image-20200528132134012"></p><h4 id="Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢"><a href="#Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢" class="headerlink" title="Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢"></a>Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„;è€ŒAçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼?</span></span><br><span class="line">ä¸€èˆ¬æ¥è¯´,å¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œ,å¹¶èƒ½å¤Ÿå€®æŒå¿ƒè·³ä¸ŠæŠ¥,é‚£ä¹ˆå°±å¯ä»¥é€‰æŒ¥APæ¨¡å¼.å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’ŒDubbo æœåŠ¡,éƒ½é€‚ç”¨äºAPæ¨¡å¼,APæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§,å› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹.</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯,é‚£ä¹ˆCP æ˜¯å¿…é¡»,K8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚</span></span><br><span class="line">CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹,æ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼,è¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡,å¦‚æœæœåŠ¡ä¸å­˜åœ¨,åˆ™ä¼šè¿”å›é”™è¯¯.</span><br><span class="line"></span><br><span class="line">å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å¹¶å‘ŠçŸ¥nacosçš„æ¨¡å¼</span><br><span class="line"><span class="code">`curl-X PUT&#x27;SNACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#x27;`</span></span><br></pre></td></tr></table></figure><h2 id="Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"><a href="#Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"></a>Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º</h2><h3 id="Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åŸºç¡€é…ç½®"><a href="#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åŸºç¡€é…ç½®" class="headerlink" title="Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åŸºç¡€é…ç½®"></a>Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åŸºç¡€é…ç½®</h3><h4 id="å»ºmodel"><a href="#å»ºmodel" class="headerlink" title="å»ºmodel"></a>å»ºmodel</h4><p>cloudalibaba-config-nacos-client3377</p><h4 id="POM-3"><a href="#POM-3" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba config --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="YML-2"><a href="#YML-2" class="headerlink" title="YML"></a>YML</h4><h5 id="bootstrap-yml-1"><a href="#bootstrap-yml-1" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacosé…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br></pre></td></tr></table></figure><h5 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><h5 id="whyé…ç½®ä¸¤ä¸ª"><a href="#whyé…ç½®ä¸¤ä¸ª" class="headerlink" title="whyé…ç½®ä¸¤ä¸ª"></a>whyé…ç½®ä¸¤ä¸ª</h5><blockquote><p>  NacosåŒspringcloud-configä¸€æ ·,åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶,è¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–,æ‹‰å–é…ç½®ä¹‹å,æ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚<br>  springbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„,bootstrapä¼˜å…ˆçº§é«˜äºapplication</p></blockquote><h4 id="ä¸»å¯åŠ¨-2"><a href="#ä¸»å¯åŠ¨-2" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NacosConfigClientMain3377</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(NacosConfigClientMain3377.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»-5"><a href="#ä¸šåŠ¡ç±»-5" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯"><a href="#åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯" class="headerlink" title="åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯"></a>åœ¨Nacosä¸­æ·»åŠ é…ç½®ä¿¡æ¯</h4><p>å…¬å¼ï¼š${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528141639257.png" alt="image-20200528141639257"></p><h4 id="æµ‹è¯•-20"><a href="#æµ‹è¯•-20" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li><p>åœ¨nacosçš„ç®¡ç†ç•Œé¢æ·»åŠ é…ç½®</p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528141830231.png" alt="image-20200528141830231" style="zoom:200%;"></li><li><p> å¯åŠ¨3377ï¼Œå¹¶è®¿é—®<a href="http://localhost:3377/configInfo%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%89%93%E5%8D%B0%E4%BA%86%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF">http://localhost:3377/configInfoæŸ¥çœ‹æ˜¯å¦æ‰“å°äº†é…ç½®ä¿¡æ¯</a></p></li><li><p> åœ¨nacosç®¡ç†ç•Œé¢ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼ŒæŸ¥çœ‹3377æ˜¯å¦æ›´æ–°</p></li></ol><h3 id="Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®"><a href="#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®" class="headerlink" title="Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®"></a>Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®</h3><h4 id="Data-ID"><a href="#Data-ID" class="headerlink" title="Data ID"></a>Data ID</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528143514511.png" alt="image-20200528143514511"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528143559804.png" alt="image-20200528143559804"></p><p>å¦‚æœæœ‰ä¸€ä¸ªdataidä¸º<code>nacos-config-client-test.yaml</code>çš„é…ç½®ï¼Œæ­¤æ—¶å°†actionçš„å€¼ä¿®æ”¹ä¸ºtestï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå»è¯»å–<code>nacos-config-client-test.yaml</code>çš„é…ç½®ï¼Œè€Œä¸ä¼šå»è¯»å–<code>nacos-config-client-dev.yaml</code>çš„é…ç½®</p><h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528145005346.png" alt="image-20200528145005346"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528145044527.png" alt="image-20200528145044527"></p><p>åº”è¯¥ä¸ç”¨æˆ‘è¯´äº†å§ğŸ˜’</p><h4 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h4><p>æ–°å»ºå‘½åç©ºé—´</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528145312056.png" alt="image-20200528145312056"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528145354352.png" alt="image-20200528145354352"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528145429410.png" alt="image-20200528145429410"></p><p>æ‡‚ï¼ŸğŸ™„</p><h2 id="star-Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰"><a href="#star-Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰" class="headerlink" title=":star:==Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰=="></a>:star:==Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰==</h2><h3 id="nacosé…ç½®æŒä¹…åŒ–"><a href="#nacosé…ç½®æŒä¹…åŒ–" class="headerlink" title="nacosé…ç½®æŒä¹…åŒ–"></a>nacosé…ç½®æŒä¹…åŒ–</h3><h4 id="æˆ‘çš„é…ç½®ï¼š"><a href="#æˆ‘çš„é…ç½®ï¼š" class="headerlink" title="æˆ‘çš„é…ç½®ï¼š"></a><strong>æˆ‘çš„é…ç½®ï¼š</strong></h4><ul><li>  mavenï¼š3.5.4</li><li>  mysqlï¼š5.7.9</li><li>  nacos-serverï¼š1.2.1</li></ul><h4 id="é…ç½®æ­¥éª¤ï¼š"><a href="#é…ç½®æ­¥éª¤ï¼š" class="headerlink" title="é…ç½®æ­¥éª¤ï¼š"></a>é…ç½®æ­¥éª¤ï¼š</h4><ol><li> åœ¨æ•°æ®åº“åˆ›å»ºä¸€ä¸ªåº“ï¼ˆnacosï¼‰</li><li> è¿è¡Œ<code>nacoså®‰è£…ç›®å½•/conf/nacos-mysql.sql</code>å»ºç«‹é‡Œé¢çš„è¡¨</li><li>ä¿®æ”¹<code>nacoså®‰è£…ç›®å½•/conf/application.properties</code><ol><li> ä¿®æ”¹è¢«ç®­å¤´æŒ‡å‘çš„ï¼Œé»˜è®¤æ˜¯è¢«æ³¨é‡Šçš„ã€‚å–æ¶ˆæ³¨é‡Šåå†ä¿®æ”¹mysqlçš„è¿æ¥ipã€è´¦å·å’Œå¯†ç </li><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200528163454937.png" alt="image-20200528163454937"></li></ol></li><li> ç™»å½•nacosæ§åˆ¶å°ï¼Œå¢åŠ ä¸€æ¡é…ç½®ï¼ŒæŸ¥çœ‹æ•°æ®åº“çš„config_infoè¡¨æœ‰æ²¡æœ‰å¢åŠ åˆšåˆšçš„é…ç½®</li></ol><h4 id="è¿æ¥mysql8"><a href="#è¿æ¥mysql8" class="headerlink" title="è¿æ¥mysql8"></a>è¿æ¥mysql8</h4><p>åœ¨nacosç›®å‰è¿™ä¸ªç‰ˆæœ¬å¦‚æœè¦è¿æ¥mysql8éœ€è¦æ·»åŠ jaråŒ…</p><p>åœ¨nacoså®‰è£…ç›®å½•ä¸‹é¢æ·»åŠ <code>\plugins\mysql</code>ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­æ·»åŠ è¿æ¥mysql8çš„jaråŒ…Â·</p><h3 id="nacosé…ç½®é›†ç¾¤"><a href="#nacosé…ç½®é›†ç¾¤" class="headerlink" title="nacosé…ç½®é›†ç¾¤"></a>nacosé…ç½®é›†ç¾¤</h3><h4 id="æˆ‘çš„é…ç½®"><a href="#æˆ‘çš„é…ç½®" class="headerlink" title="æˆ‘çš„é…ç½®"></a>æˆ‘çš„é…ç½®</h4><p>å››å°è™šæ‹Ÿæœº</p><table><thead><tr><th>ip</th><th>éƒ¨ç½²æœåŠ¡</th></tr></thead><tbody><tr><td>192.168.1.106</td><td>nginxï¼Œmysql:5.7.9</td></tr><tr><td>192.168.1.105</td><td>nacos</td></tr><tr><td>192.168.1.108</td><td>nacos</td></tr><tr><td>192.168.1.109</td><td>nacos</td></tr></tbody></table><p>==ä¸ºäº†ä¿è¯å¯ä»¥å®‰å…¨é€šè¿‡ï¼Œå»ºè®®å…ˆåœ¨å•æœºå¹¶ä¸”è¿æ¥æ•°æ®åº“çš„æƒ…å†µä¸‹å…ˆè¿è¡Œé€šè¿‡å†é…ç½®é›†ç¾¤==</p><p>ps: liunx ä¸‹çš„å•æœºå¯åŠ¨å‘½ä»¤ä¸º<code>./startup.sh -m standalone</code>ï¼Œå› ä¸º.shè„šæœ¬é‡Œé¢é»˜è®¤æ˜¯é›†ç¾¤æ¨¡å¼å¯åŠ¨ã€‚å¦‚æœæƒ³é…ç½®ä¼ªé›†ç¾¤çš„è¯éœ€è¦ä¿®æ”¹start.shå¯åŠ¨è„šæœ¬</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529095505214.png" alt="image-20200529095505214"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529095713167.png" alt="image-20200529095713167"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright 1999-2018 Alibaba Group Holding Ltd.</span></span><br><span class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"># You may obtain a copy of the License at</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line">cygwin=<span class="literal">false</span></span><br><span class="line">darwin=<span class="literal">false</span></span><br><span class="line">os400=<span class="literal">false</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;`uname`&quot;</span> <span class="keyword">in</span></span><br><span class="line">CYGWIN*) cygwin=<span class="literal">true</span>;;</span><br><span class="line">Darwin*) darwin=<span class="literal">true</span>;;</span><br><span class="line">OS400*) os400=<span class="literal">true</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">error_exit ()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ERROR: <span class="variable">$1</span> !!&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line">[ ! -e <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span> ] &amp;&amp; JAVA_HOME=<span class="variable">$HOME</span>/jdk/java</span><br><span class="line">[ ! -e <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span> ] &amp;&amp; JAVA_HOME=/usr/java</span><br><span class="line">[ ! -e <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span> ] &amp;&amp; JAVA_HOME=/opt/taobao/java</span><br><span class="line">[ ! -e <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span> ] &amp;&amp; <span class="built_in">unset</span> JAVA_HOME</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$JAVA_HOME</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> <span class="variable">$darwin</span>; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -x <span class="string">&#x27;/usr/libexec/java_home&#x27;</span> ] ; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">export</span> JAVA_HOME=`/usr/libexec/java_home`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> [ -d <span class="string">&quot;/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Home&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">export</span> JAVA_HOME=<span class="string">&quot;/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Home&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    JAVA_PATH=`dirname $(readlink -f $(<span class="built_in">which</span> javac))`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;x<span class="variable">$JAVA_PATH</span>&quot;</span> != <span class="string">&quot;x&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">export</span> JAVA_HOME=`dirname <span class="variable">$JAVA_PATH</span> 2&gt;/dev/null`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$JAVA_HOME</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        error_exit <span class="string">&quot;Please set the JAVA_HOME variable in your environment, We need java(x64)! jdk8 or later is better!&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> SERVER=<span class="string">&quot;nacos-server&quot;</span></span><br><span class="line"><span class="built_in">export</span> MODE=<span class="string">&quot;cluster&quot;</span></span><br><span class="line"><span class="built_in">export</span> FUNCTION_MODE=<span class="string">&quot;all&quot;</span></span><br><span class="line"><span class="built_in">export</span> PORT=<span class="string">&quot;8848&quot;</span> <span class="comment"># =========================æ”¹è¿™é‡Œ========================</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&quot;:m:f:s:p:&quot;</span> opt</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$opt</span> <span class="keyword">in</span></span><br><span class="line">        m)</span><br><span class="line">            MODE=<span class="variable">$OPTARG</span>;;</span><br><span class="line">        f)</span><br><span class="line">            FUNCTION_MODE=<span class="variable">$OPTARG</span>;;</span><br><span class="line">        s)</span><br><span class="line">            SERVER=<span class="variable">$OPTARG</span>;;</span><br><span class="line">        <span class="comment">#==================è¿™é‡Œä¹Ÿè¦==================#</span></span><br><span class="line">        p)</span><br><span class="line">        PORT=<span class="variable">$OPTARG</span>;;</span><br><span class="line">        ?)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Unknown parameter&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line"><span class="built_in">export</span> JAVA=<span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span></span><br><span class="line"><span class="built_in">export</span> BASE_DIR=`<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>)/..; <span class="built_in">pwd</span>`</span><br><span class="line"><span class="built_in">export</span> DEFAULT_SEARCH_LOCATIONS=<span class="string">&quot;classpath:/,classpath:/config/,file:./,file:./config/&quot;</span></span><br><span class="line"><span class="built_in">export</span> CUSTOM_SEARCH_LOCATIONS=<span class="variable">$&#123;DEFAULT_SEARCH_LOCATIONS&#125;</span>,file:<span class="variable">$&#123;BASE_DIR&#125;</span>/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="comment"># JVM Configuration</span></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;standalone&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xms512m -Xmx512m -Xmn256m&quot;</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dnacos.standalone=true&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/java_heapdump.hprof&quot;</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-UseLargePages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;FUNCTION_MODE&#125;</span>&quot;</span> == <span class="string">&quot;config&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dnacos.functionMode=config&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$&#123;FUNCTION_MODE&#125;</span>&quot;</span> == <span class="string">&quot;naming&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dnacos.functionMode=naming&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_MAJOR_VERSION=$(<span class="variable">$JAVA</span> -version 2&gt;&amp;1 | sed -E -n <span class="string">&#x27;s/.* version &quot;([0-9]*).*$/\1/p&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$JAVA_MAJOR_VERSION</span>&quot;</span> -ge <span class="string">&quot;9&quot;</span> ]] ; <span class="keyword">then</span></span><br><span class="line">  JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xlog:gc*:file=<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/nacos_gc.log:time,tags:filecount=10,filesize=102400&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Djava.ext.dirs=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre/lib/ext:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib/ext&quot;</span></span><br><span class="line">  JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xloggc:<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dloader.path=<span class="variable">$&#123;BASE_DIR&#125;</span>/plugins/health,<span class="variable">$&#123;BASE_DIR&#125;</span>/plugins/cmdb,<span class="variable">$&#123;BASE_DIR&#125;</span>/plugins/mysql&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dnacos.home=<span class="variable">$&#123;BASE_DIR&#125;</span>&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -jar <span class="variable">$&#123;BASE_DIR&#125;</span>/target/<span class="variable">$&#123;SERVER&#125;</span>.jar&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> <span class="variable">$&#123;JAVA_OPT_EXT&#125;</span>&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> --spring.config.location=<span class="variable">$&#123;CUSTOM_SEARCH_LOCATIONS&#125;</span>&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> --logging.config=<span class="variable">$&#123;BASE_DIR&#125;</span>/conf/nacos-logback.xml&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> --server.max-http-header-size=524288&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  mkdir <span class="variable">$&#123;BASE_DIR&#125;</span>/logs</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;standalone&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;nacos is starting with standalone&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;nacos is starting with cluster&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check the start.out log output file</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/start.out&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  touch <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/start.out&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># start</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span>&quot;</span> &gt; <span class="variable">$&#123;BASE_DIR&#125;</span>/logs/start.out 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># ==========================æ”¹è¿™é‡Œ====================</span></span><br><span class="line">nohup <span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span> -Dserver.port=<span class="variable">$&#123;PORT&#125;</span> nacos.nacos &gt;&gt; <span class="variable">$&#123;BASE_DIR&#125;</span>/logs/start.out 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nacos is startingï¼Œyou can check the <span class="variable">$&#123;BASE_DIR&#125;</span>/logs/start.out&quot;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ­¥éª¤"><a href="#é…ç½®æ­¥éª¤" class="headerlink" title="é…ç½®æ­¥éª¤"></a>é…ç½®æ­¥éª¤</h4><ol><li><p> ä¸‹è½½nacos-server.jarï¼Œæ³¨æ„ï¼šè¿™é‡Œä¸‹è½½çš„ç‰ˆæœ¬ä¸€å®šè¦ä¸€æ ·ï¼ï¼</p></li><li><p> è§£å‹<code>tar -zxvf xxx.tar.gz</code></p></li><li><p>è¿›å…¥nacoså®‰è£…ç›®å½•\confï¼Œä½¿ç”¨cluster.conf.exampleæ–‡ä»¶çš„å†…å®¹åˆ›å»ºä¸€ä¸ªåç§°ä¸ºcluster.confçš„æ–‡ä»¶</p><ol><li> <code>cp cluster.conf.example cluster.conf</code></li><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529092639246.png" alt="image-20200529092639246"></li></ol></li><li><p>ä¿®æ”¹cluster.confæ–‡ä»¶ï¼Œå°†æ–‡ä»¶å†…å®¹æ·»åŠ é›†ç¾¤ip:ç«¯å£å·</p><ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529093022916.png" alt="image-20200529093022916"></li></ol></li><li><p>ä¿®æ”¹confç›®å½•ä¸‹çš„application.properties</p><ol><li><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529093221473.png" alt="image-20200529093221473"></p></li><li><p> æ·»åŠ mysqlçš„é…ç½®ï¼Œå‚è€ƒä¸Šä¸€èŠ‚çš„æŒä¹…åŒ–é…ç½®</p></li><li><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529093327553.png" alt="image-20200529093327553"></p></li><li><p>```properties<br> #*************** Config Module Related Configurations ***************#</p><h3 id="If-user-MySQL-as-datasource"><a href="#If-user-MySQL-as-datasource" class="headerlink" title="If user MySQL as datasource:"></a>If user MySQL as datasource:</h3><p> spring.datasource.platform=mysql</p><h3 id="Count-of-DB"><a href="#Count-of-DB" class="headerlink" title="Count of DB:"></a>Count of DB:</h3><p> db.num=1</p><h3 id="Connect-URL-of-DB"><a href="#Connect-URL-of-DB" class="headerlink" title="Connect URL of DB:"></a>Connect URL of DB:</h3><p> db.url.0=jdbc:mysql://192.168.1.106:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true<br> db.user=root<br> db.password=123456</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6.  å¯åŠ¨mysqlï¼Œå¦‚æœè¦è¿æ¥mysql8å‚è€ƒæŒä¹…åŒ–é‡Œé¢çš„è§£å†³åŠæ³•</span><br><span class="line"></span><br><span class="line">7.  å¯åŠ¨ä¸‰å°nacos-server &#96;.&#x2F;startup.sh&#96;ï¼Œæ—¶é—´å¯èƒ½ä¼šæœ‰ç‚¹ä¹…</span><br><span class="line"></span><br><span class="line">8.  æŸ¥çœ‹å¯åŠ¨æ—¥å¿—&#96;cat start.out&#96;åœ¨logsç›®å½•é‡Œé¢ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé”™è¯¯å¯ä»¥çœ‹è¿™ä¸ªï¼Œæˆ–è€…nacos.log</span><br><span class="line"></span><br><span class="line">9.  å…¨éƒ½å¯åŠ¨èµ·æ¥ä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®nacosæ§åˆ¶å°ï¼Œä¸‰å°éƒ½è¦</span><br><span class="line"></span><br><span class="line">10.  å…¨éƒ½è®¿é—®æˆåŠŸä¹‹åï¼Œé…ç½®nginx</span><br><span class="line"></span><br><span class="line">     1.  ![image-20200529094119789](README.assets&#x2F;image-20200529094119789.png)</span><br><span class="line"></span><br><span class="line">     2.  æ·»åŠ ä¸€ä¸ªupstreamå’Œserver</span><br><span class="line"></span><br><span class="line">     3.  &#96;&#96;&#96;nginx</span><br><span class="line">         upstream cluster &#123;</span><br><span class="line">             server 192.168.1.109:8848;</span><br><span class="line">             server 192.168.1.106:8848;</span><br><span class="line">             server 192.168.1.108:8848;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         server &#123;</span><br><span class="line">             listen 23232;</span><br><span class="line">             server_name localhost;</span><br><span class="line">         </span><br><span class="line">             location &#x2F; &#123;</span><br><span class="line">                 proxy_pass http:&#x2F;&#x2F;cluster;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p> å¯åŠ¨nginxï¼Œæµè§ˆå™¨è®¿é—®<a href="http://192.168.1.106:23232/nacos%EF%BC%8C%E8%BF%99%E9%87%8C%E6%98%AF%E8%AE%BF%E9%97%AE%E7%9A%84nginx%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BB%A3%E7%90%86%E5%88%B0%E9%82%A3%E4%B8%89%E5%8F%B0nacos%E4%B8%8A%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%87%BA%E7%8E%B0%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2%E5%88%99%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F">http://192.168.1.106:23232/nacosï¼Œè¿™é‡Œæ˜¯è®¿é—®çš„nginxï¼ŒæŸ¥çœ‹æœ‰æ²¡æœ‰ä»£ç†åˆ°é‚£ä¸‰å°nacosä¸Šï¼Œå¦‚æœå‡ºç°ç™»å½•ç•Œé¢åˆ™é…ç½®æˆåŠŸ</a></p></li><li><p>nacosæ§åˆ¶å°æ·»åŠ ä¸€ä¸ªé…ç½®ï¼ŒæŸ¥çœ‹å…¶ä»–ä¸¤å°nacosæœ‰æ²¡æœ‰åŒæ ·çš„æ•°æ®ï¼Œæœ‰å°±okå•¦ï¼ï¼ï¼ï¼ğŸ˜†</p><p> psï¼šæˆ‘é…äº†ä¸€ä¸‹åˆåŠ ä¸€æ™šä¸ŠğŸ™ƒï¼Œè¯¥æ­»çš„ç‰ˆæœ¬</p></li></ol><h1 id="star2-åäº”ã€SpringCloud-Alibaba-Sentinleå®ç°ç†”æ–­ä¸é™æµ"><a href="#star2-åäº”ã€SpringCloud-Alibaba-Sentinleå®ç°ç†”æ–­ä¸é™æµ" class="headerlink" title=":star2:åäº”ã€SpringCloud Alibaba Sentinleå®ç°ç†”æ–­ä¸é™æµ"></a>:star2:åäº”ã€SpringCloud Alibaba Sentinleå®ç°ç†”æ–­ä¸é™æµ</h1><h2 id="Sentinle"><a href="#Sentinle" class="headerlink" title="Sentinle"></a>Sentinle</h2><h3 id="å®˜ç½‘-2"><a href="#å®˜ç½‘-2" class="headerlink" title="å®˜ç½‘"></a>å®˜ç½‘</h3><p><a href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p><p><a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">ä¸­æ–‡ç‰ˆ</a></p><p><a href="https://github.com/alibaba/Sentinel/wiki">wiki</a></p><h3 id="æ˜¯ä»€ä¹ˆ-11"><a href="#æ˜¯ä»€ä¹ˆ-11" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p>ä¸€å¥è¯è§£é‡Šï¼Œä¹‹å‰æˆ‘ä»¬è®²è§£è¿‡çš„Hystrixçš„Alibabaç‰ˆ</p><h3 id="å»å“ªä¸‹-2"><a href="#å»å“ªä¸‹-2" class="headerlink" title="å»å“ªä¸‹"></a>å»å“ªä¸‹</h3><p><a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p><h3 id="èƒ½å¹²å˜›-6"><a href="#èƒ½å¹²å˜›-6" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529101917054.png" alt="image-20200529101917054"></p><h3 id="æ€ä¹ˆç©"><a href="#æ€ä¹ˆç©" class="headerlink" title="æ€ä¹ˆç©"></a>æ€ä¹ˆç©</h3><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">å®˜ç½‘è§£é‡Š</a></p><p>æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜</p><ul><li>  æœåŠ¡é›ªå´©</li><li>  æœåŠ¡é™çº§</li><li>  æœåŠ¡ç†”æ–­</li><li>  æœåŠ¡é™æµ</li></ul><h2 id="å®‰è£…Sentinleæ§åˆ¶å°"><a href="#å®‰è£…Sentinleæ§åˆ¶å°" class="headerlink" title="å®‰è£…Sentinleæ§åˆ¶å°"></a>å®‰è£…Sentinleæ§åˆ¶å°</h2><h3 id="Sentinel-åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†"><a href="#Sentinel-åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†" class="headerlink" title="Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:"></a>Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:</h3><ul><li>  æ ¸å¿ƒåº“(Java å®¢æˆ·ç«¯)ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“,èƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰Java è¿è¡Œæ—¶ç¯å¢ƒ,åŒæ—¶å¯¹ Dubbo/Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ.</li><li>æ§åˆ¶å°(Dashboard)åŸºäº Spring Boot å¼€å‘,æ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œ,ä¸éœ€è¦é¢å¤–çš„ Tomcatç­‰åº”ç”¨<br>  å®¹å™¨.</li></ul><h3 id="å®‰è£…å¯åŠ¨æ­¥éª¤"><a href="#å®‰è£…å¯åŠ¨æ­¥éª¤" class="headerlink" title="å®‰è£…å¯åŠ¨æ­¥éª¤"></a>å®‰è£…å¯åŠ¨æ­¥éª¤</h3><ol><li>ä¸‹è½½<a href="https://github.com/alibaba/Sentinel/releases/download/1.7.2/sentinel-dashboard-1.7.2.jar">sentinel-dashboard-1.7.2.jar</a><ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529102718476.png" alt="image-20200529102718476"></li></ol></li><li> ä½¿ç”¨ <code>java -jar</code> å‘½ä»¤å¯åŠ¨ï¼Œä½†æ˜¯æ³¨æ„ï¼šsentinelçš„é»˜è®¤å‰å°ç«¯å£å·ä¸º8080ï¼Œæ‰€ä»¥8080ç«¯å£ä¸èƒ½è¢«å ç”¨ï¼Œå¹¶ä¸”éœ€è¦java8çš„ç¯å¢ƒ</li><li>æµè§ˆå™¨è¾“å…¥<code>localhost:8080</code>ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹ç•Œé¢è¯´æ˜å¯åŠ¨æˆåŠŸ<ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529103148889.png" alt="image-20200529103148889"></li></ol></li><li>ç™»å½•sentinelï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯sentinel<ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529103241722.png" alt="image-20200529103241722"></li></ol></li></ol><h2 id="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><a href="#åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="headerlink" title="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"></a>åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h2><h3 id="åˆ›å»ºcloudalibaba-sentinel-service8401"><a href="#åˆ›å»ºcloudalibaba-sentinel-service8401" class="headerlink" title="åˆ›å»ºcloudalibaba-sentinel-service8401"></a>åˆ›å»ºcloudalibaba-sentinel-service8401</h3><h4 id="POM-4"><a href="#POM-4" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ll.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="YML-3"><a href="#YML-3" class="headerlink" title="YML"></a>YML</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#é…ç½®Sentinel dashboardåœ°å€</span></span><br><span class="line">        <span class="comment"># é»˜è®¤æ˜¯8719ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ä¼šè‡ªåŠ¨+1ç›´åˆ°æ‰¾åˆ°å¯ç”¨çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨-3"><a href="#ä¸»å¯åŠ¨-3" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApp8410</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApp8410.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»FlowLimitController"><a href="#ä¸šåŠ¡ç±»FlowLimitController" class="headerlink" title="ä¸šåŠ¡ç±»FlowLimitController"></a>ä¸šåŠ¡ç±»FlowLimitController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLimitController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        log.info(Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;...testB&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-21"><a href="#æµ‹è¯•-21" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li> å¯åŠ¨ä¾æ¬¡nacos-serverã€sentinelå’Œ8401</li><li>ç™»å½•sentinelçš„æ§åˆ¶å°ä¼šå‘ç°ç©ºç©ºå¦‚ä¹Ÿï¼Œä¸ºå•¥ä¸€ä¸ªè¢«ç›‘æ§çš„æœåŠ¡æ²¡æœ‰ï¼Ÿ<ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529110904527.png" alt="image-20200529110904527"></li><li> å› ä¸ºsentinelé»˜è®¤æ˜¯æ‡’åŠ è½½ï¼Œéœ€è¦å¯¹åº”çš„æœåŠ¡æœ‰ä¸€æ¬¡è¯·æ±‚</li></ol></li><li>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8401/testA%E5%92%8Chttp://localhost:8401/testB%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E6%9F%A5%E7%9C%8Bsentinel%E6%8E%A7%E5%88%B6%E5%8F%B0">http://localhost:8401/testAå’Œhttp://localhost:8401/testBï¼Œç„¶åå†æŸ¥çœ‹sentinelæ§åˆ¶å°</a><ol><li> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529111045642.png" alt="image-20200529111045642"></li></ol></li></ol><h2 id="æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶ï¼‰"><a href="#æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶ï¼‰" class="headerlink" title="æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶ï¼‰"></a>æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶ï¼‰</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529112141525.png" alt="image-20200529112141525"></p><ul><li>  èµ„æºåï¼šå”¯ä¸€åç§°ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„</li><li>  é’ˆå¯¹æ¥æºï¼š<code>Sentinel</code>å¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡åï¼ŒæŒ‡å®šå¯¹å“ªä¸ªå¾®æœåŠ¡è¿›è¡Œé™æµ ï¼Œé»˜è®¤<code>default</code>(ä¸åŒºåˆ†æ¥æºï¼Œå…¨éƒ¨é™åˆ¶)</li><li>é˜ˆå€¼ç±»å‹/å•æœºé˜ˆå€¼ï¼š<ul><li>  QPS(æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡)ï¼šå½“è°ƒç”¨è¯¥æ¥å£çš„QPSè¾¾åˆ°äº†é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµï¼›</li><li>  çº¿ç¨‹æ•°ï¼šå½“è°ƒç”¨è¯¥æ¥å£çš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œé™æµ</li></ul></li><li>  æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤</li><li>æµæ§æ¨¡å¼ï¼š<ul><li>  ç›´æ¥ï¼šæ¥å£è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ</li><li>  å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</li><li>  é“¾è·¯ï¼šåªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±å¯ä»¥é™æµï¼‰[apiçº§åˆ«çš„é’ˆå¯¹æ¥æº]</li></ul></li><li>æµæ§æ•ˆæœ<ul><li>  å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥ï¼Œå°±å¼‚å¸¸</li><li>  Warm Upï¼šæ ¹æ®**<code>codeFactor</code>**ï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤ä¸º3ï¼‰çš„å€¼ï¼Œå³è¯·æ±‚ QPS ä» <strong><code>threshold / 3</code></strong> å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼</li><li>  æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿ,è®©è¯·æ±‚ä»¥åŒ€é€Ÿçš„é€Ÿåº¦é€šè¿‡,é˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸ºQPS,å¦åˆ™æ— æ•ˆ</li></ul></li></ul><p><a href="%5Bhttps://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6#%E5%9F%BA%E4%BA%8Eqps%E5%B9%B6%E5%8F%91%E6%95%B0%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%5D(https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6#%E5%9F%BA%E4%BA%8Eqps%E5%B9%B6%E5%8F%91%E6%95%B0%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6)">è¯¦æƒ…çœ‹è¿™é‡Œ</a></p><h3 id="æµæ§æ¨¡å¼"><a href="#æµæ§æ¨¡å¼" class="headerlink" title="æµæ§æ¨¡å¼"></a>æµæ§æ¨¡å¼</h3><ol><li><p>ç›´æ¥å¿«é€Ÿå¤±è´¥</p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/../../springcloud/%E5%9B%BE%E7%89%87/sentinel%E7%9A%849.png"></p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%845.png"></p><pre><code> ==ç›´æ¥å¤±è´¥çš„æ•ˆæœ:==</code></pre><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%846.png"></p></li><li><p>çº¿ç¨‹æ•°:</p><p> â€‹        <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/../../springcloud/%E5%9B%BE%E7%89%87/sentinel%E7%9A%848.png"></p><p> â€‹    <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8410.png"></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚aè¯·æ±‚è¿‡æ¥,å¤„ç†å¾ˆæ…¢,åœ¨ä¸€ç›´å¤„ç†,æ­¤æ—¶bè¯·æ±‚åˆè¿‡æ¥äº†</span><br><span class="line">æ­¤æ—¶å› ä¸ºaå ç”¨ä¸€ä¸ªçº¿ç¨‹,æ­¤æ—¶è¦å¤„ç†bè¯·æ±‚å°±åªæœ‰é¢å¤–å¼€å¯ä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">é‚£ä¹ˆå°±ä¼šæŠ¥é”™</span><br></pre></td></tr></table></figure><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8411.png"></p></li></ol><h3 id="æµæ§è§„åˆ™"><a href="#æµæ§è§„åˆ™" class="headerlink" title="æµæ§è§„åˆ™"></a>æµæ§è§„åˆ™</h3><h4 id="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"><a href="#ç›´æ¥ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"></a>ç›´æ¥ï¼ˆé»˜è®¤ï¼‰</h4><p>å¿«é€Ÿç‚¹å‡»è®¿é—®<a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p><p>ä¸€ç§’åªèƒ½è®¿é—®ä¸€æ¬¡ï¼Œå¿«é€Ÿè®¿é—®ä¼šå‡ºç°Blocked by Sentinel (flow limiting)é”™è¯¯</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529113305794.png" alt="image-20200529113305794">æµ‹è¯•</p><p><strong>é—®é¢˜ï¼š</strong></p><p>ç›´æ¥è°ƒç”¨é»˜è®¤æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ€æœ¯æ–¹é¢OK butï¼Œæ˜¯å¦åº”è¯¥æœ‰æˆ‘ä»¬è‡ªå·±çš„åç»­å¤„ç†ï¼Ÿ<br>ç±»ä¼¼æœ‰ä¸€ä¸ªfallbackçš„å…œåº•æ–¹æ³•ï¼Ÿ</p><h4 id="å…³è”"><a href="#å…³è”" class="headerlink" title="å…³è”"></a>å…³è”</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8412.png"></p><p>==åº”ç”¨åœºæ™¯:  æ¯”å¦‚<strong>æ”¯ä»˜æ¥å£</strong>è¾¾åˆ°é˜ˆå€¼,å°±è¦é™æµä¸‹<strong>è®¢å•çš„æ¥å£</strong>,é˜²æ­¢ä¸€ç›´æœ‰è®¢å•==</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8413.png"></p><p><strong>å½“testAè¾¾åˆ°é˜ˆå€¼,qpså¤§äº1,å°±è®©testBä¹‹åçš„è¯·æ±‚ç›´æ¥å¤±è´¥</strong></p><p>å¯ä»¥ä½¿ç”¨postmanå‹æµ‹</p><h4 id="é“¾è·¯"><a href="#é“¾è·¯" class="headerlink" title="é“¾è·¯"></a>é“¾è·¯</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">            machine-root</span><br><span class="line">              &#x2F;       \</span><br><span class="line">             &#x2F;         \</span><br><span class="line">       Entrance1     Entrance2</span><br><span class="line">          &#x2F;             \</span><br><span class="line">         &#x2F;               \</span><br><span class="line">DefaultNode(nodeA)   DefaultNode(nodeA)</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºçš„Nodeåˆ†å¸ƒæƒ…å†µï¼Œèµ„æºnodeAåˆ†åˆ«åœ¨ä¸¤ä¸ªä¸Šä¸‹æ–‡Entrance1å’ŒEntrance2ä¸‹è¿›è¡Œè°ƒç”¨ï¼Œå‡è®¾åœ¨ä¸Šä¸‹æ–‡Entrance1çš„è°ƒç”¨é‡å¾ˆå¤§ï¼Œè€Œä¸Šä¸‹æ–‡Entrance2çš„è°ƒç”¨é‡å¾ˆå°ï¼Œæˆ‘ä»¬æƒ³é’ˆå¯¹Entrance1ä¸Šä¸‹æ–‡çš„nodeAè°ƒç”¨è¿›è¡Œé™æµï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<strong>é“¾è·¯é™æµæ¨¡å¼</strong>ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/a.png" alt="img"> </p><p>é‚£ä¹ˆåœ¨ä¸Šä¸‹æ–‡Entrance2ä¸‹å¯¹nodeAçš„è°ƒç”¨å°±æ²¡æœ‰å½±å“</p><h4 id="é¢„çƒ­Warm-up"><a href="#é¢„çƒ­Warm-up" class="headerlink" title="é¢„çƒ­Warm up"></a>é¢„çƒ­Warm up</h4><p>â€‹     <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8414.png"></p><p>  <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/../../springcloud/%E5%9B%BE%E7%89%87/sentinel%E7%9A%8415.png"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8416.png"></p><p> ==åº”ç”¨åœºæ™¯==</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8417.png"></p><h4 id="æ’é˜Ÿç­‰å¾…"><a href="#æ’é˜Ÿç­‰å¾…" class="headerlink" title="æ’é˜Ÿç­‰å¾…"></a>æ’é˜Ÿç­‰å¾…</h4><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8418.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8419.png"></p><h2 id="é™çº§è§„åˆ™"><a href="#é™çº§è§„åˆ™" class="headerlink" title="é™çº§è§„åˆ™"></a>é™çº§è§„åˆ™</h2><p><strong>å°±æ˜¯ç†”æ–­é™çº§</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8421.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8420.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8422.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8423.png"></p><h3 id="RTé…ç½®"><a href="#RTé…ç½®" class="headerlink" title="RTé…ç½®:"></a>RTé…ç½®:</h3><p>æ–°å¢ä¸€ä¸ªè¯·æ±‚æ–¹æ³•ç”¨äºæµ‹è¯•</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8424.png"></p><p>==é…ç½®RT:==</p><p>â€‹                è¿™é‡Œé…ç½®çš„PT,é»˜è®¤æ˜¯ç§’çº§çš„å¹³å‡å“åº”æ—¶é—´</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8425.png"></p><p>é»˜è®¤è®¡ç®—å¹³å‡æ—¶é—´æ˜¯: 1ç§’ç±»è¿›å…¥5ä¸ªè¯·æ±‚,å¹¶ä¸”å“åº”çš„å¹³å‡å€¼è¶…è¿‡é˜ˆå€¼(è¿™é‡Œçš„200ms),å°±æŠ¥é”™]</p><p>â€‹            1ç§’5è¯·æ±‚æ˜¯Sentinelé»˜è®¤è®¾ç½®çš„</p><p>==æµ‹è¯•==</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8427.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8426.png"></p><p><strong>é»˜è®¤ç†”æ–­å.å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸</strong></p><h3 id="å¼‚å¸¸æ¯”ä¾‹"><a href="#å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="å¼‚å¸¸æ¯”ä¾‹:"></a>å¼‚å¸¸æ¯”ä¾‹:</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8428.png"></p><p>ä¿®æ”¹è¯·æ±‚æ–¹æ³•</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8429.png"></p><p>é…ç½®:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8431.png"></p><p>==å¦‚æœæ²¡è§¦å‘ç†”æ–­,è¿™æ­£å¸¸æŠ›å‡ºå¼‚å¸¸==:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8432.png"></p><p>==è§¦å‘ç†”æ–­==:</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8433.png"></p><h3 id="å¼‚å¸¸æ•°"><a href="#å¼‚å¸¸æ•°" class="headerlink" title="å¼‚å¸¸æ•°:"></a>å¼‚å¸¸æ•°:</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8434.png"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%8435.png"></p><p>ä¸€åˆ†é’Ÿä¹‹å†…,æœ‰5ä¸ªè¯·æ±‚å‘é€å¼‚å¸¸,è¿›å…¥ç†”æ–­</p><h2 id="çƒ­ç‚¹è§„åˆ™"><a href="#çƒ­ç‚¹è§„åˆ™" class="headerlink" title="çƒ­ç‚¹è§„åˆ™"></a>çƒ­ç‚¹è§„åˆ™</h2><blockquote><p>  ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š</p><ul><li>  å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>  ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>  çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529142000115.png" alt="image-20200529142000115"></p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529142308769.png" alt="image-20200529142308769"></p><p>å‚æ•°ç´¢å¼•æ˜¯æ–¹æ³•é‡Œé¢çš„å‚æ•°ä½ç½®ï¼Œè€Œä¸æ˜¯ç½‘å€é‡Œé¢çš„å‚æ•°ä½ç½®</p><h3 id="ä¿®æ”¹8401"><a href="#ä¿®æ”¹8401" class="headerlink" title="ä¿®æ”¹8401"></a>ä¿®æ”¹8401</h3><p>åœ¨controllerä¸­æ–°å¢ä¸€ä¸ªæ–¹æ³•</p><p>@SentinelResourceï¼švalueå€¼ä½œä¸ºæ–°å¢çƒ­ç‚¹è§„åˆ™æ—¶æ·»åŠ çš„èµ„æºåï¼Œä¸èƒ½é‡å¤ï¼›blockHandlerå€¼ä¸ºå…œåº•çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotKey&quot;, blockHandler = &quot;testHotKey_block&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;, required = false)</span> String p1,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;, required = false)</span> String p2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p1+<span class="string">&quot;, &quot;</span>+p2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testHotKey_block</span><span class="params">(String p1, String p2, BlockException e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;qwq&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é¢å¤–é…ç½®"><a href="#é¢å¤–é…ç½®" class="headerlink" title="é¢å¤–é…ç½®"></a>é¢å¤–é…ç½®</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529143651570.png" alt="image-20200529143651570"></p><p>å½“å‚æ•°å€¼ä¸ºeeeæ—¶é™æµé˜ˆå€¼ä¸º200</p><p><a href="http://localhost:8401/testHotKey?p1=eee">http://localhost:8401/testHotKey?p1=eee</a> é™æµé˜ˆå€¼ä¸º200</p><p><a href="http://localhost:8401/testHotKey?p1=123">http://localhost:8401/testHotKey?p1=123</a> é™æµé˜ˆå€¼ä¸º1</p><h2 id="ç³»ç»Ÿè§„åˆ™"><a href="#ç³»ç»Ÿè§„åˆ™" class="headerlink" title="ç³»ç»Ÿè§„åˆ™"></a>ç³»ç»Ÿè§„åˆ™</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529145026877.png" alt="image-20200529145026877"></p><p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p><ul><li>  <strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li><li>  <strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li><li>  <strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li>  <strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li>  <strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li></ul><h2 id="SentinelResourceæ³¨è§£"><a href="#SentinelResourceæ³¨è§£" class="headerlink" title="@SentinelResourceæ³¨è§£"></a>@SentinelResourceæ³¨è§£</h2><p><a href="%5Bhttps://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81%5D(https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81)">è¯¦ç»†çš„çœ‹è¿™é‡Œ</a></p><blockquote><h2 id="SentinelResource-æ³¨è§£"><a href="#SentinelResource-æ³¨è§£" class="headerlink" title="@SentinelResource æ³¨è§£"></a>@SentinelResource æ³¨è§£</h2><blockquote><p>  æ³¨æ„ï¼šæ³¨è§£æ–¹å¼åŸ‹ç‚¹ä¸æ”¯æŒ private æ–¹æ³•ã€‚</p></blockquote><p>  <code>@SentinelResource</code> ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œ fallback é…ç½®é¡¹ã€‚ <code>@SentinelResource</code> æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li>  <code>value</code>ï¼šèµ„æºåç§°ï¼Œå¿…éœ€é¡¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</li><li>  <code>entryType</code>ï¼šentry ç±»å‹ï¼Œå¯é€‰é¡¹ï¼ˆé»˜è®¤ä¸º <code>EntryType.OUT</code>ï¼‰</li><li>  <code>blockHandler</code> / <code>blockHandlerClass</code>: <code>blockHandler</code> å¯¹åº”å¤„ç† <code>BlockException</code> çš„å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ã€‚blockHandler å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯ <code>public</code>ï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º <code>BlockException</code>ã€‚blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>blockHandlerClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li><li><code>fallback</code> / <code>fallbackClass</code>ï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† <code>exceptionsToIgnore</code> é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š<ul><li>  è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>  æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª <code>Throwable</code> ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>  fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ul></li><li><code>defaultFallback</code>ï¼ˆsince 1.6.0ï¼‰ï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† <code>exceptionsToIgnore</code>é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚ï¼š<ul><li>  è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>  æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª <code>Throwable</code> ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>  defaultFallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ul></li><li>  <code>exceptionsToIgnore</code>ï¼ˆsince 1.6.0ï¼‰ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚</li></ul><blockquote><p>  æ³¨ï¼š1.6.0 ä¹‹å‰çš„ç‰ˆæœ¬ fallback å‡½æ•°åªé’ˆå¯¹é™çº§å¼‚å¸¸ï¼ˆ<code>DegradeException</code>ï¼‰è¿›è¡Œå¤„ç†ï¼Œ<strong>ä¸èƒ½é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸è¿›è¡Œå¤„ç†</strong>ã€‚</p></blockquote><p>  ==ç‰¹åˆ«åœ°ï¼Œè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º <code>BlockException</code> æ—¶åªä¼šè¿›å…¥ <code>blockHandler</code> å¤„ç†é€»è¾‘ã€‚è‹¥æœªé…ç½® <code>blockHandler</code>ã€<code>fallback</code> å’Œ <code>defaultFallback</code>ï¼Œåˆ™è¢«é™æµé™çº§æ—¶ä¼šå°† <code>BlockException</code> <strong>ç›´æ¥æŠ›å‡º</strong>ï¼ˆè‹¥æ–¹æ³•æœ¬èº«æœªå®šä¹‰ throws BlockException åˆ™ä¼šè¢« JVM åŒ…è£…ä¸€å±‚ <code>UndeclaredThrowableException</code>ï¼‰ã€‚==</p></blockquote><p>blockHandleræ”¯æŒé‡å†™</p><p><code>fallback</code> ç®¡javaå¼‚å¸¸<code>blockHandler</code> ç®¡<code>BlockException</code> </p><p>æŒ‰urlé™æµä½¿ç”¨çš„æ˜¯é»˜è®¤çš„å…œåº•æ–¹æ³•ï¼Œè€Œä¸æ˜¯æŒ‡å®šçš„å…œåº•æ–¹æ³•</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/image-20200529152748291.png" alt="image-20200529152748291"></p><h3 id="è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"><a href="#è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" class="headerlink" title="è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘:"></a>è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘:</h3><ol><li><p>==å•ç‹¬åˆ›å»ºä¸€ä¸ªç±»,ç”¨äºå¤„ç†é™æµ==</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%84%E7%9A%841.png"></p></li><li><p>==åœ¨controllerä¸­,æŒ‡å®šä½¿ç”¨è‡ªå®šä¹‰ç±»ä¸­çš„æ–¹æ³•ä½œä¸ºé™çº§æ–¹æ³•==</p><p> <img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/sentinel%E7%9A%84%E7%9A%842.png"></p></li></ol><h2 id="æœåŠ¡ç†”æ–­-1"><a href="#æœåŠ¡ç†”æ–­-1" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h2><p>sentinelæ•´åˆribbon+openFeign+fallback</p><p>æœ‰æ‰‹å°±è¡Œï¼Œå»å‚è€ƒopenFeignæ•´åˆè±ªçŒªå“¥çš„ç¬”è®°ï¼Œç´¯äº†ï¼Œä¸æƒ³å†™äº†ã€‚</p><p>æ³¨æ„æ·»åŠ openFeignå¯¹sentinelçš„æ”¯æŒï¼Œå’ŒopenFeignçš„ä¾èµ–</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br></pre></td></tr></table></figure><h2 id="è§„åˆ™æŒä¹…åŒ–"><a href="#è§„åˆ™æŒä¹…åŒ–" class="headerlink" title="è§„åˆ™æŒä¹…åŒ–"></a>è§„åˆ™æŒä¹…åŒ–</h2><h3 id="sentinel-è§„åˆ™æŒä¹…åŒ–åˆ°nacos"><a href="#sentinel-è§„åˆ™æŒä¹…åŒ–åˆ°nacos" class="headerlink" title="sentinel è§„åˆ™æŒä¹…åŒ–åˆ°nacos"></a>sentinel è§„åˆ™æŒä¹…åŒ–åˆ°nacos</h3><blockquote><p>  <strong>ç›®å½•</strong></p></blockquote><h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>Sentinel Dashboardä¸­æ·»åŠ çš„è§„åˆ™æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œåªè¦é¡¹ç›®ä¸€é‡å¯è§„åˆ™å°±ä¸¢å¤±äº†</p><p>æ­¤å¤„å°†è§„åˆ™æŒä¹…åŒ–åˆ°nacosä¸­ï¼Œåœ¨nacosä¸­æ·»åŠ è§„åˆ™ï¼Œç„¶ååŒæ­¥åˆ°dashboardä¸­ï¼›</p><p>åé¢ç ”ç©¶å¦‚æœå°†dashboardä¸­æ·»åŠ çš„è§„åˆ™è‡ªåŠ¨æ·»åŠ åˆ°nacosä¸­</p><p>å®˜ç½‘æ•™ç¨‹åœ°å€ï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</a></p><h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><p>1.å¯¼å…¥ä¾èµ–åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Greenwich.SR2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.åœ¨application.propertiesä¸­é…ç½®sentinel-nacosä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.application.name</span>=<span class="string">mz</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8003</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel dashboard</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.transport.dashboard</span>=<span class="string">localhost:8080</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds1.nacos.server-addr</span>=<span class="string">localhost:8848</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds1.nacos.data-id</span>=<span class="string">mz-sentinel</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds1.nacos.group-id</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds1.nacos.data-type</span>=<span class="string">json</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds1.nacos.rule-type</span>=<span class="string">flow</span></span><br></pre></td></tr></table></figure><p>3.åœ¨nacosä¸­æ·»åŠ è§„åˆ™</p><p><img src= "/img/loading.gif" data-lazy-src="https://img2018.cnblogs.com/blog/1230278/201907/1230278-20190731222443568-75493756.png" alt="img"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;resource&quot;:</span> <span class="string">&quot;/hello&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;limitApp&quot;:</span> <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;:</span> <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;count&quot;:</span> <span class="number">5</span>,</span><br><span class="line">        <span class="attr">&quot;strategy&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;controlBehavior&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;clusterMode&quot;:</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>4.åˆ›å»ºæµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello sentinel&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®å‡ æ¬¡æ¥å£ä¹‹åï¼Œå°±å¯ä»¥åœ¨Sentinel Dashboard ä¸­çœ‹åˆ°åœ¨nacosä¸­é…ç½®çš„è§„åˆ™ä¿¡æ¯äº†ï¼Œå¹¶ä¸”é¡¹ç›®æœåŠ¡é‡å¯ä¾ç„¶å­˜åœ¨</p><p><img src= "/img/loading.gif" data-lazy-src="https://img2018.cnblogs.com/blog/1230278/201907/1230278-20190731222719960-166637927.png" alt="img"></p><h3 id="ä¿®æ”¹è§„åˆ™åŒæ­¥åˆ°Nacos"><a href="#ä¿®æ”¹è§„åˆ™åŒæ­¥åˆ°Nacos" class="headerlink" title="ä¿®æ”¹è§„åˆ™åŒæ­¥åˆ°Nacos"></a><a href="https://www.jianshu.com/p/b597664c7678">ä¿®æ”¹è§„åˆ™åŒæ­¥åˆ°Nacos</a></h3><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>ä¸‹é¢ç›´æ¥æ¥çœ‹çœ‹å¦‚ä½•å®ç°çš„å…·ä½“æ”¹é€ æ­¥éª¤ï¼Œè¿™é‡Œå‚è€ƒäº†<code>Sentinel Dashboard</code>æºç ä¸­å…³äºNacoså®ç°çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä½†æ˜¯ç”±äºè€ƒè™‘åˆ°ä¸Spring Cloud Alibabaçš„ç»“åˆä½¿ç”¨ï¼Œç•¥ä½œä¿®æ”¹ã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šä¿®æ”¹<code>pom.xml</code>ä¸­çš„sentinel-datasource-nacosçš„ä¾èµ–ï¼Œå°†<code>&lt;scope&gt;test&lt;/scope&gt;</code>æ³¨é‡Šæ‰ï¼Œè¿™æ ·æ‰èƒ½åœ¨ä¸»ç¨‹åºä¸­ä½¿ç”¨ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥</strong>ï¼šæ‰¾åˆ°<code>resources/app/scripts/directives/sidebar/sidebar.html</code>ä¸­çš„è¿™æ®µä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ui-sref-active</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">&quot;dashboard.flowV1(&#123;app: entry.app&#125;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;glyphicon glyphicon-filter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>æµæ§è§„åˆ™</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ui-sref-active</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">&quot;dashboard.flow(&#123;app: entry.app&#125;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;glyphicon glyphicon-filter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>æµæ§è§„åˆ™</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šåœ¨<code>com.alibaba.csp.sentinel.dashboard.rule</code>åŒ…ä¸‹æ–°å»ºä¸€ä¸ªnacosåŒ…ï¼Œç”¨æ¥ç¼–å†™é’ˆå¯¹Nacosçš„æ‰©å±•å®ç°ã€‚</p><p><strong>ç¬¬å››æ­¥</strong>ï¼šåˆ›å»ºNacosçš„é…ç½®ç±»ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NacosConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; flowRuleEntityEncoder() &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON::toJSONString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; flowRuleEntityDecoder() &#123;</span><br><span class="line">        <span class="keyword">return</span> s -&gt; JSON.parseArray(s, FlowRuleEntity.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigService <span class="title">nacosConfigService</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(PropertyKeyConst.SERVER_ADDR, <span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ConfigFactory.createConfigService(properties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨åˆ°äº†namespaceéš”ç¦»ç¯å¢ƒï¼Œå¯ä»¥åœ¨<code>nacosConfigService</code>æ–¹æ³•ä¸­å†åŠ å…¥é…ç½®ï¼Œæ¯”å¦‚ï¼š<code>properties.put(PropertyKeyConst.NAMESPACE, &quot;130e71fa-97fe-467d-ad77-967456f2c16d&quot;);</code></p><p><strong>ç¬¬äº”æ­¥</strong>ï¼šå®ç°Nacosçš„é…ç½®æ‹‰å–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowRuleNacosProvider</span> <span class="keyword">implements</span> <span class="title">DynamicRuleProvider</span>&lt;<span class="title">List</span>&lt;<span class="title">FlowRuleEntity</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigService configService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; converter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FLOW_DATA_ID_POSTFIX = <span class="string">&quot;-sentinel&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GROUP_ID = <span class="string">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FlowRuleEntity&gt; <span class="title">getRules</span><span class="params">(String appName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String rules = configService.getConfig(appName + FLOW_DATA_ID_POSTFIX, GROUP_ID, <span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtil.isEmpty(rules)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> converter.convert(rules);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>  <code>getRules</code>æ–¹æ³•ä¸­çš„<code>appName</code>å‚æ•°æ˜¯Sentinelä¸­çš„æœåŠ¡åç§°ã€‚</li><li>  <code>configService.getConfig</code>æ–¹æ³•æ˜¯ä»Nacosä¸­è·å–é…ç½®ä¿¡æ¯çš„å…·ä½“æ“ä½œã€‚å…¶ä¸­ï¼ŒDataIdå’ŒGroupIdåˆ†åˆ«å¯¹åº”å®¢æˆ·ç«¯ä½¿ç”¨æ—¶å€™çš„å¯¹åº”é…ç½®ã€‚æ¯”å¦‚è¿™é‡Œçš„ä¾‹å­å¯¹åº”äº†ä¹‹å‰æˆ‘ä»¬åœ¨<a href="https://links.jianshu.com/go?to=http://blog.didispace.com/spring-cloud-alibaba-sentinel-2-1/">ã€ŠSentinelä½¿ç”¨Nacoså­˜å‚¨è§„åˆ™ã€‹</a>ä¸€æ–‡ä¸­çš„é…ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds.nacos.groupId</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="meta">spring.cloud.sentinel.datasource.ds.nacos.dataId</span>=<span class="string">$&#123;spring.application.name&#125;-sentinel</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸¤è¾¹çš„DataIdå’ŒGroupIdå¿…é¡»å¯¹åº”ä¸Šã€‚</p><p><strong>ç¬¬å…­æ­¥</strong>ï¼šå®ç°Nacosçš„é…ç½®æ¨é€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowRuleNacosPublisher</span> <span class="keyword">implements</span> <span class="title">DynamicRulePublisher</span>&lt;<span class="title">List</span>&lt;<span class="title">FlowRuleEntity</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigService configService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; converter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FLOW_DATA_ID_POSTFIX = <span class="string">&quot;-sentinel&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GROUP_ID = <span class="string">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publish</span><span class="params">(String app, List&lt;FlowRuleEntity&gt; rules)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        AssertUtil.notEmpty(app, <span class="string">&quot;app name cannot be empty&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (rules == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        configService.publishConfig(app + FLOW_DATA_ID_POSTFIX, GROUP_ID, converter.convert(rules));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>  è¿™é‡Œçš„å¤§éƒ¨åˆ†å†…å®¹ä¸ä¸Šä¸€æ­¥ä¸­çš„å®ç°ä¸€è‡´ã€‚ä¸»è¦å°±æ˜¯Nacosä¸­å­˜å‚¨é…ç½®çš„DataIdå’ŒGroupIdä¸è¦å¼„é”™ã€‚</li></ul><p><strong>ç¬¬ä¸ƒæ­¥</strong>ï¼šä¿®æ”¹<code>com.alibaba.csp.sentinel.dashboard.controller.v2.FlowControllerV2</code>ä¸­<code>DynamicRuleProvider</code>å’Œ<code>DynamicRulePublisher</code>æ³¨å…¥çš„Beanï¼Œæ”¹ä¸ºä¸Šé¢æˆ‘ä»¬ç¼–å†™çš„é’ˆå¯¹Apolloçš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DynamicRuleProvider&lt;List&lt;FlowRuleEntity&gt;&gt; ruleProvider;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DynamicRulePublisher&lt;List&lt;FlowRuleEntity&gt;&gt; rulePublisher;</span><br></pre></td></tr></table></figure><h1 id="åå…­ã€SpringCloud-Seata-å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åå…­ã€SpringCloud-Seata-å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åå…­ã€SpringCloud Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡"></a>åå…­ã€SpringCloud Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="seataç®€ä»‹"><a href="#seataç®€ä»‹" class="headerlink" title="seataç®€ä»‹"></a>seataç®€ä»‹</h2><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><p>ä¸€å¥è¯ï¼šä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</p><h3 id="æ˜¯ä»€ä¹ˆ-12"><a href="#æ˜¯ä»€ä¹ˆ-12" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p>  Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡<br>  <a href="http://seata.io/zh-cn/">å®˜ç½‘åœ°å€</a></p></blockquote><h3 id="èƒ½å¹²å˜›-7"><a href="#èƒ½å¹²å˜›-7" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h3><p><strong>ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹ï¼š</strong></p><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†è¿‡ç¨‹çš„-ID+ä¸‰ç»„ä»¶æ¨¡å‹</strong></p><ul><li><strong>Transaction ID XID</strong><ul><li>  å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ID</li></ul></li><li><strong>3ç»„ä»¶æ¦‚å¿µ</strong><ul><li>Transaction Coordinator(TC) <ul><li>  äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»š;</li></ul></li><li>Transaction  Manager(TM) <ul><li>  æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®;</li></ul></li><li>Resource Manager(RM) <ul><li>  æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œï¼ŒçŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼›</li></ul></li></ul></li></ul><h3 id="å¤„ç†è¿‡ç¨‹"><a href="#å¤„ç†è¿‡ç¨‹" class="headerlink" title="å¤„ç†è¿‡ç¨‹"></a>å¤„ç†è¿‡ç¨‹</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/07/05/spring-cloud/spring-cloud/TB1rDpkJAvoK1RjSZPfXXXPKFXa-794-478.png" alt="img"></p><ol><li> TMå‘TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡,å…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„XID;</li><li> XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­;</li><li> RMå‘TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡,å°†å…¶çº³å…¥XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–;</li><li> TMå‘TC å‘èµ·é’ˆå¯¹XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®;</li><li> TCè°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</li></ol><h3 id="Seataæœ¯è¯­"><a href="#Seataæœ¯è¯­" class="headerlink" title="Seataæœ¯è¯­"></a>Seataæœ¯è¯­</h3><h4 id="TC-äº‹åŠ¡åè°ƒè€…"><a href="#TC-äº‹åŠ¡åè°ƒè€…" class="headerlink" title="TC - äº‹åŠ¡åè°ƒè€…"></a>TC - äº‹åŠ¡åè°ƒè€…</h4><p>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p><h4 id="TM-äº‹åŠ¡ç®¡ç†å™¨"><a href="#TM-äº‹åŠ¡ç®¡ç†å™¨" class="headerlink" title="TM - äº‹åŠ¡ç®¡ç†å™¨"></a>TM - äº‹åŠ¡ç®¡ç†å™¨</h4><p>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p><h4 id="RM-èµ„æºç®¡ç†å™¨"><a href="#RM-èµ„æºç®¡ç†å™¨" class="headerlink" title="RM - èµ„æºç®¡ç†å™¨"></a>RM - èµ„æºç®¡ç†å™¨</h4><p>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p><h2 id="Seataä¸‹è½½å®‰è£…"><a href="#Seataä¸‹è½½å®‰è£…" class="headerlink" title="Seataä¸‹è½½å®‰è£…"></a>Seataä¸‹è½½å®‰è£…</h2><h3 id="ä¸‹è½½-1"><a href="#ä¸‹è½½-1" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p><a href="http://seata.io/zh-cn/blog/download.html">å®˜ç½‘åœ°å€</a></p><p><a href="https://github.com/seata/seata/releases">ä¸‹è½½åœ°å€</a></p><p>æˆ‘ä¸‹è½½çš„æ˜¯<a href="https://github.com/seata/seata/releases/tag/v1.0.0">v1.0.0-GA</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> spring </category>
          
          <category> æ¡†æ¶ </category>
          
          <category> åˆ†å¸ƒå¼ </category>
          
          <category> spring-cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> æ¡†æ¶ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> spring-cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git</title>
      <link href="2020/02/05/git/git%E5%91%BD%E4%BB%A4/"/>
      <url>2020/02/05/git/git%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="gitå‘½ä»¤è¡Œæ“ä½œ"><a href="#gitå‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="gitå‘½ä»¤è¡Œæ“ä½œ"></a>gitå‘½ä»¤è¡Œæ“ä½œ</h1><ol><li><p><code>git init</code></p><ul><li>æ•ˆæœï¼šä½¿ç”¨è¯¥å‘½ä»¤ä¼šå°†æ­¤æ–‡ä»¶å¤¹åŠ å…¥gitè¿›è¡Œç®¡ç†ï¼Œéšåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.gitéšè—æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯ç‰ˆæœ¬åº“ï¼Œè€Œå½“å‰ç›®å½•åŠå…¶å­ç›®å½•å°±æ˜¯<strong>å·¥ä½œåŒº</strong>ã€‚</li><li>æ³¨æ„ï¼š.gitæ–‡ä»¶ä¼šè®°å½•ä½ åœ¨è¿™ä¸ªå·¥ä½œåŒºä¸­çš„æ“ä½œï¼Œåˆ‡å‹¿åˆ é™¤å’Œä¿®æ”¹</li></ul></li><li><p><code>git add &lt;file&gt;</code></p><ul><li>ä½œç”¨ï¼šå°†æ–‡ä»¶ä»å·¥ä½œåŒºæäº¤åˆ°æš‚å­˜åŒºï¼ˆå°±æ˜¯æŠŠæ–‡ä»¶äº¤ç»™gitç®¡ï¼‰</li><li>æ³¨æ„ï¼šä½†æ­¤æ—¶æ–‡ä»¶<strong>å¹¶æ²¡æœ‰çœŸæ­£è¿›å…¥åˆ°ç‰ˆæœ¬åº“</strong>å½“ä¸­ï¼Œæ–‡ä»¶ç›®å‰åªå¤„äºä¸€ä¸ª<strong>ä¸­é—´çŠ¶æ€</strong>ï¼Œå¦‚æœæ–‡ä»¶æ²¡æœ‰å¤„äºæš‚å­˜åŒºçš„è¯gitæ˜¯ä¸ä¼šå»è®°å½•ä½ çš„æ“ä½œçš„ï¼Œå¦‚æœæ•°æ®è¢«åˆ é™¤äº†æ˜¯æ— æ³•é€šè¿‡gitæ¢å¤çš„ã€‚</li></ul></li><li><p><code>git commit &lt;file&gt;</code></p><ul><li>ä½œç”¨ï¼šå°†<strong>æš‚å­˜åŒº</strong>æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­</li><li>å‚æ•°ï¼š<code>-m &quot;&lt;message&gt;&quot;</code> å¯ä»¥ä¸ç”¨è¿›å…¥vimç¼–è¾‘å™¨ä¸­è¾“å…¥æäº¤ä¿¡æ¯</li><li>æ³¨æ„ï¼šè¿™ä¸ªå‘½ä»¤å°†å¤„äºä¸­é—´çŠ¶æ€çš„æ–‡ä»¶ï¼ˆ<strong>æš‚å­˜åŒºçš„æ–‡ä»¶</strong>ï¼‰æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­,è¿™æ—¶æ‰ç®—çœŸæ­£å®Œæˆäº†ä¸€æ¬¡æäº¤è¿‡ç¨‹ã€‚ç¬¬ä¸€æ¬¡æäº¤ä¸ºrootï¼ˆæ ¹ï¼‰æäº¤</li></ul><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸‰ä¸ªå‘½ä»¤çš„ä½¿ç”¨é¡ºåºåº”è¯¥æ˜¯ init -&gt; add -&gt; commit<br>å¦‚æœæ­¤æ—¶å·¥ä½œåŒºä¸­çš„æ–‡ä»¶å‘ç”Ÿäº†æ”¹åŠ¨ï¼Œå¹¶ä¸”å¸Œæœ›å°†ä¿®æ”¹åçš„æ–‡ä»¶æäº¤è‡³<strong>ç‰ˆæœ¬åº“</strong></p><ol><li>å¿…é¡»å…ˆä½¿ç”¨<code>git add &lt;file&gt;</code>å‘½ä»¤å°†ä¿®æ”¹åçš„æ–‡ä»¶å­˜å…¥æš‚å­˜åŒº</li><li>å†ä½¿ç”¨<code>git commit &lt;file&gt;</code>å‘½ä»¤å°†æ–‡ä»¶ä»<strong>æš‚å­˜åŒº</strong>æäº¤è‡³ç‰ˆæœ¬åº“æ‰å¯ä»¥ï¼Œè¿™å’Œsvnæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼ŒSVNåœ¨æ·»åŠ æ–°æ–‡ä¹‹åæ¯æ¬¡ä¿®æ”¹çš„æ–‡ä»¶ç›´æ¥commitå°±å¯ä»¥äº†ã€‚</li><li>å¦‚æœè¯¥æ–‡ä»¶å·²ç»å¤„äºè¿½è¸ªçŠ¶æ€çš„è¯åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨<code>git commit &lt;file&gt;</code>æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½†æ˜¯è¿™æ ·å°±ä¸èƒ½æ’¤é”€äº†</li></ol></blockquote></li><li><p><code>git status</code></p><ul><li>ä½œç”¨ï¼šæŸ¥çœ‹å·¥ä½œåŒºä¸­æ–‡ä»¶çš„çŠ¶æ€</li></ul></li><li><p><code>git rm --cached &lt;file&gt;</code></p><ul><li>ä½œç”¨ï¼šå°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»é™¤</li><li>æ³¨æ„ï¼šè¿™æ¡å‘½ä»¤å¹¶ä¸ä¼šåˆ é™¤æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œåªæ˜¯å•å•çš„æŠŠæ–‡ä»¶ä»æš‚å­˜åŒºä¸­ç§»é™¤ï¼ˆç®€å•çš„è¯´å°±æ˜¯ï¼šä¸æŠŠè¿™ä¸ªæ–‡ä»¶ç»™gitç®¡äº†ï¼‰<br>â€˜rmâ€™ æ˜¯(remove)åˆ é™¤çš„æ„æ€ï¼Œâ€™cachedâ€™: ç¼“å­˜</li></ul></li><li><p><code>git reset HEAD &lt;file&gt;</code></p><ul><li>ä½œç”¨ï¼šå°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»é™¤</li></ul></li></ol><h2 id="ç‰ˆæœ¬çš„å‰è¿›å’Œåé€€"><a href="#ç‰ˆæœ¬çš„å‰è¿›å’Œåé€€" class="headerlink" title="ç‰ˆæœ¬çš„å‰è¿›å’Œåé€€"></a><strong>ç‰ˆæœ¬çš„å‰è¿›å’Œåé€€</strong></h2><h3 id="æŸ¥çœ‹æäº¤çš„è®°å½•"><a href="#æŸ¥çœ‹æäº¤çš„è®°å½•" class="headerlink" title="æŸ¥çœ‹æäº¤çš„è®°å½•"></a><strong>æŸ¥çœ‹æäº¤çš„è®°å½•</strong></h3><ul><li><p><code>git log</code></p><ul><li>ä½œç”¨ï¼šæŸ¥çœ‹æäº¤çš„è®°å½•(æœ€å®Œæ•´çš„)</li><li>å‚æ•°ï¼š<ol><li><code>--pretty</code><ul><li>å€¼ï¼šonline</li><li>è§£é‡Šï¼šæ¯æ¡logæ˜¾ç¤ºä¸€è¡Œï¼ˆç®€æ´ä¸€äº›ï¼‰</li></ul></li><li><code>--online</code><ul><li>è§£é‡Šï¼šæ¯æ¡logæ˜¾ç¤ºä¸€è¡Œï¼Œä½†æ˜¯hashå€¼åªæ˜¾ç¤ºå‰ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”åªæ˜¾ç¤ºåé¢çš„ç‰ˆæœ¬ä¸æ˜¾ç¤ºå‰é¢çš„ç‰ˆæœ¬</li></ul></li></ol></li><li>psï¼šå¤šå±æ˜¾ç¤ºçš„æ§åˆ¶æ–¹å¼ï¼ˆç©ºæ ¼ï¼šå‘ä¸‹ç¿»é¡µï¼Œbï¼šå‘ä¸Šç¿»é¡µï¼Œqï¼šé€€å‡ºï¼‰</li></ul></li><li><p><code>git reflog</code></p><pre><code>  + ä½œç”¨ï¼šå’Œä¸Šé¢çš„å·®ä¸å¤šä½†æ˜¯ä¼šå¤šä¸€åˆ—å‚æ•°&#39;HEAD@&#123;&lt;ç§»åŠ¨åˆ°å½“å‰ç‰ˆæœ¬éœ€è¦å¤šå°‘æ­¥&gt;&#125;&#39;  + psï¼šæ‰€æœ‰è®°å½•éƒ½å¯ä»¥æ˜¾ç¤º</code></pre></li></ul><h3 id="ä¿®æ”¹ç‰ˆæœ¬"><a href="#ä¿®æ”¹ç‰ˆæœ¬" class="headerlink" title="ä¿®æ”¹ç‰ˆæœ¬"></a><strong>ä¿®æ”¹ç‰ˆæœ¬</strong></h3><ul><li>æ–¹å¼<ul><li>åŸºäºç´¢å¼•å€¼ [<strong>æ¨è</strong>]<ul><li><code>git reset --hard &lt;æƒ³å»ä½ç½®çš„ç´¢å¼•å€¼&gt;</code></li><li>psï¼šå‰è¿›å’Œåé€€<strong>éƒ½å¯ä»¥ç”¨</strong></li></ul></li><li>ä½¿ç”¨^ç¬¦å·<ul><li><code>git reset --hard HEAD^</code></li><li>psï¼š<strong>åªèƒ½åé€€</strong>ï¼Œå¦‚æœæƒ³åé€€2ä¸ªç‰ˆæœ¬å°±åŠ ä¸¤ä¸ª^ï¼Œä»¥æ­¤ç±»æ¨</li></ul></li><li>ä½¿ç”¨~ç¬¦å·<ul><li><code>git reset --hard HEAD~1</code></li><li>psï¼š<strong>åªèƒ½åé€€</strong>ï¼Œè¦é€€å‡ æ­¥~åå°±å†™å‡  </li></ul></li></ul></li></ul><h3 id="resetå‘½ä»¤ä¸‰ä¸ªå‚æ•°çš„å¯¹æ¯”"><a href="#resetå‘½ä»¤ä¸‰ä¸ªå‚æ•°çš„å¯¹æ¯”" class="headerlink" title="resetå‘½ä»¤ä¸‰ä¸ªå‚æ•°çš„å¯¹æ¯”"></a><strong>resetå‘½ä»¤ä¸‰ä¸ªå‚æ•°çš„å¯¹æ¯”</strong></h3><ul><li><code>--soft</code><ul><li>è§£é‡Šï¼šä¸ä¼šç®¡<strong>æš‚å­˜åŒº</strong>å’Œ<strong>å·¥ä½œåŒº</strong>ï¼Œåªç”¨äºåœ¨æœ¬åœ°åº“ç§»åŠ¨ç‰ˆæœ¬æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯æŒ‡ç§»åŠ¨ç‰ˆæœ¬ä½†ï¼‰</li></ul></li><li><code>--mixed</code><ul><li>è§£é‡Šï¼šåœ¨æœ¬åœ°åº“ç§»åŠ¨ç‰ˆæœ¬æŒ‡é’ˆå’Œé‡ç½®æš‚å­˜åŒº</li></ul></li><li><code>--hard</code><ul><li>è§£é‡Šï¼šåœ¨æœ¬åœ°åº“ç§»åŠ¨ç‰ˆæœ¬æŒ‡é’ˆå’Œé‡ç½®æš‚å­˜åŒº&amp;å·¥ä½œåŒº</li></ul></li></ul><h3 id="æ¢å¤åˆ é™¤çš„æ–‡ä»¶"><a href="#æ¢å¤åˆ é™¤çš„æ–‡ä»¶" class="headerlink" title="æ¢å¤åˆ é™¤çš„æ–‡ä»¶"></a><strong>æ¢å¤åˆ é™¤çš„æ–‡ä»¶</strong></h3><pre><code>psï¼šé€‚ç”¨äºæœ¬åœ°ä»“åº“æœ‰è®°å½•çš„æƒ…å†µ</code></pre><ul><li>å½“æ–‡ä»¶è¢«åˆ é™¤ä½†æœ¬åœ°ä»“åº“é‡Œæœ‰è¯¥æ–‡ä»¶çš„è®°å½•åˆ™å¯ä»¥ä½¿ç”¨<code>git reset --hard &lt;æ–‡ä»¶æœªè¢«åˆ é™¤æ—¶çš„ç‰ˆæœ¬hash&gt;</code>æ¥æ¢å¤æ–‡ä»¶</li></ul><h3 id="æ¯”è¾ƒå·®å¼‚æ–‡ä»¶"><a href="#æ¯”è¾ƒå·®å¼‚æ–‡ä»¶" class="headerlink" title="æ¯”è¾ƒå·®å¼‚æ–‡ä»¶"></a><strong>æ¯”è¾ƒå·®å¼‚æ–‡ä»¶</strong></h3><ul><li><code>git diff &lt;file&gt;</code><ul><li>è§£é‡Šï¼šä¸åŠ å‚æ•°æ—¶è¡¨ç¤ºä¸º<strong>å·¥ä½œåŒº</strong>å’Œ<strong>ç¼“å­˜åŒº</strong>è¿›è¡Œæ¯”è¾ƒ</li><li>å‚æ•°ï¼š<ul><li><code>HEAD</code><ul><li>è§£é‡Šï¼šå¦‚æœä½¿ç”¨ç‰ˆæœ¬æŒ‡é’ˆæŒ‡å®šæŸä¸€ä¸ªç‰ˆæœ¬çš„è¯åˆ™è¡¨ç¤º<strong>ç¼“å­˜åŒº</strong>å’ŒæŒ‡å®š<strong>ç‰ˆæœ¬</strong>è¿›è¡Œæ¯”è¾ƒ</li></ul></li></ul></li><li>psï¼šä¸å¸¦æ–‡ä»¶åè¡¨ç¤ºæ¯”è¾ƒå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</li></ul></li></ul><h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><h3 id="åˆ›å»ºåˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯</h3><ul><li><code>git branch &lt;åˆ†æ”¯åç§°&gt;</code><h3 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h3></li><li><code>git branch -v</code><h3 id="åˆ‡æ¢åˆ†æ”¯"><a href="#åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="åˆ‡æ¢åˆ†æ”¯"></a>åˆ‡æ¢åˆ†æ”¯</h3></li><li><code>git checkout &lt;åˆ†æ”¯åç§°&gt;</code><h3 id="åˆå¹¶åˆ†æ”¯"><a href="#åˆå¹¶åˆ†æ”¯" class="headerlink" title="åˆå¹¶åˆ†æ”¯"></a>åˆå¹¶åˆ†æ”¯</h3></li><li><code>git merge &lt;åˆå¹¶è¿‡æ¥çš„åˆ†æ”¯åç§°&gt;</code></li><li>psï¼šå‡è®¾æœ‰A,Bä¸¤ä¸ªåˆ†æ”¯Aè¦åˆå¹¶åˆ°Bä¸Šå»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å½“å‰å¿…é¡»è¦å¤„äºBåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯è¢«åˆå¹¶çš„åˆ†æ”¯</li><li><strong>æ­¥éª¤</strong><ol><li>åˆ‡æ¢åˆ°è¢«åˆå¹¶çš„åˆ†æ”¯ä¸Šï¼ˆæ‰§è¡Œ<code>git checkout &lt;è¢«åˆå¹¶çš„åˆ†æ”¯å&gt;</code>ï¼‰</li><li>æ‰§è¡Œ<code>checkout</code>å‘½ä»¤</li></ol></li></ul><h3 id="è§£å†³å†²çª"><a href="#è§£å†³å†²çª" class="headerlink" title="è§£å†³å†²çª"></a><strong>è§£å†³å†²çª</strong></h3><ol><li>è§£å†³å®Œæ–‡ä»¶ä¸­çš„å†²çªï¼ˆæ‰“å¼€æ–‡ä»¶ï¼Œå°†æ–‡ä»¶æ”¹æˆæƒ³è¦çš„æ ·å­ï¼‰ï¼Œä¿å­˜</li><li>æäº¤åˆ°æš‚å­˜åŒºï¼Œä½¿ç”¨ï¼š<code>git add &lt;file&gt;</code></li><li>æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œä½¿ç”¨ï¼š<code>git commit -m &quot;&lt;æ—¥å¿—&gt;&quot;</code><br> æ³¨æ„ï¼šè¿™é‡Œ<strong>ä¸€å®š</strong>ä¸èƒ½å¸¦æ–‡ä»¶å</li></ol><h2 id="è®¾ç½®ç­¾å"><a href="#è®¾ç½®ç­¾å" class="headerlink" title="è®¾ç½®ç­¾å"></a>è®¾ç½®ç­¾å</h2><ul><li><p>ä»‹ç»</p><ul><li>é¡¹ç›®/ä»“åº“çº§åˆ«ï¼šä»…åœ¨å½“å‰æœ¬åœ°åº“çš„èŒƒå›´å†…æœ‰æ•ˆ</li><li>ç³»ç»Ÿç”¨æˆ·çº§åˆ«ï¼šå½“å‰ç™»å½•çš„ç”¨æˆ·èŒƒå›´ï¼ˆå¯ä»¥ç†è§£ä¸ºå½“å‰ç³»ç»Ÿç”¨æˆ·çš„å…¨å±€èŒƒå›´ï¼‰</li><li>ä¼˜å…ˆçº§ï¼šå¦‚æœä¸¤ä¸ªçº§åˆ«éƒ½æœ‰è®¾ç½®åˆ™å°±è¿‘åŸåˆ™ä»¥é¡¹ç›®çº§åˆ«çš„ç­¾åä¸ºå‡†ï¼ˆé¡¹ç›®çº§åˆ« &gt; ç³»ç»Ÿç”¨æˆ·çº§åˆ«ï¼‰</li><li>æ³¨æ„ï¼šå¦‚æœä¸¤è€…éƒ½æ²¡æœ‰ä¼šæŠ¥é”™ï¼Œå¿…é¡»æ‹¥æœ‰å…¶ä¸€</li></ul></li><li><p>å½¢å¼</p><ul><li>ç”¨æˆ·åï¼š123qwq</li><li>emailåœ°å€ï¼š<a href="mailto:&#115;&#100;&#x6a;&#x66;&#111;&#x73;&#x69;&#100;&#102;&#110;&#64;&#113;&#113;&#46;&#99;&#111;&#x6d;">&#115;&#100;&#x6a;&#x66;&#111;&#x73;&#x69;&#100;&#102;&#110;&#64;&#113;&#113;&#46;&#99;&#111;&#x6d;</a></li></ul></li><li><p>ä½œç”¨</p><ul><li>åŒºåˆ†ä¸åŒçš„å¼€å‘äººå‘˜çš„èº«ä»½</li></ul></li><li><p>æ³¨æ„</p><ul><li>è¿™é‡Œè®¾ç½®çš„ç­¾åå’Œç™»å½•è¿œç¨‹ä»“åº“ï¼ˆä»£ç æ‰˜ç®¡ä¸­å¿ƒï¼‰çš„è´¦å·å’Œå¯†ç æ˜¯æ²¡æœ‰åŠæ¯›é’±å…³ç³»çš„</li></ul></li><li><p>å‘½ä»¤</p><ul><li><p>å¢åŠ é¡¹ç›®çº§åˆ«ï¼š</p><blockquote><p><code>git config user.name tom_pro --add</code><br>  <code>git config user.email  good1245_pro.@qq.com --add</code></p></blockquote></li><li><p>å¢åŠ å…¨å±€ï¼š</p><blockquote><p><code>git config user.name tom_pro --add --global</code><br>  <code>git config user.email good1245_pro.@qq.com --add --global</code></p></blockquote></li><li><p>åˆ é™¤ï¼š</p><blockquote><p><code>git config user.name --unset</code></p></blockquote></li><li><p>æ”¹ï¼š</p><blockquote><p><code>git config user.name qwq123</code></p></blockquote></li><li><p>æŸ¥çœ‹ç­¾åï¼š</p><blockquote><p><code>cat .git/config</code><br>  <code>git config --list </code></p></blockquote></li><li><p>æŸ¥çœ‹æŒ‡å®šå­—æ®µï¼š</p><blockquote><p><code>git config user.name</code></p></blockquote></li><li><p>æ³¨æ„ï¼šè¿™é‡Œçš„æ„æ€æ˜¯æ‰“å¼€.getæ–‡ä»¶å¤¹ä¸‹çš„configæ–‡ä»¶ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ç­¾åä¹Ÿå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€configæ–‡ä»¶ï¼Œä¿®æ”¹ä¹Ÿä¸€æ ·.<br>è®¾ç½®æˆ–æŸ¥çœ‹å…¨å±€çš„ç­¾ååœ¨åé¢åŠ <code>--global</code> å³å¯ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨<code>cat</code>å‘½ä»¤å°±å¾—åˆ°å½“å‰ç³»ç»Ÿç”¨æˆ·çš„æ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹ä½¿ç”¨<code>cd ~</code>å³å¯åˆ°è¾¾ï¼Œç„¶åå†ä½¿ç”¨<code>cat .\.gitconfig</code>å³å¯æŸ¥çœ‹<br>å¢åŠ å’Œä¿®æ”¹å‘½ä»¤å…¶å®å·®ä¸å¤š</p></li></ul></li></ul><h2 id="ä¸ç¬¬ä¸‰æ–¹è¿œç¨‹åº“è¿›è¡Œäº¤äº’"><a href="#ä¸ç¬¬ä¸‰æ–¹è¿œç¨‹åº“è¿›è¡Œäº¤äº’" class="headerlink" title="ä¸ç¬¬ä¸‰æ–¹è¿œç¨‹åº“è¿›è¡Œäº¤äº’"></a>ä¸ç¬¬ä¸‰æ–¹è¿œç¨‹åº“è¿›è¡Œäº¤äº’</h2><ul><li>ä¿å­˜é¡¹ç›®åœ°å€<ul><li>æŸ¥çœ‹åœ°å€åˆ«åï¼š<code>git remote -v</code></li><li>æ–°å»ºä¸€ä¸ªåœ°å€åˆ«åï¼š<code>git remote add &lt;åˆ«å&gt; &lt;ä»“åº“åœ°å€&gt;</code></li></ul></li><li>ä»è¿œç¨‹ä»“åº“ä¸‹è½½é¡¹ç›®<br>  <code>git clone &lt;ä»“åº“åœ°å€&gt;</code><br>  psï¼šcloneæœ‰ä¸‰ä¸ªæ•ˆæœ  <ol><li>ä¸éœ€è¦è¿›è¡Œ<code>git init</code>ä»“åº“å·²ç»åˆå§‹åŒ–å¥½äº†</li><li>ä¸éœ€è¦ä¿å­˜é¡¹ç›®åœ°å€ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ï¼ˆoriginï¼‰</li><li>å®Œæ•´çš„æŠŠè¿œç¨‹åº“ä¸‹è½½åˆ°æœ¬åœ°</li></ol></li><li>å°†æœ¬åœ°ä»“åº“æäº¤åˆ°è¿œç¨‹åº“  <ul><li><code>git push &lt;åˆ«å&gt; &lt;æ¨é€çš„åˆ†æ”¯&gt;</code></li><li>psï¼šå¦‚æœå½“å‰æäº¤çš„è¿™ä¸ªé¡¹ç›®è‡ªå·±ä¸åœ¨è¿™ä¸ªé¡¹ç›®çš„å›¢é˜Ÿä¸­çš„è¯ä¼šæäº¤å¤±è´¥</li></ul></li><li>æ‹‰å–è¿œç¨‹ä»“åº“ä¸­çš„æ›´æ–°<ul><li><code>git pull &lt;åˆ«å&gt; &lt;æŠ“å–çš„åˆ†æ”¯&gt;</code></li></ul><ol><li><code>git fetch &lt;åˆ«å&gt; &lt;æŠ“å–çš„åˆ†æ”¯&gt;</code><ul><li>è¿™ä¸€æ­¥åªæ˜¯å°†è¿œç¨‹ä»“åº“ä¸­çš„å†…å®¹æŠ“å–ä¸‹æ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¯¹æˆ‘ä»¬æœ¬åœ°å·¥ä½œåŒºè¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœéœ€è¦è¦åˆ‡æ¢åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ <code>git checkout &lt;åˆ«å&gt;/&lt;åˆ†æ”¯å&gt;</code>å³å¯</li></ul></li><li>åˆ‡æ¢åˆ°æœ¬åœ°å·¥ä½œåŒºä¸­è¢«åˆå¹¶çš„åˆ†æ”¯ä¸Š <code>git checkout &lt;è¢«åˆå¹¶çš„åˆ†æ”¯&gt;</code></li><li>å°†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆå¹¶åˆ°éœ€è¦è¢«åˆå¹¶çš„åˆ†æ”¯ä¸Š <code>git merge &lt;åˆ«å&gt;/&lt;è¢«åˆå¹¶çš„åˆ†æ”¯&gt;</code><br>psï¼špull = fetch+mergeï¼Œå¦‚æœæ›´æ–°çš„è¿œç¨‹æ•°æ®æ¯”è¾ƒç®€å•ã€ä¸å¤ªä¼šäº§ç”Ÿå†²çªçš„è¯ä½¿ç”¨<code>pull</code>, ä½†æ˜¯æ›´æ–°çš„æ•°æ®æ¯”è¾ƒå¤æ‚æ—¶æ¨èä½¿ç”¨åˆ†æ­¥æ“ä½œã€‚<br>å¦‚æœä¸¤ä¸ªäººä¿®æ”¹äº†åŒä¸€ä¸ªåœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæäº¤åˆ°è¿œç¨‹ä»“åº“çš„äººå¯ä»¥æäº¤æˆåŠŸï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå°±ä¸è¡Œã€‚è¿™ç§æƒ…å†µç¬¬äºŒä¸ªäººéœ€è¦  </li><li>å°†æœ¬åœ°å·¥ä½œåŒºä¸­çš„æ›´æ”¹æäº¤åˆ°æœ¬åœ°ä»“åº“</li><li>å°†ä»£ç æ‹‰å–æ¥ä¸‹</li><li>è§£å†³å†²çª</li><li>æäº¤</li></ol></li></ul><h2 id="è·¨å›¢é˜Ÿåä½œ"><a href="#è·¨å›¢é˜Ÿåä½œ" class="headerlink" title="è·¨å›¢é˜Ÿåä½œ"></a>è·¨å›¢é˜Ÿåä½œ</h2><p>æœ‰Aã€Bä¸¤ä¸ªäººï¼ŒAæ‰¾Bå¼€å‘é¡¹ç›®ä½†æ˜¯Bä¸èƒ½è·³æ§½åˆ°Açš„å›¢é˜Ÿå»</p><ol><li>BæŠŠAçš„é¡¹ç›®forkä¸€ä»½</li><li>BæŠŠforkä¸‹æ¥çš„é¡¹ç›®cloneåˆ°æœ¬åœ°</li><li>Bå®ŒæˆAç»™çš„ä»»åŠ¡ï¼Œforkä¸‹æ¥çš„è¿œç¨‹åº“ä¸Š</li><li>Bå‘èµ·pull request</li><li>Aå®¡æ ¸ï¼Œå®¡æ ¸okååˆå¹¶åˆ†æ”¯</li></ol><h2 id="è®¾ç½®sshç™»å½•"><a href="#è®¾ç½®sshç™»å½•" class="headerlink" title="è®¾ç½®sshç™»å½•"></a>è®¾ç½®sshç™»å½•</h2><ol><li>è¿›å…¥ç”¨æˆ·çš„æ ¹ç›®å½• <code>cd ~</code></li><li>åˆ é™¤ä»¥å‰çš„ssh <code>rm -r .ssh/</code> å¦‚æœæ²¡æœ‰å°±ä¸ç”¨åˆ </li><li>ç”Ÿæˆssh <code>ssh-keygen -t rsa -C &lt;ç¬¬ä¸‰æ–¹ä»“åº“çš„è´¦å·ï¼ˆé‚®ç®±ï¼‰&gt;</code> Cæ˜¯å¤§å†™çš„ï¼ï¼</li><li>è¿›å…¥åˆ°.sshç›®å½•ä¸­ <code>cd ./.ssh/</code></li><li>æ‰“å¼€ç›®å½•ä¸­çš„id_rsa.pubæ–‡ä»¶ <code>cat id_rsa.pub</code> å¹¶å¤åˆ¶é‡Œé¢çš„å†…å®¹</li><li>è¿›å…¥åˆ°ç¬¬ä¸‰æ–¹ä»“åº“ä¸­è®¾ç½®sshå…¬é’¥</li><li>æ–°å»ºä¸€ä¸ªè¿œç¨‹sshè¿æ¥çš„åˆ«å <code>git remote add &lt;åˆ«å&gt; &lt;sshåœ°å€&gt;</code></li><li>ä½¿ç”¨sshç™»å½•å°±è¦å°†æ¨é€çš„åˆ«åæ›´æ”¹ä¸ºåˆšåˆšè®¾ç½®çš„sshçš„åˆ«å </li></ol><h2 id="eclipse-Gitæ’ä»¶"><a href="#eclipse-Gitæ’ä»¶" class="headerlink" title="eclipse Gitæ’ä»¶"></a>eclipse Gitæ’ä»¶</h2><ul><li>å°†å·¥ç¨‹åˆå§‹åŒ–ä¸ºä¸€ä¸ªgitå·¥ç¨‹ï¼ˆå³é”®-&gt;theam-&gt;share project-&gt;gitï¼‰</li></ul><h2 id="gitå·¥ä½œæµ"><a href="#gitå·¥ä½œæµ" class="headerlink" title="gitå·¥ä½œæµ"></a>gitå·¥ä½œæµ</h2><p><img src= "/img/loading.gif" data-lazy-src="/2020/02/05/git/git%E5%91%BD%E4%BB%A4/gitflow.png" alt="gitå·¥ä½œæµ"></p><ul><li>Aä¸ºåˆ†å‘ä»»åŠ¡çš„ï¼ŒBä¸ºç¨‹åºå‘˜</li></ul><ol><li>åˆ›å»ºä¸»åˆ†æ”¯</li><li>Aåˆ†å‘ä¸€ä¸ªéœ€æ±‚åˆ°Bï¼ŒBåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼ˆnewï¼‰ç”¨æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½</li><li>Bå®Œæˆä¹‹åæäº¤åˆ°è¿œç¨‹åº“</li><li>Aæ‹‰å–è¿œç¨‹åº“ä¸­çš„newåˆ†æ”¯ï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰bugï¼Œè¿™ä¸ªåŠŸèƒ½é€šä¸é€šè¿‡ï¼Œå¦‚æœä¸é€šè¿‡å°±å«Aæ”¹ï¼Œå¦‚æœé€šè¿‡å°±åˆå¹¶åˆ°ä¸»åˆ†æ”¯</li></ol>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
          <category> git </category>
          
          <category> ä»£ç ç®¡ç† </category>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
            <tag> git </tag>
            
            <tag> ä»£ç ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Boot é”™è¯¯è®°å½•</title>
      <link href="2020/02/05/spring-boot/%E9%94%99%E8%AF%AF%E6%95%B4%E7%90%86/"/>
      <url>2020/02/05/spring-boot/%E9%94%99%E8%AF%AF%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— æ³•é€šè¿‡-params-ç»™æ˜ å°„å¯¹è±¡ä¸­çš„-Map-ç±»å‹ä¼ å€¼"><a href="#æ— æ³•é€šè¿‡-params-ç»™æ˜ å°„å¯¹è±¡ä¸­çš„-Map-ç±»å‹ä¼ å€¼" class="headerlink" title="æ— æ³•é€šè¿‡ params ç»™æ˜ å°„å¯¹è±¡ä¸­çš„ Map ç±»å‹ä¼ å€¼"></a>æ— æ³•é€šè¿‡ params ç»™æ˜ å°„å¯¹è±¡ä¸­çš„ Map ç±»å‹ä¼ å€¼</h1><ul><li><p>ç‰ˆæœ¬ï¼š</p><ul><li>spring-bootï¼š<code>2.2.13RELEASE</code></li></ul></li><li><p>é—®é¢˜æè¿°ï¼š</p><p>æ— æ³•ç›´æ¥åœ¨è·¯å¾„åœ°å€åé¢æ‹¼æ¥å‚æ•°ç»™æ˜ å°„å¯¹è±¡ä¸­mapå±æ€§ä¼ å€¼</p><p>ä¾‹ï¼š<code>http://localhost:8080/list?id=1&amp;role.id=1&amp;map.a=2</code></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­Entityç±»ä¸­çš„mapæ— æ³•è¢«æ­£ç¡®çš„æ˜ å°„å€¼ï¼Œä½†æ˜¯ <code>role.id</code> å´å¯ä»¥æ˜ å°„åˆ°å€¼</p><p>çŒœæµ‹æ˜¯ è·¯å¾„ä¸­çš„ <code>map.a</code> æ— æ³•è¢«æ˜ å°„åˆ°æ­£ç¡®çš„ç±»å‹æ‰€ä»¥bootå°±æ²¡æœ‰å¯¹mapè¿›è¡Œæ˜ å°„ï¼Œ<code>map.a=2</code> ä¸­çš„ <code>2</code> å¯èƒ½æ˜¯ string ä¹Ÿå¯èƒ½æ˜¯ int ç±»å‹</p><p>entityï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ------Role.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ------Entity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> Role role;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">getRole</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.role;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRole</span><span class="params">(Role role)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.role = role</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getMap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.map;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, Object&gt;)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.map = map</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Entity entity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è§£å†³æ–¹æ¡ˆ</p><ul><li><p>åœ¨ <code>controller</code> ä¸­çš„å‚æ•°åˆ—è¡¨ä¸­åŠ å…¥ <code>@RequestBody</code> æ³¨è§£</p></li><li><pre><code class="java">@GetMapping(&quot;/list&quot;)@ResponseBodypublic String list(@RequestBody Entity entity) &#123;    return &quot;success&quot;;&#125;</code></pre></li><li><p>ç„¶åå‰å°è¯·æ±‚æ—¶ä¸è¦åœ¨ <code>params</code> ä¸­ä¼ é€’å‚æ•°ï¼Œåœ¨ <code>body</code> ä¸­ä¼ é€’å‚æ•°å³å¯</p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2020/02/05/spring-boot/%E9%94%99%E8%AF%AF%E6%95%B4%E7%90%86/image-20210317205432768.png" alt="image-20210317205432768"></p><ul><li>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ° <code>map.a</code> çš„å±æ€§å€¼äº†</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> spring </category>
          
          <category> spring-boot </category>
          
          <category> æ¡†æ¶ </category>
          
          <category> é”™è¯¯è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é”™è¯¯è®°å½• </tag>
            
            <tag> java </tag>
            
            <tag> spring-boot </tag>
            
            <tag> æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot å­¦ä¹ ç¬”è®°</title>
      <link href="2020/01/05/spring-boot/spring-boot/"/>
      <url>2020/01/05/spring-boot/spring-boot/</url>
      
        <content type="html"><![CDATA[<h1 id="å®˜ç½‘"><a href="#å®˜ç½‘" class="headerlink" title="å®˜ç½‘"></a>å®˜ç½‘</h1><p><a href="https://spring.io/projects/spring-boot">spring.io</a></p><h1 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h1><blockquote><p>  Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications that you can â€œjust runâ€.</p><p>  We take an opinionated view of the Spring platform and third-party libraries so you can get started with minimum fuss. Most Spring Boot applications need minimal Spring configuration.</p></blockquote><p>ä½¿ç”¨Spring Bootå¯ä»¥è½»æ¾åœ°åˆ›å»ºç‹¬ç«‹çš„ï¼ŒåŸºäºç”Ÿäº§çº§åˆ«çš„Springçš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥â€œè¿è¡Œâ€å®ƒä»¬ã€‚</p><p>æˆ‘ä»¬å¯¹Springå¹³å°å’Œç¬¬ä¸‰æ–¹åº“æœ‰é»˜è®¤çš„è®¾ç½®ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ä»é›¶å¼€å§‹ã€‚å¤§å¤šæ•°Springå¼•å¯¼åº”ç”¨ç¨‹åºåªéœ€è¦æœ€å°çš„Springé…ç½®ã€‚</p><h1 id="æ€ä¹ˆä¸‹ï¼Ÿ"><a href="#æ€ä¹ˆä¸‹ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¸‹ï¼Ÿ"></a>æ€ä¹ˆä¸‹ï¼Ÿ</h1><h2 id="ä½¿ç”¨maven"><a href="#ä½¿ç”¨maven" class="headerlink" title="ä½¿ç”¨maven"></a>ä½¿ç”¨maven</h2><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ·»åŠ ä¸€ä¸ªçˆ¶é¡¹ç›® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ·»åŠ springbootä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ­å»ºäº†ä¸€ä¸ªç®€å•çš„springbooté¡¹ç›®</p><h2 id="ä½¿ç”¨springbootæ„å»ºå™¨ï¼ˆspring-initialierï¼‰"><a href="#ä½¿ç”¨springbootæ„å»ºå™¨ï¼ˆspring-initialierï¼‰" class="headerlink" title="ä½¿ç”¨springbootæ„å»ºå™¨ï¼ˆspring initialierï¼‰"></a>ä½¿ç”¨springbootæ„å»ºå™¨ï¼ˆspring initialierï¼‰</h2><p>ä½¿ç”¨spring initialieræ„å»ºspringbooté¡¹ç›®éå¸¸ç®€å•</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200610080858326.png" alt="image-20200610080858326"></p><p>åªéœ€è¦åœ¨è¿™ä¸€æ­¥é€‰æ‹©éœ€è¦çš„æ¨¡å—å³å¯</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200610080945287.png" alt="image-20200610080945287"></p><h1 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h1><p>spring-booté»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸º<strong>application.properties</strong>å’Œ<strong>application.yml</strong></p><h2 id="YMAL"><a href="#YMAL" class="headerlink" title="YMAL"></a>YMAL</h2><h3 id="YMALè¯­æ³•"><a href="#YMALè¯­æ³•" class="headerlink" title="YMALè¯­æ³•"></a>YMALè¯­æ³•</h3><h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><ul><li><code>yaml</code> è¯­æ³•ä»¥é”®å€¼å¯¹çš„å½¢å¼ä½¿ç”¨ <strong>é”®å€¼å¯¹</strong> å½¢å¼å­˜å‚¨æ•°æ® (k: v)</li><li>å¤§å°å†™æ•æ„Ÿ</li><li>å†’å·åé¢çš„ <strong>ç©ºæ ¼</strong> æ˜¯å¿…é¡»è¦çš„</li></ul><h4 id="å€¼çš„å†™æ³•"><a href="#å€¼çš„å†™æ³•" class="headerlink" title="å€¼çš„å†™æ³•"></a>å€¼çš„å†™æ³•</h4><ul><li><p>å­—é¢é‡</p><ul><li><p>å¸ƒå°”ã€å­—ç¬¦ä¸²ã€æ•°å­—éƒ½å¯ä»¥ç›´æ¥å†™</p></li><li><p>å­—ç¬¦ä¸²é»˜è®¤å¯ä»¥ä¸ç”¨åŠ  <code>&quot;&quot;</code> å’Œ <code>&#39;&#39;</code> </p></li><li><p>å¦‚æœå­—ç¬¦ä¸²åŠ äº†<code>&quot;&quot;</code>åˆ™ä¸ä¼šè½¬ä¹‰å€¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚ä¾‹ï¼š</p><blockquote><p>k: â€œ123 \n 456â€</p><p>è¾“å‡º:<br>123<br>[â€¦è¿™é‡Œæ˜¯æ¢è¡Œâ€¦]<br>456</p></blockquote></li><li><p>å¦‚æœæ·»åŠ äº†<code>&#39;&#39;</code>åˆ™ä¼šè½¬ä¹‰å€¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦</p></li></ul><blockquote><p>k: â€˜123 \n 456â€™</p><p>è¾“å‡º: 123 \n 456</p></blockquote></li></ul><ul><li><p>å¯¹è±¡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> </span><br><span class="line"><span class="attr">v1:</span> <span class="number">123</span></span><br><span class="line"><span class="attr">v2:</span> <span class="number">456</span></span><br></pre></td></tr></table></figure></li><li><p>è¡Œå†…å†™æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> &#123;<span class="attr">v1:</span> <span class="number">123</span>, <span class="attr">v2:</span> <span class="number">456</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ•°ç»„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li><li><p>è¡Œå†…å†™æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure></li></ul><h2 id="é…ç½®æ–‡ä»¶æ³¨å…¥å€¼"><a href="#é…ç½®æ–‡ä»¶æ³¨å…¥å€¼" class="headerlink" title="é…ç½®æ–‡ä»¶æ³¨å…¥å€¼"></a>é…ç½®æ–‡ä»¶æ³¨å…¥å€¼</h2><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rens:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">qwq</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">12</span></span><br><span class="line">  <span class="attr">date:</span> <span class="number">2019</span><span class="string">/12/12</span></span><br><span class="line">  <span class="attr">is_man:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">lists:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">a:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>, <span class="attr">k2:</span> <span class="string">v2</span>&#125;</span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">qaq</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure><p>javaBean:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;rens&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rens</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean isMan;</span><br><span class="line">    <span class="keyword">private</span> Map a;</span><br><span class="line">    <span class="keyword">private</span> List lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š@ConfigurationPropertiesæ³¨è§£å¹¶ä¸èƒ½å°†ç»„ä»¶åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œè¦å®Œæˆé…ç½®æ–‡ä»¶æ³¨å…¥çš„åŠŸèƒ½å¿…é¡»è¿˜è¦å°†ç»„ä»¶åŠ å…¥åˆ°å®¹å™¨ä¸­</p></blockquote><p>åœ¨pomæ–‡ä»¶ä¸­å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="propertiesæ–‡ä»¶æ³¨å…¥æ—¶ä¹±ç "><a href="#propertiesæ–‡ä»¶æ³¨å…¥æ—¶ä¹±ç " class="headerlink" title="propertiesæ–‡ä»¶æ³¨å…¥æ—¶ä¹±ç "></a>propertiesæ–‡ä»¶æ³¨å…¥æ—¶ä¹±ç </h3><p>è§£å†³åŠæ³•ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/properties%E6%96%87%E4%BB%B6%E4%B9%B1%E7%A0%81.png" alt="image-20200325092529457"></p><h2 id="å¼•å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"><a href="#å¼•å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶" class="headerlink" title="å¼•å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"></a>å¼•å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</h2><p>ä½¿ç”¨@Importæ³¨è§£æ¥å¼•å…¥yml/propertiesé…ç½®æ–‡ä»¶</p><p>ä½¿ç”¨@ImportResourcesæ³¨è§£æ¥å¼•å…¥xmlé…ç½®æ–‡ä»¶</p><h2 id="ConfigurationPropertieså’Œ-Valueè·å–å€¼çš„åŒºåˆ«"><a href="#ConfigurationPropertieså’Œ-Valueè·å–å€¼çš„åŒºåˆ«" class="headerlink" title="@ConfigurationPropertieså’Œ@Valueè·å–å€¼çš„åŒºåˆ«"></a>@ConfigurationPropertieså’Œ@Valueè·å–å€¼çš„åŒºåˆ«</h2><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>å¤æ‚ç±»å‹å°è£…</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>åŠŸèƒ½</td><td>æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å€¼</td><td>ä¸€ä¸ªä¸€ä¸ªæŒ‡å®š</td></tr><tr><td>æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>SpEL</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>JSR303</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><p>éœ€è¦æ‰¹é‡æ³¨å…¥å€¼æ—¶ä½¿ç”¨@ConfigurationProperties</p><p>åªéœ€è¦è·å¾—é…ç½®æ–‡ä»¶ä¸­æŸé¡¹å€¼æ—¶ä½¿ç”¨@Value</p><h2 id="é…ç½®æ–‡ä»¶å ä½ç¬¦"><a href="#é…ç½®æ–‡ä»¶å ä½ç¬¦" class="headerlink" title="é…ç½®æ–‡ä»¶å ä½ç¬¦"></a>é…ç½®æ–‡ä»¶å ä½ç¬¦</h2><p>é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨éšæœºæ•°ï¼š</p><p>${random.value} ${random.int} ${random.long} ${random.int(10)} ${random.int[10, 20]}ã€‚ã€‚ã€‚</p><p>å±æ€§é…ç½®å ä½ç¬¦</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">prot:</span> <span class="number">12</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">$&#123;service.prot&#125;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ä¹‹å‰å®šä¹‰è¿‡çš„å€¼</p><h2 id="é…ç½®éšæœºå€¼"><a href="#é…ç½®éšæœºå€¼" class="headerlink" title="é…ç½®éšæœºå€¼"></a>é…ç½®éšæœºå€¼</h2><p><code>RandomValuePropertySource</code> å¯¹äºéšæœºå€¼æ³¨å…¥éå¸¸æœ‰ç”¨ï¼ˆæ¯”å¦‚åœ¨ä¿å¯†åœºæ™¯æˆ–è€…æµ‹è¯•ç”¨ä¾‹ä¸­)ã€‚å®ƒå¯ä»¥äº§ç”Ÿ integerã€longã€uuid å’Œ stringã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my.secret</span>=<span class="variable">$&#123;random.value&#125;</span></span><br><span class="line"><span class="attr">my.number</span>=<span class="variable">$&#123;random.int&#125;</span></span><br><span class="line"><span class="attr">my.bignumber</span>=<span class="variable">$&#123;random.long&#125;</span></span><br><span class="line"><span class="attr">my.uuid</span>=<span class="variable">$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="attr">my.number.less.than.ten</span>=<span class="variable">$&#123;random.int(10)&#125;</span></span><br><span class="line"><span class="attr">my.number.in.range</span>=<span class="variable">$&#123;random.int[1024,65536]&#125;</span></span><br></pre></td></tr></table></figure><p><code>random.int*</code> è¯­æ³•ä¸º <code>OPEN value (,max) CLOSE</code>ï¼Œ<code>OPEN,CLOSE</code> å¯ä¸ºä»»æ„å­—ç¬¦ï¼Œ<code>value,max</code> ä¸ºæ•´æ•°ã€‚å¦‚æœä½¿ç”¨äº† <code>max</code>ï¼Œ<code>value</code> åˆ™ä¸ºæœ€å°å€¼ï¼Œ<code>max</code> ä¸ºæœ€å¤§å€¼ã€‚</p><h2 id="å¤šProfileæ–‡ä»¶"><a href="#å¤šProfileæ–‡ä»¶" class="headerlink" title="å¤šProfileæ–‡ä»¶"></a>å¤šProfileæ–‡ä»¶</h2><p>åœ¨springbootä¸­å¯ä»¥ä½¿ç”¨<strong>application[-profile].properties/yml</strong>æ¥åˆ›å»ºå¤šä¸ªä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶</p><h2 id="yamlæ–‡æ¡£å—"><a href="#yamlæ–‡æ¡£å—" class="headerlink" title="yamlæ–‡æ¡£å—"></a>yamlæ–‡æ¡£å—</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev2</span></span><br></pre></td></tr></table></figure><p>åœ¨yamlä¸­å¯ä»¥ä½¿ç”¨<code>---</code>æ¥åˆ†å‰²</p><h2 id="æ¿€æ´»profileç¯å¢ƒ"><a href="#æ¿€æ´»profileç¯å¢ƒ" class="headerlink" title="æ¿€æ´»profileç¯å¢ƒ"></a>æ¿€æ´»profileç¯å¢ƒ</h2><h3 id="é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»"><a href="#é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»" class="headerlink" title="é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»"></a>é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»</h3><p>ä½¿ç”¨spring.profiles.activeæ¥æ¿€æ´»æŒ‡å®šçš„ç¯å¢ƒ</p><h3 id="å‘½ä»¤è¡Œä¸­æ¿€æ´»"><a href="#å‘½ä»¤è¡Œä¸­æ¿€æ´»" class="headerlink" title="å‘½ä»¤è¡Œä¸­æ¿€æ´»"></a>å‘½ä»¤è¡Œä¸­æ¿€æ´»</h3><p>â€“spring.profiles.active=dev</p><p>è™šæ‹Ÿæœºä¸­æ¿€æ´»</p><p>-Dspring.profiles.active=dev</p><h2 id="é…ç½®æ–‡ä»¶ä½ç½®"><a href="#é…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶ä½ç½®"></a>é…ç½®æ–‡ä»¶ä½ç½®</h2><h3 id="é…ç½®æ–‡ä»¶é»˜è®¤åŠ è½½ä½ç½®"><a href="#é…ç½®æ–‡ä»¶é»˜è®¤åŠ è½½ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶é»˜è®¤åŠ è½½ä½ç½®"></a>é…ç½®æ–‡ä»¶é»˜è®¤åŠ è½½ä½ç½®</h3><p>spring-booté»˜è®¤ä»ä»¥ä¸‹ä½ç½®åŠ è½½é…ç½®æ–‡ä»¶</p><ol><li> <code>file:./config/</code></li><li> <code>file:./config/*/</code></li><li> <code>file:./</code></li><li> <code>classpath:/config/</code></li><li> <code>classpath:/</code></li></ol><p>ä¼˜å…ˆçº§ä»ä¸Šåˆ°ä¸‹</p><p>spring-bootä¼šä»ä»¥ä¸Šè·¯å¾„ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åŠ è½½ï¼›å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰ç›¸åŒçš„å±æ€§åˆ™ä¼šä»¥é«˜ä¼˜å…ˆçº§çš„ä¸ºå‡†</p><h3 id="ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶åç§°"><a href="#ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶åç§°" class="headerlink" title="ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶åç§°"></a>ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶åç§°</h3><p>spring-booté»˜è®¤ä¼šå»æŸ¥æ‰¾åç§°ä¸º<strong>application</strong>çš„é…ç½®æ–‡ä»¶</p><p>å¦‚æœä¸å–œæ¬¢é»˜è®¤çš„applicationåç§°ï¼Œå¯ä»¥ä½¿ç”¨<code>spring.config.name</code>æ¥æ›´æ”¹é»˜è®¤åç§°</p><h3 id="æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®"><a href="#æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®"></a>æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®</h3><h4 id="spring-config-location"><a href="#spring-config-location" class="headerlink" title="spring.config.location"></a>spring.config.location</h4><p>spring-bootä¸­å¯ä»¥ä½¿ç”¨<strong>spring.config.location</strong>æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œ<strong>é»˜è®¤ä½ç½®é…ç½®å°†è¢«æ›¿ä»£</strong></p><p>ä¾‹å¦‚ï¼Œå¦‚æœ <code>spring.config.location</code> é…ç½®ä¸º <code>classpath:/custom-config/,file:./custom-config/</code>ï¼Œæœç´¢é¡ºåºå°†å˜ä¸ºä»¥ä¸‹ï¼š</p><ol><li> <code>file:./custom-config/</code></li><li> <code>classpath:custom-config/</code></li></ol><p>==è¯¥å±æ€§åœ¨springé¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ˜¯æ— æ•ˆçš„ï¼Œå¿…é¡»ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š==</p><p>å‘½ä»¤è¡ŒæŒ‡å®šçš„é…ç½®æ–‡ä»¶åˆ™æŒ‡å®šçš„é‚£ä¸ªé…ç½®æ–‡ä»¶ä¸ºæœ€é«˜ä¼˜å…ˆçº§</p><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p><p>å°†é¡¹ç›®æ‰“åŒ…åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><p><code>java -jar xxx.jar --spring.config.location=d:a/qwq.yml</code></p><p>å¦‚æœæŒ‡å®šçš„æ˜¯ä¸€ä¸ª<strong>ç›®å½•è€Œä¸æ˜¯æ–‡ä»¶</strong>åˆ™ä¼šæŸ¥æ‰¾è¯¥ç›®å½•ä¸‹çš„<strong>application.yml/.properties</strong></p><blockquote><p>  âš ï¸æ³¨æ„ï¼šå¦‚æœæŒ‡å®šçš„æ˜¯ä¸€ä¸ªç›®å½•å¿…é¡»åœ¨æœ«å°¾å†™ä¸Šâ€˜/â€™ï¼›</p><p>  ä¾‹ï¼š</p><p>  â€‹    spring.config.location=d:config/ (âˆš)</p><p>  â€‹    spring.config.location=d:config (Ã—)</p></blockquote><h4 id="spring-config-additional-location"><a href="#spring-config-additional-location" class="headerlink" title="spring.config.additional-location"></a>spring.config.additional-location</h4><p>æˆ–è€…ï¼Œå½“ä½¿ç”¨ <code>spring.config.additional-location</code> é…ç½®è‡ªå®šä¹‰é…ç½®ä½ç½®æ—¶ï¼Œé™¤äº†ä½¿ç”¨é»˜è®¤ä½ç½®å¤–ï¼Œè¿˜ä¼šä½¿ç”¨å®ƒä»¬ã€‚è¿™äº›å…¶ä»–ï¼ˆadditionalï¼‰ä½ç½®å°†åœ¨é»˜è®¤ä½ç½®ä¹‹å‰æœç´¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†å…¶ä»–ä½ç½®é…ç½®ä¸º <code>classpath:/custom-config/,file:./custom-config/</code>ï¼Œåˆ™æœç´¢é¡ºåºå°†å˜ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p><ol><li> <code>file:./custom-config/</code></li><li> <code>classpath:custom-config/</code></li><li> <code>file:./config/</code></li><li> <code>file:./</code></li><li> <code>classpath:/config/</code></li><li> <code>classpath:/</code></li></ol><p>è¯¥æœç´¢é¡ºåºå…è®¸æ‚¨åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤å€¼ï¼Œç„¶åæœ‰é€‰æ‹©åœ°è¦†ç›–å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚æ‚¨å¯ä»¥åœ¨ <code>application.properties</code>ï¼ˆæˆ–æ‚¨ä½¿ç”¨ <code>spring.config.name</code> æŒ‡å®šçš„å…¶ä»–æ–‡ä»¶ï¼‰ä¸­çš„æŸä¸ªé»˜è®¤ä½ç½®ä¸ºåº”ç”¨ç¨‹åºæä¾›é»˜è®¤å€¼ã€‚ä¹‹åï¼Œåœ¨è¿è¡Œæ—¶ï¼Œè¿™äº›é»˜è®¤å€¼å°†è¢«è‡ªå®šä¹‰ä½ç½®ä¸­çš„æŸä¸ªæ–‡ä»¶æ‰€è¦†ç›–ã€‚</p><h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><p>==springbootæ—¥å¿—æ¡†æ¶é»˜è®¤é‡‡ç”¨çš„æ˜¯slf4gå’Œlogbackï¼›==</p><h2 id="slf4gä½¿ç”¨"><a href="#slf4gä½¿ç”¨" class="headerlink" title="slf4gä½¿ç”¨"></a>slf4gä½¿ç”¨</h2><h3 id="å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨slf4g"><a href="#å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨slf4g" class="headerlink" title="å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨slf4g"></a>å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨slf4g</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›¾ç¤ºï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/concrete-bindings.png" alt="img"></p><p>æ¯ä¸€ä¸ªæ—¥å¿—æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨slf4gä»¥åé…ç½®æ–‡ä»¶è¿˜æ˜¯éœ€è¦<strong>ä½¿ç”¨å…·ä½“å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶</strong></p><h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><p>åœ¨å®é™…çš„å¼€å‘ä¸­éœ€è¦ä½¿ç”¨åˆ°å¤šä¸ªæ¡†æ¶ï¼Œå¦‚springã€hibernateã€mybatisâ€¦å¾€å¾€è¿™äº›æ¡†æ¶åº•å±‚ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶éƒ½æœ‰æ‰€ä¸åŒï¼Œspring(commons-logging)ã€hibernate(jboss-logging)ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³è¿™ä¸€é—®é¢˜ã€‚ç»Ÿä¸€çš„å°†æ—¥å¿—æ¡†æ¶çš„å®ç°éƒ½æ”¹ä¸ºslf4g</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/legacy.png" alt="click to enlarge"></p><h2 id="å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4j"><a href="#å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4j" class="headerlink" title="å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4j:"></a><strong>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4j:</strong></h2><ol><li> å…ˆå°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼›</li><li> ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼›</li><li> æˆ‘ä»¬å¯¼å…¥slf4jå…¶ä»–çš„å®ç°ï¼›</li></ol><h2 id="spring-bootæ—¥å¿—å…³ç³»"><a href="#spring-bootæ—¥å¿—å…³ç³»" class="headerlink" title="spring-bootæ—¥å¿—å…³ç³»"></a>spring-bootæ—¥å¿—å…³ç³»</h2><p>springbootä¸­ä½¿ç”¨å®ƒæ¥åšæ—¥å¿—åŠŸèƒ½ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åº•å±‚ä¾èµ–å…³ç³»ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200610091059443.png" alt="image-20200610091059443"></p><h1 id="WEBå¼€å‘"><a href="#WEBå¼€å‘" class="headerlink" title="WEBå¼€å‘"></a>WEBå¼€å‘</h1><h2 id="é™æ€èµ„æºçš„æ˜ å°„"><a href="#é™æ€èµ„æºçš„æ˜ å°„" class="headerlink" title="é™æ€èµ„æºçš„æ˜ å°„"></a>é™æ€èµ„æºçš„æ˜ å°„</h2><p>springBooté»˜è®¤è®¿é—®çš„é™æ€è·¯å¾„çš„ä½ç½®ï¼š</p><ul><li><p>classpath:\MATE-INFO\resources</p></li><li><p>classpath:\resources</p></li><li><p>classpath:\static</p></li><li><p>classpath:\public</p></li><li><p>\   (é¡¹ç›®æ ¹è·¯å¾„)</p></li></ul><blockquote><p>æ”¹å˜é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨<code>spring.resources.static-locations</code>å±æ€§æ›´æ”¹</p></blockquote><h2 id="å¼€å‘æœŸé—´ç¦ç”¨ç¼“å­˜"><a href="#å¼€å‘æœŸé—´ç¦ç”¨ç¼“å­˜" class="headerlink" title="å¼€å‘æœŸé—´ç¦ç”¨ç¼“å­˜"></a>å¼€å‘æœŸé—´ç¦ç”¨ç¼“å­˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç¦ç”¨ç¼“å­˜</span><br><span class="line">spring.thymeleaf.cache&#x3D;false</span><br></pre></td></tr></table></figure><p>æŒ‰<code>ctrl</code>+<code>f9</code>é‡æ–°ç¼–è¯‘é¡¹ç›®</p><h2 id="æ¨¡æ¿å¼•æ“"><a href="#æ¨¡æ¿å¼•æ“" class="headerlink" title="æ¨¡æ¿å¼•æ“"></a>æ¨¡æ¿å¼•æ“</h2><h3 id="thymeleaf"><a href="#thymeleaf" class="headerlink" title="thymeleaf"></a>thymeleaf</h3><p>å¼•å…¥thymeleaf</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="thymeleafä½¿ç”¨-amp-è¯­æ³•"><a href="#thymeleafä½¿ç”¨-amp-è¯­æ³•" class="headerlink" title="thymeleafä½¿ç”¨&amp;è¯­æ³•"></a>thymeleafä½¿ç”¨&amp;è¯­æ³•</h4><p>å…·ä½“ä½¿ç”¨å¯ä»¥æŸ¥çœ‹<a href="../thymeleaf/thymeleaf.md">thymeleaf.md</a></p><blockquote><p>åœ¨htmlæ ‡ç­¾ä¸­æ·»åŠ <code>xmlns:th=&quot;http://www.thymeleaf.org/&quot;</code>å±æ€§ç¼–å†™æ—¶å°±ä¼šå‡ºç°æç¤ºäº†</p></blockquote><h5 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.thymeleaf&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> String prefix = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String suffix = <span class="string">&quot;.html&quot;</span>;</span><br></pre></td></tr></table></figure><p>spring-bootä¸­ä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†thymeleafçš„é…ç½®é¡¹ï¼Œåªè¦åœ¨<code>classpath:/templates</code>ä¸­çš„htmlæ–‡ä»¶ä¼šè‡ªåŠ¨ä½¿ç”¨thyemeleafæ¨¡æ¿è¯­æ³•æ¥è§£æ</p><h5 id="Thymeleafå¸¸ç”¨è¯­æ³•"><a href="#Thymeleafå¸¸ç”¨è¯­æ³•" class="headerlink" title="Thymeleafå¸¸ç”¨è¯­æ³•"></a>Thymeleafå¸¸ç”¨è¯­æ³•</h5><ul><li><p>${} </p><p>ç”¨äºè·å–å˜é‡å€¼</p><blockquote><p>è¿™é‡Œçš„${}å¹¶ä¸æ˜¯elè¡¨è¾¾å¼è€Œæ˜¯ognl</p></blockquote></li><li><p>*{}</p><p>ä¸${}çš„ä½œç”¨ç±»ä¼¼ï¼Œä¸€èˆ¬ä¸<code>th:object</code>ä¸€èµ·ä½¿ç”¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;#session.qwq&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- *&#123;name&#125; ç›¸å½“äº $&#123;session.qwq.name&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;sex&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>@{}</p><p>  é“¾æ¥ç½‘å€</p></li><li><p>#{}</p></li><li><p>~{}</p></li><li><p>[()], [[]]</p></li></ul><h5 id="Thymeleafå†…ç½®å¯¹è±¡"><a href="#Thymeleafå†…ç½®å¯¹è±¡" class="headerlink" title="Thymeleafå†…ç½®å¯¹è±¡"></a>Thymeleafå†…ç½®å¯¹è±¡</h5><p>Thymeleafä¸­æä¾›äº†ä¸€äº›å†…ç½®å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨è¿™äº›å¯¹è±¡ä¸­æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ¥è°ƒç”¨ã€‚è·å–è¿™äº›å¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨<code>#å¯¹è±¡å</code>æ¥å¼•ç”¨ã€‚</p><ul><li>ä¸€äº›ç¯å¢ƒç›¸å…³å¯¹è±¡</li></ul><table><thead><tr><th>å¯¹è±¡</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>#ctx</code></td><td>è·å–Thymeleafè‡ªå·±çš„Contextå¯¹è±¡</td></tr><tr><td><code>#requset</code></td><td>å¦‚æœæ˜¯webç¨‹åºï¼Œå¯ä»¥è·å–HttpServletRequestå¯¹è±¡</td></tr><tr><td><code>#response</code></td><td>å¦‚æœæ˜¯webç¨‹åºï¼Œå¯ä»¥è·å–HttpServletReponseå¯¹è±¡</td></tr><tr><td><code>#session</code></td><td>å¦‚æœæ˜¯webç¨‹åºï¼Œå¯ä»¥è·å–HttpSessionå¯¹è±¡</td></tr><tr><td><code>#servletContext</code></td><td>å¦‚æœæ˜¯webç¨‹åºï¼Œå¯ä»¥è·å–HttpServletContextå¯¹è±¡</td></tr><tr><td></td><td></td></tr></tbody></table><ul><li>Thymeleafæä¾›çš„å…¨å±€å¯¹è±¡ï¼š</li></ul><table><thead><tr><th>å¯¹è±¡</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>#dates</code></td><td>å¤„ç†java.util.dateçš„å·¥å…·å¯¹è±¡</td></tr><tr><td><code>#calendars</code></td><td>å¤„ç†java.util.calendarçš„å·¥å…·å¯¹è±¡</td></tr><tr><td><code>#numbers</code></td><td>ç”¨æ¥å¯¹æ•°å­—æ ¼å¼åŒ–çš„æ–¹æ³•</td></tr><tr><td><code>#strings</code></td><td>ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²çš„æ–¹æ³•</td></tr><tr><td><code>#bools</code></td><td>ç”¨æ¥åˆ¤æ–­å¸ƒå°”å€¼çš„æ–¹æ³•</td></tr><tr><td><code>#arrays</code></td><td>ç”¨æ¥æŠ¤ç†æ•°ç»„çš„æ–¹æ³•</td></tr><tr><td><code>#lists</code></td><td>ç”¨æ¥å¤„ç†Listé›†åˆçš„æ–¹æ³•</td></tr><tr><td><code>#sets</code></td><td>ç”¨æ¥å¤„ç†seté›†åˆçš„æ–¹æ³•</td></tr><tr><td><code>#maps</code></td><td>ç”¨æ¥å¤„ç†mapé›†åˆçš„æ–¹æ³•</td></tr></tbody></table><h5 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h5><ul><li><p>å­—ç¬¦ä¸²</p><p>ä½¿ç”¨<code>&#39;&#39;</code>æ ‡æ³¨èµ·æ¥çš„å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  ä½ æ­£åœ¨è§‚çœ‹ <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;thymeleaf&#x27;&quot;</span>&gt;</span>template<span class="tag">&lt;/<span class="name">span</span>&gt;</span> çš„å­—ç¬¦ä¸²å¸¸é‡å€¼.</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨<code>&#39;&#39;</code>æ ‡æ³¨å¥½åƒä¹Ÿä¼šè¯†åˆ«æˆä¸€ä¸ªå­—ç¬¦ä¸²</p></li><li><p>æ•°å­—</p><p>æ•°å­—ä¸éœ€è¦è¿›è¡Œä»»ä½•æ ‡æ³¨ç›´æ¥ä½¿ç”¨å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;12+13&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å¸ƒå°”</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    ä½ å¡«çš„æ˜¯true</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="æ‹¼æ¥"><a href="#æ‹¼æ¥" class="headerlink" title="æ‹¼æ¥"></a>æ‹¼æ¥</h5><p>å­—ç¬¦ä¸²æ‹¼æ¥</p><p>å­—ç¬¦ä¸²å­—é¢å€¼éœ€è¦ç”¨<code>&#39;&#39;</code>ï¼Œæ‹¼æ¥èµ·æ¥éå¸¸éº»çƒ¦ï¼ŒThymeleafå¯¹æ­¤è¿›è¡Œäº†ç®€åŒ–ï¼Œä½¿ç”¨ä¸€å¯¹<code>|</code>å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;|æ¬¢è¿æ‚¨:$&#123;user.name&#125;|&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h5><p>éœ€è¦æ³¨æ„ï¼š<code>$&#123;&#125;</code>å†…éƒ¨çš„æ˜¯é€šè¿‡OGNLè¡¨è¾¾å¼å¼•æ“è§£æçš„ï¼Œå¤–éƒ¨çš„æ‰æ˜¯é€šè¿‡Thymeleafçš„å¼•æ“è§£æï¼Œå› æ­¤è¿ç®—ç¬¦å°½é‡æ”¾åœ¨<code>$&#123;&#125;</code>å¤–è¿›è¡Œã€‚</p><ul><li><p>ç®—æœ¯è¿ç®—</p><p>æ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦ï¼š<code>+ - * / %</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age+12&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>         //21</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;%2 == 0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>  //false</span><br></pre></td></tr></table></figure></li><li><p>æ¯”è¾ƒè¿ç®—</p><p>æ”¯æŒçš„æ¯”è¾ƒè¿ç®—ï¼š<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code> and <code>&lt;=</code> ï¼Œä½†æ˜¯<code>&gt;</code>, <code>&lt;</code>ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºxmlä¼šè§£æä¸ºæ ‡ç­¾ï¼Œè¦ä½¿ç”¨åˆ«åã€‚==ï¼ˆ3.0.11å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰==</p><p>æ³¨æ„ <code>==</code> and <code>!=</code>ä¸ä»…å¯ä»¥æ¯”è¾ƒæ•°å€¼ï¼Œç±»ä¼¼äºequalsçš„åŠŸèƒ½ã€‚</p><p>å¯ä»¥ä½¿ç”¨çš„åˆ«åï¼š<code>gt (&gt;), lt (&lt;), ge (&gt;=), le (&lt;=), not (!). Also eq (==), neq/ne (!=).</code></p></li><li><p>æ¡ä»¶è¿ç®—</p><ul><li>ä¸‰å…ƒè¿ç®—</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.sex&#125; ? &#x27;ç”·&#x27;:&#x27;å¥³&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>é»˜è®¤å€¼</p><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å–ä¸€ä¸ªå€¼å¯èƒ½ä¸ºç©ºï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åšéç©ºåˆ¤æ–­ï¼Œå¯ä»¥ä½¿ç”¨ <code>è¡¨è¾¾å¼ ?: é»˜è®¤å€¼</code>ç®€å†™ï¼š</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:text&#x3D;&quot;$&#123;user.name&#125; ?: &#39;äºŒç‹—&#39;&quot;&gt;&lt;&#x2F;span&gt;</span><br></pre></td></tr></table></figure><p>å½“å‰é¢çš„è¡¨è¾¾å¼å€¼ä¸ºnullæ—¶ï¼Œå°±ä¼šä½¿ç”¨åé¢çš„é»˜è®¤å€¼ã€‚</p><p>æ³¨æ„ï¼š<code>?:</code>ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚</p></li></ul><h5 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h5><p>å¾ªç¯ä¹Ÿæ˜¯éå¸¸é¢‘ç¹ä½¿ç”¨çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>th:each</code>æŒ‡ä»¤æ¥å®Œæˆï¼š</p><p>å‡å¦‚æœ‰ç”¨æˆ·çš„é›†åˆï¼šusersåœ¨Contextä¸­ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user : $&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>${users} æ˜¯è¦éå†çš„é›†åˆï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ç±»å‹ï¼š<ul><li>Iterableï¼Œå®ç°äº†Iterableæ¥å£çš„ç±»</li><li>Enumerationï¼Œæšä¸¾</li><li>Interatorï¼Œè¿­ä»£å™¨</li><li>Mapï¼Œéå†å¾—åˆ°çš„æ˜¯Map.Entry</li><li>Arrayï¼Œæ•°ç»„åŠå…¶å®ƒä¸€åˆ‡ç¬¦åˆæ•°ç»„ç»“æœçš„å¯¹è±¡</li></ul></li></ul><p>åœ¨è¿­ä»£çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å–è¿­ä»£çš„çŠ¶æ€å¯¹è±¡ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user,stat : $&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><p>statå¯¹è±¡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li>indexï¼Œä»0å¼€å§‹çš„è§’æ ‡</li><li>countï¼Œå…ƒç´ çš„ä¸ªæ•°ï¼Œä»1å¼€å§‹</li><li>sizeï¼Œæ€»å…ƒç´ ä¸ªæ•°</li><li>currentï¼Œå½“å‰éå†åˆ°çš„å…ƒç´ </li><li>even/oddï¼Œè¿”å›æ˜¯å¦ä¸ºå¥‡å¶ï¼Œbooleanå€¼</li><li>first/lastï¼Œè¿”å›æ˜¯å¦ä¸ºç¬¬ä¸€æˆ–æœ€åï¼Œbooleanå€¼</li></ul><h5 id="é€»è¾‘åˆ¤æ–­"><a href="#é€»è¾‘åˆ¤æ–­" class="headerlink" title="é€»è¾‘åˆ¤æ–­"></a>é€»è¾‘åˆ¤æ–­</h5><p>æœ‰äº†<code>ifå’Œelse</code>ï¼Œæˆ‘ä»¬èƒ½å®ç°ä¸€åˆ‡åŠŸèƒ½^_^ã€‚</p><p>Thymeleafä¸­ä½¿ç”¨<code>th:if</code> æˆ–è€… <code>th:unless</code> ï¼Œä¸¤è€…çš„æ„æ€æ°å¥½ç›¸åã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;user.age&#125; &gt; 24&quot;</span>&gt;</span>è€æ²¹æ¡<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¡¨è¾¾å¼çš„å€¼ä¸ºtrueï¼Œåˆ™æ ‡ç­¾ä¼šæ¸²æŸ“åˆ°é¡µé¢ï¼Œå¦åˆ™ä¸è¿›è¡Œæ¸²æŸ“ã€‚</p><p>ä»¥ä¸‹æƒ…å†µè¢«è®¤å®šä¸ºtrueï¼š</p><ul><li>è¡¨è¾¾å¼å€¼ä¸ºtrue</li><li>è¡¨è¾¾å¼å€¼ä¸ºé0æ•°å€¼</li><li>è¡¨è¾¾å¼å€¼ä¸ºé0å­—ç¬¦</li><li>è¡¨è¾¾å¼å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä½†ä¸æ˜¯<code>&quot;false&quot;</code>,<code>&quot;no&quot;</code>,<code>&quot;off&quot;</code></li><li>è¡¨è¾¾å¼ä¸æ˜¯å¸ƒå°”ã€å­—ç¬¦ä¸²ã€æ•°å­—ã€å­—ç¬¦ä¸­çš„ä»»ä½•ä¸€ç§</li></ul><p>å…¶å®ƒæƒ…å†µåŒ…æ‹¬nulléƒ½è¢«è®¤å®šä¸ºfalse</p><h5 id="åˆ†æ”¯æ§åˆ¶switch"><a href="#åˆ†æ”¯æ§åˆ¶switch" class="headerlink" title="åˆ†æ”¯æ§åˆ¶switch"></a>åˆ†æ”¯æ§åˆ¶switch</h5><p>è¿™é‡Œè¦ä½¿ç”¨ä¸¤ä¸ªæŒ‡ä»¤ï¼š<code>th:switch</code> å’Œ <code>th:case</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>ç”¨æˆ·æ˜¯ç®¡ç†å‘˜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;manager&#x27;&quot;</span>&gt;</span>ç”¨æˆ·æ˜¯ç»ç†<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>ç”¨æˆ·æ˜¯åˆ«çš„ç©æ„<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªth:caseæˆç«‹ï¼Œå…¶å®ƒçš„åˆ™ä¸å†åˆ¤æ–­ã€‚ä¸javaä¸­çš„switchæ˜¯ä¸€æ ·çš„ã€‚</p><p>å¦å¤–<code>th:case=&quot;*&quot;</code>è¡¨ç¤ºé»˜è®¤ï¼Œæ”¾æœ€åã€‚</p><h5 id="JSæ¨¡æ¿"><a href="#JSæ¨¡æ¿" class="headerlink" title="JSæ¨¡æ¿"></a>JSæ¨¡æ¿</h5><p>æ¨¡æ¿å¼•æ“ä¸ä»…å¯ä»¥æ¸²æŸ“htmlï¼Œä¹Ÿå¯ä»¥å¯¹JSä¸­çš„è¿›è¡Œé¢„å¤„ç†ã€‚è€Œä¸”ä¸ºäº†åœ¨çº¯é™æ€ç¯å¢ƒä¸‹å¯ä»¥è¿è¡Œï¼Œå…¶Thymeleafä»£ç å¯ä»¥è¢«æ³¨é‡Šèµ·æ¥ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:inline</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> user = <span class="comment">/*[[$&#123;user&#125;]]*/</span> &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> age = <span class="comment">/*[[$&#123;user.age&#125;]]*/</span> <span class="number">20</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(user);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(age)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>åœ¨scriptæ ‡ç­¾ä¸­é€šè¿‡<code>th:inline=&quot;javascript&quot;</code>æ¥å£°æ˜è¿™æ˜¯è¦ç‰¹æ®Šå¤„ç†çš„jsè„šæœ¬</p></li><li><p>è¯­æ³•ç»“æ„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = <span class="comment">/*[[Thymeleafè¡¨è¾¾å¼]]*/</span> <span class="string">&quot;é™æ€ç¯å¢ƒä¸‹çš„é»˜è®¤å€¼&quot;</span>;</span><br></pre></td></tr></table></figure><p>å› ä¸ºThymeleafè¢«æ³¨é‡Šèµ·æ¥ï¼Œå› æ­¤å³ä¾¿æ˜¯é™æ€ç¯å¢ƒä¸‹ï¼Œ jsä»£ç ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯é‡‡ç”¨è¡¨è¾¾å¼åé¢è·Ÿç€çš„é»˜è®¤å€¼ã€‚ä¸”Userå¯¹è±¡ä¼šè¢«ç›´æ¥å¤„ç†ä¸ºjsonæ ¼å¼ã€‚</p></li></ul><h3 id="freemarker"><a href="#freemarker" class="headerlink" title="freemarker"></a>freemarker</h3><p><a href="../freemarker/README.md">freemarker.md</a></p><h2 id="å›½é™…åŒ–"><a href="#å›½é™…åŒ–" class="headerlink" title="å›½é™…åŒ–"></a>å›½é™…åŒ–</h2><p>ç”±äºspring-bootä¸ºæˆ‘ä»¬é…ç½®äº†å›½é™…åŒ–çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å†™å›½é™…åŒ–é…ç½®æ–‡ä»¶</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/%E5%9B%BD%E9%99%85%E5%8C%96.png" alt="å›½é™…åŒ–"></p><p>ä½†æ˜¯spring-bootçš„é»˜è®¤é…ç½®å›½é™…åŒ–é…ç½®æ–‡ä»¶çš„æ ¼å¼æ˜¯åœ¨ç±»è·¯å¾„ä¸‹å¯»æ‰¾message[_å›½å®¶ä»£ç ].propertiesæ–‡ä»¶ï¼Œå¦‚æœè¦ä¿®æ”¹é»˜è®¤é…ç½®éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹<code>spring.message.basename</code>çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class: MessageSourceAutoConfiguration</span></span><br><span class="line"><span class="comment">// è¿™é‡Œå°†MessageSourcePropertiesç±»åŠ å…¥åˆ°å®¹å™¨ä¸­å¹¶å°†é…ç½®æ–‡ä»¶ä¸­çš„spring.messagesçš„é…ç½®æ˜ å°„åˆ°è¯¥ç»„ä»¶ä¸­</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.messages&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSourceProperties <span class="title">messageSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MessageSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">(MessageSourceProperties properties)</span> </span>&#123;</span><br><span class="line">    ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œè®¾ç½®äº†æŸ¥æ‰¾å›½é™…åŒ–æ–‡ä»¶çš„basename</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(properties.getBasename())) &#123;</span><br><span class="line">        messageSource.setBasenames(StringUtils</span><br><span class="line">                                   .commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(properties.getBasename())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (properties.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setDefaultEncoding(properties.getEncoding().name());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setFallbackToSystemLocale(properties.isFallbackToSystemLocale());</span><br><span class="line">    Duration cacheDuration = properties.getCacheDuration();</span><br><span class="line">    <span class="keyword">if</span> (cacheDuration != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setCacheMillis(cacheDuration.toMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setAlwaysUseMessageFormat(properties.isAlwaysUseMessageFormat());</span><br><span class="line">    messageSource.setUseCodeAsDefaultMessage(properties.isUseCodeAsDefaultMessage());</span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å›½é™…åŒ–æ–‡ä»¶ä¸­å†™å…¥å€¼ä¹‹åå¦‚æœä½¿ç”¨çš„<strong>thymeleaf</strong>æ¨¡æ¿åˆ™ä½¿ç”¨#{}å–å€¼å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;submit&#125;&quot;</span>&gt;</span> ç«‹å³ç™»å½•!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå›½é™…åŒ–å°±å®Œæˆäº†ï¼Œä½†æ˜¯å¦‚æœæƒ³å®ç°ç‚¹å‡»å¯¹åº”è¯­è¨€çš„é“¾æ¥å°±è½¬æ¢æˆå¯¹åº”çš„è¯­è¨€å°±éœ€è¦åœ¨å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ª<code>LocaleResolver</code>ï¼ˆåœ°åŒºè§£æå™¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤çš„LocaleResolver</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">    AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">    localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°çš„LocaleResolver</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LocaleResolver() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å›½å®¶è¯­è¨€å‚æ•°</span></span><br><span class="line">            String localeStr = request.getParameter(<span class="string">&quot;locale&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å£°æ˜å­˜æ”¾è¯­è¨€å’Œå›½å®¶æ•°ç»„</span></span><br><span class="line">            String[] language_country = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰æºå¸¦å›½å®¶è¯­è¨€å‚æ•°å°±ä½¿ç”¨æµè§ˆå™¨é»˜è®¤ä¼ é€’çš„</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(localeStr)) &#123;</span><br><span class="line">                language_country = localeStr.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                language_country = request.getHeader(<span class="string">&quot;Accept-Language&quot;</span>)</span><br><span class="line">                    .split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">                    .split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Locale(language_country[<span class="number">0</span>], language_country[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨springmvcçš„è‡ªåŠ¨é…ç½®ç±»ä¸­ä¸ºæˆ‘ä»¬æ·»åŠ äº†é»˜è®¤çš„LocaleResolver</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">    AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">    localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>åœ¨spring-bootå®ç°æ‹¦æˆªå™¨éå¸¸ç®€å•ï¼Œä»¥ä¸‹ç”¨ç™»å½•åšç¤ºä¾‹</p><ol><li><p>åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æ‹¦æˆªå™¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯ä¸ªæ‹¦æˆªå™¨ç±»éƒ½å¿…é¡»å®ç°HandlerInterceptorç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨è·³è½¬ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String userName = (String) request.getSession().getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(userName))&#123;</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.html&quot;</span>).forward(request, response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ³¨å†Œæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login.html&quot;</span>, <span class="string">&quot;/user/login&quot;</span>); <span class="comment">// ä¸æ‹¦æˆªå…¶ä¸­çš„è¯·æ±‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><p>springbootä¼šå¯¹ä¸åŒçš„å®¢æˆ·ç«¯è¿›è¡Œä¸åŒçš„ç›¸åº”ï¼ˆç½‘é¡µç«¯å‡ºç°é”™è¯¯æ—¶ä¼šè¿”å›é¡µé¢ï¼Œå…¶ä»–å®¢æˆ·ç«¯è‹¥æœªæ ‡æ˜éœ€è¦æ¥å—ç½‘é¡µçš„è¯åˆ™è¿”å›jsonæ•°æ®ï¼‰</p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200423100634694.png" alt="image-20200423100634694"></p><h3 id="é”™è¯¯é¡µé¢å®šåˆ¶"><a href="#é”™è¯¯é¡µé¢å®šåˆ¶" class="headerlink" title="é”™è¯¯é¡µé¢å®šåˆ¶"></a>é”™è¯¯é¡µé¢å®šåˆ¶</h3><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200423095450376.png" alt="image-20200423095450376"></p><p>åªéœ€è¦åœ¨resourcesæ–‡ä»¶ä¸‹çš„staticæˆ–templetesæ–‡ä»¶å¤¹ä¸‹æ”¾ç½®åŒ…å«é”™è¯¯é¡µé¢çš„erroræ–‡ä»¶å¤¹å³å¯</p><h4 id="é”™è¯¯æ–‡ä»¶æ³¨æ„äº‹é¡¹"><a href="#é”™è¯¯æ–‡ä»¶æ³¨æ„äº‹é¡¹" class="headerlink" title="é”™è¯¯æ–‡ä»¶æ³¨æ„äº‹é¡¹"></a>é”™è¯¯æ–‡ä»¶æ³¨æ„äº‹é¡¹</h4><ul><li><p>é”™è¯¯æ–‡ä»¶çš„å‘½åå¯ä»¥ä¸ºå‡†ç¡®çš„é”™è¯¯ä»£ç åï¼ˆå¦‚ï¼š404.html, 405.htmlï¼‰</p></li><li><p>å‘½åä¹Ÿå¯ä»¥ä¸º4xx.htmlæˆ–5xx.html</p></li><li><p>springbootä¼˜å…ˆç²¾å‡†åŒ¹é…ï¼ˆå½“å‘ç”Ÿ404é”™è¯¯æ—¶å¦‚æœæœ‰404.htmlå’Œ4xx.htmlå°±ä¼šä¼˜å…ˆä½¿ç”¨404.htmlï¼‰</p></li><li><p>springbootä¼˜å…ˆä½¿ç”¨templetesä¸­çš„é”™è¯¯æ–‡ä»¶</p></li></ul><h2 id="è‡ªå®šä¹‰é”™è¯¯json"><a href="#è‡ªå®šä¹‰é”™è¯¯json" class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯json"></a>è‡ªå®šä¹‰é”™è¯¯json</h2><ol><li>springmvcä¸­å¤„ç†å¼‚å¸¸çš„æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserMiss.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">error</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;error&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œè¿”å›çš„æ•°æ®å…¨æ˜¯jsonä¸ä¼šè¿”å›é¡µé¢</p><ol start="2"><li><p>æ”¹è¿›ä¸Šä¸€ä¸ªæ–¹æ³•ä½¿å¾—å¯ä»¥è‡ªé€‚åº”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserMiss.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">error</span><span class="params">(Exception e, HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;error&quot;</span>, e.getMessage());</span><br><span class="line">    map.put(<span class="string">&quot;code&quot;</span>, <span class="number">500</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;ext&quot;</span>, map);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>, <span class="number">500</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/error&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2è™½ç„¶å¯ä»¥åšåˆ°è‡ªé€‚åº”ä½†æ˜¯æ— æ³•åšåˆ°è‡ªå®šä¹‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯mapä¸­å®šä¹‰çš„æ•°æ®æ— æ³•ä¼ é€’åˆ°å®¢æˆ·ç«¯</p><p>æ³¨æ„ï¼šå¿…é¡»è¦å‘requestä¸­æ·»åŠ status_codeï¼Œå› ä¸ºé»˜è®¤çš„çŠ¶æ€ç ä¸º200ï¼ŒçŠ¶æ€ç ä¸º200çš„è¯ä¼šå¯¼è‡´æ‰¾ä¸åˆ°é”™è¯¯é¡µé¢è€Œä½¿ç”¨springbooté»˜è®¤çš„é”™è¯¯é¡µ</p></li><li><p>åšåˆ°è‡ªé€‚åº”çš„åŒæ—¶æ·»åŠ è‡ªå®šä¹‰æ•°æ®</p><p>ä»æºç å¯çŸ¥æ•°æ®æ˜¯ä»<code>ErrorAttributes.getErrorAttributes</code>æ–¹æ³•ä¸­è·å–çš„æ‰€ä»¥åªéœ€è¦é‡å†™<code>getErrorAttributes</code>æ–¹æ³•å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map =  <span class="keyword">super</span>.getErrorAttributes(webRequest, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">&quot;qwq&quot;</span>, <span class="string">&quot;qwq&quot;</span>);</span><br><span class="line">        <span class="comment">// ä»requeståŸŸä¸­æŸ¥æ‰¾æ·»åŠ è¿›æ¥çš„æ•°æ®</span></span><br><span class="line">        map.put(<span class="string">&quot;ext&quot;</span>, webRequest.getAttribute(<span class="string">&quot;ext&quot;</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><p>å‘å®¹å™¨ä¸­æ·»åŠ <code>BasicErrorController</code>ç±»å¹¶é‡å†™<code>errorHtml</code>å’Œ<code>error</code>æ–¹æ³•ã€‚</p><p>å¤ªéº»çƒ¦äº†ï¼Œç•¥è¿‡</p></li></ol></li></ol><h2 id="é”™è¯¯å¤„ç†åŸç†"><a href="#é”™è¯¯å¤„ç†åŸç†" class="headerlink" title="é”™è¯¯å¤„ç†åŸç†"></a>é”™è¯¯å¤„ç†åŸç†</h2><p>è¯¦æƒ…è§ç±»</p><p>springbootä¸ºæ­¤ç±»æ·»åŠ äº†ä¸€ä¸‹å‡ ä¸ªé‡è¦çš„ç»„ä»¶</p><ol><li><p>ErrorPageCustomizer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;error.path:/error&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">&quot;/error&quot;</span>; <span class="comment">// å‡ºç°é”™è¯¯æ—¶æ¥åˆ°errorè¯·æ±‚è¿›è¡Œå¤„ç†</span></span><br></pre></td></tr></table></figure></li><li><p>BasicErrorController å¤„ç†é»˜è®¤/errorè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span> <span class="comment">// ï¼šä»£è¡¨å¦‚æœæ²¡æœ‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// public static final String TEXT_HTML_VALUE = &quot;text/html&quot;;</span></span><br><span class="line"><span class="meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span> <span class="comment">// å“åº”éœ€è¦ä¼ å›é¡µé¢çš„è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">HttpStatus status = getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections</span><br><span class="line">.unmodifiableMap(getErrorAttributes(request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•æœªå†™@ResponseBodyæ³¨è§£ä¹Ÿèƒ½è¿”å›jsonæ•°æ®çš„åŸå› æ˜¯ResponseEntityç±»å’Œ@ResponseBodyä¸€æ ·ä¸ä¼šè¢«è§£ææˆè§†å›¾ï¼Œä½†æ˜¯ResponseEntityå¯ä»¥è‡ªå®šä¹‰å“åº”å¤´å’ŒçŠ¶æ€ç ï¼Œ@ResponseBodyä¸è¡Œ</span></span><br><span class="line"><span class="meta">@RequestMapping</span> <span class="comment">// å“åº”æœªæ ‡æ³¨text/htmlçš„è¯·æ±‚</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">HttpStatus status = getStatus(request);</span><br><span class="line"><span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">&#125;</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>DefaultErrorViewResolver </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultErrorViewResolver</span> <span class="keyword">implements</span> <span class="title">ErrorViewResolver</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">Map&lt;Series, String&gt; views = <span class="keyword">new</span> EnumMap&lt;&gt;(Series.class);</span><br><span class="line">views.put(Series.CLIENT_ERROR, <span class="string">&quot;4xx&quot;</span>);</span><br><span class="line">views.put(Series.SERVER_ERROR, <span class="string">&quot;5xx&quot;</span>);</span><br><span class="line">SERIES_VIEWS = Collections.unmodifiableMap(views);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// resolveErrorViewæ–¹æ³•ç”¨äºå°†é”™è¯¯ç ä¼ å…¥resolveæŸ¥æ‰¾é”™è¯¯é¡µé¢ï¼Œå¦‚æœæœ‰å°±è¿”å›é”™è¯¯é¡µé¢ï¼›å¦‚æœæ²¡æœ‰å°±å°†é”™è¯¯ç³»åˆ—ä¼ å…¥å†è¿›è¡ŒæŸ¥æ‰¾ï¼ˆé”™è¯¯ç³»åˆ—ä¸º1,2,3,4,5ï¼›è¯¦æƒ…è§HttpStatusç±»ï¼‰ä½†ç”±äºspringbootåªç»‘å®šäº†4å’Œ5çš„é”™è¯¯ç³»åˆ—ï¼Œæ‰€ä»¥å‡ºç°å…¶ä»–ç³»åˆ—çš„é”™è¯¯æ—¶ä¼šå› ä¸ºé›†åˆä¸­æ²¡æœ‰ç»‘å®šæ‰€ä»¥ä¼šè¿”å›é»˜è®¤çš„é¡µé¢</span></span><br><span class="line">    <span class="comment">// å› ä¸ºå…ˆæŸ¥æ‰¾çš„æ˜¯ç²¾ç¡®çš„é”™è¯¯ç æ‰€ä»¥æ‰ä¼šä¼˜å…ˆæ˜¾ç¤ºç²¾ç¡®é”™è¯¯ç .htmlçš„é¡µé¢</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// resolveæ–¹æ³•ç”¨äºæŸ¥æ‰¾é”™è¯¯è§†å›¾ã€‚æŸ¥æ‰¾è§„åˆ™ä¸ºï¼šå°†ç”±resolveErrorViewæ–¹æ³•ä¼ é€’è¿‡æ¥çš„é”™è¯¯ç æˆ–é”™è¯¯ç³»åˆ—ï¼ˆ4xx, 5xxï¼‰æ‹¼æ¥åˆ°error/åå†ä»templatesæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å†è°ƒç”¨resolveResourceæ–¹æ³•ä»é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ ï¼ˆ&quot;classpath:/META-INF/resources/&quot;,&quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot;ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">String errorViewName = <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName,</span><br><span class="line"><span class="keyword">this</span>.applicationContext);</span><br><span class="line"><span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// resolveResourceç”¨äºä»é™æ€èµ„æºç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ä¼šè¿”å›null</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (String location : <span class="keyword">this</span>.resourceProperties.getStaticLocations()) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Resource resource = <span class="keyword">this</span>.applicationContext.getResource(location);</span><br><span class="line">resource = resource.createRelative(viewName + <span class="string">&quot;.html&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> HtmlResourceView(resource), model);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>DefaultErrorAttributes   è·å–é”™è¯¯ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">errorAttributes.put(<span class="string">&quot;timestamp&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">addStatus(errorAttributes, webRequest);</span><br><span class="line">addErrorDetails(errorAttributes, webRequest, includeStackTrace);</span><br><span class="line">addPath(errorAttributes, webRequest);</span><br><span class="line"><span class="keyword">return</span> errorAttributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è·å–çš„é”™è¯¯ä¿¡æ¯æœ‰ï¼š</p><p>timestampï¼šæ—¶é—´æˆ³</p><p>statusï¼šçŠ¶æ€ç </p><p>errorï¼šé”™è¯¯æç¤º</p><p>exceptionï¼šå¼‚å¸¸å¯¹è±¡</p><p>messageï¼šé”™è¯¯æ¶ˆæ¯</p><p>errorsï¼šJSR303æ•°æ®æ ¡éªŒçš„é”™è¯¯ä¿¡æ¯</p></li></ol><p>é¡ºåºï¼šå½“ç¨‹åºå‡ºç°4xxæˆ–5xxé”™è¯¯æ—¶<code>ErrorPageCustomizer</code>å°±ä¼šç”Ÿæ•ˆï¼ˆå®šåˆ¶é”™è¯¯çš„å“åº”è§„åˆ™ï¼‰ï¼Œæ¥åˆ°/errorè¯·æ±‚ï¼›</p><p>/errorè¯·æ±‚ç”±<code>BasicErrorController</code>æ¥è¿›è¡Œå“åº”ï¼›å†ç”±<code>DefaultErrorViewResolver</code>è¿›è¡Œå¤„ç†ï¼ˆ<code>BasicErrorController</code>è°ƒç”¨<code>resolveErrorView</code>æ–¹æ³•æŸ¥æ‰¾é”™è¯¯è§†å›¾ã€ç”±äºé»˜è®¤springbootä¸­åªæœ‰ä¸€ä¸ª<code>ErrorViewResolver</code>çš„å®ç°ç±»æ‰€ä»¥ä¼šè°ƒç”¨åˆ° <code>DefaultErrorViewResolver</code>æ¥å¤„ç†ã€‘ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°é”™è¯¯è§†å›¾springbootä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼‰å¾—åˆ°çš„modelandviewä¸­modelä¸­åŒ…å«çš„ä¿¡æ¯ä»<code>DefaultErrorAttributes</code>  ä¸­è·å–çš„</p><h1 id="åµŒå…¥å¼servletå®¹å™¨"><a href="#åµŒå…¥å¼servletå®¹å™¨" class="headerlink" title="åµŒå…¥å¼servletå®¹å™¨"></a>åµŒå…¥å¼servletå®¹å™¨</h1><h2 id="ä¿®æ”¹ä¸serveræœ‰å…³çš„é…ç½®"><a href="#ä¿®æ”¹ä¸serveræœ‰å…³çš„é…ç½®" class="headerlink" title="ä¿®æ”¹ä¸serveræœ‰å…³çš„é…ç½®"></a>ä¿®æ”¹ä¸serveræœ‰å…³çš„é…ç½®</h2><h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®-ServerProperties"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®-ServerProperties" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®[ServerProperties]"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®[ServerProperties]</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.post</span> = <span class="string">8081</span></span><br><span class="line"><span class="meta">server.error.path</span>=<span class="string">/error2</span></span><br><span class="line"><span class="comment"># server.xxx ä¸ºserverçš„é€šç”¨é…ç½®</span></span><br><span class="line"><span class="comment"># server.tomcat.xxx ä¸ºTomcatçš„é€šç”¨é…ç½®</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Servletå®¹å™¨å®šåˆ¶å™¨"><a href="#ä½¿ç”¨Servletå®¹å™¨å®šåˆ¶å™¨" class="headerlink" title="ä½¿ç”¨Servletå®¹å™¨å®šåˆ¶å™¨"></a>ä½¿ç”¨Servletå®¹å™¨å®šåˆ¶å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer <span class="title">webServerFactoryCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">            factory.setPort(<span class="number">8082</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤è€…çš„é…ç½®æ–¹å¼è™½ç„¶ä¸åŒï¼Œä½†æ˜¯åœ¨é…ç½®æ–‡ä»¶åœ¨åº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨servletå®¹å™¨å®šåˆ¶å™¨å®ç°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletWebServerFactoryCustomizer</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">ConfigurableServletWebServerFactory</span>&gt;, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ServerProperties serverProperties;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®servletä¸‰å¤§ç»„ä»¶ï¼ˆservletï¼Œfilterï¼ŒListenerï¼‰"><a href="#é…ç½®servletä¸‰å¤§ç»„ä»¶ï¼ˆservletï¼Œfilterï¼ŒListenerï¼‰" class="headerlink" title="é…ç½®servletä¸‰å¤§ç»„ä»¶ï¼ˆservletï¼Œfilterï¼ŒListenerï¼‰"></a>é…ç½®servletä¸‰å¤§ç»„ä»¶ï¼ˆservletï¼Œfilterï¼ŒListenerï¼‰</h2><p>åªéœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ ServletRegistrationBeanã€ã€ç»„ä»¶</p><h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;servlet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®Servlet</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">servletRegistrationBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ServletRegistrationBean&lt;MyServlet&gt; registrationBean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> MyServlet(), <span class="string">&quot;/servlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">extends</span> <span class="title">HttpFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;filter...&quot;</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®filter</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">filterRegistrationBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FilterRegistrationBean&lt;MyFilter&gt; registrationBean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;(<span class="keyword">new</span> MyFilter());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/servlet&quot;</span>, <span class="string">&quot;/hello&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€æ¯å•¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€æ¯å•¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ‡æ¢å…¶ä»–servletå®¹å™¨"><a href="#åˆ‡æ¢å…¶ä»–servletå®¹å™¨" class="headerlink" title="åˆ‡æ¢å…¶ä»–servletå®¹å™¨"></a>åˆ‡æ¢å…¶ä»–servletå®¹å™¨</h2><p>Tomcatï¼ˆé»˜è®¤ä½¿ç”¨ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥webæ¨¡å—æ—¶é»˜è®¤ä½¿ç”¨çš„servletå®¹å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>jetty</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>undertow</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†"><a href="#åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†"></a><a href="https://www.cnblogs.com/jatpeo/p/11767502.html">åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†</a></h2><p><code>ServletWebServerFactoryAutoConfiguration</code>ï¼šåµŒå…¥å¼servletè‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="comment">// ä»…åœ¨ç±» ServletRequest å­˜åœ¨äº classpath ä¸Šæ—¶æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(ServletRequest.class)</span></span><br><span class="line"><span class="comment">// åº”ç”¨ä¸º servlet web åº”ç”¨æ˜¯æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="comment">// ç¡®ä¿ server å¼€å¤´çš„é…ç½®åŠ å…¥åˆ°å®¹å™¨ä¸­äº†</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span></span><br><span class="line"><span class="comment">// å¯¼å…¥ä¸¤ä¸ªåç½®å¤„ç†å™¨ï¼šwebServerFactoryCustomizerBeanPostProcessorå’ŒerrorPageRegistrarBeanPostProcessor</span></span><br><span class="line"><span class="comment">// å¯¼å…¥çš„EmbeddedTomcat/EmbeddedJetty/EmbeddedUndertowä¼šé€šè¿‡åˆ¤æ–­classpathä¸Šæ˜¯å¦å­˜åœ¨å¯¹åº”çš„tomcat/jetty/undertowå®¹å™¨ï¼Œåˆ¤æ–­å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸ªå®¹å™¨</span></span><br><span class="line"><span class="comment">// å†å†³å®šå®šä¹‰å“ªä¸€ä¸ª Servlet WebæœåŠ¡å™¨çš„å·¥å‚ bean :</span></span><br><span class="line"><span class="comment">// TomcatServletWebServerFactory/JettyServletWebServerFactory/UndertowServletWebServerFactory</span></span><br><span class="line"><span class="meta">@Import(&#123; ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,</span></span><br><span class="line"><span class="meta">         ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,</span></span><br><span class="line"><span class="meta">         ServletWebServerFactoryConfiguration.EmbeddedJetty.class,</span></span><br><span class="line"><span class="meta">         ServletWebServerFactoryConfiguration.EmbeddedUndertow.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletWebServerFactoryAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure><p><code>ServletWebServerFactoryAutoConfiguration</code>å†…éƒ¨ç±»<code>BeanPostProcessorsRegistrar</code></p><p><code>webServerFactoryCustomizerBeanPostProcessor</code>ï¼šæ”¶é›†å®¹å™¨ä¸­æ‰€æœ‰çš„<code>WebServerFactoryCustomizer</code>å¯¹å½“å‰åº”ç”¨æ‰€é‡‡ç”¨çš„<code>WebServerFactory</code> è¢«åˆå§‹åŒ–å‰è¿›è¡Œå®šåˆ¶</p><p><code>ErrorPageRegistrarBeanPostProcessor</code>ï¼šæ”¶é›†æ‰€æœ‰çš„é”™è¯¯å¤„ç†å®šåˆ¶å™¨æ³¨å†Œåˆ°å¯¹åº”çš„servletå®¹å™¨é‡Œé¢å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanPostProcessorsRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">BeanFactoryAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ConfigurableListableBeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> ConfigurableListableBeanFactory) &#123;</span><br><span class="line"><span class="keyword">this</span>.beanFactory = (ConfigurableListableBeanFactory) beanFactory;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata,</span></span></span><br><span class="line"><span class="function"><span class="params">BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">registerSyntheticBeanIfMissing(registry, <span class="string">&quot;webServerFactoryCustomizerBeanPostProcessor&quot;</span>,</span><br><span class="line">WebServerFactoryCustomizerBeanPostProcessor.class);</span><br><span class="line">registerSyntheticBeanIfMissing(registry, <span class="string">&quot;errorPageRegistrarBeanPostProcessor&quot;</span>,</span><br><span class="line">ErrorPageRegistrarBeanPostProcessor.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerSyntheticBeanIfMissing</span><span class="params">(BeanDefinitionRegistry registry, String name, Class&lt;?&gt; beanClass)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (ObjectUtils.isEmpty(<span class="keyword">this</span>.beanFactory.getBeanNamesForType(beanClass, <span class="keyword">true</span>, <span class="keyword">false</span>))) &#123;</span><br><span class="line">RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(beanClass);</span><br><span class="line">beanDefinition.setSynthetic(<span class="keyword">true</span>);</span><br><span class="line">registry.registerBeanDefinition(name, beanDefinition);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…ç½®servleté…ç½®ä¿®æ”¹åŸç†"><a href="#å†…ç½®servleté…ç½®ä¿®æ”¹åŸç†" class="headerlink" title="å†…ç½®servleté…ç½®ä¿®æ”¹åŸç†"></a>å†…ç½®servleté…ç½®ä¿®æ”¹åŸç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebServerFactoryCustomizerBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span>, <span class="title">BeanFactoryAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ListableBeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;WebServerFactoryCustomizer&lt;?&gt;&gt; customizers;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">        Assert.isInstanceOf(ListableBeanFactory.class, beanFactory,</span><br><span class="line">                            <span class="string">&quot;WebServerCustomizerBeanPostProcessor can only be used with a ListableBeanFactory&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = (ListableBeanFactory) beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å¦‚æœå½“å‰åˆå§‹åŒ–ç»„ä»¶æ˜¯WebServerFactory çš„ä¸€ä¸ªç»„ä»¶ï¼Œå°±è°ƒç”¨postProcessBeforeInitializationæ­¤æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> WebServerFactory) &#123;</span><br><span class="line">            postProcessBeforeInitialization((WebServerFactory) bean);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„å®šåˆ¶å™¨ï¼Œè°ƒç”¨æ¯ä¸€ä¸ªå®šåˆ¶å™¨çš„customizeæ–¹æ³•ï¼Œæ¥ç»™servletå®¹å™¨è¿›è¡Œå±æ€§èµ‹å€¼</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postProcessBeforeInitialization</span><span class="params">(WebServerFactory webServerFactory)</span> </span>&#123;</span><br><span class="line">        LambdaSafe.callbacks(WebServerFactoryCustomizer.class, getCustomizers(), webServerFactory)</span><br><span class="line">            .withLogger(WebServerFactoryCustomizerBeanPostProcessor.class)</span><br><span class="line">            .invoke((customizer) -&gt; customizer.customize(webServerFactory));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰WebServerFactoryCustomizerå¹¶æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> Collection&lt;WebServerFactoryCustomizer&lt;?&gt;&gt; getCustomizers() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.customizers == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">            <span class="keyword">this</span>.customizers = <span class="keyword">new</span> ArrayList&lt;&gt;(getWebServerFactoryCustomizerBeans());</span><br><span class="line">            <span class="keyword">this</span>.customizers.sort(AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">            <span class="keyword">this</span>.customizers = Collections.unmodifiableList(<span class="keyword">this</span>.customizers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.customizers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰WebServerFactoryCustomizer</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Collection&lt;WebServerFactoryCustomizer&lt;?&gt;&gt; getWebServerFactoryCustomizerBeans() &#123;</span><br><span class="line">        <span class="keyword">return</span> (Collection) <span class="keyword">this</span>.beanFactory.getBeansOfType(WebServerFactoryCustomizer.class, <span class="keyword">false</span>, <span class="keyword">false</span>).values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†çš„æ­¥éª¤"><a href="#åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†çš„æ­¥éª¤" class="headerlink" title="åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†çš„æ­¥éª¤"></a><strong>åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†çš„æ­¥éª¤</strong></h3><ol><li><p><strong>SpringBootæ ¹æ®å¯¼å…¥çš„ä¾èµ–æƒ…å†µï¼Œå®¹å™¨ä¸­å¯¼å…¥çš„ServletWebServerFactoryConfigurationé…ç½®ç±»ï¼Œç»™å®¹å™¨æ·»åŠ ç›¸åº”çš„TomcatServletWebServerFactoryï¼Œé€šè¿‡TomcatServletWebServerFactoryçš„getWebServerï¼ˆï¼‰å¯åŠ¨serveltå®¹å™¨</strong></p></li><li><p><strong>å®¹å™¨ä¸­æŸä¸ªç»„ä»¶è¦åˆ›å»ºå¯¹è±¡å°±ä¼šæƒŠåŠ¨åç½®å¤„ç†å™¨ï¼›@Import({ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,åªè¦æ˜¯åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼Œåç½®å¤„ç†å™¨å°±å·¥ä½œï¼Œç”¨ä¸å®šåˆ¶åµŒå…¥å¼å®¹å™¨çš„é…ç½®ä¿®æ”¹ï¼Œ</strong></p></li><li><p><strong>åç½®å¤„ç†å™¨ï¼Œæ‰§è¡ŒpostProcessBeforeInitializationï¼ˆï¼‰æ–¹æ³•ï¼Œè°ƒç”¨å®šåˆ¶å™¨çš„å®šåˆ¶æ–¹æ³•ï¼›</strong></p></li></ol><h3 id="å†…ç½®servletå®¹å™¨å¯åŠ¨åŸç†"><a href="#å†…ç½®servletå®¹å™¨å¯åŠ¨åŸç†" class="headerlink" title="å†…ç½®servletå®¹å™¨å¯åŠ¨åŸç†"></a>å†…ç½®servletå®¹å™¨å¯åŠ¨åŸç†</h3><ol><li><p>é¡¹ç›®å¯åŠ¨ï¼Œspringbootè°ƒç”¨runæ–¹æ³•</p></li><li><p>è°ƒç”¨run()è¿‡ç¨‹ä¸­è°ƒç”¨<code>refreshContext(context);</code>åˆ›å»ºå¹¶åˆ·æ–°iocå®¹å™¨</p><ol><li>è°ƒç”¨<code>createApplicationContext();</code></li><li>åˆ¤æ–­å½“å‰é¡¹ç›®ç±»å‹ï¼Œæ ¹æ®é¡¹ç›®ç±»å‹åˆ›å»ºå¯¹åº”çš„iocå®¹å™¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="keyword">this</span>.webApplicationType) &#123;</span><br><span class="line">    <span class="keyword">case</span> SERVLET:</span><br><span class="line">        <span class="comment">// web.servlet.context.AnnotationConfigServletWebServerApplicationContext</span></span><br><span class="line">        contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> REACTIVE:</span><br><span class="line">        <span class="comment">// boot.web.reactive.context.AnnotationConfigReactiveWebServerApplicationContext</span></span><br><span class="line">        contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// annotation.AnnotationConfigApplicationContext</span></span><br><span class="line">        contextClass = Class.forName(DEFAULT_CONTEXT_CLASS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>è°ƒç”¨<code>((AbstractApplicationContext) applicationContext).refresh();</code>æ–¹æ³•åˆ·æ–°iocå®¹å™¨</li><li>å› ä¸ºåˆ›å»ºçš„æ˜¯åµŒå…¥å¼servlet iocå®¹å™¨æ‰€ä»¥è°ƒç”¨çš„å°±æ˜¯servlet iocå®¹å™¨çš„<code>refresh()</code>æ–¹æ³•ï¼Œservlet iocå®¹å™¨é‡å†™äº†<code>refresh()</code></li><li>è°ƒç”¨servlet iocå®¹å™¨çš„<code>this.onRefresh();</code>æ–¹æ³•</li><li>è°ƒç”¨<code>createWebServer();</code>æ¥åˆ›å»ºå¹¶å¯åŠ¨åµŒå…¥å¼servletå®¹å™¨</li></ol></li></ol><p><strong>å…ˆå¯åŠ¨åµŒå…¥å¼servletå®¹å™¨ï¼Œå†å°†iocå®¹å™¨ä¸­å‰©ä¸‹æ²¡æœ‰åˆ›å»ºçš„ç»„ä»¶åˆ›å»ºå‡ºæ¥</strong></p><p><strong>iocå®¹å™¨å¯åŠ¨å°±åˆ›å»ºåµŒå…¥å¼servletå®¹å™¨</strong></p><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="å®‰è£…å¹¶å¯åŠ¨docker"><a href="#å®‰è£…å¹¶å¯åŠ¨docker" class="headerlink" title="å®‰è£…å¹¶å¯åŠ¨docker"></a>å®‰è£…å¹¶å¯åŠ¨docker</h2><ol><li><p>æŸ¥è¯¢liunxå†…æ ¸ç‰ˆæœ¬ï¼ˆé«˜ä¸3.10ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><p>å¦‚æœä½äº3.10å°±ä½¿ç”¨<code>yum update</code>æ›´æ–°</p></li><li><p>å®‰è£…docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li><li><p>åŠ å…¥åˆ°å¼€æœºå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docke</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure></li></ol><h2 id="è®¾ç½®dockeré•œåƒæº"><a href="#è®¾ç½®dockeré•œåƒæº" class="headerlink" title="è®¾ç½®dockeré•œåƒæº"></a>è®¾ç½®dockeré•œåƒæº</h2><p><strong>åˆ›å»ºæˆ–ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶</strong> </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">      <span class="string">&quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Dockerä¸­å›½åŒºå®˜æ–¹é•œåƒ</strong><br><strong><a href="https://registry.docker-cn.com/">https://registry.docker-cn.com</a></strong></p><p><strong>ç½‘æ˜“</strong><br><strong><a href="http://hub-mirror.c.163.com/">http://hub-mirror.c.163.com</a></strong></p><p><strong>ustc</strong><br><strong><a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn</a></strong></p><p><strong>åŠ è½½é‡å¯docker</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl daemon-reload</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart docker</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker info</span></span><br></pre></td></tr></table></figure><h2 id="dockerå¸¸ç”¨å‘½ä»¤"><a href="#dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤"></a><a href="https://www.runoob.com/docker/docker-command-manual.html">dockerå¸¸ç”¨å‘½ä»¤</a></h2><h3 id="dockeré•œåƒæ“ä½œ"><a href="#dockeré•œåƒæ“ä½œ" class="headerlink" title="dockeré•œåƒæ“ä½œ"></a>dockeré•œåƒæ“ä½œ</h3><h4 id="æŸ¥çœ‹æ‰€æœ‰é•œåƒ"><a href="#æŸ¥çœ‹æ‰€æœ‰é•œåƒ" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰é•œåƒ"></a>æŸ¥çœ‹æ‰€æœ‰é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><h4 id="æ£€ç´¢é•œåƒ"><a href="#æ£€ç´¢é•œåƒ" class="headerlink" title="æ£€ç´¢é•œåƒ"></a>æ£€ç´¢é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search å…³é”®å­—</span><br></pre></td></tr></table></figure><h4 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull é•œåƒå[:tag]</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi é•œåƒå/é•œåƒid</span><br></pre></td></tr></table></figure><h3 id="dockerå®¹å™¨æ“ä½œ"><a href="#dockerå®¹å™¨æ“ä½œ" class="headerlink" title="dockerå®¹å™¨æ“ä½œ"></a>dockerå®¹å™¨æ“ä½œ</h3><h4 id="åˆ›å»ºå¹¶å¯åŠ¨"><a href="#åˆ›å»ºå¹¶å¯åŠ¨" class="headerlink" title="åˆ›å»ºå¹¶å¯åŠ¨"></a>åˆ›å»ºå¹¶å¯åŠ¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --name è‡ªå®šä¹‰å®¹å™¨å -d é•œåƒå:tag</span><br><span class="line"><span class="meta">#</span><span class="bash"> -d åå°è¿è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tagä¸å†™é»˜è®¤ä¸ºlatest</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</span></span><br></pre></td></tr></table></figure><h5 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-p 8888:8080</span><br><span class="line">docker run --name tomcat_test -p 8888:8080 -d tomcat:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> -p å°†ä¸»æœºç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨ç«¯å£</span></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm å®¹å™¨å/å®¹å™¨id</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥æ‰¹é‡åˆ é™¤ docker rm mysql1 mysql2 mysql3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ä¸­çš„å®¹å™¨éœ€è¦å…ˆåœæ­¢å†åˆ é™¤</span></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å®¹å™¨"><a href="#æŸ¥çœ‹å®¹å™¨" class="headerlink" title="æŸ¥çœ‹å®¹å™¨"></a>æŸ¥çœ‹å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨åˆ—è¡¨</span><br><span class="line">docker ps -a # æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨åˆ—è¡¨</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start å®¹å™¨å/å®¹å™¨id</span><br></pre></td></tr></table></figure><h4 id="åœæ­¢å®¹å™¨"><a href="#åœæ­¢å®¹å™¨" class="headerlink" title="åœæ­¢å®¹å™¨"></a>åœæ­¢å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨å/å®¹å™¨id</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs å®¹å™¨å/å®¹å™¨id</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€"><a href="#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€"></a>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service firewalld status # æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">service firewalld start # å¯åŠ¨</span><br><span class="line">service firewalld stop # å…³é—­</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> MYSQL_ROOT_PASSWORD rootå¯†ç , MYSQL_ALLOW_EMPTY å…è®¸ç©ºå¯†ç , MYSQL_RANDOM_PASSWORD éšæœºå¯†ç </span></span><br></pre></td></tr></table></figure><h1 id="springbootä¸æ•°æ®è®¿é—®"><a href="#springbootä¸æ•°æ®è®¿é—®" class="headerlink" title="springbootä¸æ•°æ®è®¿é—®"></a>springbootä¸æ•°æ®è®¿é—®</h1><h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><ol><li>é…ç½®æ–‡ä»¶</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="comment"># é…ç½®æ•°æ®æº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.104:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span> <span class="comment"># åœ¨springboot 2.2.6ç‰ˆæœ¬ä¸­ä¾èµ–çš„mysqlé©±åŠ¨ç”±com.mysql.jdbc.Driver æ”¹ä¸º com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>springbooté»˜è®¤æ”¯æŒçš„æ•°æ®æºæœ‰</p><ul><li>org.apache.tomcat.jdbc.pool.DataSource # 1.xé»˜è®¤ä¸ºè¿™ä¸ªæ•°æ®æº</li><li>com.zaxxer.hikari.HikariDataSource # 2.xé»˜è®¤ä¸ºè¿™ä¸ªæ•°æ®æº</li><li>org.apache.commons.dbcp2.BasicDataSource</li></ul></li><li><p>è‡ªå®šä¹‰æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Generic DataSource configuration.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„åˆ›å»ºå‡ºæ•°æ®æºå†æŠŠå±æ€§ç»‘å®šä¸Šå»</span></span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.springframework.boot.autoconfigure.jdbc.DataSourceInitializer</span></span><br><span class="line"><span class="comment">// é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–ç”¨æ¥è‡ªåŠ¨æ‰§è¡Œçš„sqlæ–‡ä»¶ï¼ˆé»˜è®¤æŸ¥æ‰¾ç±»è·¯å¾„ä¸‹çš„schema.sql/data.sql;schema-all.sql/data-all.sqlï¼‰</span></span><br><span class="line"><span class="comment">// é»˜è®¤è§„åˆ™ä¸­çš„allå¯ä»¥é€šè¿‡spring.datasource.platformæ¥ä¿®æ”¹</span></span><br><span class="line"><span class="comment">// å¯ä»¥é€šè¿‡spring.datasource.schema/dataæ¥è‡ªå®šä¹‰è‡ªå·±çš„è§„åˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Resource&gt; <span class="title">getScripts</span><span class="params">(String propertyName, List&lt;String&gt; resources, String fallback)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (resources != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources(propertyName, resources, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String platform = <span class="keyword">this</span>.properties.getPlatform();</span><br><span class="line">    List&lt;String&gt; fallbackResources = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    fallbackResources.add(<span class="string">&quot;classpath*:&quot;</span> + fallback + <span class="string">&quot;-&quot;</span> + platform + <span class="string">&quot;.sql&quot;</span>);</span><br><span class="line">    fallbackResources.add(<span class="string">&quot;classpath*:&quot;</span> + fallback + <span class="string">&quot;.sql&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> getResources(propertyName, fallbackResources, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==æ³¨æ„ï¼š2.xç‰ˆæœ¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ <code>initialization-mode: ALWAYS</code>æ‰èƒ½å®Œæˆè‡ªåŠ¨æ‰§è¡Œsql==</p></li><li><p>æ“ä½œæ•°æ®åº“</p><p>ä½¿ç”¨JdbcTemplateæ“ä½œæ•°æ®åº“ï¼Œå…·ä½“çš„è‡ªåŠ¨é…ç½®è¯·çœ‹org.springframework.boot.autoconfigure.jdbc.JdbcTemplateConfiguration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForList(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="æ•´åˆDruidæ•°æ®æº"><a href="#æ•´åˆDruidæ•°æ®æº" class="headerlink" title="æ•´åˆDruidæ•°æ®æº"></a>æ•´åˆDruidæ•°æ®æº</h2><ol start="0"><li><p>å‘pomæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ DruidDataSourceåŸºæœ¬é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.104:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#    initialization-mode: ALWAYS</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># druidé…ç½®</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">600000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">dual</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,slf4j</span></span><br><span class="line">    <span class="attr">maxPoolPrepareStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span></span><br></pre></td></tr></table></figure></li><li><p>ç”±äºè¿™äº›é…ç½®é»˜è®¤æ˜¯æ·»åŠ åˆ°DataSourcePropertiesç±»ä¸­çš„ï¼Œä½†æ˜¯DataSourcePropertiesç±»ä¸­å¹¶æ²¡æœ‰druidçš„å±æ€§ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å‘å®¹å™¨ä¸­åˆ›å»ºDruidDataSource</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®StatViewServletå’ŒWebStatFilter</p><p>ä»ç„¶åœ¨Druidé…ç½®ç±»ä¸­é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean&lt;StatViewServlet&gt; <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> StatViewServlet(),</span><br><span class="line">                <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; initParameter = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParameter.put(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;LLQWQ&quot;</span>);</span><br><span class="line">        initParameter.put(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        initParameter.put(<span class="string">&quot;allow&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        initParameter.put(<span class="string">&quot;deny&quot;</span>, <span class="string">&quot;192.168.1.103&quot;</span>);</span><br><span class="line">        bean.setInitParameters(initParameter);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean&lt;WebStatFilter&gt; <span class="title">statViewFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean&lt;WebStatFilter&gt; bean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        Map&lt;String, String&gt; initParameter = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParameter.put(<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js,*.css,*.html,/druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParameter);</span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="æ•´åˆMybatis"><a href="#æ•´åˆMybatis" class="headerlink" title="æ•´åˆMybatis"></a>æ•´åˆMybatis</h2><h3 id="æ³¨è§£ç‰ˆ"><a href="#æ³¨è§£ç‰ˆ" class="headerlink" title="æ³¨è§£ç‰ˆ"></a>æ³¨è§£ç‰ˆ</h3><ol><li><p>å¼•å…¥mybatisçš„æ•´åˆåŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™mapperæ¥å£å’Œcontrollerå’Œmybatisçš„é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;sId&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into student(s_name, s_sex) values(#&#123;sName&#125;, #&#123;sSex&#125;)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Student student)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from student where s_id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update student set s_name = #&#123;sName&#125;, s_sex = #&#123;sSex&#125; where s_id = #&#123;sId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from student where s_id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Student <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StudentMapper studentMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/student&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(Student student)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.insert(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/student/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/student&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Student student)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.update(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/student/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">find</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.ll.springboot.mapper&quot;)</span> <span class="comment">// å¼€å¯è‡ªåŠ¨æ‰«æ</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘å®¹å™¨ä¸­æ·»åŠ mybatisçš„å®šåˆ¶å™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">configurationCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(org.apache.ibatis.session.Configuration configuration)</span> </span>&#123;</span><br><span class="line">              <span class="comment">// å¼€å¯é©¼å³°å‘½å</span></span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ol><blockquote><p>mybatisæ•´åˆåŒ…ä¸­å·²ç»ä¸ºæˆ‘ä»¬é…ç½®å¥½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿›è¡Œè¿‡å¤šçš„é…ç½®å°±å¯ä»¥ä½¿ç”¨mybatis</p></blockquote><h3 id="é…ç½®æ–‡ä»¶ç‰ˆ"><a href="#é…ç½®æ–‡ä»¶ç‰ˆ" class="headerlink" title="é…ç½®æ–‡ä»¶ç‰ˆ"></a>é…ç½®æ–‡ä»¶ç‰ˆ</h3><p>åªéœ€è¦åœ¨springbooté…ç½®æ–‡ä»¶ä¸­å¯¼å…¥ä¸€ä¸‹ä¸¤ä¸ªå±æ€§å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="comment"># mybatiså…¨å±€é…ç½®æ–‡ä»¶ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*-mapper.xml</span> <span class="comment"># sqlæ˜ å°„æ–‡ä»¶ä½ç½®</span></span><br></pre></td></tr></table></figure><h1 id="spring-bootå¯åŠ¨é…ç½®åŸç†"><a href="#spring-bootå¯åŠ¨é…ç½®åŸç†" class="headerlink" title="spring-bootå¯åŠ¨é…ç½®åŸç†"></a>spring-bootå¯åŠ¨é…ç½®åŸç†</h1><p><strong>å‡ ä¸ªé‡è¦çš„ç±»ï¼š</strong></p><p><strong>éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š</strong></p><p><strong>ApplicationListener</strong></p><p><strong>ApplicationContextInitializer</strong></p><p><strong>éœ€è¦æ·»åŠ åˆ°iocå®¹å™¨ä¸­</strong></p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><h2 id="å¯åŠ¨æµç¨‹ï¼š"><a href="#å¯åŠ¨æµç¨‹ï¼š" class="headerlink" title="å¯åŠ¨æµç¨‹ï¼š"></a><strong>å¯åŠ¨æµç¨‹ï¼š</strong></h2><h3 id="1-åˆ›å»ºSpringApplicationå¯¹è±¡"><a href="#1-åˆ›å»ºSpringApplicationå¯¹è±¡" class="headerlink" title="1. åˆ›å»ºSpringApplicationå¯¹è±¡"></a>1. åˆ›å»ºSpringApplicationå¯¹è±¡</h3><p>springApplicationæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">null</span>, primarySources);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¢«ä¸Šé¢çš„æ–¹æ³•æ‰€è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€åˆå§‹åŒ– èµ„æºåŠ è½½å™¨ä¸ºnull</span></span><br><span class="line">    <span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">    <span class="comment">// 2ã€æ–­è¨€ä¸»è¦åŠ è½½èµ„æºç±»ä¸ä¸ºç©ºï¼Œå¦åˆ™æŠ¥é”™</span></span><br><span class="line">    Assert.notNull(primarySources, <span class="string">&quot;PrimarySources must not be null&quot;</span>);</span><br><span class="line">    <span class="comment">// 3ã€åˆå§‹åŒ–ä¸»è¦åŠ è½½èµ„æºç±»å¹¶å»é‡</span></span><br><span class="line">    <span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</span><br><span class="line">    <span class="comment">// 4ã€åˆ¤æ–­å½“å‰webåº”ç”¨ç±»å‹ é€šè¿‡åˆ¤æ–­å½“å‰å†…è·¯å¾„ä¸‹æ˜¯å¦æœ‰å¯¹åº”çš„é¡¹ç›®ç±»å‹</span></span><br><span class="line">    <span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">    <span class="comment">// 5ã€è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠ è½½å™¨</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">// 6ã€è®¾ç½®ç›‘å¬å™¨</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">// 7ã€æ¨æ–­ä¸»å…¥å£</span></span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-1-è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠ è½½å™¨ï¼ˆInitializersï¼‰"><a href="#1-1-è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠ è½½å™¨ï¼ˆInitializersï¼‰" class="headerlink" title="1.1 è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠ è½½å™¨ï¼ˆInitializersï¼‰"></a>1.1 è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠ è½½å™¨ï¼ˆInitializersï¼‰</h4><p>ä»ç¬¬äº”æ­¥å¼€å§‹åˆ†æ</p><p>getSpringFactoriesInstancesç›¸å…³çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getSpringFactoriesInstances(type, <span class="keyword">new</span> Class&lt;?&gt;[] &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</span></span><br><span class="line">    ClassLoader classLoader = getClassLoader();</span><br><span class="line">    <span class="comment">// 2ã€è·å– ApplicationContextInitializer çš„å®ä¾‹åç§°é›†åˆå¹¶å»é‡</span></span><br><span class="line">    Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸Šé¢è·å–çš„ç±»è·¯å¾„åˆ›å»ºåˆå§‹åŒ–å™¨å®ä¾‹åˆ—è¡¨</span></span><br><span class="line">    List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å™¨å®ä¾‹åˆ—è¡¨æ’åº</span></span><br><span class="line">    AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">    <span class="keyword">return</span> instances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getClassLoader()ç›¸å…³çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸€æ­¥æ—¶resourceLoaderé»˜è®¤æ˜¯null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.resourceLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Thread.currentThread().getContextClassLoader()è·å¾—ç±»åŠ è½½å™¨</span></span><br><span class="line">    <span class="keyword">return</span> ClassUtils.getDefaultClassLoader();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>loadFactoryNamesç›¸å…³çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    String factoryTypeName = factoryType.getName();</span><br><span class="line">    <span class="keyword">return</span> (List)loadSpringFactories(classLoader).getOrDefault(factoryTypeName, Collections.emptyList());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</span><br><span class="line">    MultiValueMap&lt;String, String&gt; result = (MultiValueMap)cache.get(classLoader);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span> ? classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) : ClassLoader.getSystemResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">            LinkedMultiValueMap result = <span class="keyword">new</span> LinkedMultiValueMap();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">                URL url = (URL)urls.nextElement();</span><br><span class="line">                UrlResource resource = <span class="keyword">new</span> UrlResource(url);</span><br><span class="line">                Properties properties = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">                Iterator var6 = properties.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(var6.hasNext()) &#123;</span><br><span class="line">                    Entry&lt;?, ?&gt; entry = (Entry)var6.next();</span><br><span class="line">                    String factoryTypeName = ((String)entry.getKey()).trim();</span><br><span class="line">                    String[] var9 = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());</span><br><span class="line">                    <span class="keyword">int</span> var10 = var9.length;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> var11 = <span class="number">0</span>; var11 &lt; var10; ++var11) &#123;</span><br><span class="line">                        String factoryImplementationName = var9[var11];</span><br><span class="line">                        result.add(factoryTypeName, factoryImplementationName.trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cache.put(classLoader, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var13) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unable to load factories from location [META-INF/spring.factories]&quot;</span>, var13);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç±»è·¯å¾„ä¸‹çš„ <code>META-INF/spring.factories</code> æ–‡ä»¶è§£æå¹¶è·å– <code>ApplicationContextInitializer</code> æ¥å£çš„æ‰€æœ‰é…ç½®çš„ç±»è·¯å¾„åç§°ã€‚ </p><p>è·å¾—ä»¥ä¸‹<code>ApplicationContextInitializer</code> </p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200517151305532.png" alt="image-20200517151305532"></p><h4 id="1-2-è®¾ç½®ç›‘å¬å™¨ï¼ˆListenersï¼‰"><a href="#1-2-è®¾ç½®ç›‘å¬å™¨ï¼ˆListenersï¼‰" class="headerlink" title="1.2 è®¾ç½®ç›‘å¬å™¨ï¼ˆListenersï¼‰"></a>1.2 è®¾ç½®ç›‘å¬å™¨ï¼ˆListenersï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥çš„æ­¥éª¤æ˜¯å’Œè®¾ç½®<code>Initializers</code>æ˜¯ä¸€æ ·çš„ï¼Œæ ¹æ®ç±»è·¯å¾„ä¸‹çš„ <code>META-INF/spring.factories</code> æ–‡ä»¶è§£æå¹¶è·å– <code>ApplicationListener</code> æ¥å£çš„æ‰€æœ‰é…ç½®çš„ç±»è·¯å¾„åç§°ã€‚ </p><p><img src= "/img/loading.gif" data-lazy-src="/2020/01/05/spring-boot/spring-boot/image-20200517155020680.png" alt="image-20200517155020680"></p><h4 id="1-3-æ¨æ–­ä¸»å…¥å£"><a href="#1-3-æ¨æ–­ä¸»å…¥å£" class="headerlink" title="1.3 æ¨æ–­ä¸»å…¥å£"></a>1.3 æ¨æ–­ä¸»å…¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Class&lt;?&gt; deduceMainApplicationClass() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        StackTraceElement[] stackTrace = <span class="keyword">new</span> RuntimeException().getStackTrace();</span><br><span class="line">        <span class="keyword">for</span> (StackTraceElement stackTraceElement : stackTrace) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;main&quot;</span>.equals(stackTraceElement.getMethodName())) &#123;</span><br><span class="line">                <span class="keyword">return</span> Class.forName(stackTraceElement.getClassName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">        <span class="comment">// Swallow and continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> é€šè¿‡æ„é€ ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå†éå†å¼‚å¸¸æ ˆä¸­çš„æ–¹æ³•åï¼Œè·å–æ–¹æ³•åä¸º main çš„æ ˆå¸§ï¼Œä»è€Œå¾—åˆ°å…¥å£ç±»çš„åå­—å†è¿”å›è¯¥ç±»ã€‚ </p><p><code>new RuntimeException().getStackTrace();</code>è¿™ä¸€ä¸²ä»£ç å¯ä»¥è·å¾—çˆ¶/ç¥–çˆ¶æ–¹æ³•åˆ°å·±æ–¹æ³•çš„ä¸€ä¸ªæ•°ç»„</p><h3 id="2-è¿è¡Œrunæ–¹æ³•"><a href="#2-è¿è¡Œrunæ–¹æ³•" class="headerlink" title="2. è¿è¡Œrunæ–¹æ³•"></a>2. è¿è¡Œrunæ–¹æ³•</h3><p>runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€åˆ›å»ºå¹¶å¯åŠ¨è®¡æ—¶ç›‘æ§ç±»</span></span><br><span class="line">    StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">    stopWatch.start();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2ã€åˆå§‹åŒ–iocå®¹å™¨å’Œå¼‚å¸¸å¤„ç†æŠ¥å‘Š</span></span><br><span class="line">    ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">    Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3ã€è®¾ç½®ç³»ç»Ÿå±æ€§ java.awt.headless çš„å€¼ï¼Œé»˜è®¤å€¼ä¸ºï¼štrue</span></span><br><span class="line">    configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4ã€åˆ›å»ºæ‰€æœ‰ Spring è¿è¡Œç›‘å¬å™¨å¹¶å‘å¸ƒåº”ç”¨å¯åŠ¨äº‹ä»¶</span></span><br><span class="line">    SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">    listeners.starting();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 5ã€åˆå§‹åŒ–é»˜è®¤åº”ç”¨å‚æ•°</span></span><br><span class="line">        ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6ã€æ ¹æ®ç›‘å¬å™¨å’Œåº”ç”¨å‚æ•°æ¥å‡†å¤‡springç¯å¢ƒ</span></span><br><span class="line">        ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);</span><br><span class="line">        configureIgnoreBeanInfo(environment);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 7ã€åˆ›å»º Banner æ‰“å°ç±»</span></span><br><span class="line">        Banner printedBanner = printBanner(environment);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 8ã€åˆ›å»ºiocå®¹å™¨</span></span><br><span class="line">        context = createApplicationContext();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 9ã€å‡†å¤‡å¼‚å¸¸æŠ¥å‘Šå™¨</span></span><br><span class="line">        exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,</span><br><span class="line">                                                         <span class="keyword">new</span> Class[] &#123; ConfigurableApplicationContext.class &#125;, context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 10ã€å‡†å¤‡iocå®¹å™¨</span></span><br><span class="line">        prepareContext(context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 11ã€åˆ·æ–°iocå®¹å™¨</span></span><br><span class="line">        refreshContext(context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 12ã€iocå®¹å™¨åˆ·æ–°åç½®å¤„ç†</span></span><br><span class="line">        afterRefresh(context, applicationArguments);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 13ã€åœæ­¢è®¡æ—¶ç›‘æ§ç±»</span></span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 14ã€è¾“å‡ºæ—¥å¿—è®°å½•æ‰§è¡Œä¸»ç±»åã€æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">            <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 15ã€å‘å¸ƒiocå®¹å™¨å¯åŠ¨å®Œæˆäº‹ä»¶</span></span><br><span class="line">        listeners.started(context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 16ã€æ‰§è¡Œæ‰€æœ‰ Runner è¿è¡Œå™¨</span></span><br><span class="line">        callRunners(context, applicationArguments);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        handleRunFailure(context, ex, exceptionReporters, listeners);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 17ã€å‘å¸ƒåº”ç”¨ä¸Šä¸‹æ–‡å°±ç»ªäº‹ä»¶</span></span><br><span class="line">        listeners.running(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        handleRunFailure(context, ex, exceptionReporters, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 18ã€è¿”å›åº”ç”¨ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-åˆ›å»ºæ‰€æœ‰-Spring-è¿è¡Œç›‘å¬å™¨"><a href="#2-1-åˆ›å»ºæ‰€æœ‰-Spring-è¿è¡Œç›‘å¬å™¨" class="headerlink" title="2.1 åˆ›å»ºæ‰€æœ‰ Spring è¿è¡Œç›‘å¬å™¨"></a>2.1 åˆ›å»ºæ‰€æœ‰ Spring è¿è¡Œç›‘å¬å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SpringApplicationRunListeners <span class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Class&lt;?&gt;[] types = <span class="keyword">new</span> Class&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SpringApplicationRunListeners(logger,</span><br><span class="line">getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span class="keyword">this</span>, args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºé€»è¾‘å’Œä¹‹å‰å®ä¾‹åŒ–åˆå§‹åŒ–å™¨å’Œç›‘å¬å™¨çš„ä¸€æ ·ï¼Œä¸€æ ·è°ƒç”¨çš„æ˜¯ <code>getSpringFactoriesInstances</code> æ–¹æ³•æ¥è·å–é…ç½®çš„ç›‘å¬å™¨åç§°å¹¶å®ä¾‹åŒ–æ‰€æœ‰çš„ç±»ã€‚ </p><h4 id="2-2-æ ¹æ®ç›‘å¬å™¨å’Œåº”ç”¨å‚æ•°æ¥å‡†å¤‡springç¯å¢ƒ"><a href="#2-2-æ ¹æ®ç›‘å¬å™¨å’Œåº”ç”¨å‚æ•°æ¥å‡†å¤‡springç¯å¢ƒ" class="headerlink" title="2.2 æ ¹æ®ç›‘å¬å™¨å’Œåº”ç”¨å‚æ•°æ¥å‡†å¤‡springç¯å¢ƒ"></a>2.2 æ ¹æ®ç›‘å¬å™¨å’Œåº”ç”¨å‚æ•°æ¥å‡†å¤‡springç¯å¢ƒ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                   ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–æˆ–åˆ›å»ºspringç¯å¢ƒ</span></span><br><span class="line">    ConfigurableEnvironment environment = getOrCreateEnvironment();</span><br><span class="line">    <span class="comment">// é…ç½®åº”ç”¨ç¯å¢ƒ</span></span><br><span class="line">    configureEnvironment(environment, applicationArguments.getSourceArgs());</span><br><span class="line">    ConfigurationPropertySources.attach(environment);</span><br><span class="line">    listeners.environmentPrepared(environment);</span><br><span class="line">    bindToSpringApplication(environment);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isCustomEnvironment) &#123;</span><br><span class="line">        environment = <span class="keyword">new</span> EnvironmentConverter(getClassLoader()).convertEnvironmentIfNecessary(environment,</span><br><span class="line">                                                                                               deduceEnvironmentClass());</span><br><span class="line">    &#125;</span><br><span class="line">    ConfigurationPropertySources.attach(environment);</span><br><span class="line">    <span class="keyword">return</span> environment;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">getOrCreateEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.environment != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.environment;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“é¡¹ç›®ä¸ºä»€ä¹ˆç±»å‹</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">this</span>.webApplicationType) &#123;</span><br><span class="line">        <span class="keyword">case</span> SERVLET:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StandardServletEnvironment();</span><br><span class="line">        <span class="keyword">case</span> REACTIVE:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StandardReactiveWebEnvironment();</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StandardEnvironment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-åˆ›å»ºiocå®¹å™¨"><a href="#2-3-åˆ›å»ºiocå®¹å™¨" class="headerlink" title="2.3 åˆ›å»ºiocå®¹å™¨"></a>2.3 åˆ›å»ºiocå®¹å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ConfigurableApplicationContext <span class="title">createApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Class&lt;?&gt; contextClass = <span class="keyword">this</span>.applicationContextClass;</span><br><span class="line">    <span class="keyword">if</span> (contextClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®ä¸åŒçš„åº”ç”¨ç±»å‹åˆå§‹åŒ–ä¸åŒçš„iocåº”ç”¨ç±»</span></span><br><span class="line">            <span class="keyword">switch</span> (<span class="keyword">this</span>.webApplicationType) &#123;</span><br><span class="line">                <span class="keyword">case</span> SERVLET:</span><br><span class="line">                    <span class="comment">// org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext</span></span><br><span class="line">                    contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> REACTIVE:</span><br><span class="line">                    <span class="comment">// org.springframework.boot.web.reactive.context.AnnotationConfigReactiveWebServerApplicationContext</span></span><br><span class="line">                    contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="comment">// org.springframework.context.annotation.AnnotationConfigApplicationContext</span></span><br><span class="line">                    contextClass = Class.forName(DEFAULT_CONTEXT_CLASS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                <span class="string">&quot;Unable create a default ApplicationContext, please specify an ApplicationContextClass&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-å‡†å¤‡iocå®¹å™¨"><a href="#2-4-å‡†å¤‡iocå®¹å™¨" class="headerlink" title="2.4 å‡†å¤‡iocå®¹å™¨"></a>2.4 å‡†å¤‡iocå®¹å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(ConfigurableApplicationContext context, ConfigurableEnvironment environment,</span></span></span><br><span class="line"><span class="function"><span class="params">                            SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†ç¯å¢ƒç»‘å®šåˆ°iocå®¹å™¨ä¸Š</span></span><br><span class="line">    context.setEnvironment(environment);</span><br><span class="line">    <span class="comment">// é…ç½®iocçš„ bean ç”Ÿæˆå™¨åŠèµ„æºåŠ è½½å™¨, å…·ä½“çš„æ–¹æ³•çœ‹åäº†ï¼Œä¸æƒ³çœ‹äº†</span></span><br><span class="line">    postProcessApplicationContext(context);</span><br><span class="line">    <span class="comment">// ä¸ºiocä½¿ç”¨æ‰€æœ‰åˆå§‹åŒ–å™¨</span></span><br><span class="line">    applyInitializers(context);</span><br><span class="line">    <span class="comment">// è§¦å‘æ‰€æœ‰ SpringApplicationRunListener ç›‘å¬å™¨çš„ contextPrepared äº‹ä»¶æ–¹æ³•</span></span><br><span class="line">    listeners.contextPrepared(context);</span><br><span class="line">    <span class="comment">// è®°å½•å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">        logStartupInfo(context.getParent() == <span class="keyword">null</span>);</span><br><span class="line">        logStartupProfileInfo(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ³¨å†Œä¸¤ä¸ªç‰¹æ®Šçš„å•ä¾‹bean</span></span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</span><br><span class="line">    beanFactory.registerSingleton(<span class="string">&quot;springApplicationArguments&quot;</span>, applicationArguments);</span><br><span class="line">    <span class="keyword">if</span> (printedBanner != <span class="keyword">null</span>) &#123;</span><br><span class="line">        beanFactory.registerSingleton(<span class="string">&quot;springBootBanner&quot;</span>, printedBanner);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®beanæ˜¯å¦å¯ä»¥è¢«é‡å®šä¹‰</span></span><br><span class="line">    <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</span><br><span class="line">        ((DefaultListableBeanFactory) beanFactory)</span><br><span class="line">        .setAllowBeanDefinitionOverriding(<span class="keyword">this</span>.allowBeanDefinitionOverriding);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœInitializationä¸ºæ‡’åŠ è½½çš„è¯å°±æ·»åŠ ä¸€ä¸ªç”¨äºæ‡’åŠ è½½Initializationçš„åç½®å¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.lazyInitialization) &#123;</span><br><span class="line">        context.addBeanFactoryPostProcessor(<span class="keyword">new</span> LazyInitializationBeanFactoryPostProcessor());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ è½½æ‰€æœ‰èµ„æº</span></span><br><span class="line">    Set&lt;Object&gt; sources = getAllSources();</span><br><span class="line">    Assert.notEmpty(sources, <span class="string">&quot;Sources must not be empty&quot;</span>);</span><br><span class="line">    load(context, sources.toArray(<span class="keyword">new</span> Object[<span class="number">0</span>]));</span><br><span class="line">    <span class="comment">// è§¦å‘æ‰€æœ‰ SpringApplicationRunListener ç›‘å¬å™¨çš„ contextLoaded äº‹ä»¶æ–¹æ³•</span></span><br><span class="line">    listeners.contextLoaded(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-5-æ‰§è¡Œæ‰€æœ‰çš„-runner-è¿è¡Œå™¨"><a href="#2-5-æ‰§è¡Œæ‰€æœ‰çš„-runner-è¿è¡Œå™¨" class="headerlink" title="2.5 æ‰§è¡Œæ‰€æœ‰çš„ runner è¿è¡Œå™¨"></a>2.5 æ‰§è¡Œæ‰€æœ‰çš„ runner è¿è¡Œå™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callRunners</span><span class="params">(ApplicationContext context, ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    List&lt;Object&gt; runners = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// ä»iocå®¹å™¨ä¸­å–å‡ºrunnerè¿è¡Œå™¨å¹¶æ’åº</span></span><br><span class="line">    runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());</span><br><span class="line">    runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());</span><br><span class="line">    AnnotationAwareOrderComparator.sort(runners);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (Object runner : <span class="keyword">new</span> LinkedHashSet&lt;&gt;(runners)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> ApplicationRunner) &#123;</span><br><span class="line">            callRunner((ApplicationRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> CommandLineRunner) &#123;</span><br><span class="line">            callRunner((CommandLineRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> spring </category>
          
          <category> spring-boot </category>
          
          <category> æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> spring-boot </tag>
            
            <tag> æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaé”™è¯¯è®°å½•</title>
      <link href="2019/09/15/idea/%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/"/>
      <url>2019/09/15/idea/%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="idea-æ‰¾ä¸åˆ°ç¨‹åºåŒ…æœ€ç»ˆè§£å†³"><a href="#idea-æ‰¾ä¸åˆ°ç¨‹åºåŒ…æœ€ç»ˆè§£å†³" class="headerlink" title="idea,æ‰¾ä¸åˆ°ç¨‹åºåŒ…æœ€ç»ˆè§£å†³"></a>idea,æ‰¾ä¸åˆ°ç¨‹åºåŒ…æœ€ç»ˆè§£å†³</h1><p>ideaç¼–è¯‘é¡¹ç›®æ²¡æœ‰æŠ¥é”™,buildæ—¶ä¼šæç¤ºæ‰¾ä¸åˆ°ç¨‹åºåŒ…,è¯•äº†å¥½å¤šæ–¹æ³•éƒ½æ²¡æœ‰æ•ˆæœ,æœ€ç»ˆæ§åˆ¶å°è¿è¡Œä¸‹é¢å‘½ä»¤å,å®Œç¾è§£å†³!!!</p><p><code>mvn idea:idea</code></p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
          <category> idea </category>
          
          <category> IDE </category>
          
          <category> é”™è¯¯è®°å½• </category>
          
          <category> idea </category>
          
          <category> é”™è¯¯è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é”™è¯¯è®°å½• </tag>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
            <tag> idea </tag>
            
            <tag> IDE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å­¦ä¹ ç¬”è®°</title>
      <link href="2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/"/>
      <url>2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/</url>
      
        <content type="html"><![CDATA[<p>æ ¼å¼å¾…æ•´ç†</p><span id="more"></span><h1 id="mysql-è¯­æ³•è§„èŒƒ"><a href="#mysql-è¯­æ³•è§„èŒƒ" class="headerlink" title="mysql è¯­æ³•è§„èŒƒ"></a>mysql è¯­æ³•è§„èŒƒ</h1><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%201%204.png" alt="Pasted image 1 4.png"></p><hr><h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><h2 id="DQL-data-query-language-è¯­è¨€"><a href="#DQL-data-query-language-è¯­è¨€" class="headerlink" title="DQL(data query language)è¯­è¨€"></a>DQL(data query language)è¯­è¨€</h2><h3 id="åŸºç¡€æŸ¥è¯¢"><a href="#åŸºç¡€æŸ¥è¯¢" class="headerlink" title="åŸºç¡€æŸ¥è¯¢"></a>åŸºç¡€æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># mysqlæŸ¥è¯¢è¯­æ³•</span><br><span class="line"><span class="keyword">select</span> æŸ¥è¯¢åˆ—è¡¨ <span class="keyword">from</span> è¡¨å</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">1. æŸ¥è¯¢åˆ—è¡¨å¯ä»¥æ˜¯ï¼šè¡¨å­—æ®µã€å¸¸é‡å€¼ã€è¡¨è¾¾å¼ã€å‡½æ•°</span></span><br><span class="line"><span class="comment">2. æŸ¥è¯¢ç»“æœå¯ä»¥æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨(dual)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"># è¡¨è¾¾å¼</span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span><span class="operator">*</span><span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span><span class="operator">*</span><span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"># å¸¸é‡å€¼</span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span>;</span><br><span class="line"># å‡½æ•°</span><br><span class="line"><span class="keyword">select</span> version();</span><br><span class="line"># mysqlä¸­çš„<span class="operator">+</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åœ¨mysqlä¸­çš„+å·åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼šè¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment">æ‰€ä»¥å¹¶ä¸èƒ½ä½œä¸ºå­—ç¬¦ä¸²çš„æ‹¼æ¥ç¬¦ï¼Œå¦‚éœ€æ‹¼æ¥å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨concatå‡½æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span><span class="operator">+</span><span class="number">2</span>; # å½“åŠ å·ä¸¤è¾¹éƒ½ä¸ºæ•°å€¼ç±»å‹åˆ™ä¼šè¿›è¡Œç›¸åŠ ï¼›ç»“æœä¸ºï¼š<span class="number">102</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;100&#x27;</span><span class="operator">+</span><span class="number">2</span>; # å½“å…¶ä¸­ä¸€ä¸ªæˆ–ä¸¤ä¸ªéƒ½ä¸ºå­—ç¬¦å‹çš„è¯åˆ™å°è¯•å°†å­—ç¬¦ç±»å‹è½¬æ¢ä¸ºæ•°å€¼ç±»å‹ï¼›ç»“æœï¼š<span class="number">102</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;join&#x27;</span><span class="operator">+</span><span class="number">2</span>; # å½“å­—ç¬¦å‹ä¸èƒ½è½¬æ¢ä¸ºæ•°å€¼å‹çš„è¯ï¼Œé‚£ä¸ªç±»å‹çš„å€¼å°†ä¼šå˜ä¸º<span class="number">0</span>ï¼›ç»“æœï¼š<span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">null</span><span class="operator">+</span><span class="number">2</span>; # å½“å…¶ä¸­ä¸€ä¸ªå€¼ä¸º<span class="keyword">null</span>ç»“æœå¿…ä¸º<span class="keyword">null</span>ï¼›ç»“æœï¼š<span class="keyword">null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># mysqlæŸ¥è¯¢è¯­æ³•</span><br><span class="line"><span class="keyword">select</span> æŸ¥è¯¢åˆ—è¡¨ <span class="keyword">from</span> è¡¨å <span class="keyword">where</span> ç­›é€‰æ¡ä»¶;</span><br><span class="line"># æ¨¡ç³Š</span><br><span class="line"># _ ä»£è¡¨å•ä¸ªå­—ç¬¦</span><br><span class="line"># <span class="operator">%</span> ä»£è¡¨å¤šä¸ªå­—ç¬¦</span><br><span class="line"># å¯ä»¥ä½¿ç”¨\ è½¬ä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰è½¬ä¹‰ç¬¦ï¼š</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;_$_%&#x27;</span> excape <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line"># ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­å°±å°†$å®šä¹‰ä¸ºè½¬ä¹‰ç¬¦äº†</span><br><span class="line"></span><br><span class="line"># å®‰å…¨ç­‰äº <span class="operator">&lt;=&gt;</span> å¯ä»¥åˆ¤æ–­<span class="keyword">null</span>å’Œæ™®é€šæ•°å€¼</span><br><span class="line"># ä¸ç­‰äºä¹Ÿå¯ä»¥å†™æˆ <span class="operator">&lt;&gt;</span></span><br><span class="line"># å»é‡ <span class="keyword">distinct</span></span><br></pre></td></tr></table></figure><h3 id="æ’åºæŸ¥è¯¢"><a href="#æ’åºæŸ¥è¯¢" class="headerlink" title="æ’åºæŸ¥è¯¢"></a>æ’åºæŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¯­æ³•ï¼š</span></span><br><span class="line"><span class="comment">select æŸ¥è¯¢åˆ—è¡¨ from è¡¨å [where ç­›é€‰æ¡ä»¶] order by æ’åºå­—æ®µ [asc|desc]</span></span><br><span class="line"><span class="comment">asc å‡åº</span></span><br><span class="line"><span class="comment">desc é™åº</span></span><br><span class="line"><span class="comment">å½“æ’åºå­—æ®µä¸ºå¤šä¸ªçš„æƒ…å†µä¸‹ï¼Œæ’åºè§„åˆ™ä¸ºå…ˆæ ¹æ®å‰é¢çš„å­—æ®µè¿›è¡Œæ’åºï¼Œå½“å‰çš„å­—æ®µæœ‰ç›¸åŒå€¼çš„æƒ…å†µå†æ ¹æ®åé¢çš„å­—æ®µè¿›è¡Œæ¯”è¾ƒæ’åº</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">é™¤äº†limitå­å¥å¤–å…¶ä»–çš„å­å¥éƒ½æ˜¯æ”¾åœ¨order byä¹‹å‰çš„</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h3><p><a href="https://www.cnblogs.com/panchanggui/p/10652322.html">https://www.cnblogs.com/panchanggui/p/10652322.html</a><br><strong>åˆ†ç±»ï¼š</strong></p><ul><li>å•è¡Œå‡½æ•°<br>å¦‚ï¼šlengthã€concatã€ifnull ç­‰<ul><li>å­—ç¬¦å‡½æ•°</li><li>æ•°å­¦å‡½æ•°</li><li>æ—¥æœŸå‡½æ•°</li><li>å…¶ä»–å‡½æ•°</li><li>æµç¨‹æ§åˆ¶å‡½æ•°</li></ul></li><li>åˆ†ç»„å‡½æ•°<br>åŠŸèƒ½ï¼šåšç»Ÿè®¡ä½¿ç”¨ï¼Œåˆç§°ä¸ºç»Ÿè®¡å‡½æ•°ã€ç»„å‡½æ•°ã€èšåˆå‡½æ•°</li></ul><h3 id="åˆ†ç»„å‡½æ•°"><a href="#åˆ†ç»„å‡½æ•°" class="headerlink" title="åˆ†ç»„å‡½æ•°"></a>åˆ†ç»„å‡½æ•°</h3><ul><li>sum è®¡ç®—æ€»å’Œ</li><li>avg è®¡ç®—å¹³å‡æ•°</li><li>max è®¡ç®—æœ€å¤§å€¼</li><li>min è®¡ç®—æœ€å°å€¼</li><li>count è®¡ç®—æ¬¡æ•°</li></ul><blockquote><p>ç‰¹ç‚¹ï¼š</p><ol><li>sumã€avg ä¸€èˆ¬ç”¨äºå¤„ç†æ•°å€¼ç±»å‹<br>maxã€minã€count å¯ä»¥å¤„ç†ä»»ä½•ç±»å‹</li><li>ä»¥ä¸Šåˆ†ç»„å‡½æ•°éƒ½å¿½ç•¥ null å€¼</li><li>å¯ä»¥æ­é… distinct å®ç°å»é‡è¿ç®—</li></ol></blockquote><h3 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a>åˆ†ç»„æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¯­æ³•ï¼š</span></span><br><span class="line"><span class="comment">selectåˆ†ç»„å‡½æ•°,åˆ—(è¦æ±‚å‡ºç°åœ¨group byçš„åé¢)</span></span><br><span class="line"><span class="comment">fromè¡¨</span></span><br><span class="line"><span class="comment">[where ç­›é€‰æ¡ä»¶]</span></span><br><span class="line"><span class="comment">group by åˆ†ç»„çš„åˆ—è¡¨</span></span><br><span class="line"><span class="comment">[order byå­å¥]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="è¿æ¥æŸ¥è¯¢"><a href="#è¿æ¥æŸ¥è¯¢" class="headerlink" title="è¿æ¥æŸ¥è¯¢"></a>è¿æ¥æŸ¥è¯¢</h3><p><strong>æŒ‰å¹´ä»£åˆ†ç±»ï¼š</strong></p><ul><li>sql92 æ ‡å‡†ï¼šä»…ä»…åªæ”¯æŒå†…è¿æ¥</li><li>sql99 æ ‡å‡†ã€æ¨èã€‘</li></ul><p><strong>æŒ‰åŠŸèƒ½åˆ†ç±»ï¼š</strong></p><ul><li>å†…è¿æ¥<ul><li>ç­‰å€¼è¿æ¥</li><li>éç­‰å€¼è¿æ¥</li><li>è‡ªè¿æ¥</li></ul></li><li>å¤–è¿æ¥<ul><li>å·¦å¤–é“¾æ¥</li><li>å³å¤–è¿æ¥</li><li>å…¨å¤–è¿æ¥</li></ul></li><li>äº¤å‰è¿æ¥</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">select æŸ¥è¯¢åˆ—è¡¨</span></span><br><span class="line"><span class="comment">from è¡¨1 åˆ«å [è¿æ¥ç±»å‹]</span></span><br><span class="line"><span class="comment">join è¡¨2 åˆ«å</span></span><br><span class="line"><span class="comment">on è¿æ¥æ¡ä»¶</span></span><br><span class="line"><span class="comment">[where ç­›é€‰æ¡ä»¶]</span></span><br><span class="line"><span class="comment">Lgroup by åˆ†ç»„]</span></span><br><span class="line"><span class="comment">[having ç­›é€‰æ¡ä»¶]</span></span><br><span class="line"><span class="comment">[order by æ’åºåˆ—è¡¨]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å†…è¿æ¥ inner</span></span><br><span class="line"><span class="comment">å·¦å¤–é“¾æ¥ left [outer]</span></span><br><span class="line"><span class="comment">å³å¤–è¿æ¥ rigth [outer]</span></span><br><span class="line"><span class="comment">å…¨å¤–è¿æ¥ full [outer]</span></span><br><span class="line"><span class="comment">äº¤å‰è¿æ¥ cross</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">åº”ç”¨åœºæ™¯: ç”¨äºæŸ¥è¯¢ä¸€ä¸ªè¡¨ä¸­æœ‰,å¦ä¸€ä¸ªè¡¨æ²¡æœ‰çš„è®°å½•</span></span><br><span class="line"><span class="comment">ç‰¹ç‚¹:</span></span><br><span class="line"><span class="comment">1. å¤–è¿æ¥çš„æŸ¥è¯¢ç»“æœä¸ºä¸»è¡¨ä¸­çš„æ‰€æœ‰è®°å½•</span></span><br><span class="line"><span class="comment">å¦‚æœä»è¡¨ä¸­æœ‰å’Œå®ƒåŒ¹é…çš„,åˆ™æ˜¾ç¤ºåŒ¹é…çš„å€¼</span></span><br><span class="line"><span class="comment">å¦‚æœä»è¡¨ä¸­æ²¡æœ‰å’Œå®ƒåŒ¹é…çš„,åˆ™æ˜¾ç¤ºnull</span></span><br><span class="line"><span class="comment">å¤–è¿æ¥æŸ¥è¯¢ç»“æœ=å†…è¿æ¥ç»“æœ+ä¸»è¡¨ä¸­æœ‰è€Œä»è¡¨æ²¡æœ‰çš„è®°å½•</span></span><br><span class="line"><span class="comment">2. å·¦å¤–è¿æ¥,left joinå·¦è¾¹çš„æ˜¯ä¸»è¡¨</span></span><br><span class="line"><span class="comment">   å³å¤–è¿æ¥,right joinå³è¾¹çš„æ˜¯ä¸»è¡¨</span></span><br><span class="line"><span class="comment">3. å·¦å¤–å’Œå³å¤–äº¤æ¢ä¸¤ä¸ªè¡¨çš„é¡ºåº,å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœ</span></span><br><span class="line"><span class="comment">4. å…¨å¤–è¿æ¥=å†…è¿æ¥çš„ç»“æœ+è¡¨1ä¸­æœ‰ä½†è¡¨2æ²¡æœ‰çš„+è¡¨2ä¸­æœ‰ä½†è¡¨1æ²¡æœ‰çš„</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">äº¤å‰æŸ¥è¯¢å’Œæ™®é€šå¤šè¡¨è«å¾—åŒºåˆ«ï¼Œå°±æ˜¯å°†é€—å·æ¢æˆäº†crosså…³é”®å­—</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p><strong>åˆ†ç±»:</strong></p><ul><li>æŒ‰å­æŸ¥è¯¢å‡ºç°çš„ä½ç½®:<ul><li>select åé¢:<ul><li>ä»…ä»…æ”¯æŒæ ‡é‡å­æŸ¥è¯¢</li></ul></li><li>from åé¢:<ul><li>æ”¯æŒè¡¨å­æŸ¥è¯¢</li></ul></li><li>where æˆ– having åé¢ï¼š<ul><li>æ ‡é‡å­æŸ¥è¯¢(å•è¡Œ)</li><li>åˆ—å­æŸ¥è¯¢(å¤šè¡Œ)</li><li>è¡Œå­æŸ¥è¯¢</li></ul></li><li>exists åé¢(ç›¸å…³å­æŸ¥è¯¢)<ul><li>ps: exists æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåªå…³å¿ƒæ‹¬å·å†…çš„æ˜¯å¦æœ‰å€¼ï¼Œæœ‰å€¼å°±è¿”å› 1 è«å¾—å€¼å°±è¿”å› 0</li><li>è¡¨å­æŸ¥è¯¢</li></ul></li></ul></li><li>æŒ‰ç»“æœé›†çš„è¡Œåˆ—æ•°ä¸åŒ:<ul><li>æ ‡é‡å­æŸ¥è¯¢(ç»“æœé›†åªæœ‰ä¸€è¡Œä¸€åˆ—)</li><li>åˆ—å­æŸ¥è¯¢(ç»“æœé›†åªæœ‰ä¸€åˆ—å¤šè¡Œ)</li><li>è¡Œå­æŸ¥è¯¢(ç»“æœé›†æœ‰ä¸€è¡Œå¤šåˆ—)</li><li>è¡¨å­æŸ¥è¯¢(ç»“æœé›†ä¸€èˆ¬ä¸ºå¤šè¡Œå¤šåˆ—)</li></ul></li></ul><h3 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h3><p>limit</p><h3 id="union-è”åˆæŸ¥è¯¢"><a href="#union-è”åˆæŸ¥è¯¢" class="headerlink" title="union è”åˆæŸ¥è¯¢"></a>union è”åˆæŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¯­æ³•ï¼š</span></span><br><span class="line"><span class="comment">select æŸ¥è¯¢å­—æ®µ from è¡¨å where ç­›é€‰æ¡ä»¶</span></span><br><span class="line"><span class="comment">union</span></span><br><span class="line"><span class="comment">select æŸ¥è¯¢å­—æ®µ from è¡¨å where ç­›é€‰æ¡ä»¶</span></span><br><span class="line"><span class="comment">union</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">ä½œç”¨ï¼šå°†å¤šä¸ªç»“æœé›†åˆå¹¶åˆ°ä¸€èµ·</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">åœºæ™¯ï¼šæœ‰Aã€Bã€Cä¸‰å¼ è¡¨ï¼Œå…¶ä¸­aè¡¨å­˜äº†ç”¨æˆ·çš„é‚®ç®±ï¼Œbè¡¨å­˜äº†ç”¨æˆ·çš„ç”¨æˆ·åï¼Œcè¡¨å­˜äº†ç”¨æˆ·çš„æ‰‹æœºå·ï¼Œè¦æ±‚å¯ä»¥é€šè¿‡ç”¨æˆ·è¾“å…¥çš„å€¼ï¼ˆå› ä¸ºä¸çŸ¥é“ç”¨æˆ·è¾“å…¥çš„æ˜¯æ‰‹æœºå·è¿˜æ˜¯ç”¨æˆ·åå’Œé‚®ç®±ï¼Œæ‰€ä»¥éœ€è¦æŸ¥è¯¢ä¸‰å¼ è¡¨ç„¶åå†å°†ç»“æœé›†åˆå¹¶ï¼‰æŸ¥è¯¢å‡ºå¯¹åº”çš„ç”¨æˆ·</span></span><br><span class="line"><span class="comment">select * from a where email like &#x27;%value%&#x27;</span></span><br><span class="line"><span class="comment">union</span></span><br><span class="line"><span class="comment">select * from b where username like &#x27;%value%&#x27;</span></span><br><span class="line"><span class="comment">union</span></span><br><span class="line"><span class="comment">select * from c where phone like &#x27;%value%&#x27;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç‰¹ç‚¹:</span></span><br><span class="line"><span class="comment">1. è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢åˆ—æ•°æ˜¯ä¸€è‡´çš„!</span></span><br><span class="line"><span class="comment">2. è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„æ¯ä¸€åˆ—çš„ç±»å‹å’Œé¡ºåºæœ€å¥½ä¸€è‡´</span></span><br><span class="line"><span class="comment">3. unionå…³é”®å­—é»˜è®¤å»é‡,å¦‚æœä½¿ç”¨union all å¯ä»¥åŒ…å«é‡å¤é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="DML-data-manipulation-language-è¯­è¨€"><a href="#DML-data-manipulation-language-è¯­è¨€" class="headerlink" title="DML(data manipulation language)è¯­è¨€"></a>DML(data manipulation language)è¯­è¨€</h2><h3 id="æ’å…¥è¯­å¥"><a href="#æ’å…¥è¯­å¥" class="headerlink" title="æ’å…¥è¯­å¥"></a>æ’å…¥è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹å¼ä¸€ï¼š</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å <span class="keyword">set</span> å­—æ®µå<span class="operator">=</span>å€¼;</span><br><span class="line"># æ–¹å¼äºŒï¼š</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å[(å­—æ®µ)] valuse(å€¼);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å[(å­—æ®µ)] valuse(å€¼),(å€¼),(å€¼)...;</span><br><span class="line"># æ”¯æŒå­æŸ¥è¯¢</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å[(å­—æ®µ)] å­æŸ¥è¯¢è¯­å¥;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹è¯­å¥"><a href="#ä¿®æ”¹è¯­å¥" class="headerlink" title="ä¿®æ”¹è¯­å¥"></a>ä¿®æ”¹è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> ä¿®æ”¹å•å¼ è¡¨çš„è®°å½•</span><br><span class="line">update è¡¨å <span class="keyword">set</span> åˆ—<span class="operator">=</span>å€¼ [<span class="keyword">where</span> ç­›é€‰æ¡ä»¶];</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span>ä¿®æ”¹å¤šè¡¨çš„è®°å½•</span><br><span class="line"># è¯­æ³•:</span><br><span class="line"># sql92è¯­æ³•:</span><br><span class="line">update è¡¨<span class="number">1</span> åˆ«å,è¡¨<span class="number">2</span> åˆ«å</span><br><span class="line"><span class="keyword">set</span> åˆ—<span class="operator">=</span>å€¼,</span><br><span class="line"><span class="keyword">where</span> è¿æ¥æ¡ä»¶</span><br><span class="line"><span class="keyword">and</span> ç­›é€‰æ¡ä»¶;</span><br><span class="line"></span><br><span class="line"># sql99è¯­æ³•:</span><br><span class="line">update è¡¨<span class="number">1</span> åˆ«å</span><br><span class="line"><span class="keyword">inner</span> <span class="operator">|</span> <span class="keyword">left</span> <span class="operator">|</span> <span class="keyword">right</span> <span class="keyword">join</span> è¡¨<span class="number">2</span> åˆ«å</span><br><span class="line"><span class="keyword">on</span> è¿æ¥æ¡ä»¶</span><br><span class="line"><span class="keyword">set</span> åˆ—<span class="operator">=</span>å€¼</span><br><span class="line"><span class="keyword">where</span> ç­›é€‰æ¡ä»¶;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤è¯­å¥"><a href="#åˆ é™¤è¯­å¥" class="headerlink" title="åˆ é™¤è¯­å¥"></a>åˆ é™¤è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹å¼ä¸€ï¼š<span class="keyword">delete</span></span><br><span class="line"># è¯­æ³•ï¼š</span><br><span class="line"># å•è¡¨çš„åˆ é™¤</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> è¡¨å <span class="keyword">where</span> ç­›é€‰æ¡ä»¶;</span><br><span class="line"># å¤šè¡¨çš„åˆ é™¤</span><br><span class="line"># sql92è¯­æ³•:</span><br><span class="line"><span class="keyword">delete</span> è¡¨<span class="number">1</span>çš„åˆ«å, è¡¨<span class="number">2</span>çš„åˆ«å # å¦‚æœåªæƒ³åˆ é™¤è¡¨<span class="number">1</span>ä¸­çš„æ•°æ®ï¼Œè¿™é‡Œå°±ä¸éœ€è¦å†™è¡¨<span class="number">2</span>çš„åˆ«å</span><br><span class="line"><span class="keyword">from</span> è¡¨<span class="number">1</span> åˆ«å, è¡¨<span class="number">2</span> åˆ«å</span><br><span class="line"><span class="keyword">where</span> è¿æ¥æ¡ä»¶</span><br><span class="line"><span class="keyword">and</span> ç­›é€‰æ¡ä»¶;</span><br><span class="line"></span><br><span class="line"># sql99è¯­æ³•:</span><br><span class="line"><span class="keyword">delete</span> è¡¨<span class="number">1</span>çš„åˆ«å, è¡¨<span class="number">2</span>çš„åˆ«å</span><br><span class="line"><span class="keyword">from</span> è¡¨<span class="number">1</span> åˆ«å</span><br><span class="line"><span class="keyword">inner</span> <span class="operator">|</span> <span class="keyword">left</span> <span class="operator">|</span> <span class="keyword">right</span> <span class="keyword">join</span> è¡¨<span class="number">2</span> åˆ«å <span class="keyword">on</span> è¿æ¥æ¡ä»¶</span><br><span class="line"><span class="keyword">where</span> ç­›é€‰æ¡ä»¶;</span><br><span class="line"></span><br><span class="line"># æ–¹å¼äºŒï¼š<span class="keyword">truncate</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> è¡¨å;</span><br></pre></td></tr></table></figure><blockquote><p>psï¼šåœ¨ oracle ä¸­ä½¿ç”¨ delete è¿›è¡Œåˆ é™¤çš„è¯å¯ä»¥ä¸éœ€è¦ä½¿ç”¨ from å…³é”®å­—</p></blockquote><p><strong>delete å’Œ truncate çš„åŒºåˆ«ï¼š</strong></p><ol><li>delete å¯ä»¥åŠ  where æ¡ä»¶ï¼Œtruncate ä¸èƒ½åŠ </li><li>truncate åˆ é™¤,æ•ˆç‡é«˜ä¸€ä¸¢ä¸¢</li><li>å‡å¦‚è¦åˆ é™¤çš„è¡¨ä¸­æœ‰è‡ªå¢é•¿åˆ—ï¼Œå¦‚æœç”¨ delete åˆ é™¤å,å†æ’å…¥æ•°æ®ï¼Œ <strong>è‡ªå¢é•¿åˆ—çš„å€¼ä»æ–­ç‚¹å¼€å§‹</strong> è€Œ truncate åˆ é™¤å,å†æ’å…¥æ•°æ®ï¼Œ <strong>è‡ªå¢é•¿åˆ—çš„å€¼ä» 1 å¼€å§‹</strong></li><li>truncate åˆ é™¤<strong>æ²¡æœ‰è¿”å›å€¼</strong>ï¼Œdelete åˆ é™¤<strong>æœ‰è¿”å›å€¼</strong> (ä½¿ç”¨ delete åˆ é™¤ä¼šè¿”å› n è¡Œå—å½±å“ï¼Œä½†ä½¿ç”¨ truncate åˆ é™¤åªä¼šè¿”å› 0 è¡Œå—å½±å“)</li><li>truncate åˆ é™¤<strong>ä¸èƒ½å›æ»š</strong>ï¼Œdelete åˆ é™¤<strong>å¯ä»¥å›æ»š</strong>ã€‚</li></ol><h2 id="DDL-data-define-language-è¯­è¨€"><a href="#DDL-data-define-language-è¯­è¨€" class="headerlink" title="DDL(data define language)è¯­è¨€"></a>DDL(data define language)è¯­è¨€</h2><blockquote><p>ddl è¯­è¨€è§£é‡Šï¼šæ•°æ®å®šä¹‰è¯­è¨€</p></blockquote><h3 id="åº“å’Œè¡¨ç®¡ç†"><a href="#åº“å’Œè¡¨ç®¡ç†" class="headerlink" title="åº“å’Œè¡¨ç®¡ç†"></a>åº“å’Œè¡¨ç®¡ç†</h3><h4 id="åº“çš„ç®¡ç†"><a href="#åº“çš„ç®¡ç†" class="headerlink" title="åº“çš„ç®¡ç†"></a>åº“çš„ç®¡ç†</h4><p><strong>åº“çš„ç®¡ç†åˆ†ä¸ºï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</strong></p><ol><li><p>åº“çš„åˆ›å»º</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¯­æ³•ï¼šcreate database [if not exists]åº“å;</span><br><span class="line"># if not exists çš„æ„æ€æ˜¯å½“åº“ä¸å­˜åœ¨å°±åˆ›å»º</span><br><span class="line"># æ¡ˆä¾‹:åˆ›å»ºåº“Books</span><br><span class="line">CREATE DATABASE IF NOT EXISTS books;</span><br></pre></td></tr></table></figure></li><li><p>åº“çš„ä¿®æ”¹</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹åº“çš„åç§°ï¼ˆé‡å‘½åï¼‰è¯­æ³•ï¼š</span><br><span class="line">RENAME DATABASE books TO æ–°åº“å; # ç›®å‰è¿™ç§æ–¹æ³•ä¸æ”¯æŒäº†ï¼Œå› ä¸ºè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹åº“çš„å­—ç¬¦é›†</span><br><span class="line">ALTER DATABASE books CHARACTER SET gbk;</span><br></pre></td></tr></table></figure><blockquote><p>psï¼šå¦‚æœå®åœ¨éœ€è¦ä¿®æ”¹åº“çš„åç§°çš„è¯ï¼Œå¯ä»¥é€šè¿‡é‡å‘½å data æ–‡ä»¶å¤¹ä¸‹çš„å¯¹åº”åº“çš„æ–‡ä»¶å¤¹åç§°</p><p>data æ–‡ä»¶å¤¹é»˜è®¤åœ¨ï¼š<code>C:\ProgramData\MySQL\MySQL Server 8.0\Data</code></p><p>å½“ mysql ä¸­æ¯åˆ›å»ºä¸€ä¸ªåº“å°±ä¼šåœ¨ data æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªå¯¹åº”åç§°çš„æ–‡ä»¶å¤¹</p><p>ä¸è¿‡ä»¥ä¸Šçš„æ–¹æ³•å¯èƒ½ä¹Ÿä¼šæœ‰ä¸€ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥æ¨èå°†<strong>æ•°æ®å¯¼å‡ºå†åˆ›å»ºåº“å¯¼å…¥</strong>çš„æ–¹å¼æ¥æ›²çº¿æ•‘å›½</p></blockquote></li><li><p>åº“çš„åˆ é™¤</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> books;</span><br></pre></td></tr></table></figure></li></ol><h4 id="è¡¨çš„ç®¡ç†"><a href="#è¡¨çš„ç®¡ç†" class="headerlink" title="è¡¨çš„ç®¡ç†"></a>è¡¨çš„ç®¡ç†</h4><p><strong>è¡¨çš„ç®¡ç†åˆ†ä¸ºï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</strong></p><ol><li><p>åˆ›å»º: create</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¯­æ³•:</span></span><br><span class="line"><span class="comment">create table è¡¨å(</span></span><br><span class="line"><span class="comment">åˆ—å åˆ—çš„ç±»å‹[é•¿åº¦] [çº¦æŸ]</span></span><br><span class="line"><span class="comment">åˆ—å åˆ—çš„ç±»å‹[é•¿åº¦] [çº¦æŸ]</span></span><br><span class="line"><span class="comment">åˆ—å åˆ—çš„ç±»å‹[é•¿åº¦] [çº¦æŸ]</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹: alter</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># è¯­æ³•</span><br><span class="line">alter table è¡¨å add | drop | modify | change column åˆ—å [åˆ—ç±»å‹ çº¦æŸ]</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹åˆ—å</span><br><span class="line"># è¯­æ³•ï¼šALTER TABLE è¡¨å CHANGE [COLUMN] æ—§åˆ—å æ–°åˆ—å åˆ—ç±»å‹;</span><br><span class="line">ALTER TABLE book CHANGE COLUMN publishdate pubDate DATETIME;</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹åˆ—çš„ç±»å‹æˆ–çº¦æŸ</span><br><span class="line"># è¯­æ³•ï¼šALTER TABLE è¡¨å MODIFY COLUMN åˆ—å ç±»å‹&#x2F;çº¦æŸ;</span><br><span class="line">ALTER TABLE book MODIFY COLUMN pubdate TIMESTAMP;</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æ–°åˆ—</span><br><span class="line"># è¯­æ³•ï¼šALTER TABLE è¡¨å ADD COLUMN åˆ—å åˆ—ç±»å‹;</span><br><span class="line">ALTER TABLE author ADD COLUMN annual DOUBLE;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤åˆ—</span><br><span class="line"># è¯­æ³•ï¼šALTER TABLE è¡¨å DROP COLUMN åˆ—å;</span><br><span class="line">ALTER TABLE author DROP COLUMN annual;</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹è¡¨å</span><br><span class="line"># è¯­æ³•ï¼šALTER TABLE è¡¨å RENAME TO æ–°è¡¨å</span><br><span class="line">ALTER TABLE author RENAME TO author;</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤: drop</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># è¡¨çš„åˆ é™¤</span><br><span class="line"># è¯­æ³•ï¼šDROP TABLE [IF EXISTS] è¡¨å;</span><br><span class="line">DROP TABLE IF EXISTS book_author;</span><br></pre></td></tr></table></figure></li><li><p>è¡¨çš„å¤åˆ¶</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#1.ä»…ä»…å¤åˆ¶è¡¨çš„ç»“æ„</span><br><span class="line">CREATE TABLE copy LIKE author;</span><br><span class="line"></span><br><span class="line">#2.å¤åˆ¶è¡¨çš„ç»“æ„+æ•ˆæ®</span><br><span class="line">CREATE TABLE copy2</span><br><span class="line">SELECT*FROM author;</span><br><span class="line"></span><br><span class="line">#åªå¤åˆ¶éƒ¨åˆ†æ•°æ®</span><br><span class="line">CREATE TABLE copy3</span><br><span class="line">    SELECT id,au_name</span><br><span class="line">    FROM author</span><br><span class="line">    WHERE nation&#x3D;&#39;ä¸­å›½&#39;;</span><br><span class="line"></span><br><span class="line"># åªå¤åˆ¶éƒ¨åˆ†ç»“æ„</span><br><span class="line">CREATE TABLE copy4</span><br><span class="line">    SELECT id,au_name</span><br><span class="line">    FROM author</span><br><span class="line">    WHERE 0;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¸¸è§æ•°æ®ç±»å‹ä»‹ç»"><a href="#å¸¸è§æ•°æ®ç±»å‹ä»‹ç»" class="headerlink" title="å¸¸è§æ•°æ®ç±»å‹ä»‹ç»"></a>å¸¸è§æ•°æ®ç±»å‹ä»‹ç»</h3><blockquote><p>MySQL ä¸­å®šä¹‰æ•°æ®å­—æ®µçš„ç±»å‹å¯¹ä½ æ•°æ®åº“çš„ä¼˜åŒ–æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>MySQL æ”¯æŒå¤šç§ç±»å‹ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼šæ•°å€¼ã€æ—¥æœŸ/æ—¶é—´å’Œå­—ç¬¦ä¸²(å­—ç¬¦)ç±»å‹ã€‚</p></blockquote><p><a href="MySQL-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">mysql æ•°æ®ç±»å‹</a></p><h3 id="å¸¸è§çº¦æŸ"><a href="#å¸¸è§çº¦æŸ" class="headerlink" title="å¸¸è§çº¦æŸ"></a>å¸¸è§çº¦æŸ</h3><h4 id="å…­å¤§çº¦æŸï¼š"><a href="#å…­å¤§çº¦æŸï¼š" class="headerlink" title="å…­å¤§çº¦æŸï¼š"></a><strong>å…­å¤§çº¦æŸï¼š</strong></h4><ul><li>not null éç©ºçº¦æŸ</li><li>default é»˜è®¤</li><li>primary key ä¸»é”®çº¦æŸ</li><li>unique å”¯ä¸€çº¦æŸ</li><li>check æ£€æŸ¥çº¦æŸ</li><li>foreign key å¤–é”®çº¦æŸ</li></ul><h4 id="çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š"><a href="#çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š" class="headerlink" title="çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š"></a><strong>çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š</strong></h4><ul><li><p>åˆ—çº§çº¦æŸ</p><ul><li><p>å…­å¤§çº¦æŸè¯­æ³•ä¸Šéƒ½æ”¯æŒåˆ—çº§çº¦æŸï¼Œ<strong>ä½†å¤–é”®æ²¡æœ‰æ•ˆæœ</strong></p></li><li><p>```mysql</p><h1 id="æ·»åŠ åˆ—çº§çº¦æŸï¼Œåˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥åœ¨ç±»å‹åé¢åŠ å°±å¥½å•¦"><a href="#æ·»åŠ åˆ—çº§çº¦æŸï¼Œåˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥åœ¨ç±»å‹åé¢åŠ å°±å¥½å•¦" class="headerlink" title="æ·»åŠ åˆ—çº§çº¦æŸï¼Œåˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥åœ¨ç±»å‹åé¢åŠ å°±å¥½å•¦"></a>æ·»åŠ åˆ—çº§çº¦æŸï¼Œåˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥åœ¨ç±»å‹åé¢åŠ å°±å¥½å•¦</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- è¡¨çº§çº¦æŸ</span><br><span class="line"></span><br><span class="line">  - é™¤äº†éç©ºã€é»˜è®¤ï¼Œå…¶ä»–çš„éƒ½æ”¯æŒ</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;mysql</span><br><span class="line">    # åˆ›å»ºè¡¨çº§çº¦æŸ</span><br><span class="line">    constraint çº¦æŸå çº¦æŸç±»å‹(å­—æ®µå)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="ä¸»é”®å’Œéç©ºçš„å¯¹æ¯”ï¼š"><a href="#ä¸»é”®å’Œéç©ºçš„å¯¹æ¯”ï¼š" class="headerlink" title="ä¸»é”®å’Œéç©ºçš„å¯¹æ¯”ï¼š"></a><strong>ä¸»é”®å’Œéç©ºçš„å¯¹æ¯”ï¼š</strong></h4><table><thead><tr><th></th><th>ä¿è¯å”¯ä¸€æ€§</th><th>æ˜¯å¦å…è®¸ä¸ºç©º</th><th>ä¸€ä¸ªè¡¨ä¸­å…è®¸æœ‰å¤šå°‘ä¸ª</th></tr></thead><tbody><tr><td>ä¸»é”®(primary key)</td><td>ğŸ™‚âˆš</td><td>ğŸ™ƒÃ—</td><td>æœ€å¤šä¸€ä¸ª</td></tr><tr><td>å”¯ä¸€(unique)</td><td>ğŸ™‚âˆš</td><td>ğŸ™‚âˆš</td><td>å¤šä¸ª</td></tr></tbody></table><h4 id="ä¿®æ”¹è¡¨æ—¶æ·»åŠ çº¦æŸ"><a href="#ä¿®æ”¹è¡¨æ—¶æ·»åŠ çº¦æŸ" class="headerlink" title="ä¿®æ”¹è¡¨æ—¶æ·»åŠ çº¦æŸ"></a>ä¿®æ”¹è¡¨æ—¶æ·»åŠ çº¦æŸ</h4><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707160215003.png" alt="image-20200707160215003"></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707155946478.png" alt="image-20200707155946478"></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707160044655.png" alt="image-20200707160044655"></p><h4 id="ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ"><a href="#ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ" class="headerlink" title="ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ"></a>ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ</h4><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707160430197.png" alt="image-20200707160430197"></p><h4 id="è‡ªå¢ï¼ˆæ ‡è¯†åˆ—ï¼‰"><a href="#è‡ªå¢ï¼ˆæ ‡è¯†åˆ—ï¼‰" class="headerlink" title="è‡ªå¢ï¼ˆæ ‡è¯†åˆ—ï¼‰"></a>è‡ªå¢ï¼ˆæ ‡è¯†åˆ—ï¼‰</h4><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707161042486.png" alt="image-20200707161042486"></p><p><strong>ä¿®æ”¹è¡¨æ—¶è®¾ç½®æ ‡è¯†åˆ—</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707161147002.png" alt="image-20200707161147002"></p><p><strong>ä¿®æ”¹è¡¨æ—¶åˆ é™¤æ ‡è¯†åˆ—</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707161310445.png" alt="image-20200707161310445"></p><h2 id="TCL-Transation-Control-Language-è¯­è¨€"><a href="#TCL-Transation-Control-Language-è¯­è¨€" class="headerlink" title="TCL(Transation Control Language)è¯­è¨€"></a>TCL(Transation Control Language)è¯­è¨€</h2><p><strong>äº‹åŠ¡æ§åˆ¶è¯­è¨€</strong></p><h3 id="äº‹åŠ¡çš„ç‰¹æ€§"><a href="#äº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡çš„ç‰¹æ€§"></a>äº‹åŠ¡çš„ç‰¹æ€§</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707161635495.png" alt="image-20200707161635495"></p><h3 id="äº‹åŠ¡å’Œäº‹åŠ¡å¤„ç†"><a href="#äº‹åŠ¡å’Œäº‹åŠ¡å¤„ç†" class="headerlink" title="äº‹åŠ¡å’Œäº‹åŠ¡å¤„ç†"></a>äº‹åŠ¡å’Œäº‹åŠ¡å¤„ç†</h3><p><strong>äº‹åŠ¡åˆ†ä¸ºéšå¼äº‹åŠ¡å’Œæ˜¾ç¤ºäº‹åŠ¡</strong></p><ul><li><strong>éšå¼äº‹åŠ¡</strong><ul><li>æ²¡æœ‰æ˜æ˜¾çš„å¼€å§‹å’Œç»“æŸæ ‡è®°</li><li>æ¯”å¦‚ï¼šinsertã€updateã€delete</li></ul></li><li><strong>æ˜¾å¼äº‹åŠ¡</strong><ul><li>å…·æœ‰æ˜æ˜¾çš„å¼€å§‹å’Œç»“æŸæ ‡è®°</li><li>å¼€å¯æ˜¾ç¤ºäº‹åŠ¡çš„å‰ææ˜¯ï¼Œéœ€è¦<strong>å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤</strong></li></ul></li></ul><blockquote><p>åœ¨ mysql ä¸­å¯ä»¥è¢«äº‹åŠ¡æ§åˆ¶çš„åªæœ‰ dml å’Œ dql è¯­è¨€ï¼Œä¸” mysql é»˜è®¤å¼€å¯äº†äº‹åŠ¡è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ¯æ¡ dml å’Œ dql è¯­è¨€éƒ½ä¼šè‡ªåŠ¨æäº¤</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­å¥æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†è‡ªåŠ¨æäº¤</span><br><span class="line">show variables like â€˜autocommitâ€™;</span><br><span class="line"># å…³é—­è‡ªåŠ¨æäº¤</span><br><span class="line">set autocommit&#x3D;0;</span><br><span class="line"></span><br><span class="line"># å¼€å¯æ˜¾å¼äº‹åŠ¡</span><br><span class="line">start transation; # è¿™ä¸ªæ˜¯å¯é€‰çš„</span><br><span class="line">insert into...</span><br><span class="line">update...</span><br><span class="line">delete...</span><br><span class="line"># é€‰æ‹©æäº¤è¿˜æ˜¯å›æ»š</span><br><span class="line">commit;</span><br><span class="line">rollback;</span><br></pre></td></tr></table></figure><p><strong>ä¿å­˜ç‚¹(savepoint)</strong></p><blockquote><p>ä¿å­˜ç‚¹ä½œç”¨ï¼šå…è®¸è®©äº‹åŠ¡å›æ»šåˆ°è®¾ç‚¹çš„ä¿å­˜ç‚¹ï¼Œå¯ä»¥ç†è§£ä¸º<strong>æ¸¸æˆé‡Œçš„å­˜æ¡£</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®ä¿å­˜ç‚¹</span><br><span class="line">delete from emp where id &#x3D; 1; # åœ¨è¿™ä¸€æ­¥åˆ é™¤idä¸º1çš„å‘˜å·¥</span><br><span class="line">savepoint a; # è®¾å®šä¸€ä¸ªä¿å­˜ç‚¹</span><br><span class="line">delete from emp where id &#x3D;2; # åœ¨è¿™ä¸€æ­¥åˆ é™¤idä¸º2çš„å‘˜å·¥</span><br><span class="line">rollback to a; # å°†äº‹åŠ¡å›æ»šåˆ°ä¿å­˜ç‚¹aï¼Œå›æ»šä¹‹åä¼šå‘ç°idä¸º1çš„å‘˜å·¥è¢«åˆ é™¤äº†ï¼Œä½†idä¸º2çš„å‘˜å·¥è¿˜å­˜åœ¨</span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡å¹¶å‘é—®é¢˜"><a href="#äº‹åŠ¡å¹¶å‘é—®é¢˜" class="headerlink" title="äº‹åŠ¡å¹¶å‘é—®é¢˜"></a>äº‹åŠ¡å¹¶å‘é—®é¢˜</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707170436873.png" alt="image-20200707170436873"></p><blockquote><p>å¯¹äºä»¥ä¸Šé—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è¿›è¡Œè§£å†³</p><p>æ¯ä¸ªæ•°æ®åº“éƒ½æœ‰å¯¹åº”çš„äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°</p></blockquote><h3 id="äº‹åŠ¡éš”ç¦»"><a href="#äº‹åŠ¡éš”ç¦»" class="headerlink" title="äº‹åŠ¡éš”ç¦»"></a>äº‹åŠ¡éš”ç¦»</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707171431091.png" alt="image-20200707171431091"></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707171531156.png" alt="image-20200707171531156"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨mysqlä¸­å¯ä»¥é€šè¿‡&#96;select @@tx_isolation&#96;æ¥æŸ¥çœ‹æ•°æ®åº“å½“å‰çš„éš”ç¦»çº§åˆ«</span><br><span class="line">select @@tx_isolation</span><br><span class="line"># è®¾ç½®å…¶ä»–çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</span><br><span class="line">set session transation isolation level read uncommitted</span><br><span class="line"># è®¾ç½®å…¨å±€çš„å°±å°†sessionæ”¹ä¸ºglobal</span><br></pre></td></tr></table></figure><p><strong>4 ç§éš”ç¦»çº§åˆ«çš„æ¯”è¾ƒï¼š</strong></p><p>æ¯”è¾ƒå¯ä»¥è§£å†³å“ªäº›äº‹åŠ¡å¹¶å‘é—®é¢˜</p><p>âˆš ä¸ºä¼šå‡ºç°çš„é—®é¢˜</p><p>Ã— ä¸ºä¸ä¼šå‡ºç°çš„é—®é¢˜</p><table><thead><tr><th></th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>read uncommitted</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>read committed</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>repeatable read</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>serializable</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><blockquote><p>mysql ä¸­é»˜è®¤ ç¬¬ä¸‰ä¸ªéš”é«˜çº§åˆ« <code>repeatable read</code><br>oracle ä¸­é»˜è®¤ç¬¬äºŒä¸ªéš”é«˜çº§åˆ« <code>read committed</code></p></blockquote><hr><h1 id="mysql-å®‰è£…-windows-ç‰ˆ"><a href="#mysql-å®‰è£…-windows-ç‰ˆ" class="headerlink" title="mysql å®‰è£…(windows ç‰ˆ)"></a>mysql å®‰è£…(windows ç‰ˆ)</h1><p><strong>æœ¬èŠ‚å®‰è£…çš„ mysql ç‰ˆæœ¬ä¸º 8.0.20</strong></p><ol><li><p>å®˜ç½‘ä¸‹è½½ mysql å®‰è£…æ–‡ä»¶</p><ol><li>å®˜ç½‘ç½‘å€ï¼š<a href="https://www.mysql.com/">https://www.mysql.com/</a> ï¼Œå¦‚æœå«Œå¼ƒè®¿é—®æ…¢å¯ä»¥ä½¿ç”¨æœç‹çš„ mysql é•œåƒ <a href="http://mirrors.sohu.com/mysql/">http://mirrors.sohu.com/mysql/</a></li><li><a href="https://dev.mysql.com/downloads/">ä¸‹è½½é¡µé¢</a><br><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%201%201.png" alt="./images/Pasted image 1 1.png"></li><li><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/20210409102739.png" alt="downloads"></li><li>è¿™ä¸ªçš„ç•Œé¢æ˜¯ä¸‹è½½çš„ zipï¼Œå¦‚æœæƒ³ä¸‹è½½å®‰è£…ç¨‹åºç‚¹å‡»ä¹‹å‰é¡µé¢çš„<code>Go to Download Page</code>æŒ‰é’®</li><li>ä¸‹è½½è¿™ä¸ª <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/20210409102908.png" alt="downloads"></li></ol></li><li><p>å®‰è£…</p><ol><li><p>åŒå‡»å®‰è£…ç¨‹åºï¼ˆå¯èƒ½è¦ç­‰ä¸€ä¼šï¼‰</p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%205%201.png" alt="./images/Pasted image 5 1.png"></p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%206.png" alt="æ•°æ®åº“/mysql/images/Pasted image 6.png"></p></li><li><p>ç‚¹ execute ç„¶åç­‰å¾…ä¸‹è½½å°±å¥½å•¦ <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%201%202.png" alt="./images/Pasted image 1 2.png"></p></li><li><p>å®‰è£…å¥½äº†ä¹‹åç‚¹å‡» next <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%203%201-1594046783783.png" alt="./images/Pasted image 3 1.png"></p></li><li><p>ç‚¹ next <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%204%201-1594046791886.png" alt="./images/Pasted image 4 1.png"></p></li><li><p>é€‰æ‹©ç¬¬ä¸€ä¸ª <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%205%201-1594046798866.png" alt="./images/Pasted image 5 1.png"></p></li><li><p>ç‚¹å‡» next<img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%204%201-1594046898158.png" alt="./images/Pasted image 4 1.png"></p></li><li><p>è¾“å…¥ root è´¦æˆ·å¯†ç ï¼Œå¦‚æœæƒ³æ·»åŠ å…¶ä»–ç”¨æˆ·å°±åœ¨ mysql user accounts ä¸‹é¢æ·»åŠ  <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/01.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p></li><li><p>åœ¨è¿™é‡Œè®¾ç½® windows æœåŠ¡åç§° <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%209.png" alt="./images/Pasted image 9.png"></p></li><li><p>ç‚¹å‡» execute å®‰è£… <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%2010.png" alt="./images/Pasted image 10.png"></p></li><li><p>ç‚¹å‡» finish <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%2011.png" alt="./images/Pasted image 11.png"></p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%201%203.png" alt="./images/Pasted image 1 3.png"></p></li><li><p>è¾“å…¥ä¸€ä¸‹å¯†ç ç„¶åç‚¹å‡» next <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%202%202.png" alt="./images/Pasted image 2 2.png"></p></li><li><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%203%202.png" alt="./images/Pasted image 3 2.png"></p></li><li><p>ç„¶åä¸€è·¯ next å°±å®‰å®Œå•¦ ğŸ¥³</p></li></ol></li></ol><h1 id="MySQL-å®‰è£…-Linux-ç‰ˆ"><a href="#MySQL-å®‰è£…-Linux-ç‰ˆ" class="headerlink" title="MySQL å®‰è£…(Linux ç‰ˆ)"></a>MySQL å®‰è£…(Linux ç‰ˆ)</h1><blockquote><p>å¦‚æœåªæ˜¯åŸºç¡€éƒ¨åˆ†çš„å­¦ä¹ è¿™ä¸€èŠ‚å¯ä»¥æš‚æ—¶ä¸çœ‹</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/yss818824/p/12349719.html">https://www.cnblogs.com/yss818824/p/12349719.html</a></p></blockquote><p>è¿™é‡Œä»‹ç»ä¸¤ç§å®‰è£…æ–¹å¼ï¼šyum å®‰è£…å’Œä¸‹è½½æœç‹é•œåƒæ‰‹åŠ¨å®‰è£…</p><p>åœ¨ä¸¤ç§æ–¹å¼ä¸‹è½½ä¹‹å‰å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤ä¹‹å‰å®‰è£…è¿‡çš„ mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mysql #æ‰¾åˆ°å·²è£…çš„rpmåŒ…å,å¦‚æœæœ‰å®‰è£…è¿‡çš„mysqlå°±ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤</span><br><span class="line">yum -y remove åŒ…å #å¸è½½ï¼ŒåŒ…åæ˜¯ä¸Šé¢å‘½ä»¤åˆ—å‡ºæ¥çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ—å‡ºæ¥å°±æ˜¯æ²¡å®‰è£…è¿‡</span><br><span class="line">cd /opt # ç§»åŠ¨åˆ°optç›®å½•</span><br></pre></td></tr></table></figure><h2 id="yum-å®‰è£…"><a href="#yum-å®‰è£…" class="headerlink" title="yum å®‰è£…"></a>yum å®‰è£…</h2><ol><li><p> è®¿é—® <a href="https://dev.mysql.com/downloads/repo/yum/">https://dev.mysql.com/downloads/repo/yum/</a> ä¸‹è½½ yum çš„ä»“åº“ä¸‹è½½åŒ…</p></li><li><p>ä¸‹è½½å¯¹åº” linux ç‰ˆæœ¬çš„ä»“åº“ä¸‹è½½åŒ…ï¼ˆæˆ‘çš„æ˜¯ centos7 æ‰€ä»¥å°±ä¸‹ linux7ï¼‰</p><p> <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200714083401273.png" alt="image-20200714083401273"></p></li><li><p>è¿™é‡Œæœ‰ä¸¤ç§ä¸‹è½½æ–¹å¼ï¼š</p><ol><li> ä¸‹è½½åˆ°æœ¬åœ°ç„¶åä¼ åˆ° linux é‡Œé¢</li><li> å¤åˆ¶ä¸‹è½½é“¾æ¥ï¼Œåœ¨ linux é‡Œé¢ä½¿ç”¨ wget å‘½ä»¤ä¸‹è½½<code>wget ä¸‹è½½ç½‘å€</code></li></ol></li><li><p> å°† rpm åŒ…ä¸‹è½½åˆ° linux é‡Œé¢åä½¿ç”¨<code>rpm -ivh rpmåŒ…å</code>è¿›è¡Œä¸‹è½½</p></li><li><p> å®‰è£…ä¹‹å‰å…ˆæ¸…é™¤ç¼“å­˜<code>yum clean all</code></p></li><li><p> ç„¶åä½¿ç”¨<code>yum install mysql-server</code>è¿›è¡Œå®‰è£…</p></li></ol><h2 id="æœç‹é•œåƒæ‰‹åŠ¨å®‰è£…"><a href="#æœç‹é•œåƒæ‰‹åŠ¨å®‰è£…" class="headerlink" title="æœç‹é•œåƒæ‰‹åŠ¨å®‰è£…"></a>æœç‹é•œåƒæ‰‹åŠ¨å®‰è£…</h2><p><strong>è¿™é‡Œä»¥ä¸‹è½½ mysql8.0.20 ä¸ºä¾‹</strong></p><ol><li><p> è®¿é—® <a href="http://mirrors.sohu.com/mysql/MySQL-8.0/">http://mirrors.sohu.com/mysql/MySQL-8.0/</a> è¿›å…¥æœç‹ mysql é•œåƒä¸‹è½½åœ°å€</p></li><li><p> æŒ‰ ctrl+f æœç´¢ communityï¼ˆcommunity æ˜¯ç¤¾åŒºçš„æ„æ€ï¼‰</p></li><li><p>ä¸‹è½½ clientã€serverã€commonã€libs çš„å®‰è£…åŒ…ï¼ˆrpmï¼‰</p><blockquote><p>æ³¨æ„ï¼šel7 æ˜¯ linux çš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ centos7 å°±ä¸‹ el7ï¼Œå¦‚æœæ˜¯ centos8 å°±ä¸‹è½½ el8</p><p>x86_64 æ˜¯æ¶æ„</p></blockquote><p> <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200713160747557.png" alt="image-20200713160747557"></p><p> <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200713160824285.png" alt="image-20200713160824285"></p></li><li><p> æ‰“å¼€è™šæ‹Ÿæœºï¼Œå°†è¿™ä¸¤ä¸ªå®‰è£…åŒ…ä¼ åˆ° centos é‡Œé¢çš„ opt ç›®å½•ä¸‹</p></li><li><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mysql #æ‰¾åˆ°å·²è£…çš„rpmåŒ…å,å¦‚æœæœ‰å®‰è£…è¿‡çš„mysqlå°±ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤</span><br><span class="line">yum -y remove åŒ…å #å¸è½½ï¼ŒåŒ…åæ˜¯ä¸Šé¢å‘½ä»¤åˆ—å‡ºæ¥çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ—å‡ºæ¥å°±æ˜¯æ²¡å®‰è£…è¿‡</span><br><span class="line">cd /opt # ç§»åŠ¨åˆ°optç›®å½•</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…é¡ºåºï¼šcommon --&gt; libs --&gt; clients --&gt; server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å‘½ä»¤</span></span><br><span class="line">rpm -ivh mysql-community-common-5.7.19-1.el6.x86_64.rpm mysql-community-libs-5.7.19-1.el6.x86_64.rpm mysql-community-client-5.7.19-1.el6.x86_64.rpm mysql-community-server-5.7.19-1.el6.x86_64.rpm # åé¢çš„è¿™äº›rpmå†™åˆšåˆšä¸‹è½½çš„rpmå®‰è£…åŒ…</span><br></pre></td></tr></table></figure></li></ol><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p><strong>å°† mysql ä¸‹è½½åˆ° linux é‡Œé¢åå†è¿›è¡Œè¿™ä¸€æ­¥</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å…ˆå¯åŠ¨mysql</span></span><br><span class="line">systemctl start  mysqld.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> çœ‹ä¸€ä¸‹çŠ¶æ€æ˜¯å¦æ˜¯å¯åŠ¨</span></span><br><span class="line">systemctl status mysqld.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡ŒæˆåŠŸä¹‹åæŸ¥çœ‹mysqlå¯†ç </span></span><br><span class="line">grep &quot;password&quot; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200714084807164.png" alt="image-20200714084807164"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨mysql</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥mysqlä¹‹åä¸èƒ½åšä»»ä½•æ“ä½œï¼Œéœ€è¦å…ˆé‡æ–°è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœåšäº†æ“ä½œä¼šæŠ¥é”™ï¼Œè¿™ä¸ªé”™çš„æ„æ€å°±æ˜¯è¦ä½ å…ˆé‡ç½®å¯†ç </span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200714085249682.png" alt="image-20200714085249682"></p><h3 id="è®¾ç½®å¯†ç å’Œå¯†ç å¤æ‚åº¦"><a href="#è®¾ç½®å¯†ç å’Œå¯†ç å¤æ‚åº¦" class="headerlink" title="è®¾ç½®å¯†ç å’Œå¯†ç å¤æ‚åº¦"></a><strong>è®¾ç½®å¯†ç å’Œå¯†ç å¤æ‚åº¦</strong></h3><blockquote><p>å‰æ’æé†’ï¼šå¦‚æœè¦å°†å¯†ç æ”¹æˆ<code>12345678</code>çš„è¯ï¼Œéœ€è¦å…ˆå°†å¯†ç æ”¹æˆæœ‰å¤§å°å†™å­—æ¯å’Œæ•°å­—ä¸”é•¿åº¦æ˜¯å…«ä½çš„å¯†ç ï¼Œç„¶åå†ä¿®æ”¹å¯†ç å¤æ‚åº¦ä¸º lowï¼Œç„¶åå†å°†å¯†ç æ”¹æˆ<code>12345678</code>ã€‚å¦‚æœè¦æ”¹æˆ<code>123456</code>çš„è¯è¿˜éœ€è¦ä¿®æ”¹å¯†ç é•¿åº¦ä¸ºå…­ä½ã€‚ğŸ™ƒ æœ‰ç‚¹éº»çƒ¦<br>æ³¨æ„çœ‹æ³¨é‡Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼æ³¨æ„çœ‹æ³¨é‡Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹å¯†ç </span><br><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line"># å…¶ä¸­â€˜123456â€™æ›¿æ¢æˆä½ è¦è®¾ç½®çš„å¯†ç ï¼Œæ³¨æ„:å¯†ç è®¾ç½®å¿…é¡»è¦å¤§å°å†™å­—æ¯æ•°å­—å’Œç‰¹æ®Šç¬¦å·ï¼ˆ,&#x2F;&#39;;:ç­‰ï¼‰,ä¸ç„¶ä¸èƒ½é…ç½®æˆåŠŸã€‚</span><br><span class="line"># å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200714085659414.png" alt="image-20200714085659414"></p><p>æ˜¯å› ä¸ºå¯†ç çš„å¤æ‚åº¦ä¸ç¬¦åˆé»˜è®¤è§„å®šï¼Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ mysql é»˜è®¤å¯†ç å¤æ‚åº¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œè¿™ä¸ªä¹‹å‰æ˜¯éœ€è¦ä¿®æ”¹é»˜è®¤å¯†ç çš„ï¼Œå¦‚æœæƒ³ä¿®æ”¹å¯†ç ä¸º123456å¯ä»¥å…ˆä¿®æ”¹å¯†ç åå†ä¿®æ”¹å¯†ç å¤æ‚åº¦ç„¶åå†ä¿®æ”¹å¯†ç </span><br><span class="line">SHOW VARIABLES LIKE &#39;validate_password%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200714090733765.png" alt="image-20200714090733765"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼å»ä¿®æ”¹å®ƒ</span><br><span class="line">set global validate_password.policy&#x3D;LOW;</span><br><span class="line"># validate_password.policyï¼ˆæ ¡éªŒè§„åˆ™ï¼‰ï¼Œå–å€¼èŒƒå›´[0,1,2]ï¼Œé»˜è®¤å€¼1ã€‚0ï¼ˆLOWï¼‰ï¼šåªæ ¡éªŒé•¿åº¦ï¼›1ï¼ˆMEDIUMï¼‰ï¼šæ ¡éªŒé•¿åº¦ã€å¤§å°å†™å’Œç‰¹æ®Šå­—ç¬¦ï¼›2ï¼ˆSTRONGï¼‰ï¼šæ ¡éªŒé•¿åº¦ã€å¤§å°å†™ã€ç‰¹æ®Šå­—ç¬¦å’Œdictionary_file</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯-mysql-è¿œç¨‹è®¿é—®"><a href="#å¼€å¯-mysql-è¿œç¨‹è®¿é—®" class="headerlink" title="å¼€å¯ mysql è¿œç¨‹è®¿é—®"></a><strong>å¼€å¯ mysql è¿œç¨‹è®¿é—®</strong></h3><p>è®°å¾—å…³ä¸€ä¸‹é˜²ç«å¢™ï¼Œæˆ–è€…é˜²ç«å¢™å¼€æ”¾ 3306 ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld # å…³é—­é˜²ç«å¢™</span><br><span class="line">systemctl disable firewalld # å–æ¶ˆé˜²ç«å¢™å¼€æœºè‡ªå¯</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨æ”¹è¡¨æ³•å»å¼€å¯è¿œç¨‹è®¿é—®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># è¿›å…¥åˆ°mysqlåº“</span><br><span class="line">use mysql;</span><br><span class="line"># æŸ¥è¯¢mysqlè¡¨çš„è®¿é—®ä¸»æœºèŒƒå›´å’Œç”¨æˆ·</span><br><span class="line">select host, user from user;</span><br><span class="line"># å¦‚æœè¦å¼€å¯rootç”¨æˆ·çš„è¿œç¨‹è®¿é—®ï¼Œä¿®æ”¹å®ƒçš„hostä¸º%</span><br><span class="line">update user set host &#x3D; &#39;%&#39; where user &#x3D; &#39;root&#39;;</span><br><span class="line"># è¿™å¥è¡¨ç¤ºä»mysqlæ•°æ®åº“çš„grantè¡¨ä¸­é‡æ–°åŠ è½½æƒé™æ•°æ®</span><br><span class="line">flush privileges; # å¦‚æœé‡å¯çš„è¯å°±ä¸ç”¨æ‰§è¡Œè¿™å¥è¯äº†</span><br><span class="line"># å¦‚æœè¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼ŒæŸ¥çœ‹mysqlæ˜¯å¦åªå…è®¸æœ¬åœ°127.0.0.1è®¿é—®</span><br><span class="line"># cat &#x2F;etc&#x2F;my.cnf</span><br><span class="line"># bind-address&#x3D;127.0.0.1    #å»æ‰è¿™ä¸€è¡Œï¼Œæˆ–è€…å»æ‰</span><br><span class="line"># skip-networking</span><br><span class="line"># é‡å¯mysqlï¼šservice mysqld restart</span><br></pre></td></tr></table></figure><p><strong>è®¾ç½®å¼€æœºå¯åŠ¨</strong></p><p>ä½¿ç”¨<code>systemctl enable mysqld</code>æ¥è®¾ç½®å¼€æœºå¯åŠ¨</p><h3 id="MySQL-å®‰è£…ç›®å½•"><a href="#MySQL-å®‰è£…ç›®å½•" class="headerlink" title="MySQL å®‰è£…ç›®å½•"></a>MySQL å®‰è£…ç›®å½•</h3><table><thead><tr><th></th><th>è§£é‡Š</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>/var/lib/mysql/</td><td>mysql æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®</td><td></td></tr><tr><td>/usr/share/mysql/</td><td>é…ç½®æ–‡ä»¶ç›®å½•</td><td>mysqladminã€mysqldump ç­‰å‘½ä»¤</td></tr><tr><td>/usr/bin</td><td>ç›¸å…³å‘½ä»¤ç›®å½•</td><td></td></tr></tbody></table><h1 id="å·¥å…·ä»‹ç»"><a href="#å·¥å…·ä»‹ç»" class="headerlink" title="å·¥å…·ä»‹ç»"></a>å·¥å…·ä»‹ç»</h1><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%204%202.png" alt="./images/Pasted image 4 2.png"></p><ul><li>mysql å‘½ä»¤è¡Œè¿æ¥å™¨ï¼š<ul><li>MySQL 8.0 Command Line Client - Unicode</li><li>MySQL 8.0 Command Line Client</li></ul></li><li>MySQL Installer - Communityï¼š <strong>ä¿®æ”¹ mysql å®‰è£…é…ç½®çš„</strong></li><li>MySQL Workbench 8.0 CEï¼š <strong>mysql è‡ªå¸¦çš„å›¾å½¢ç•Œé¢</strong></li><li>MySQL Shell</li><li>MySQL Notifier 1.1.8 <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%2012.png" alt="./images/Pasted image 12.png"></li></ul><h1 id="mysql-åŸºç¡€é…ç½®"><a href="#mysql-åŸºç¡€é…ç½®" class="headerlink" title="mysql åŸºç¡€é…ç½®"></a>mysql åŸºç¡€é…ç½®</h1><h2 id="mysql-çš„é…ç½®æ–‡ä»¶ä½ç½®"><a href="#mysql-çš„é…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="mysql çš„é…ç½®æ–‡ä»¶ä½ç½®"></a>mysql çš„é…ç½®æ–‡ä»¶ä½ç½®</h2><p>é»˜è®¤ä½ç½®æ˜¯åœ¨<code>C:\ProgramData\MySQL\MySQL Server 8.0</code></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/image-20200707095630942.png" alt="image-20200707095630942"></p><h2 id="é…ç½®æ–‡ä»¶ç®€å•æ¦‚è¿°"><a href="#é…ç½®æ–‡ä»¶ç®€å•æ¦‚è¿°" class="headerlink" title="é…ç½®æ–‡ä»¶ç®€å•æ¦‚è¿°"></a>é…ç½®æ–‡ä»¶ç®€å•æ¦‚è¿°</h2><blockquote><p>è¿™é‡Œåªæ˜¯æ¦‚è¿°ï¼Œå…·ä½“çš„è¯¦è§£è§<a href="MySQL-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">mysql é…ç½®æ–‡ä»¶è¯¦è§£</a></p><p>ini è¯­æ³•è§<a href="../../%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/ini/ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F.md">ini è¯­æ³•</a></p></blockquote><p>ä»¥ä¸‹é…ç½®åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå½“éœ€è¦ä¿®æ”¹ mysql çš„è¿æ¥ç«¯å£æ—¶ä¿®æ”¹ port å³å¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="comment"># pipe=</span></span><br><span class="line"><span class="comment"># socket=MYSQL</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><p>åœ¨ path ç¯å¢ƒå˜é‡ä¸­æ·»åŠ  mysql server å®‰è£…è·¯å¾„\bin<br>å¦‚ï¼šæˆ‘å½“å‰ mysql å®‰è£…è·¯å¾„åœ¨ c ç›˜<br>![./images/Pasted image 7 1.png]<br>è¿›å…¥åˆ° mysql server æ–‡ä»¶å¤¹ä¸‹çš„ bin æ–‡ä»¶å¤¹<br>æˆ‘åœ¨ path ä¸­å°±æ·»åŠ å¦‚ä¸‹è·¯å¾„<code>C:\Program Files\MySQL\MySQL Server 8.0\bin</code></p><hr><h1 id="å¯åŠ¨å’Œå…³é—­-mysql-æœåŠ¡"><a href="#å¯åŠ¨å’Œå…³é—­-mysql-æœåŠ¡" class="headerlink" title="å¯åŠ¨å’Œå…³é—­ mysql æœåŠ¡"></a>å¯åŠ¨å’Œå…³é—­ mysql æœåŠ¡</h1><h2 id="ç•Œé¢çš„æ–¹å¼å¯åŠ¨"><a href="#ç•Œé¢çš„æ–¹å¼å¯åŠ¨" class="headerlink" title="ç•Œé¢çš„æ–¹å¼å¯åŠ¨"></a>ç•Œé¢çš„æ–¹å¼å¯åŠ¨</h2><ol><li>ç‚¹å‡»æœåŠ¡ <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%202%201-1594047001888.png" alt="./images/Pasted image 2 1.png"></li><li>æ‰¾åˆ° mysql æœåŠ¡å¹¶å¯åŠ¨æˆ–å…³é—­</li></ol><h2 id="å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨"><a href="#å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨" class="headerlink" title="å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨"></a>å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨</h2><ol><li>æ‰“å¼€ cmdï¼ˆéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™ï¼‰</li><li>å…³é—­ mysql æœåŠ¡ï¼š<code>net stop &lt;æœåŠ¡å&gt;</code></li><li>å¯åŠ¨ mysql æœåŠ¡ï¼š<code>net start &lt;æœåŠ¡å&gt;</code></li></ol><hr><h1 id="mysql-ç™»å½•å’Œé€€å‡º"><a href="#mysql-ç™»å½•å’Œé€€å‡º" class="headerlink" title="mysql ç™»å½•å’Œé€€å‡º"></a>mysql ç™»å½•å’Œé€€å‡º</h1><h2 id="ä½¿ç”¨-mysql-è‡ªå¸¦çš„è¿æ¥å™¨è¿æ¥"><a href="#ä½¿ç”¨-mysql-è‡ªå¸¦çš„è¿æ¥å™¨è¿æ¥" class="headerlink" title="ä½¿ç”¨ mysql è‡ªå¸¦çš„è¿æ¥å™¨è¿æ¥"></a>ä½¿ç”¨ mysql è‡ªå¸¦çš„è¿æ¥å™¨è¿æ¥</h2><p>ä½¿ç”¨ MySQL 8.0 Command Line Client è¿æ¥ <img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%206%202.png" alt="./images/Pasted image 6 2.png"></p><h2 id="å‘½ä»¤è¡Œè¿æ¥"><a href="#å‘½ä»¤è¡Œè¿æ¥" class="headerlink" title="å‘½ä»¤è¡Œè¿æ¥"></a>å‘½ä»¤è¡Œè¿æ¥</h2><p>å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè¿æ¥<br><code>mysql -h &lt;ä¸»æœºå/ip&gt; -P &lt;ç«¯å£å·&gt; -u &lt;ç”¨æˆ·å&gt; -p&lt;å¯†ç &gt;</code></p><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨-h -P -u è¿™äº›å‚æ•°çš„æ—¶å€™åé¢å¯ä»¥ä¸ç”¨åŠ ç©ºæ ¼ï¼Œä½†ä½¿ç”¨-p å‚æ•°æ—¶åé¢ä¸èƒ½æœ‰ç©ºæ ¼å¦‚ï¼š<code>mysql -hlocalhost -P3306 -uroot -p123456</code>ï¼Œå¦‚æœå†™æ³•ä¸ºï¼š<code>mysql -hlocalhost -P3306 -uroot -p 123456</code>åˆ™ä¸ºé”™è¯¯çš„</p></blockquote><blockquote><p>-h å’Œ -P å‚æ•°é»˜è®¤å€¼æ˜¯ <code>localhost</code> å’Œ <code>3306</code>ï¼Œæ‰€ä»¥å¦‚æœè¿æ¥æœ¬åœ°çš„ mysql è¿æ¥çš„è¯å¯ä»¥ä¸ç”¨åŠ è¿™ä¸¤ä¸ªå‚æ•°</p></blockquote><p><strong>ä½¿ç”¨ exit é€€å‡º mysql</strong></p><h2 id="ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è¿æ¥"><a href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è¿æ¥" class="headerlink" title="ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è¿æ¥"></a>ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è¿æ¥</h2><p>ä½¿ç”¨<strong>Navicat Premium 15</strong>è¿›è¡Œè¿æ¥</p><hr><h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><p><strong>åœ¨ mysql ä¸­å˜é‡åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</strong></p><ul><li>ç³»ç»Ÿå˜é‡<ul><li>å…¨å±€å˜é‡</li><li>ä¼šè¯å˜é‡</li></ul></li><li>è‡ªå®šä¹‰å˜é‡<ul><li>ç”¨æˆ·å˜é‡</li><li>å±€éƒ¨å˜é‡</li></ul></li></ul><h2 id="ç³»ç»Ÿå˜é‡"><a href="#ç³»ç»Ÿå˜é‡" class="headerlink" title="ç³»ç»Ÿå˜é‡"></a>ç³»ç»Ÿå˜é‡</h2><blockquote><p>ğŸ“– è¯´æ˜ï¼šå˜é‡ç”±ç³»ç»Ÿæä¾›ï¼Œè€Œä¸æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œå±äºæœåŠ¡å™¨å±‚é¢</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹å½“å‰ä¼šè¯çš„æ‰€æœ‰ç³»ç»Ÿå˜é‡</span><br><span class="line">show session variables;</span><br><span class="line"># æŸ¥çœ‹å…¨å±€çš„ç³»ç»Ÿå˜é‡</span><br><span class="line">show global variables;</span><br><span class="line"># æŸ¥çœ‹ç¬¦åˆæ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡</span><br><span class="line">show session variables like &#39;%auto%&#39;;</span><br><span class="line"># æŸ¥çœ‹æŒ‡å®šæŸä¸ªå˜é‡çš„å€¼</span><br><span class="line">select @@global|[session].ç³»ç»Ÿå˜é‡å;</span><br><span class="line"></span><br><span class="line"># ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼ï¼š</span><br><span class="line"># æ–¹æ³•ä¸€:</span><br><span class="line">set session ç³»ç»Ÿå˜é‡å&#x3D;å€¼;</span><br><span class="line"># æ–¹æ³•äºŒï¼š</span><br><span class="line">set @@session.ç³»ç»Ÿå˜é‡å&#x3D;å€¼;</span><br><span class="line"># å¦‚æœæ˜¯ä¼šè¯çº§åˆ«éœ€è¦åŠ sessionï¼Œå¦‚æœæ˜¯å…¨å±€çº§åˆ«éœ€è¦åŠ globalï¼Œä¸å†™çš„è¯é»˜è®¤æ˜¯session</span><br></pre></td></tr></table></figure><blockquote><p>â— æ³¨æ„ï¼š</p><ul><li>å…¨å±€å˜é‡<ul><li>åªä½œç”¨äºå…¨éƒ¨ä¼šè¯ï¼Œä½†æ˜¯<strong>ä¸èƒ½è·¨é‡å¯</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´é‡æ–°å¯åŠ¨æœåŠ¡ä¹‹åè®¾ç½®è¿‡çš„å€¼ä¼šå˜å›<strong>é»˜è®¤çŠ¶æ€</strong>ã€‚å¦‚æœéœ€è¦é‡å¯æœåŠ¡ä¹‹åå€¼ä¸æ”¹å˜éœ€è¦ä¿®æ”¹<strong>mysql é…ç½®æ–‡ä»¶</strong></li></ul></li><li>ä¼šè¯å˜é‡<ul><li>åªä½œç”¨äº<strong>å½“å‰ä¼šè¯</strong></li></ul></li></ul></blockquote><h2 id="è‡ªå®šä¹‰å˜é‡"><a href="#è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è‡ªå®šä¹‰å˜é‡"></a>è‡ªå®šä¹‰å˜é‡</h2><blockquote><p>ğŸ“– è¯´æ˜ï¼šè‡ªå®šä¹‰å˜é‡æ˜¯å±äºç”¨æˆ·åˆ›å»ºçš„ï¼Œä¸å±äºç³»ç»Ÿ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># å£°æ˜è‡ªå®šä¹‰å˜é‡ï¼Œç”¨æˆ·å˜é‡è¦æ±‚å¿…é¡»åŠ ä¸Š@ç¬¦</span><br><span class="line"># æ–¹å¼ä¸€ï¼š</span><br><span class="line">set @ç”¨æˆ·å˜é‡å&#x3D;å€¼;</span><br><span class="line"># æ–¹å¼äºŒï¼šå› ä¸º&#x3D;å­˜åœ¨æ­§ä¹‰ï¼Œå› ä¸ºç­‰å·æœ‰ä¸¤ä¸ªä½œç”¨1.èµ‹å€¼ 2.æ¯”è¾ƒ æ‰€ä»¥ä¸ºäº†å–æ¶ˆæ­§ä¹‰å¯ä»¥ä½¿ç”¨:&#x3D;æ¥å˜é‡çš„è¿›è¡Œèµ‹å€¼</span><br><span class="line">set @ç”¨æˆ·å˜é‡å:&#x3D;å€¼;</span><br><span class="line"># æ–¹å¼ä¸‰ï¼šå¯ä»¥ä½¿ç”¨selectå…³é”®å­—è¿›è¡Œèµ‹å€¼ï¼Œä½†æ˜¯èµ‹å€¼ç¬¦å·å¿…é¡»ä½¿ç”¨:&#x3D;</span><br><span class="line">select @ç”¨æˆ·å˜é‡å:&#x3D;å€¼;</span><br><span class="line"></span><br><span class="line"># èµ‹å€¼ï¼š</span><br><span class="line"># æ–¹å¼ä¸€ï¼šä¸Šé¢çš„è¯­å¥ä¹Ÿå¯ä»¥ç”¨äºèµ‹å€¼</span><br><span class="line">set @ç”¨æˆ·å˜é‡å&#x3D;å€¼;</span><br><span class="line">set @ç”¨æˆ·å˜é‡å:&#x3D;å€¼;</span><br><span class="line">select @ç”¨æˆ·å˜é‡å:&#x3D;å€¼;</span><br><span class="line"># æ–¹å¼äºŒï¼šä½¿ç”¨select into</span><br><span class="line">select å­—æ®µ into @ç”¨æˆ·å˜é‡å from è¡¨å;</span><br><span class="line">select max(id) into @max_id from emp;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹</span><br><span class="line">select @ç”¨æˆ·å˜é‡å;</span><br><span class="line"></span><br><span class="line"># ä»¥ä¸Šå®šä¹‰çš„éƒ½æ˜¯ç”¨æˆ·å˜é‡</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å±€éƒ¨å˜é‡</span><br><span class="line"># å£°æ˜</span><br><span class="line">declare å˜é‡å ç±»å‹;</span><br><span class="line">declare å˜é‡å ç±»å‹ default å€¼;</span><br><span class="line"></span><br><span class="line"># èµ‹å€¼</span><br><span class="line"># é€šè¿‡setå’Œselectï¼Œå®šä¹‰å±€éƒ¨å˜é‡ä¸éœ€è¦åŠ @ç¬¦</span><br><span class="line">set å±€éƒ¨å˜é‡å&#x3D;å€¼;</span><br><span class="line">set å±€éƒ¨å˜é‡å:&#x3D;å€¼;</span><br><span class="line">select @å±€éƒ¨å˜é‡å:&#x3D;å€¼; # è¿™æ˜¯ç‰¹ä¾‹ï¼Œç”¨selectå…³é”®å­—æ—¶éœ€è¦åŠ @ç¬¦</span><br><span class="line"># é€šè¿‡select into</span><br><span class="line">select å­—æ®µ into å±€éƒ¨å˜é‡å from è¡¨å;</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ æ³¨æ„ï¼š</p><ul><li>ç”¨æˆ·å˜é‡<ul><li>ä½œç”¨äºå½“å‰ä¼šè¯</li></ul></li><li>å±€éƒ¨å˜é‡<ul><li>ä»…ä»…åœ¨å®šä¹‰å®ƒä»¬çš„ begin end ä¸­æœ‰æ•ˆï¼Œä¸”åº”ç”¨åœ¨ begin end ä¸­çš„ç¬¬ä¸€å¥è¯</li></ul></li></ul></blockquote><p><strong>å±€éƒ¨å˜é‡å’Œç”¨æˆ·å˜é‡çš„æ¯”è¾ƒï¼š</strong></p><table><thead><tr><th></th><th>ä½œç”¨åŸŸ</th><th>å®šä¹‰å’Œä½¿ç”¨çš„ä½ç½®</th><th>è¯­æ³•</th></tr></thead><tbody><tr><td>ç”¨æˆ·å˜é‡</td><td>å½“å‰çš„ä¼šè¯ä¸­</td><td>ä¼šè¯ä¸­çš„ä»»ä½•åœ°æ–¹</td><td>å¿…é¡»åŠ @ç¬¦ï¼Œä¸ç”¨é™å®šç±»å‹</td></tr><tr><td>å±€éƒ¨å˜é‡</td><td>begin end ä¸­</td><td>åªèƒ½åœ¨ begin end ä¸­ï¼Œä¸”æ˜¯ begin end ä¸­çš„ç¬¬ä¸€å¥è¯</td><td>ä¸€èˆ¬ä¸éœ€è¦åŠ @ç¬¦ï¼Œéœ€è¦é™å®šç±»å‹</td></tr></tbody></table><hr><h1 id="mysql-çš„å¸¸ç”¨å‘½ä»¤"><a href="#mysql-çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="mysql çš„å¸¸ç”¨å‘½ä»¤"></a>mysql çš„å¸¸ç”¨å‘½ä»¤</h1><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/Pasted%20image%2013.png" alt="./images/Pasted image 13.png"></p><h2 id="ä¿®æ”¹ç»“æŸå­—ç¬¦"><a href="#ä¿®æ”¹ç»“æŸå­—ç¬¦" class="headerlink" title="ä¿®æ”¹ç»“æŸå­—ç¬¦"></a>ä¿®æ”¹ç»“æŸå­—ç¬¦</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹ä¹‹å‰</span><br><span class="line">select * from emp;</span><br><span class="line">delimiter $ # ä¿®æ”¹ç»“æŸå­—ç¬¦ä¸º$</span><br><span class="line"># ä¿®æ”¹ä¹‹å</span><br><span class="line">select * from emp$</span><br></pre></td></tr></table></figure><hr><h1 id="å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°"><a href="#å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°"></a>å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°</h1><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.cnblogs.com/chenhuabin/p/10142190.html">https://www.cnblogs.com/chenhuabin/p/10142190.html</a></p><p><a href="https://blog.csdn.net/Bb15070047748/article/details/106292488">https://blog.csdn.net/Bb15070047748/article/details/106292488</a></p><p>MySQL ä¸­æä¾›å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°æœºåˆ¶ï¼Œæˆ‘ä»¬å§‘ä¸”å°†å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°åˆç§°ä¸ºå­˜å‚¨ç¨‹åºã€‚ä¸ä¸€èˆ¬çš„ SQL è¯­å¥éœ€è¦å…ˆç¼–è¯‘ç„¶åç«‹å³æ‰§è¡Œä¸åŒï¼Œå­˜å‚¨ç¨‹åºæ˜¯ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥é›†ï¼Œç»ç¼–è¯‘åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“ç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨ç¨‹åºçš„åå­—å¹¶ç»™å®šå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨ç¨‹åºå¸¦æœ‰å‚æ•°ï¼‰æ¥è°ƒç”¨æ‰ä¼šæ‰§è¡Œã€‚</p><p>å­˜å‚¨ç¨‹åºå°±æ˜¯ä¸€æ¡æˆ–è€…å¤šæ¡ SQL è¯­å¥å’Œæ§åˆ¶è¯­å¥çš„é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹ä½œ MySQL çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼Œå½“ç„¶ï¼Œå…¶ä½œç”¨ä¸ä»…é™äºæ‰¹å¤„ç†ã€‚å½“æƒ³è¦åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–å¹³å°ä¸Šæ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ä¸€æ®µç¨‹åºæˆ–è€…å°è£…ç‰¹å®šåŠŸèƒ½æ—¶ï¼Œå­˜å‚¨ç¨‹åºæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ•°æ®åº“ä¸­çš„å­˜å‚¨ç¨‹åºå¯ä»¥çœ‹åšæ˜¯é¢å‘å¯¹ç¼–ç¨‹ä¸­é¢å‘å¯¹è±¡æ–¹æ³•ï¼Œå®ƒå…è®¸æ§åˆ¶æ•°æ®çš„è®¿é—®æ–¹å¼ã€‚</p><p>å­˜å‚¨å‡½æ•°ä¸å­˜å‚¨è¿‡ç¨‹æœ‰å¦‚ä¸‹åŒºåˆ«ï¼š</p><p>ï¼ˆ1ï¼‰å­˜å‚¨å‡½æ•°çš„é™åˆ¶æ¯”è¾ƒå¤š,ä¾‹å¦‚ä¸èƒ½ç”¨ä¸´æ—¶è¡¨,åªèƒ½ç”¨è¡¨å˜é‡,è€Œå­˜å‚¨è¿‡ç¨‹çš„é™åˆ¶è¾ƒå°‘ï¼Œå­˜å‚¨è¿‡ç¨‹çš„å®ç°åŠŸèƒ½è¦å¤æ‚äº›,è€Œå‡½æ•°çš„å®ç°åŠŸèƒ½é’ˆå¯¹æ€§æ¯”è¾ƒå¼ºã€‚</p><p>ï¼ˆ2ï¼‰è¿”å›å€¼ä¸åŒã€‚å­˜å‚¨å‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼,ä¸”ä»…è¿”å›ä¸€ä¸ªç»“æœå€¼ï¼›å­˜å‚¨è¿‡ç¨‹å¯ä»¥æ²¡æœ‰è¿”å›å€¼,ä½†æ˜¯èƒ½è¿”å›ç»“æœé›†(out,inout)ã€‚</p><p>ï¼ˆ3ï¼‰è°ƒç”¨æ—¶çš„ä¸åŒã€‚å­˜å‚¨å‡½æ•°åµŒå…¥åœ¨ SQL ä¸­ä½¿ç”¨,å¯ä»¥åœ¨ select å­˜å‚¨å‡½æ•°å(å˜é‡å€¼)ï¼›å­˜å‚¨è¿‡ç¨‹é€šè¿‡ call è¯­å¥è°ƒç”¨ call å­˜å‚¨è¿‡ç¨‹åã€‚</p><p>ï¼ˆ4ï¼‰å‚æ•°çš„ä¸åŒã€‚å­˜å‚¨å‡½æ•°çš„å‚æ•°ç±»å‹ç±»ä¼¼äº IN å‚æ•°ï¼Œæ²¡æœ‰ç±»ä¼¼äº OUT å’Œ INOUT çš„å‚æ•°ã€‚å­˜å‚¨è¿‡ç¨‹çš„å‚æ•°ç±»å‹æœ‰ä¸‰ç§ï¼ŒINã€out å’Œ INOUTï¼š</p><p>a. inï¼šæ•°æ®åªæ˜¯ä»å¤–éƒ¨ä¼ å…¥å†…éƒ¨ä½¿ç”¨(å€¼ä¼ é€’),å¯ä»¥æ˜¯æ•°å€¼ä¹Ÿå¯ä»¥æ˜¯å˜é‡</p><p>b. outï¼šåªå…è®¸è¿‡ç¨‹å†…éƒ¨ä½¿ç”¨(ä¸ç”¨å¤–éƒ¨æ•°æ®),ç»™å¤–éƒ¨ä½¿ç”¨çš„(å¼•ç”¨ä¼ é€’:å¤–éƒ¨çš„æ•°æ®ä¼šè¢«å…ˆæ¸…ç©ºæ‰ä¼šè¿›å…¥åˆ°å†…éƒ¨),åªèƒ½æ˜¯å˜é‡</p><p>c. inoutï¼šå¤–éƒ¨å¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨,å†…éƒ¨ä¿®æ”¹çš„ä¹Ÿå¯ä»¥ç»™å¤–éƒ¨ä½¿ç”¨,å…¸å‹çš„å¼•ç”¨ ä¼ é€’,åªèƒ½ä¼ é€’å˜é‡ã€‚</p><h1 id="3-å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°"><a href="#3-å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°" class="headerlink" title="3 å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°"></a>3 å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°</h1><h2 id="3-1-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#3-1-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3.1 åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>3.1 åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h2><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE  è¿‡ç¨‹å([[IN|OUT|INOUT] å‚æ•°å æ•°æ®ç±»å‹[,[IN|OUT|INOUT] å‚æ•°å æ•°æ®ç±»å‹â€¦]]) [ç‰¹æ€§ ...]</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">    è¿‡ç¨‹ä½“</span><br><span class="line"></span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>â€‹ CREATE PROCEDURE æ˜¯ç”¨æ¥åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„å…³é”®å­—ï¼›[IN|OUT|INOUT]æ˜¯å‚æ•°çš„è¾“å…¥è¾“å‡ºç±»å‹ï¼ŒIN è¡¨ç¤ºè¾“å…¥å‚æ•°ï¼ŒOUT è¡¨ç¤ºè¾“å‡ºå‚æ•°ï¼ŒINOUT è¡¨ç¤ºæ—¢å¯ä»¥è¾“å…¥ä¹Ÿå¯ä»¥è¾“å‡ºï¼›è¿‡ç¨‹ä½“æ˜¯åŒ…å«è‹¥å¹² SQL è¯­å¥æˆ–æµç¨‹æ§åˆ¶è¯­å¥çš„é›†åˆï¼Œå¯ä»¥ç”¨ BEGINâ€¦END æ¥åŒ…è£¹ã€‚</p><p>â€‹ åœ¨æ¼”ç¤ºå¦‚æœåˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä¹‹å‰ï¼ˆemp è¡¨ã€dept è¡¨ï¼‰ï¼Œå…ˆåˆ›å»ºä¸¤ä¸ªæ•°æ®è¡¨ï¼Œæœ¬æ–‡æ‰€æœ‰æ¼”ç¤ºæ“ä½œéƒ½åŸºäºè¿™ä¸¤ä¸ªè¡¨æ¥è¿›è¡Œï¼Œåˆ›å»ºè¡¨ä¸æ’å…¥æ•°æ® SQL è¯­å¥å¦‚ä¸‹ï¼š</p><p><strong>emp è¡¨ï¼š</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219111636619-865486033.png" alt="img"></p><p><img src= "/img/loading.gif" data-lazy-src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img">emp è¡¨ SQL</p><p><strong>dept è¡¨ï¼š</strong></p><p><strong><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219111700940-2040680975.png" alt="img"></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES utf8mb4;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS &#x3D; 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Table structure for dept</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS &#96;dept&#96;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;dept&#96;  (</span><br><span class="line"></span><br><span class="line">  &#96;deptno&#96; int(2) NOT NULL,</span><br><span class="line"></span><br><span class="line">  &#96;dname&#96; varchar(14) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL,</span><br><span class="line"></span><br><span class="line">  &#96;loc&#96; varchar(13) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL,</span><br><span class="line"></span><br><span class="line">  PRIMARY KEY (&#96;deptno&#96;) USING BTREE</span><br><span class="line"></span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; latin1 COLLATE &#x3D; latin1_swedish_ci ROW_FORMAT &#x3D; Compact;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Records of dept</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;dept&#96; VALUES (10, &#39;ACCOUNTING&#39;, &#39;NEW YORK&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;dept&#96; VALUES (20, &#39;RESEARCH&#39;, &#39;DALLAS&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;dept&#96; VALUES (30, &#39;SALES&#39;, &#39;CHICAGO&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;dept&#96; VALUES (40, &#39;OPERATIONS&#39;, &#39;BOSTON&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS &#x3D; 1;</span><br></pre></td></tr></table></figure><p>å»ºå¥½è¡¨åï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong>é€šè¿‡å­˜å‚¨è¿‡ç¨‹å®ŒæˆæŸ¥è¯¢æ¯ä¸ªå‘˜å·¥ç¼–å·ï¼ˆempnoï¼‰ã€å§“åï¼ˆenameï¼‰ã€èŒä½ï¼ˆjobï¼‰ã€é¢†å¯¼ç¼–å·ï¼ˆmgrï¼‰ã€é¢†å¯¼å§“åï¼ˆempnoï¼‰ã€éƒ¨é—¨åç§°ï¼ˆdnameï¼‰ã€éƒ¨é—¨ä½ç½®ï¼ˆlocï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">delimiter &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">create procedure select_pro()</span><br><span class="line"></span><br><span class="line">         begin</span><br><span class="line"></span><br><span class="line">                   select e1.empno bianhao, e1.ename xingming, e1.job zhiwei, e1.mgr lindaobianhao, e2.ename lindaoxingming, d.dname bumenmingchen, ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€d.loc bumenweizhi</span><br><span class="line"></span><br><span class="line">                   from emp e1 , emp e2 , dept d</span><br><span class="line"></span><br><span class="line">                   where e1.mgr&#x3D;e2.empno and e1.deptno&#x3D;d.deptno ;</span><br><span class="line"></span><br><span class="line">         end &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šâ€œdelimiter //â€è¯­å¥çš„ä½œç”¨æ˜¯å°† MySQL çš„ç»“æŸç¬¦è®¾ç½®ä¸º//ï¼Œå› ä¸º MySQL é»˜è®¤çš„è¯­å¥ç»“æŸç¬¦æ˜¯åˆ†å·â€œï¼›â€ï¼Œä¸ºäº†é¿å…ä¸å­˜å‚¨è¿‡ç¨‹ä¸­çš„ SQL è¯­å¥ç»“æŸç¬¦ç›¸å†²çªï¼Œéœ€è¦ä½¿ç”¨ delimiter æ”¹å˜å­˜å‚¨è¿‡ç¨‹çš„ç»“æŸç¬¦ï¼Œè®¾ç½®ä¸ºä»¥â€œend //â€ç»“æŸå­˜å‚¨è¿‡ç¨‹ã€‚å­˜å‚¨è¿‡ç¨‹å®šä¹‰å®Œæ¯•ä¹‹åï¼Œå†ä½¿ç”¨â€œdelimiter;â€å›å¤é»˜è®¤ç»“æŸç¬¦ã€‚delimiter ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–ç¬¦å·ä½œä¸ºç»“æŸç¬¦ï¼ˆâ€œ\â€é™¤å¤–ï¼Œè¿™æ˜¯è½¬ä¹‰å­—ç¬¦ï¼‰ã€‚å½“ç„¶ï¼Œå¦‚æœä½ åœ¨ Navicat ç­‰å›¾å½¢ç•Œé¢ä¸‹è¿›è¡Œï¼Œå¯ä»¥ä¸ç”¨è®¾ç½® delimiterã€‚</p><p>ç¤ºä¾‹ 1 ä¸­ SQL è¯­å¥åˆ›å»ºäº†ä¸€ä¸ªåä¸º select_pro çš„å­˜å‚¨è¿‡ç¨‹ï¼Œé€šè¿‡â€œcall select_pro()â€ï¼Œå³å¯å®ŒæˆæŸ¥è¯¢åŠŸèƒ½ï¼Œä¸åœ¨éœ€è¦æ¯æ¬¡æŸ¥è¯¢éƒ½é‡å†™æŸ¥è¯¢è¯­å¥ã€‚</p><p><strong>ç¤ºä¾‹ 2ï¼š</strong>åˆ›å»ºä¸€ä¸ªå¸¦å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ é™¤ emp è¡¨ä¸­ empno ä¸ºæŒ‡å®šå€¼å¾—è®°å½•ï¼Œå¹¶è¿”å›æœ€é«˜æœ€é«˜æœˆè–ªï¼Œä¹Ÿè¿”å›å¤§äºæŒ‡å®šæœˆè–ªçš„äººæ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">delimiter &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">create procedure param_pro(in id int , out num int, inout p_sal int)</span><br><span class="line"></span><br><span class="line">         begin</span><br><span class="line"></span><br><span class="line">                   delete from emp where empno &#x3D; id ;</span><br><span class="line"></span><br><span class="line">                   select max(sal) from emp into num;</span><br><span class="line"></span><br><span class="line">                   select count(*)  into p_sal from emp where sal &gt;P_sal ;</span><br><span class="line"></span><br><span class="line">         end &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ä¸Šé¢åˆ›å»ºå¥½çš„å­˜å‚¨è¿‡ç¨‹ param_proï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set @p_sal &#x3D; 1250 ;</span><br><span class="line"></span><br><span class="line">call param_pro(7369 , @num , @p_sal);</span><br><span class="line"></span><br><span class="line">select @num , @p_sal ;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219111727122-382478754.png" alt="img"></p><p>æŸ¥çœ‹ emp è¡¨ï¼Œä¹Ÿå‘ç° empno ä¸º 7369 çš„è®°å½•ç¡®å®è¢«åˆ é™¤ã€‚</p><p>å°†æŸ¥è¯¢ç»“æœèµ‹å€¼ç»™å˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ into å…³é”®å­—ï¼Œæ—¢å¯ä»¥åœ¨ select å­å¥æœ«å°¾å†™ into å…³é”®å­—ï¼Œä¹Ÿå¯ä»¥åœ¨å€¼åé¢å†™ into è¯­å¥ã€‚</p><h2 id="3-2-åˆ›å»ºå­˜å‚¨å‡½æ•°"><a href="#3-2-åˆ›å»ºå­˜å‚¨å‡½æ•°" class="headerlink" title="3.2 åˆ›å»ºå­˜å‚¨å‡½æ•°"></a>3.2 åˆ›å»ºå­˜å‚¨å‡½æ•°</h2><p>è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION  å‡½æ•°å([ å‚æ•°å æ•°æ®ç±»å‹ [, â€¦]]) RETURNSè¿”å›ç±»å‹</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">ã€€ã€€è¿‡ç¨‹ä½“</span><br><span class="line"></span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>å­˜å‚¨è¿‡ç¨‹ä¸å­˜å‚¨å‡½æ•°ä¸€ä¸ªå¾ˆå¤§çš„ä¸åŒå°±æ˜¯åˆ¶å®šå‚æ•° INã€OUTã€INOUT åªå¯¹å­˜å‚¨è¿‡ç¨‹æœ‰ç”¨ï¼Œå­˜å‚¨å‡½æ•°é»˜è®¤ IN ç±»å‹å‚æ•°ï¼Œä¸èƒ½è®¾ç½®å…¶ä»–ä¸¤ç§ç±»å‹ã€‚RETURNS å­å¥å£°æ˜è¿”å›å€¼ç±»å‹ä¹Ÿåªèƒ½åœ¨å­˜å‚¨å‡½æ•°ä¸­ä½¿ç”¨ï¼Œä¸”ä¸€ä¸ªå­˜å‚¨å‡½æ•°å¿…é¡»åŒ…å«ä¸€ä¸ª RETURNS è¯­å¥ã€‚</p><p><strong>ç¤ºä¾‹ 3ï¼š</strong>ç”¨å­˜å‚¨å‡½æ•°æŸ¥è¯¢æŒ‡å®š empno çš„å‘˜å·¥çš„æœˆè–ª sal</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">create function fun1(id int) returns int</span><br><span class="line"></span><br><span class="line">         begin</span><br><span class="line"></span><br><span class="line">                   return (select sal from emp where empno&#x3D;id);</span><br><span class="line"></span><br><span class="line">         end &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨å­˜å‚¨å‡½æ•° fun1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select fun1(7698)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219111905427-256074913.png" alt="img"></p><h2 id="3-3-ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#3-3-ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="3.3 ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>3.3 ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h2><p>ä½¿ç”¨ ALTER è¯­å¥å¯ä»¥ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ç‰¹æ€§ã€‚è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER &#123;PROCEDURE | FUNCTION&#125; sp_name [characteristic â€¦]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œsp_name è¡¨ç¤ºå­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„åç§°ï¼Œcharacteristic å‚æ•°æŒ‡å®šå­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„ç‰¹æ€§ï¼Œå¯èƒ½å–å€¼æœ‰ï¼š</p><p>CONTAINS SQL:å­ç¨‹åºåŒ…å« SQL è¯­å¥ï¼Œä½†ä¸åŒ…å«è¯»æˆ–å†™æ•°æ®çš„è¯­å¥ã€‚</p><p>NO SQLï¼šå­ç¨‹åºä¸åŒ…å« SQL è¯­å¥ã€‚</p><p>READS SQL DATAï¼šå­ç¨‹åºåŒ…å«è¯»æ•°æ®çš„è¯­å¥ã€‚</p><p>MODIFIES SQL DATAï¼šå­ç¨‹åºåŒ…å«å†™æ•°æ®çš„è¯­å¥ã€‚</p><p>SQL SECURITY { DEFINER | INVOKER}ï¼šæŒ‡æ˜è°æœ‰æƒé™æ‰§è¡Œã€‚</p><p>DEFINERï¼šåªæœ‰å®šä¹‰è€…è‡ªå·±æ‰èƒ½æ‰§è¡Œã€‚</p><p>INVOKERï¼šè°ƒç”¨è€…å¯ä»¥æ‰§è¡Œã€‚</p><p>COMMENT â€˜stringâ€™ ï¼šæ³¨é‡Šã€‚</p><p><strong>ç¤ºä¾‹ 4</strong>ï¼šç¤ºä¾‹ 1 ä¸­åˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹ param_proï¼Œå°†å…¶è¯»å†™æƒé™è¯¥ä¸º MODIFIES SQL DATAï¼Œå¹¶æŒ‡æ˜è°ƒç”¨è€…å¯ä»¥æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER PROCEDURE param_pro</span><br><span class="line"></span><br><span class="line">MODIFIES SQL DATA</span><br><span class="line"></span><br><span class="line">SQL SECURITY INVOKER ;</span><br></pre></td></tr></table></figure><h1 id="4-æµç¨‹æ§åˆ¶è¯­å¥"><a href="#4-æµç¨‹æ§åˆ¶è¯­å¥" class="headerlink" title="4 æµç¨‹æ§åˆ¶è¯­å¥"></a>4 æµç¨‹æ§åˆ¶è¯­å¥</h1><p>MySQL ä¸­ç”¨æ¥æ„é€ æµç¨‹æ§åˆ¶è¯­å¥çš„æœ‰ï¼šIF è¯­å¥ã€CASE è¯­å¥ã€LOOP è¯­å¥ã€LEAVE è¯­å¥ã€ITERATE è¯­å¥ã€REPEAT è¯­å¥å’Œ WHILE è¯­å¥ã€‚æ¯ä¸€ä¸ªæµç¨‹ä¸­å¯èƒ½åŒ…å«ä¸€ä¸ªå•ç‹¬çš„è¯­å¥ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ BEGINâ€¦END æ„é€ å¤æ‚è¯­å¥ï¼Œæ„é€ å¯ä»¥è¢«åµŒå¥—ã€‚</p><p><strong>ï¼ˆ1ï¼‰IF è¯­å¥</strong></p><p>IF è¯­å¥åŒ…å«å¤šä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œæ ¹æ®åˆ¤æ–­ç»“æœä¸º TRUE æˆ– FALSE æ¥æ‰§è¡Œç›¸åº”çš„è¯­å¥ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF expr_condition THEN statement_list</span><br><span class="line"></span><br><span class="line">[ELSEIF expr_condition THEN statement_list]</span><br><span class="line"></span><br><span class="line">[ELSE statement_list]</span><br><span class="line"></span><br><span class="line">END IF</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šæ‰€ä»¥ IF è¯­å¥éƒ½éœ€è¦ç”¨ END IF æ¥ç»“æŸï¼Œåœ¨ THEN ä¸­æ‰§è¡Œï¼ŒELSEIF å’Œ ELSE æ˜¯å¯é€‰çš„ã€‚</strong></p><p><strong>ç¤ºä¾‹ 5ï¼š</strong>æœ‰ä¸€ä¸ªå˜é‡ valï¼Œåˆ¤æ–­å˜é‡å€¼æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œè¾“å‡ºâ€œval is NULLâ€ï¼›å¦åˆ™è¾“å‡ºâ€œval is not NULLâ€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF val IS NULL</span><br><span class="line"></span><br><span class="line">         THEN SELECT â€˜val is NULLâ€™ ;</span><br><span class="line"></span><br><span class="line">         ELSE SELECT â€˜val is not NULLâ€™ ;</span><br><span class="line"></span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰CASE è¯­å¥</strong></p><p>CASE æ˜¯å¦ä¸€ç§æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼Œè¯¥è¯­å¥æœ‰ä¸¤ç§æ ¼å¼ï¼Œç¬¬ä¸€ç§æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CASE case_expr</span><br><span class="line"></span><br><span class="line">WHEN when_value THEN statement_list</span><br><span class="line"></span><br><span class="line">[WHEN when_value THEN statement_list]â€¦â€¦</span><br><span class="line"></span><br><span class="line">[ELSE statement_list]</span><br><span class="line"></span><br><span class="line">END CASE</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><p>case_exprï¼Œè¡¨ç¤ºæ¡ä»¶åˆ¤æ–­çš„è¡¨è¾¾å¼ï¼Œå†³å®šäº†å“ªä¸€ä¸ª WHEN è‡ªå·±ä¼šè¢«æ‰§è¡Œ</p><p>When_valueï¼Œè¡¨ç¤ºè¡¨è¾¾å¼å¯èƒ½çš„å€¼ï¼Œå¦‚æœï¼ŒæŸä¸ª when_value è¡¨è¾¾å¼ä¸ case_expr è¡¨è¾¾å¼ç»“æœç›¸åŒï¼Œåˆ™æ‰§è¡Œå¯¹åº” THEN å…³é”®å­—åçš„ statement ä¸­çš„è¯­å¥</p><p>Statement_listï¼Œè¡¨ç¤ºä¸åŒ when_value å€¼çš„æ‰§è¡Œè¯­å¥</p><p><strong>ç¤ºä¾‹ 6ï¼š</strong>ä½¿ç”¨ CASE æµç¨‹æ§åˆ¶è¯­å¥çš„ç¬¬ä¸€ç§æ ¼å¼ï¼Œåˆ¤æ–­ val å€¼ï¼Œè‹¥ç­‰äº 1 åˆ™è¾“å‡ºâ€˜val is 1â€™ ï¼Œ è‹¥ç­‰äº 2 åˆ™è¾“å‡ºâ€˜val is 2â€™ï¼Œæˆ–è€…ä¸¤è€…éƒ½ä¸ç­‰äºåˆ™è¾“å‡ºâ€˜val is not 1 or 2â€™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CASE val</span><br><span class="line"></span><br><span class="line">WHEN 1 THEN SELECT â€˜val is 1â€™;</span><br><span class="line"></span><br><span class="line">WHEN 2 THEN SELECT â€˜val is 2â€™;</span><br><span class="line"></span><br><span class="line">ELSE SELECT â€˜val is not 1 or 2â€™;</span><br><span class="line"></span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure><p>CASE è¯­å¥çš„ç¬¬äºŒç§æ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line"></span><br><span class="line">ã€€ã€€WHEN expr_condition THEN statement_list</span><br><span class="line"></span><br><span class="line">ã€€ã€€[WHEN expr_condition THEN statement_list]</span><br><span class="line"></span><br><span class="line">ã€€ã€€[ELSE statement_list]</span><br><span class="line"></span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 7ï¼š</strong>ä½¿ç”¨ CASE æµç¨‹æ§åˆ¶è¯­å¥çš„ç¬¬äºŒç§æ ¼å¼åˆ¤æ–­å˜é‡ val æ˜¯å¦ä¸ºç©ºï¼Œå°äºé›¶ã€å¤§äºé›¶ã€ç­‰äºé›¶ï¼Œå¹¶ä½œå¯¹åº”çš„è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line"></span><br><span class="line">         WHEN val is NULL THEN SELECT â€˜val is NULLâ€™ ;</span><br><span class="line"></span><br><span class="line">         WHEN val &lt; 0 THEN SELECT â€˜val is less than 0â€™ ;</span><br><span class="line"></span><br><span class="line">         WHEN val &gt; 0 THEN SELECT â€˜val is greater than 0â€™ ;</span><br><span class="line"></span><br><span class="line">         ELSE SELECT â€˜val is 0â€™ ;</span><br><span class="line"></span><br><span class="line">END CASE ;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼Œè¿™é‡Œå­˜å‚¨è¿‡ç¨‹ä¸­çš„ CASE è¯­å¥ï¼Œä¸æ§åˆ¶æµç¨‹å‡½æ•°ä¸­çš„ SQL CASE è¡¨è¾¾å¼ä¸­çš„ CASE æ˜¯ä¸åŒçš„ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸­ï¼ŒCASE è¯­å¥ä¸èƒ½æœ‰ ELSE NULL å­å¥ï¼Œå¹¶ä¸”ç”¨ END CASE ä»£æ›¿ END æ¥ç»ˆæ­¢ã€‚</strong></p><p><strong>ï¼ˆ3ï¼‰ LOOP è¯­å¥ä¸ LEAVE è¯­å¥</strong></p><p>LOOP è¯­å¥å¾ªç¯è¯­å¥ç”¨æ¥é‡å¤æ‰§è¡ŒæŸäº›è¯­å¥ï¼Œä¸ IF å’Œ CASE è¯­å¥ç›¸æ¯”ï¼ŒLOOP åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¾ªç¯æ“ä½œè¿‡ç¨‹ï¼Œå¹¶ä¸è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚LOOP å†…çš„è¯­å¥ä¸€ç›´è¢«é‡å¤æ‰§è¡Œç›´åˆ°å¾ªç¯è¢«é€€å‡ºï¼Œè·³å‡ºå¾ªç¯ä½¿ç”¨çš„æ˜¯ LEAVE å­å¥ï¼ŒLOOP è¯­å¥åŸºæœ¬è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[loop_label:] LOOP</span><br><span class="line"></span><br><span class="line">         statement_list</span><br><span class="line"></span><br><span class="line">END LOOP [lop_label]</span><br></pre></td></tr></table></figure><p>loop_label è¡¨ç¤º LOOP è¯­å¥çš„æ ‡æ³¨åç§°ï¼Œè¯¥å‚æ•°å¯ä»¥çœç•¥ã€‚statement_list å‚æ•°è¡¨ç¤ºå¾ªç¯æ‰§è¡Œçš„è¯­å¥ã€‚</p><p><strong>ç¤ºä¾‹ 8ï¼š</strong>å®šä¹‰ä¸€ä¸ªå˜é‡ idï¼Œåˆå§‹å€¼ä¸º 0ï¼Œå¾ªç¯æ‰§è¡Œ id åŠ  1 çš„æ“ä½œ ï¼Œå½“ id å€¼å°äº 10 æ—¶ï¼Œå¾ªç¯é‡å¤æ‰§è¡Œï¼Œå½“ id å€¼å¤§äºæˆ–è€…ç­‰äº 10 æ—¶ï¼Œä½¿ç”¨ LEAVE è¯­å¥é€€å‡ºå¾ªç¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DECLARE id INT DEFAULT 0;</span><br><span class="line"></span><br><span class="line">Add_loop:LOOP</span><br><span class="line"></span><br><span class="line">SET id&#x3D;id+1;</span><br><span class="line"></span><br><span class="line">IF id&gt;&#x3D;10 THEN LEAVE add_loop;</span><br><span class="line"></span><br><span class="line">END IF;</span><br><span class="line"></span><br><span class="line">END LOOP add_loop;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ4ï¼‰ITERATE è¯­å¥</strong></p><p>ITERATE è¯­å¥ç”¨äºå°†æ‰§è¡Œé¡ºåºè½¬åˆ°è¯­å¥æ®µçš„å¼€å¤´å¤„ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€€ã€€ITERATE lable</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œlableï¼Œè¡¨ç¤ºå¾ªç¯çš„æ ‡å¿—.æ³¨æ„ï¼ŒITERATE è¯­å¥åªå¯ä»¥å‡ºç°åœ¨ï¼ŒLOOPã€REPEAT å’Œ WHILE è¯­å¥ä¸­ã€‚ITERATE çš„ä½œç”¨ç±»ä¼¼äº Java å’Œ Python ä¸­çš„ continue å…³é”®å­—ã€‚</p><p><strong>ç¤ºä¾‹ 9ï¼š</strong>p1 çš„åˆå§‹å€¼ä¸º 0ï¼Œå¦‚æœï¼Œp1 çš„å€¼å°äº 10 æ—¶ï¼Œé‡å¤æ‰§è¡Œ p1 åŠ  1 çš„æ“ä½œï¼Œå½“ p1 å¤§äºæˆ–ç­‰äº 10ï¼Œå¹¶ä¸”å°äº 20 æ—¶ï¼Œæ‰“å°æ¶ˆæ¯ p1 is between 10 and 20ï¼Œå½“ p1 å¤§äº 20 æ—¶ï¼Œé€€å‡ºå¾ªç¯</p><p>æ¼”ç¤º ITERATE è¯­å¥ï¼Œåœ¨ LOOP è¯­å¥å†…çš„ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE doiterate()</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">    DECLARE p1 INT DEFAULT 0;</span><br><span class="line"></span><br><span class="line">    my_loop:LOOP</span><br><span class="line"></span><br><span class="line">        SET p1&#x3D;p1+1;</span><br><span class="line"></span><br><span class="line">        IF p1&lt;10 THEN ITERATE my_loop;</span><br><span class="line"></span><br><span class="line">        ELSEIF p1&gt;20 THEN LEAVE my_loop;</span><br><span class="line"></span><br><span class="line">        END IF;</span><br><span class="line"></span><br><span class="line">        SELECT â€˜p1 is between 10 and 20â€™;</span><br><span class="line"></span><br><span class="line">    END LOOP my_loop;</span><br><span class="line"></span><br><span class="line">END</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ5ï¼‰REPEAT è¯­å¥</strong></p><p>REPEAT è¯­å¥ç”¨äºåˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ¡ä»¶åˆ¤æ–­çš„å¾ªç¯è¿‡ç¨‹ï¼Œæ¯æ¬¡è¯­å¥æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šå¯¹æ¡ä»¶è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™å¾ªç¯ç»“æŸï¼Œå¦åˆ™ï¼Œé‡å¤æ‰§è¡Œå¾ªç¯ä¸­çš„è¯­å¥ã€‚è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[repeat_lable:] REPEAT</span><br><span class="line"></span><br><span class="line">statement_list</span><br><span class="line"></span><br><span class="line">UNTIL expr_condition</span><br><span class="line"></span><br><span class="line">END REPEAT [repeat_lable]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œrepeat_lableï¼Œä¸º REPEAT è¯­å¥çš„æ ‡æ³¨åç§°ï¼Œè¯¥å‚æ•°æ˜¯å¯é€‰çš„ï¼ŒREPEAT è¯­å¥å†…çš„è¯­å¥ï¼Œæˆ–è¯­å¥ç¾¤è¢«é‡å¤ï¼Œç›´è‡³ expr_condition ä¸ºçœŸã€‚</p><p><strong>ç¤ºä¾‹ 10ï¼š</strong>id å€¼å°äº 10 å‰ï¼Œé‡å¤å¾ªç¯è®© id å€¼åŠ  1ï¼Œä½¿ç”¨ REPEAT è¯­å¥ï¼Œæ‰§è¡Œå¾ªç¯è¿‡ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DECLARE id INT DEFAULT 0;</span><br><span class="line"></span><br><span class="line">REPEAT</span><br><span class="line"></span><br><span class="line">    SET id&#x3D;id+1;</span><br><span class="line"></span><br><span class="line">    UNTIL id&gt;&#x3D;10;</span><br><span class="line"></span><br><span class="line">END REPEAT;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ6ï¼‰WHILE è¯­å¥</strong></p><p>WHILE è¯­å¥åˆ›å»ºä¸€ä¸ªå¸¦æ¡ä»¶åˆ¤æ–­çš„å¾ªç¯è¿‡ç¨‹ ä¸ REPEAT ä¸åŒçš„æ˜¯ï¼ŒWHILE åœ¨è¯­å¥æ‰§è¡Œæ—¶ï¼Œå…ˆå¯¹æŒ‡å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™æ‰§è¡Œå¾ªç¯å†…çš„è¯­å¥ï¼Œå¦åˆ™é€€å‡ºå¾ªç¯ã€‚è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[while_lable:] WHILE expr_condition DO</span><br><span class="line"></span><br><span class="line">ã€€ã€€Statement_list</span><br><span class="line"></span><br><span class="line">END WHILE [while_lable]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œwhile_lable ä¸º WHILE è¯­å¥çš„æ ‡æ³¨åç§°ï¼ŒExpr_conditionï¼Œä¸ºè¿›è¡Œåˆ¤æ–­çš„è¡¨è¾¾å¼ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼ŒWHILE è¯­å¥å†…çš„è¯­å¥ï¼Œæˆ–è¯­å¥ç¾¤å°±è¢«æ‰§è¡Œï¼Œç›´è‡³ expr_condition ä¸ºå‡ï¼Œé€€å‡ºå¾ªç¯ã€‚</p><p><strong>ç¤ºä¾‹ 11ï¼š</strong>åˆ›å»ºä¸€ä¸ªå˜é‡ iï¼Œåˆå§‹å€¼ä¸º 0ï¼Œå½“ i å°äº 10 æ—¶é‡å¤æ‰§è¡ŒåŠ  1ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line"></span><br><span class="line">WHILE i&lt;10 DO</span><br><span class="line"></span><br><span class="line">ã€€ã€€SET i&#x3D;i+1;</span><br><span class="line"></span><br><span class="line">END WHILE;</span><br></pre></td></tr></table></figure><h1 id="5-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#5-æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="5 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>5 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h1><p><strong>ï¼ˆ1ï¼‰ ä½¿ç”¨ SHOW STATUS è¯­å¥æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„çŠ¶æ€</strong></p><p>SHOW STATUS è¯­å¥å¯ä»¥æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„çŠ¶æ€ï¼Œå…¶åŸºæœ¬è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW &#123;PROCEDURE | FUNCTION&#125; STATUS [LIKE â€˜patternâ€™]</span><br></pre></td></tr></table></figure><p>è¯­æ³•ç»“æ„ä¸­ï¼Œä½¿ç”¨ LIKE è¯­å¥è¡¨ç¤ºåŒ¹é…å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„åç§°ã€‚</p><p><strong>ç¤ºä¾‹ 12ï¼š</strong>æŸ¥çœ‹ç¤ºä¾‹ 2 ä¸­åˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW PROCEDURE STATUS LIKE â€˜param_proâ€™ ;</span><br></pre></td></tr></table></figure><p>éƒ¨åˆ†è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219112657060-649815465.png" alt="img"></p><p><strong>ï¼ˆ2ï¼‰ä½¿ç”¨ SHOW CREATE è¯­å¥æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„å®šä¹‰</strong></p><p>SHOW CREATE è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE &#123;PROCEDURE | FUNCTION&#125; sp_name</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 13ï¼š</strong>æŸ¥çœ‹ç¤ºä¾‹ 3 ä¸­åˆ›å»ºçš„å­˜å‚¨å‡½æ•°ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE FUNCTION fun1;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219112810628-1130016802.png" alt="img"></p><p><strong>ï¼ˆ3ï¼‰ä» information_schema.Routines è¡¨ä¸­æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¿¡æ¯</strong></p><p>MySQL ä¸­çš„å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯å­˜å‚¨åœ¨ information_schema.Routines è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨ä¸­çš„è®°å½•æ¥æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯ã€‚</p><p><strong>ç¤ºä¾‹ 14ï¼š</strong>ä» Routines è¡¨ä¸­æŸ¥çœ‹å½¢æˆä¸º param_pro çš„å­˜å‚¨è¿‡ç¨‹ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM information_schema.Routines WHERE ROUTINE_NAME &#x3D; &#39;param_pro&#39; AND ROUTINE_TYPE&#x3D;&#39;PROCEDURE&#39; ;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1539768-20181219112856845-1941699294.png" alt="img"></p><h1 id="6-åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#6-åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="6 åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>6 åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h1><p>åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å¯ä»¥ä½¿ç”¨ DROP è¯­å¥ï¼Œå…¶è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP &#123;PROCEDURE | FUNCTION &#125; [IF EXISTS] sp_name</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 15ï¼š</strong>åˆ é™¤å­˜å‚¨è¿‡ç¨‹ select_pro å’Œå­˜å‚¨å‡½æ•° fun1ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE  IF EXISTS  select_pro ;</span><br><span class="line"></span><br><span class="line">DROP FUNCTION IF EXISTS fun1 ;</span><br></pre></td></tr></table></figure><hr><h1 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h1><blockquote><p>è§†å›¾æ˜¯ä¸€å¼ è™šæ‹Ÿçš„è¡¨ï¼Œå®ƒå®é™…å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ¥æºäºå‚¨å­˜çš„ sql é€»è¾‘ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºè§†å›¾å°±æ˜¯å°†æ•°æ®ä»ç‰©ç†è¡¨ä¸­æŸ¥è¯¢å‡ºæ¥å†è¿›è¡ŒäºŒæ¬¡æ“ä½œ</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/891080852_44349.jpg" alt="img"></p></blockquote><h2 id="è§†å›¾åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤"><a href="#è§†å›¾åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤" class="headerlink" title="è§†å›¾åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤"></a>è§†å›¾åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</h2><h3 id="åˆ›å»ºè§†å›¾"><a href="#åˆ›å»ºè§†å›¾" class="headerlink" title="åˆ›å»ºè§†å›¾"></a>åˆ›å»ºè§†å›¾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">è¯­æ³•ï¼šcreate view è§†å›¾å as sqlè¯­å¥;</span><br><span class="line">*&#x2F;</span><br><span class="line">create view emp_v1</span><br><span class="line">as</span><br><span class="line">select * from emp;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹è§†å›¾"><a href="#ä¿®æ”¹è§†å›¾" class="headerlink" title="ä¿®æ”¹è§†å›¾"></a>ä¿®æ”¹è§†å›¾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹æ³•ä¸€ï¼š</span><br><span class="line">create or replace view è§†å›¾åç§° as sqlè¯­å¥</span><br><span class="line"># æ–¹æ³•äºŒï¼š</span><br><span class="line">alter view è§†å›¾åç§° as sqlè¯­å¥</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤è§†å›¾"><a href="#åˆ é™¤è§†å›¾" class="headerlink" title="åˆ é™¤è§†å›¾"></a>åˆ é™¤è§†å›¾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># è¯­æ³•ï¼šdrop view è§†å›¾å1,è§†å›¾å2...;</span><br><span class="line">drop view emp_v1;</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°è§†å›¾"><a href="#æ›´æ–°è§†å›¾" class="headerlink" title="æ›´æ–°è§†å›¾"></a>æ›´æ–°è§†å›¾</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># è™½ç„¶è¯´è§†å›¾å¹¶æ²¡æœ‰å­˜å‚¨å®é™…çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è§†å›¾å»ä¿®æ”¹ç‰©ç†è¡¨ä¸­çš„æ•°æ®ï¼ˆéƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥ï¼‰</span><br><span class="line">create view emp_v1</span><br><span class="line">as</span><br><span class="line">select * from emp;</span><br><span class="line"></span><br><span class="line"># è§†å›¾ä¸­æ•°æ®çš„æ›´æ–°å’Œæ›´æ–°ç‰©ç†è¡¨ä¸­çš„æ•°æ®çš„è¯­æ³•æ˜¯ä¸€æ ·çš„</span><br><span class="line">insert into emp_v1 values(1, &#39;qaq&#39;);</span><br><span class="line">update emp_v1 set name &#x3D; &#39;qwq&#39; where id &#x3D; 1;</span><br><span class="line">delete from emp_v1 where id &#x3D; 1;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¯´åˆ°åªæœ‰<strong>éƒ¨åˆ†æƒ…å†µ</strong>ä¸‹å¯ä»¥é€šè¿‡è§†å›¾æ›´æ”¹ç‰©ç†è¡¨çš„æ•°æ®</p><p>å…¶ä¸­ä»¥ä¸‹ç¬¦åˆæ¡ä»¶çš„è§†å›¾éƒ½æ˜¯<strong>ä¸å…è®¸æ›´æ–°</strong>çš„</p><ul><li><p>åŒ…å«ä»¥ä¸‹å…³é”®å­—çš„ sql è¯­å¥:åˆ†ç»„å‡½æ•°ã€distinctã€group byã€havingã€union æˆ–è€… union all</p><ul><li>```mysql<h1 id="ä»¥åˆ†ç»„å‡½æ•°ä¸¾ä¾‹"><a href="#ä»¥åˆ†ç»„å‡½æ•°ä¸¾ä¾‹" class="headerlink" title="ä»¥åˆ†ç»„å‡½æ•°ä¸¾ä¾‹"></a>ä»¥åˆ†ç»„å‡½æ•°ä¸¾ä¾‹</h1>create view emp_max<br>as<br>select max(id) from emp;<h1 id="ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åªæœ‰ä¸€ä¸ªåˆ—ä¸ºidæœ€å¤§çš„è§†å›¾ï¼Œä»¥è¿™ä¸ªä¸ºä¾‹å¦‚æœä¿®æ”¹è¿™ä¸ªè§†å›¾çš„è¯æ˜¯ä¸æˆåŠŸçš„"><a href="#ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åªæœ‰ä¸€ä¸ªåˆ—ä¸ºidæœ€å¤§çš„è§†å›¾ï¼Œä»¥è¿™ä¸ªä¸ºä¾‹å¦‚æœä¿®æ”¹è¿™ä¸ªè§†å›¾çš„è¯æ˜¯ä¸æˆåŠŸçš„" class="headerlink" title="ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åªæœ‰ä¸€ä¸ªåˆ—ä¸ºidæœ€å¤§çš„è§†å›¾ï¼Œä»¥è¿™ä¸ªä¸ºä¾‹å¦‚æœä¿®æ”¹è¿™ä¸ªè§†å›¾çš„è¯æ˜¯ä¸æˆåŠŸçš„"></a>ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åªæœ‰ä¸€ä¸ªåˆ—ä¸ºidæœ€å¤§çš„è§†å›¾ï¼Œä»¥è¿™ä¸ªä¸ºä¾‹å¦‚æœä¿®æ”¹è¿™ä¸ªè§†å›¾çš„è¯æ˜¯ä¸æˆåŠŸçš„</h1><h1 id="å› ä¸ºè¿™ä¸ªè§†å›¾ä¸­çš„åˆ—åä¸ºmax-id-å€¼ä¸ºempè¡¨ä¸­idæœ€å¤§çš„å€¼ï¼Œè¿™æ ·å»ä¿®æ”¹çš„è¯mysqlæ˜¯ä¸èƒ½çŸ¥é“è¦ä¿®æ”¹çš„å…·ä½“çš„ç‰©ç†æ•°æ®æ˜¯å•¥ï¼Œæ‰€ä»¥ä¸è¡Œ"><a href="#å› ä¸ºè¿™ä¸ªè§†å›¾ä¸­çš„åˆ—åä¸ºmax-id-å€¼ä¸ºempè¡¨ä¸­idæœ€å¤§çš„å€¼ï¼Œè¿™æ ·å»ä¿®æ”¹çš„è¯mysqlæ˜¯ä¸èƒ½çŸ¥é“è¦ä¿®æ”¹çš„å…·ä½“çš„ç‰©ç†æ•°æ®æ˜¯å•¥ï¼Œæ‰€ä»¥ä¸è¡Œ" class="headerlink" title="å› ä¸ºè¿™ä¸ªè§†å›¾ä¸­çš„åˆ—åä¸ºmax(id)å€¼ä¸ºempè¡¨ä¸­idæœ€å¤§çš„å€¼ï¼Œè¿™æ ·å»ä¿®æ”¹çš„è¯mysqlæ˜¯ä¸èƒ½çŸ¥é“è¦ä¿®æ”¹çš„å…·ä½“çš„ç‰©ç†æ•°æ®æ˜¯å•¥ï¼Œæ‰€ä»¥ä¸è¡Œ"></a>å› ä¸ºè¿™ä¸ªè§†å›¾ä¸­çš„åˆ—åä¸ºmax(id)å€¼ä¸ºempè¡¨ä¸­idæœ€å¤§çš„å€¼ï¼Œè¿™æ ·å»ä¿®æ”¹çš„è¯mysqlæ˜¯ä¸èƒ½çŸ¥é“è¦ä¿®æ”¹çš„å…·ä½“çš„ç‰©ç†æ•°æ®æ˜¯å•¥ï¼Œæ‰€ä»¥ä¸è¡Œ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- å¸¸é‡è§†å›¾</span><br><span class="line"></span><br><span class="line">  - å¸¸é‡ä½ ä¿®æ”¹ä¸ªå•¥</span><br><span class="line"></span><br><span class="line">- Select ä¸­åŒ…åˆå­æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;mysql</span><br><span class="line">    create view emp_v1</span><br><span class="line">    as</span><br><span class="line">    select (select id from emp where name &#x3D; &#39;qwq&#39;) as id;</span><br><span class="line">    # è‡ªå·±æƒ³æƒ³å¦‚æœä½ æ˜¯mysqlä½ æ€ä¹ˆçŸ¥é“ä½ è¦é€šè¿‡è¿™ä¸ªè§†å›¾ä¿®æ”¹å•¥æ•°æ®ï¼Ÿ</span><br></pre></td></tr></table></figure></li></ul></li><li><p>joinï¼Œå¤šè¡¨</p><ul><li>```mysql<br>create view emp_v1<br>as<br>select a.id, b.name from a left join b on a.id = b.id;<h1 id="è¿™ä¸ªè§†å›¾å¯ä»¥ä¿®æ”¹-update-ä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œæ·»åŠ "><a href="#è¿™ä¸ªè§†å›¾å¯ä»¥ä¿®æ”¹-update-ä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œæ·»åŠ " class="headerlink" title="è¿™ä¸ªè§†å›¾å¯ä»¥ä¿®æ”¹(update)ä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œæ·»åŠ "></a>è¿™ä¸ªè§†å›¾å¯ä»¥ä¿®æ”¹(update)ä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œæ·»åŠ </h1><h1 id="å› ä¸ºè¿™æ˜¯ä¸¤å¼ è¡¨ï¼Œmysqlæ€ä¹ˆçŸ¥é“ä½ æ˜¯åˆ é™¤çš„é‚£å¼ è¡¨ï¼Œæ·»åŠ çš„åˆæ˜¯é‚£å¼ è¡¨"><a href="#å› ä¸ºè¿™æ˜¯ä¸¤å¼ è¡¨ï¼Œmysqlæ€ä¹ˆçŸ¥é“ä½ æ˜¯åˆ é™¤çš„é‚£å¼ è¡¨ï¼Œæ·»åŠ çš„åˆæ˜¯é‚£å¼ è¡¨" class="headerlink" title="å› ä¸ºè¿™æ˜¯ä¸¤å¼ è¡¨ï¼Œmysqlæ€ä¹ˆçŸ¥é“ä½ æ˜¯åˆ é™¤çš„é‚£å¼ è¡¨ï¼Œæ·»åŠ çš„åˆæ˜¯é‚£å¼ è¡¨"></a>å› ä¸ºè¿™æ˜¯ä¸¤å¼ è¡¨ï¼Œmysqlæ€ä¹ˆçŸ¥é“ä½ æ˜¯åˆ é™¤çš„é‚£å¼ è¡¨ï¼Œæ·»åŠ çš„åˆæ˜¯é‚£å¼ è¡¨</h1><h1 id="å¯ä»¥ä¿®æ”¹æ˜¯å› ä¸ºmysqlåªéœ€è¦å»è¿™ä¸ªåˆ—å¯¹åº”çš„è¡¨ä¸­ä¿®æ”¹æ•°æ®å°±å¥½äº†"><a href="#å¯ä»¥ä¿®æ”¹æ˜¯å› ä¸ºmysqlåªéœ€è¦å»è¿™ä¸ªåˆ—å¯¹åº”çš„è¡¨ä¸­ä¿®æ”¹æ•°æ®å°±å¥½äº†" class="headerlink" title="å¯ä»¥ä¿®æ”¹æ˜¯å› ä¸ºmysqlåªéœ€è¦å»è¿™ä¸ªåˆ—å¯¹åº”çš„è¡¨ä¸­ä¿®æ”¹æ•°æ®å°±å¥½äº†"></a>å¯ä»¥ä¿®æ”¹æ˜¯å› ä¸ºmysqlåªéœ€è¦å»è¿™ä¸ªåˆ—å¯¹åº”çš„è¡¨ä¸­ä¿®æ”¹æ•°æ®å°±å¥½äº†</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- from ä¸€ä¸ªä¸èƒ½æ›´æ–°çš„è§†å›¾</span><br><span class="line"></span><br><span class="line">  - æ•°æ®é›†éƒ½æ¥æºäºä¸€ä¸ªä¸èƒ½æ›´æ–°çš„è§†å›¾äº†è‚¯å®šå°±ä¸è¡Œäº†å‘€</span><br><span class="line"></span><br><span class="line">- where å­å¥çš„å­æŸ¥è¯¢å¼•ç”¨äº† from å­å¥ä¸­çš„è¡¨ #TODO è®°å¾—æŸ¥ä¸€ä¸‹ä¸ºå•¥</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;mysql</span><br><span class="line">    create view emp_v1</span><br><span class="line">    as</span><br><span class="line">    select * from emp e</span><br><span class="line">    where e.id in (select id from emp where id is null)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="è§†å›¾å’Œè¡¨çš„åŒºåˆ«"><a href="#è§†å›¾å’Œè¡¨çš„åŒºåˆ«" class="headerlink" title="è§†å›¾å’Œè¡¨çš„åŒºåˆ«"></a>è§†å›¾å’Œè¡¨çš„åŒºåˆ«</h2><table><thead><tr><th></th><th>åˆ›å»ºæ–¹å¼</th><th>æ˜¯å¦å®é™…å ç”¨ç‰©ç†ç©ºé—´</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>è§†å›¾</td><td>create view</td><td>åªå æœ‰ä¸€å°éƒ¨åˆ†çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨ sql é€»è¾‘</td><td>å¢åˆ æ”¹æŸ¥ï¼Œä½†æ˜¯ä¸€èˆ¬åªç”¨äºæŸ¥è¯¢</td></tr><tr><td>è¡¨</td><td>create table</td><td>ä¿å­˜äº†è¡¨æ•°æ®</td><td>å¢åˆ æ”¹æŸ¥</td></tr></tbody></table><h2 id="è§†å›¾çš„ä¼˜ç¼ºç‚¹"><a href="#è§†å›¾çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="è§†å›¾çš„ä¼˜ç¼ºç‚¹"></a>è§†å›¾çš„ä¼˜ç¼ºç‚¹</h2><h3 id="æ•°æ®åº“è§†å›¾çš„ä¼˜ç‚¹"><a href="#æ•°æ®åº“è§†å›¾çš„ä¼˜ç‚¹" class="headerlink" title="æ•°æ®åº“è§†å›¾çš„ä¼˜ç‚¹"></a>æ•°æ®åº“è§†å›¾çš„ä¼˜ç‚¹</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨æ•°æ®åº“è§†å›¾çš„ä¼˜ç‚¹ï¼š</p><ul><li><strong>æ•°æ®åº“è§†å›¾å…è®¸ç®€åŒ–å¤æ‚æŸ¥è¯¢</strong>ï¼šæ•°æ®åº“è§†å›¾ç”±ä¸è®¸å¤šåŸºç¡€è¡¨ç›¸å…³è”çš„ SQL è¯­å¥å®šä¹‰ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°æ®åº“è§†å›¾æ¥éšè—æœ€ç»ˆç”¨æˆ·å’Œå¤–éƒ¨åº”ç”¨ç¨‹åºçš„åŸºç¡€è¡¨çš„å¤æ‚æ€§ã€‚ é€šè¿‡æ•°æ®åº“è§†å›¾ï¼Œæ‚¨åªéœ€ä½¿ç”¨ç®€å•çš„ SQL è¯­å¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…·æœ‰å¤šä¸ªè¿æ¥çš„å¤æ‚çš„ SQL è¯­å¥ã€‚</li><li><strong>æ•°æ®åº“è§†å›¾æœ‰åŠ©äºé™åˆ¶å¯¹ç‰¹å®šç”¨æˆ·çš„æ•°æ®è®¿é—®</strong>ã€‚ æ‚¨å¯èƒ½ä¸å¸Œæœ›æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æŸ¥è¯¢æ•æ„Ÿæ•°æ®çš„å­é›†ã€‚å¯ä»¥ä½¿ç”¨æ•°æ®åº“è§†å›¾å°†éæ•æ„Ÿæ•°æ®ä»…æ˜¾ç¤ºç»™ç‰¹å®šç”¨æˆ·ç»„ã€‚</li><li><strong>æ•°æ®åº“è§†å›¾æä¾›é¢å¤–çš„å®‰å…¨å±‚</strong>ã€‚ å®‰å…¨æ˜¯ä»»ä½•å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ æ•°æ®åº“è§†å›¾ä¸ºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†é¢å¤–çš„å®‰å…¨æ€§ã€‚ æ•°æ®åº“è§†å›¾å…è®¸æ‚¨åˆ›å»ºåªè¯»è§†å›¾ï¼Œä»¥å°†åªè¯»æ•°æ®å…¬å¼€ç»™ç‰¹å®šç”¨æˆ·ã€‚ ç”¨æˆ·åªèƒ½ä»¥åªè¯»è§†å›¾æ£€ç´¢æ•°æ®ï¼Œä½†æ— æ³•æ›´æ–°ã€‚</li><li><strong>æ•°æ®åº“è§†å›¾å¯ç”¨è®¡ç®—åˆ—</strong>ã€‚ æ•°æ®åº“è¡¨ä¸åº”è¯¥å…·æœ‰è®¡ç®—åˆ—ï¼Œä½†æ•°æ®åº“è§†å›¾å¯ä»¥è¿™æ ·ã€‚ å‡è®¾åœ¨<code>orderDetails</code>è¡¨ä¸­æœ‰<code>quantityOrder</code>(äº§å“çš„æ•°é‡)å’Œ<code>priceEach</code>(äº§å“çš„ä»·æ ¼)åˆ—ã€‚ ä½†æ˜¯ï¼Œ<code>orderDetails</code>è¡¨æ²¡æœ‰ä¸€ä¸ªåˆ—ç”¨æ¥å­˜å‚¨è®¢å•çš„æ¯ä¸ªè®¢å•é¡¹çš„æ€»é”€å”®é¢ã€‚å¦‚æœæœ‰ï¼Œæ•°æ®åº“æ¨¡å¼ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>total</code>çš„è®¡ç®—åˆ—ï¼Œè¯¥åˆ—æ˜¯<code>quantityOrder</code>å’Œ<code>priceEach</code>çš„ä¹˜ç§¯ï¼Œä»¥è¡¨ç¤ºè®¡ç®—ç»“æœã€‚å½“æ‚¨ä»æ•°æ®åº“è§†å›¾ä¸­æŸ¥è¯¢æ•°æ®æ—¶ï¼Œè®¡ç®—åˆ—çš„æ•°æ®å°†éšæœºè®¡ç®—äº§ç”Ÿã€‚</li><li><strong>æ•°æ®åº“è§†å›¾å®ç°å‘åå…¼å®¹</strong>ã€‚ å‡è®¾ä½ æœ‰ä¸€ä¸ªä¸­å¤®æ•°æ®åº“ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨å®ƒã€‚ æœ‰ä¸€å¤©ï¼Œæ‚¨å†³å®šé‡æ–°è®¾è®¡æ•°æ®åº“ä»¥é€‚åº”æ–°çš„ä¸šåŠ¡éœ€æ±‚ã€‚åˆ é™¤ä¸€äº›è¡¨å¹¶åˆ›å»ºæ–°çš„è¡¨ï¼Œå¹¶ä¸”ä¸å¸Œæœ›æ›´æ”¹å½±å“å…¶ä»–åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ›å»ºä¸å°†è¦åˆ é™¤çš„æ—§è¡¨ç›¸åŒçš„æ¨¡å¼çš„æ•°æ®åº“è§†å›¾ã€‚</li></ul><h3 id="æ•°æ®åº“è§†å›¾çš„ç¼ºç‚¹"><a href="#æ•°æ®åº“è§†å›¾çš„ç¼ºç‚¹" class="headerlink" title="æ•°æ®åº“è§†å›¾çš„ç¼ºç‚¹"></a>æ•°æ®åº“è§†å›¾çš„ç¼ºç‚¹</h3><p>é™¤äº†ä¸Šé¢çš„ä¼˜ç‚¹ï¼Œä½¿ç”¨æ•°æ®åº“è§†å›¾æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p><ul><li>_æ€§èƒ½_ï¼šä»æ•°æ®åº“è§†å›¾æŸ¥è¯¢æ•°æ®å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œç‰¹åˆ«æ˜¯å¦‚æœè§†å›¾æ˜¯<strong>åŸºäºå…¶ä»–è§†å›¾åˆ›å»ºçš„</strong>ã€‚</li><li>_è¡¨ä¾èµ–å…³ç³»_ï¼šå°†æ ¹æ®æ•°æ®åº“çš„åŸºç¡€è¡¨åˆ›å»ºä¸€ä¸ªè§†å›¾ã€‚æ¯å½“æ›´æ”¹ä¸å…¶ç›¸å…³è”çš„è¡¨çš„ç»“æ„æ—¶ï¼Œ<strong>éƒ½å¿…é¡»æ›´æ”¹è§†å›¾</strong>ã€‚</li></ul><hr><h1 id="Mysql-ä¹‹æ•°æ®ç±»å‹"><a href="#Mysql-ä¹‹æ•°æ®ç±»å‹" class="headerlink" title="Mysql ä¹‹æ•°æ®ç±»å‹"></a>Mysql ä¹‹æ•°æ®ç±»å‹</h1><h2 id="å‚è€ƒåšå®¢"><a href="#å‚è€ƒåšå®¢" class="headerlink" title="å‚è€ƒåšå®¢"></a>å‚è€ƒåšå®¢</h2><p><a href="https://www.cnblogs.com/qq631243523/p/9791393.html">https://www.cnblogs.com/qq631243523/p/9791393.html</a></p><p><a href="https://www.runoob.com/mysql/mysql-data-types.html">èœé¸Ÿæ•™ç¨‹</a></p><h2 id="ä¸€ã€æ•°å€¼ç±»å‹"><a href="#ä¸€ã€æ•°å€¼ç±»å‹" class="headerlink" title="ä¸€ã€æ•°å€¼ç±»å‹"></a>ä¸€ã€æ•°å€¼ç±»å‹</h2><p>MySQL æ”¯æŒæ‰€æœ‰æ ‡å‡† SQL æ•°å€¼æ•°æ®ç±»å‹ã€‚</p><p>è¿™äº›ç±»å‹åŒ…æ‹¬<strong>ä¸¥æ ¼æ•°å€¼</strong>æ•°æ®ç±»å‹(<code>INTEGER</code>ã€<code>SMALLINT</code>ã€<code>DECIMAL</code>å’Œ<code>NUMERIC</code>)ï¼Œä»¥åŠ<strong>è¿‘ä¼¼æ•°å€¼</strong>æ•°æ®ç±»å‹(<code>FLOAT</code>ã€<code>REAL</code>å’Œ<code>DOUBLE PRECISION</code>)ã€‚</p><p>å…³é”®å­—<code>INT</code>æ˜¯<code>INTEGER</code>çš„<strong>åŒä¹‰è¯</strong>ï¼Œå…³é”®å­—<code>DEC</code>æ˜¯<code>DECIMAL</code>çš„<strong>åŒä¹‰è¯</strong>ã€‚</p><p><code>BIT</code>æ•°æ®ç±»å‹ä¿å­˜<strong>ä½å­—æ®µå€¼</strong>ï¼Œå¹¶ä¸”æ”¯æŒ MyISAMã€MEMORYã€InnoDB å’Œ BDB è¡¨ã€‚</p><p>ä½œä¸º SQL æ ‡å‡†çš„æ‰©å±•ï¼ŒMySQL ä¹Ÿæ”¯æŒæ•´æ•°ç±»å‹<code>TINYINT</code>ã€<code>MEDIUMINT</code>å’Œ<code>BIGINT</code>ã€‚ä¸‹é¢çš„è¡¨æ˜¾ç¤ºäº†éœ€è¦çš„æ¯ä¸ªæ•´æ•°ç±»å‹çš„å­˜å‚¨å’ŒèŒƒå›´ã€‚</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">å¤§å°</th><th align="left">èŒƒå›´ï¼ˆæœ‰ç¬¦å·ï¼‰</th><th align="left">èŒƒå›´ï¼ˆæ— ç¬¦å·ï¼‰</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="left">TINYINT(Tinyint)</td><td align="left">1 byte</td><td align="left">(-128ï¼Œ127)</td><td align="left">(0ï¼Œ255)</td><td align="left">å°æ•´æ•°å€¼</td></tr><tr><td align="left">SMALLINT(smallint)</td><td align="left">2 bytes</td><td align="left">(-32 768ï¼Œ32 767)</td><td align="left">(0ï¼Œ65 535)</td><td align="left">å¤§æ•´æ•°å€¼</td></tr><tr><td align="left">MEDIUMINT(mediumint)</td><td align="left">3 bytes</td><td align="left">(-8 388 608ï¼Œ8 388 607)</td><td align="left">(0ï¼Œ16 777 215)</td><td align="left">å¤§æ•´æ•°å€¼</td></tr><tr><td align="left">INT æˆ– INTEGER(intã€integer)</td><td align="left">4 bytes</td><td align="left">(-2 147 483 648ï¼Œ2 147 483 647)</td><td align="left">(0ï¼Œ4 294 967 295)</td><td align="left">å¤§æ•´æ•°å€¼</td></tr><tr><td align="left">BIGINT(bigint)</td><td align="left">8 bytes</td><td align="left">(-9,223,372,036,854,775,808ï¼Œ9 223 372 036 854 775 807)</td><td align="left">(0ï¼Œ18 446 744 073 709 551 615)</td><td align="left">æå¤§æ•´æ•°å€¼</td></tr><tr><td align="left">FLOAT(float)</td><td align="left">4 bytes</td><td align="left">(-3.402 823 466 E+38ï¼Œ-1.175 494 351 E-38)ï¼Œ0ï¼Œ(1.175 494 351 E-38ï¼Œ3.402 823 466 351 E+38)</td><td align="left">0ï¼Œ(1.175 494 351 E-38ï¼Œ3.402 823 466 E+38)</td><td align="left">å•ç²¾åº¦ æµ®ç‚¹æ•°å€¼</td></tr><tr><td align="left">DOUBLE(double)</td><td align="left">8 bytes</td><td align="left">(-1.797 693 134 862 315 7 E+308ï¼Œ-2.225 073 858 507 201 4 E-308)ï¼Œ0ï¼Œ(2.225 073 858 507 201 4 E-308ï¼Œ1.797 693 134 862 315 7 E+308)</td><td align="left">0ï¼Œ(2.225 073 858 507 201 4 E-308ï¼Œ1.797 693 134 862 315 7 E+308)</td><td align="left">åŒç²¾åº¦ æµ®ç‚¹æ•°å€¼</td></tr><tr><td align="left">DECIMAL(decimal)</td><td align="left">å¯¹ DECIMAL(M,D) ï¼Œå¦‚æœ M&gt;Dï¼Œä¸º M+2 å¦åˆ™ä¸º D+2</td><td align="left">ä¾èµ–äº M å’Œ D çš„å€¼</td><td align="left">ä¾èµ–äº M å’Œ D çš„å€¼</td><td align="left">å°æ•°å€¼</td></tr></tbody></table><blockquote><p>mysql ä¸­<code>TINYINT</code>ã€<code>smallint</code>ã€<code>MEDIUMINT</code>ã€<code>int\integer</code>å’Œ<code>BIGINT</code>é»˜è®¤éƒ½æ˜¯æœ‰ç¬¦å·çš„ï¼Œå¦‚æœæƒ³æŒ‡å®šä¸ºæ— ç¬¦å·éœ€è¦ä½¿ç”¨<code>unsigned</code>å…³é”®å­—</p><p>å¦‚æœæŒ‡å®šäº†é›¶å¡«å……åˆ™é»˜è®¤æ˜¯æ— ç¬¦å·</p></blockquote><h3 id="æ•´å½¢çš„æ˜¾ç¤ºå®½åº¦"><a href="#æ•´å½¢çš„æ˜¾ç¤ºå®½åº¦" class="headerlink" title="æ•´å½¢çš„æ˜¾ç¤ºå®½åº¦"></a>æ•´å½¢çš„æ˜¾ç¤ºå®½åº¦</h3><p>åœ¨ mysql çš„æ•°æ®ç±»å‹ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ•´å‹ç±»å‹(æ˜¾ç¤ºå®½åº¦)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ­£ç¡®çš„ç†è§£ï¼Œå…¶å®æ˜¯æ˜¾ç¤ºå®½åº¦ï¼Œ<strong>å› ä¸ºæ•´å‹çš„æ˜¾ç¤ºå®½åº¦ï¼Œå¯¹æ•°å€¼å¤§å°æ— å½±å“ï¼Œåªæ˜¯å½“è®¾ç½®äº† zerofill çš„æ—¶å€™ï¼Œåœ¨æ˜¾ç¤ºçš„æ—¶å€™è¡¥ 0 è€Œå·²ã€‚</strong></p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1449547-20181015152509099-1787578855.png" alt="img"></p><p>ä»ä¸Šé¢çš„æ˜¾ç¤ºæˆ‘ä»¬çœ‹åˆ°ï¼Œè®¾ç½®äº†å®½åº¦ä¸º 5ï¼Œ<strong>å¹¶ä¸” zerofill äº†</strong>ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šåœ¨å‰é¢è‡ªåŠ¨è¡¥ 0ã€‚<strong>å®½åº¦å¯ä»¥ä¸è®¾ç½®ï¼Œå› ä¸ºæ•´æ•°æ•°æ®ç±»å‹éƒ½æœ‰é»˜è®¤çš„æ˜¾ç¤ºå®½åº¦ï¼Œä¸è®¾å°±é‡‡ç”¨é»˜è®¤çš„ã€‚</strong></p><p>å¦å¤–ï¼Œå³ä½¿è®¾ç½®äº†æ˜¾ç¤ºå®½åº¦ï¼Œä¹Ÿèƒ½èµ‹è¶…è¿‡æ˜¾ç¤ºå®½åº¦çš„å€¼ï¼Œæ•´å‹çš„æ˜¾ç¤ºå®½åº¦ä»…ä»…ç”¨äºæ˜¾ç¤ºè¡¥ 0ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1449547-20181015152509099-1787578855.png" alt="img"></p><h3 id="æµ®ç‚¹å‹ä¸å®šç‚¹å‹"><a href="#æµ®ç‚¹å‹ä¸å®šç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹ä¸å®šç‚¹å‹"></a><strong>æµ®ç‚¹å‹ä¸å®šç‚¹å‹</strong></h3><p>åœ¨ mysql çš„æ•°æ®ç±»å‹ä¸­æµ®ç‚¹å‹åˆ†ä¸ºä¸¤ç§ï¼Œfloat()ä¸ double()ç±»å‹ï¼Œå®šç‚¹å‹ä¸º decimal()ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®ç±»å‹(M,D)</span><br></pre></td></tr></table></figure><ul><li><strong>Mï¼šç²¾åº¦ï¼Œæ•°æ®çš„æ€»é•¿åº¦ï¼›</strong></li><li><strong>Dï¼šæ ‡åº¦ï¼Œå°æ•°ç‚¹åçš„é•¿åº¦ï¼›</strong></li></ul><p>å…¶åŒºåˆ«åœ¨äºï¼š</p><ol><li> å½“ä¸æŒ‡å®šç²¾åº¦æ—¶ï¼ŒFloatã€Double é»˜è®¤ä¼šä¿å­˜å®é™…ç²¾åº¦ï¼Œè€Œ Decimal é»˜è®¤æ˜¯æ•´æ•°ï¼›</li><li> å½“æ ‡åº¦ä¸å¤Ÿæ—¶ï¼Œéƒ½ä¼šå››èˆäº”å…¥ï¼Œä½† Decimal ä¼šè­¦å‘Šä¿¡æ¯ã€‚</li></ol><p><strong><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1449547-20181015153329393-1163892650.png" alt="img"></strong></p><h2 id="ä¸‰ã€æ—¥æœŸä¸æ—¶é—´ç±»å‹"><a href="#ä¸‰ã€æ—¥æœŸä¸æ—¶é—´ç±»å‹" class="headerlink" title="ä¸‰ã€æ—¥æœŸä¸æ—¶é—´ç±»å‹"></a><strong>ä¸‰ã€æ—¥æœŸä¸æ—¶é—´ç±»å‹</strong></h2><p>è¡¨ç¤ºæ—¶é—´å€¼çš„æ—¥æœŸå’Œæ—¶é—´ç±»å‹ä¸º<code>DATETIME</code>ã€<code>DATE</code>ã€<code>TIMESTAMP</code>ã€<code>TIME</code>å’Œ<code>YEAR</code>ã€‚</p><p>æ¯ä¸ªæ—¶é—´ç±»å‹æœ‰ä¸€ä¸ªæœ‰æ•ˆå€¼èŒƒå›´å’Œä¸€ä¸ªâ€é›¶â€å€¼ï¼Œå½“æŒ‡å®šä¸åˆæ³•çš„ MySQL ä¸èƒ½è¡¨ç¤ºçš„å€¼æ—¶ä½¿ç”¨â€é›¶â€å€¼ã€‚</p><p>TIMESTAMP ç±»å‹æœ‰ä¸“æœ‰çš„è‡ªåŠ¨æ›´æ–°ç‰¹æ€§ï¼Œå°†åœ¨åé¢æè¿°ã€‚</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">å¤§å° ( bytes)</th><th align="left">èŒƒå›´</th><th>é›¶å€¼</th><th align="left">æ ¼å¼</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="left">DATE(date)</td><td align="left">3</td><td align="left">1000-01-01/9999-12-31</td><td>0000:00:00</td><td align="left">YYYY-MM-DD</td><td align="left">æ—¥æœŸå€¼</td></tr><tr><td align="left">TIME(time)</td><td align="left">3</td><td align="left">â€˜-838:59:59â€™/â€˜838:59:59â€™</td><td>00:00:00</td><td align="left">HH:MM:SS</td><td align="left">æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´</td></tr><tr><td align="left">YEAR(year)</td><td align="left">1</td><td align="left">1901/2155</td><td>0000</td><td align="left">YYYY</td><td align="left">å¹´ä»½å€¼</td></tr><tr><td align="left">DATETIME(datetime)</td><td align="left">8</td><td align="left">1000-01-01 00:00:00/9999-12-31 23:59:59</td><td>0000-00-00 00:00:00</td><td align="left">YYYY-MM-DD HH:MM:SS</td><td align="left">æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼</td></tr><tr><td align="left">TIMESTAMP(timestamp)</td><td align="left">4</td><td align="left">1970-01-01 00:00:00/2038 ç»“æŸæ—¶é—´æ˜¯ç¬¬ <strong>2147483647</strong> ç§’ï¼ŒåŒ—äº¬æ—¶é—´ <strong>2038-1-19 11:14:07</strong>ï¼Œæ ¼æ—å°¼æ²»æ—¶é—´ 2038 å¹´ 1 æœˆ 19 æ—¥ å‡Œæ™¨ 03:14:07</td><td>00000000000000</td><td align="left">YYYYMMDD HHMMSS</td><td align="left">æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ï¼Œæ—¶é—´æˆ³</td></tr></tbody></table><p>DATE ç±»å‹å‰é¢å¯ä»¥åŠ ä¸ª Dï¼ŒD è¡¨ç¤ºå¤©å³ 24 å°æ—¶ï¼Œå¦‚å¾€ DATE ç±»å‹æ’å…¥ â€˜2 15:20:20â€™ï¼›</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/1449547-20181015154059404-1017945968.png" alt="img"></p><p>å¦å¤– TimeStamp ç±»å‹ä¸ DateTime åœ¨æ— è¾“å…¥çš„æƒ…å†µä¸‹è¦æ³¨æ„ä¸‹ï¼š</p><ol><li> TimeStamp ä½¿ç”¨ Current_TimeStamp()è€Œ DateTime ä½¿ç”¨ NOW()æ¥è·å–å½“å‰æ—¶é—´ï¼›</li><li> è¾“å…¥ NULL æ—¶ï¼Œç³»ç»Ÿä¼šè¾“å…¥ç³»ç»Ÿå½“å‰æ—¥æœŸä¸æ—¶é—´ï¼›</li><li> æ— ä»»ä½•è¾“å…¥æ—¶ï¼Œç³»ç»Ÿä¼šè¾“å…¥ç³»ç»Ÿå½“å‰æ—¥æœŸä¸æ—¶é—´ï¼›</li></ol><h2 id="å››ã€å­—ç¬¦ä¸²ç±»å‹"><a href="#å››ã€å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å››ã€å­—ç¬¦ä¸²ç±»å‹"></a><strong>å››ã€å­—ç¬¦ä¸²ç±»å‹</strong></h2><p>å­—ç¬¦ä¸²ç±»å‹åŒ…æ‹¬ CHARã€VARCHARã€BINARYã€VARBINARYã€BLOBã€TEXTã€ENUM å’Œ SETã€‚</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">å¤§å°</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="left">CHAR(char)</td><td align="left">0-255 bytes</td><td align="left">å®šé•¿å­—ç¬¦ä¸²</td></tr><tr><td align="left">VARCHAR(varchar)</td><td align="left">0-65535 bytes</td><td align="left">å˜é•¿å­—ç¬¦ä¸²</td></tr><tr><td align="left">TINYBLOB(tinyblob)</td><td align="left">0-255 bytes</td><td align="left">ä¸è¶…è¿‡ 255 ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td></tr><tr><td align="left">TINYTEXT(tinytext)</td><td align="left">0-255 bytes</td><td align="left">çŸ­æ–‡æœ¬å­—ç¬¦ä¸²</td></tr><tr><td align="left">BLOB(blob)</td><td align="left">0-65 535 bytes</td><td align="left">äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ®</td></tr><tr><td align="left">TEXT(text)</td><td align="left">0-65 535 bytes</td><td align="left">é•¿æ–‡æœ¬æ•°æ®</td></tr><tr><td align="left">MEDIUMBLOB(mediumblob)</td><td align="left">0-16 777 215 bytes</td><td align="left">äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®</td></tr><tr><td align="left">MEDIUMTEXT(mediumtext)</td><td align="left">0-16 777 215 bytes</td><td align="left">ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®</td></tr><tr><td align="left">LONGBLOB(longblob)</td><td align="left">0-4 294 967 295 bytes</td><td align="left">äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ®</td></tr><tr><td align="left">LONGTEXT(longtext)</td><td align="left">0-4 294 967 295 bytes</td><td align="left">æå¤§æ–‡æœ¬æ•°æ®</td></tr></tbody></table><h3 id="1ã€CHAR-ä¸-VARCHAR"><a href="#1ã€CHAR-ä¸-VARCHAR" class="headerlink" title="1ã€CHAR ä¸ VARCHAR"></a><strong>1ã€CHAR ä¸ VARCHAR</strong></h3><p>å…¶å®šä¹‰æ–¹å¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸²ç±»å‹(M)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª M æ˜¯é•¿åº¦çš„æ„æ€(<strong>M æ˜¯å­—ç¬¦æ•°</strong>)ï¼Œæ’å…¥è¯¥åˆ—çš„å­—ç¬¦ä¸²é•¿åº¦å°†ä¸å…è®¸è¶…è¿‡ M æ‰€æŒ‡å®šçš„é•¿åº¦ã€‚å¦å¤–ï¼Œç”±äº MySQL åœ¨å»ºåº“æ—¶å°±æŒ‡å®šäº†å­—ç¬¦é›†ï¼Œå› æ­¤å°±ä¸å­˜åœ¨ ncharã€nvarcharã€ntext è¿™ç§æ•°æ®ç±»å‹äº†ã€‚</p><ul><li>char æœ€é•¿å¯å– 255ï¼›</li><li>varchar æœ€é•¿å¯å– 65535ï¼›</li></ul><h3 id="2ã€TEXT"><a href="#2ã€TEXT" class="headerlink" title="2ã€TEXT"></a><strong>2ã€TEXT</strong></h3><p>TEXT åˆ†ä¸º 4 ç§ï¼Œä¸ SQLServer ä¸åŒï¼š</p><table><thead><tr><th>ç±»å‹</th><th>å…è®¸çš„é•¿åº¦</th><th>å­˜å‚¨ç©ºé—´</th></tr></thead><tbody><tr><td>TINYTEXT(tinytext)</td><td>0~255 å­—èŠ‚</td><td>å€¼çš„é•¿åº¦+2 å­—èŠ‚</td></tr><tr><td>TEXT(text)</td><td>0~65535 å­—èŠ‚</td><td>å€¼çš„é•¿åº¦+2 å­—èŠ‚</td></tr><tr><td>MEDIUMTEXT(mediumtext)</td><td>0~167772150 å­—èŠ‚</td><td>å€¼çš„é•¿åº¦+3 å­—èŠ‚</td></tr><tr><td>LONGTEXT(longtext)</td><td>0~4294967295 å­—èŠ‚</td><td>å€¼çš„é•¿åº¦+4 å­—èŠ‚</td></tr></tbody></table><h2 id="3ã€ENUM-ç±»å‹"><a href="#3ã€ENUM-ç±»å‹" class="headerlink" title="3ã€ENUM ç±»å‹"></a><strong>3ã€ENUM ç±»å‹</strong></h2><p>ENUM ç±»å‹(æšä¸¾ç±»å‹)ï¼Œä¸ C#çš„æ¦‚å¿µä¸€æ ·ï¼Œåœ¨å®šä¹‰æ—¶æŒ‡å®šå–å€¼èŒƒå›´ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å±æ€§å ENUM(&#39;å€¼1&#39;,&#39;å€¼2&#39;,&#39;å€¼3&#39;...&#39;å€¼n&#39;)</span><br></pre></td></tr></table></figure><ul><li>ENUM æœ‰ NOT NULL å±æ€§ï¼Œå…¶é»˜è®¤å€¼ä¸ºå–å€¼åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</li><li>ENUM æ—  NOT NULLï¼Œåˆ™ ENUM ç±»å‹å°†å…è®¸æ’å…¥ NULLï¼Œå¹¶ä¸” NULL ä¸ºé»˜è®¤å€¼ï¼›</li></ul><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/121428362289426.jpg" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Test4(Sex ENUM(&#39;ç”·&#39;,&#39;å¥³&#39;));</span><br><span class="line">INSERT INTO Test4 VALUES(&#39;ç”·&#39;);</span><br><span class="line">INSERT INTO Test4 VALUES(&#39;çˆ·&#39;);    --è¿™è¡ŒæŠ¥é”™</span><br><span class="line">SELECT * FROM Test4;</span><br></pre></td></tr></table></figure><h2 id="4ã€SET-ç±»å‹"><a href="#4ã€SET-ç±»å‹" class="headerlink" title="4ã€SET ç±»å‹"></a><strong>4ã€SET ç±»å‹</strong></h2><p>åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œå°±æŒ‡å®š SET ç±»å‹çš„å–å€¼èŒƒå›´ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å±æ€§å SET(&#39;å€¼1&#39;,&#39;å€¼2&#39;,&#39;å€¼3&#39;...,&#39;å€¼n&#39;)</span><br></pre></td></tr></table></figure><p>å®ƒä¸ ENUM çš„åŒºåˆ«åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/121442395091653.jpg" alt="img"></p><p>åŸºæœ¬ä¸Šå°±æ˜¯å¤šé€‰çš„ ENUMã€‚</p><h2 id="5ã€äºŒè¿›åˆ¶ç±»å‹"><a href="#5ã€äºŒè¿›åˆ¶ç±»å‹" class="headerlink" title="5ã€äºŒè¿›åˆ¶ç±»å‹"></a><strong>5ã€äºŒè¿›åˆ¶ç±»å‹</strong></h2><p>äºŒè¿›åˆ¶ç±»å‹æ˜¯åœ¨æ•°æ®åº“ä¸­å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„æ•°æ®ç±»å‹ã€‚äºŒè¿›åˆ¶ç±»å‹åŒ…æ‹¬ BINARYã€VARBINARYã€BITã€TINYBLOBã€BLOBã€MEDIUMBLOBã€LONGBLOBã€‚</p><table><thead><tr><th>ç±»å‹</th><th>å–å€¼èŒƒå›´</th></tr></thead><tbody><tr><td>BINARY(M)[binary]</td><td>å­—èŠ‚æ•°ä¸º Mï¼Œå…è®¸é•¿åº¦ä¸º 0~M çš„å®šé•¿äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td></tr><tr><td>VARBINARY(M)[varbinary]</td><td>å…è®¸é•¿åº¦ä¸º 0~M çš„å˜é•¿äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå­—èŠ‚æ•°ä¸ºå€¼çš„é•¿åº¦åŠ  1</td></tr><tr><td>BIT(M)[bit]</td><td>M ä½äºŒè¿›åˆ¶æ•°æ®ï¼ŒM æœ€å¤§å€¼ä¸º 64</td></tr><tr><td>TINYBLOB[tinyblob]</td><td>å¯å˜é•¿äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤š 255 ä¸ªå­—èŠ‚</td></tr><tr><td>BLOB[blob]</td><td>å¯å˜é•¿äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤š 2 çš„ 16 æ¬¡æ–¹-1 ä¸ªå­—èŠ‚</td></tr><tr><td>MEDIUMBLOB[mediumblob]</td><td>å¯å˜é•¿äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤š 2 çš„ 24 æ¬¡æ–¹-1 ä¸ªå­—èŠ‚</td></tr><tr><td>LONGBLOB[longblob]</td><td>å¯å˜é•¿äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¤š 2 çš„ 32 æ¬¡æ–¹-1 ä¸ªå­—èŠ‚</td></tr></tbody></table><h3 id="1ã€BINARY-å’Œ-VARBINARY"><a href="#1ã€BINARY-å’Œ-VARBINARY" class="headerlink" title="1ã€BINARY å’Œ VARBINARY"></a><strong>1ã€BINARY å’Œ VARBINARY</strong></h3><p>ä¸¤è€…å”¯ä¸€çš„å·®åˆ«åœ¨äº BINARY å½“é•¿åº¦ä¸å¤Ÿæ—¶ä¼šè¡¥\0ã€‚</p><h3 id="2ã€BIT-ç±»å‹"><a href="#2ã€BIT-ç±»å‹" class="headerlink" title="2ã€BIT ç±»å‹"></a><strong>2ã€BIT ç±»å‹</strong></h3><p>BIT ç±»å‹ä¸ SQLServer é‡Œçš„å°±å·®åˆ«å¤§äº†ã€‚ å…¶å®šä¹‰æ–¹å¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BIT(M)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­â€Mâ€æŒ‡å®šäº†è¯¥äºŒè¿›åˆ¶çš„æœ€å¤§å­—èŠ‚é•¿åº¦ä¸º Mï¼ŒM çš„æœ€å¤§å€¼ä¸º 64ã€‚å¦‚ BIT(4)å°±æ˜¯æ•°æ®ç±»å‹ä¸º BIT ç±»å‹ï¼Œé•¿åº¦ä¸º 4ã€‚å…¶èƒ½å¤Ÿå­˜å‚¨çš„å€¼ä¸º 0-15ã€‚å› ä¸ºå˜æˆäºŒè¿›åˆ¶åï¼Œ15 çš„å€¼ä¸º 1111ã€‚</p><p>åœ¨æŸ¥è¯¢ BIT ç±»å‹çš„æ•°æ®æ—¶ï¼Œè¦ç”¨ BIN(å­—æ®µå+0)æ¥å°†å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¾ç¤ºã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/09/05/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/121528536183759.jpg" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Test6(BB BIT(4));</span><br><span class="line">INSERT INTO Test6 VALUES(12);</span><br><span class="line">SELECT BIN(BB+0) FROM Test6;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»“æœä»¥äºŒè¿›åˆ¶æ˜¾ç¤ºï¼Œæœ€å¤§çš„é•¿åº¦ä¸º 4ã€‚</p><p><strong>3ã€BLOB ç±»å‹</strong></p><p>BLOB ç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶ç±»å‹ã€‚BLOB å¯ä»¥å­˜å‚¨æ•°æ®é‡å¾ˆå¤§çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚å›¾ç‰‡ï¼Œè§†é¢‘ç­‰ã€‚BLOB ç±»å‹åŒ…æ‹¬ TINYBLOBã€BLOBã€MEDIUMBLOB å’Œ LONGBLOBã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¹Ÿåªæ˜¯æœ€å¤§é•¿åº¦ä¸åŒã€‚</p><h2 id="äº”ã€æ•°æ®ç±»å‹çš„é€‰æ‹©"><a href="#äº”ã€æ•°æ®ç±»å‹çš„é€‰æ‹©" class="headerlink" title="äº”ã€æ•°æ®ç±»å‹çš„é€‰æ‹©"></a><strong>äº”ã€æ•°æ®ç±»å‹çš„é€‰æ‹©</strong></h2><ol><li> æ•´å‹ï¼šæ ¹æ®è¦æ˜¾ç¤ºçš„æœ€å¤§å€¼å†³å®šï¼›</li><li> æµ®ç‚¹å‹ï¼šè¦æ˜¾ç¤ºå°æ•°ã€‚å¦‚æœè¦ç²¾ç¡®åˆ°å°æ•°ç‚¹å 10 ä½ï¼Œå°±é€‰æ‹© DOUBLEï¼Œè€Œä¸åº”è¯¥é€‰æ‹© FLOATã€‚DECIMAL ç²¾åº¦è¾ƒé«˜ï¼Œæµ®ç‚¹æ•°ä¼šå‡ºç°è¯¯å·®ï¼Œå¦‚æœç²¾åº¦è¾ƒé«˜ï¼Œåˆ™åº”é€‰æ‹©å®šç‚¹æ•° DECIMALï¼›</li><li> å­—ç¬¦ä¸²å‹ï¼šå®šé•¿ä¸å˜é•¿çš„åŒºåˆ«ï¼ŒCHAR ç±»å‹å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯å¤„ç†é€Ÿåº¦æ¯” VARCHAR å¿«ï¼Œå¦‚æœé•¿åº¦å˜åŒ–ä¸å¤§ï¼Œå¦‚èº«ä»½è¯å·ç é‚£ç§ï¼Œæœ€å¥½é€‰æ‹© CHAR ç±»å‹ã€‚è€Œå¯¹äºè¯„è®ºå­—ç¬¦ä¸²ï¼Œæœ€å¥½é€‰æ‹© VARCHARï¼›</li><li> æ—¶é—´ï¼šæ ¹æ®éœ€è¦æ˜¾ç¤ºçš„ç±»å‹å’¯ï¼Œç‰¹åˆ«æ˜¯ TIMESTAMP,å¦‚æœéœ€è¦æ˜¾ç¤ºçš„æ—¶é—´ä¸æ—¶åŒºå¯¹åº”ï¼Œå°±åº”è¯¥é€‰æ‹© TIMESTAMPï¼›</li><li> ENUM ç±»å‹å’Œ SET ç±»å‹ï¼šé•¿åº¦ä¸åŒï¼ŒENUM ç±»å‹æœ€å¤šå¯ä»¥ç”± 65535 ä¸ªæˆå‘˜ï¼Œè€Œ SET ç±»å‹æœ€å¤šåªèƒ½åŒ…å« 64 ä¸ªæˆå‘˜ã€‚ä¸” ENUM åªèƒ½å•é€‰ï¼Œè€Œ SET ç±»å‹å¯ä»¥å¤šé€‰ï¼›</li><li> TEXT ç±»å‹å’Œ BLOB ç±»å‹ï¼šTEXT åªèƒ½å­˜å‚¨å­—ç¬¦æ•°æ®ï¼Œè€Œ BLOB å¯ä»¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ã€‚å¦‚æœæ˜¯çº¯æ–‡æœ¬ï¼Œé€‚åˆ TEXTã€‚å¦‚æœæ˜¯å›¾ç‰‡ç­‰é€‚åˆå­˜äºŒè¿›åˆ¶ï¼›</li></ol><h2 id="å…­ã€é—®é¢˜æ€»ç»“"><a href="#å…­ã€é—®é¢˜æ€»ç»“" class="headerlink" title="å…­ã€é—®é¢˜æ€»ç»“"></a><strong>å…­ã€é—®é¢˜æ€»ç»“</strong></h2><p><strong>1ã€å­˜å‚¨è·¯å¾„çš„é—®é¢˜</strong></p><p>MySQL ä¸­ï¼Œå¦‚æœè·¯å¾„ä¸­ä½¿ç”¨â€&quot;ç¬¦å·æ—¶ï¼Œè¿™ä¸ªç¬¦å·ä¼šè¢«è¿‡æ»¤ã€‚è§£å†³çš„åŠæ³•æ˜¯è·¯å¾„ä¸­ç”¨â€/â€œæˆ–â€\â€œæ¥ä»£æ›¿â€&quot;ã€‚è¿™æ · MySQL å°±ä¸ä¼šè‡ªåŠ¨è¿‡æ»¤è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦ã€‚</p><p><strong>2ã€MySQL ä¸­çš„å¸ƒå°”ç±»å‹</strong></p><p>MySQL ä¸­æ²¡æœ‰ Bool æˆ– Boolean ç±»å‹ï¼Œä½†æ˜¯ä¸ºäº†æ”¯æŒ SQL æ ‡å‡†ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ Bool æˆ– Boolean ç±»å‹çš„ï¼Œä½†æ˜¯ Bool æˆ– Boolean ç±»å‹æœ€åè½¬æ¢æˆçš„æ˜¯ TinyInt(1)ï¼Œä¹Ÿå°±æ˜¯è¯´,åœ¨ MySQL ä¸­ï¼Œå¸ƒå°”ç±»å‹å®é™…ä¸Šæ˜¯ TinyInt(1)ã€‚</p><p><strong>3ã€MySQL ä¸­å¦‚ä½•å­˜å‚¨ JPG å›¾ç‰‡æˆ– MP3 éŸ³ä¹</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ•°æ®åº“ä¸­ä¸ç›´æ¥å­˜å‚¨å›¾ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶ï¼Œè€Œæ˜¯å­˜å‚¨å›¾ç‰‡æˆ–éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœåœ¨ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦åœ¨ MySQL æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶ï¼Œå¯ä»¥é€‰æ‹© BLOB ç±»å‹ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> å¾…æ•´ç† </category>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾…æ•´ç† </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaåŸºç¡€é…ç½®</title>
      <link href="2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/"/>
      <url>2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€ideaå®‰è£…å¯åŠ¨"><a href="#ä¸€ã€ideaå®‰è£…å¯åŠ¨" class="headerlink" title="ä¸€ã€ideaå®‰è£…å¯åŠ¨"></a>ä¸€ã€ideaå®‰è£…å¯åŠ¨</h1><p>ç•¥</p><h1 id="äºŒã€ideaé…ç½®"><a href="#äºŒã€ideaé…ç½®" class="headerlink" title="äºŒã€ideaé…ç½®"></a>äºŒã€ideaé…ç½®</h1><h2 id="ideaè™šæ‹Ÿæœºé…ç½®"><a href="#ideaè™šæ‹Ÿæœºé…ç½®" class="headerlink" title="ideaè™šæ‹Ÿæœºé…ç½®"></a>ideaè™šæ‹Ÿæœºé…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-Xms128m # åˆå§‹å†…å­˜æ•°</span><br><span class="line">-Xmx750m # æœ€å¤§å†…å­˜æ•°</span><br><span class="line">-XX:ReservedCodeCacheSize&#x3D;240m # ä¿ç•™ä»£ç ç¼“å­˜å¤§å°</span><br><span class="line">-XX:+UseConcMarkSweepGC </span><br><span class="line">-XX:SoftRefLRUPolicyMSPerMB&#x3D;50</span><br><span class="line">-ea</span><br><span class="line">-Dsun.io.useCanonCaches&#x3D;false</span><br><span class="line">-Djava.net.preferIPv4Stack&#x3D;true</span><br><span class="line">-Djdk.http.auth.tunneling.disabledSchemes&#x3D;&quot;&quot;</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:-OmitStackTraceInFastThrow</span><br><span class="line">-javaagent:D:\downloads\Learning\JetBrains\IntelliJ IDEA 2018.2.5\bin\JetbrainsCrack-release-enc.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ideaç•Œé¢è®¾ç½®"><a href="#ideaç•Œé¢è®¾ç½®" class="headerlink" title="ideaç•Œé¢è®¾ç½®"></a>ideaç•Œé¢è®¾ç½®</h2><p>æ‰“å¼€å·¥å…·è§†å›¾</p><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609161002504.png" alt="image-20200609161002504"></p><h3 id="è®¾ç½®æ‚¬æµ®æç¤º"><a href="#è®¾ç½®æ‚¬æµ®æç¤º" class="headerlink" title="è®¾ç½®æ‚¬æµ®æç¤º"></a>è®¾ç½®æ‚¬æµ®æç¤º</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609164301178.png" alt="image-20200609164301178"></p><h3 id="è®¾ç½®è‡ªåŠ¨å¯¼åŒ…"><a href="#è®¾ç½®è‡ªåŠ¨å¯¼åŒ…" class="headerlink" title="è®¾ç½®è‡ªåŠ¨å¯¼åŒ…"></a>è®¾ç½®è‡ªåŠ¨å¯¼åŒ…</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609164402862.png" alt="image-20200609164402862"></p><h3 id="è®¾ç½®æ–¹æ³•ä¹‹é—´çš„åˆ†å‰²çº¿"><a href="#è®¾ç½®æ–¹æ³•ä¹‹é—´çš„åˆ†å‰²çº¿" class="headerlink" title="è®¾ç½®æ–¹æ³•ä¹‹é—´çš„åˆ†å‰²çº¿"></a>è®¾ç½®æ–¹æ³•ä¹‹é—´çš„åˆ†å‰²çº¿</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609164554935.png" alt="image-20200609164554935"></p><h3 id="è®¾ç½®å¿½ç•¥å¤§å°å†™æç¤º"><a href="#è®¾ç½®å¿½ç•¥å¤§å°å†™æç¤º" class="headerlink" title="è®¾ç½®å¿½ç•¥å¤§å°å†™æç¤º"></a>è®¾ç½®å¿½ç•¥å¤§å°å†™æç¤º</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609164842973.png" alt="image-20200609164842973"></p><h3 id="è®¾ç½®tabè¿‡å¤šæ—¶ä¸éšè—"><a href="#è®¾ç½®tabè¿‡å¤šæ—¶ä¸éšè—" class="headerlink" title="è®¾ç½®tabè¿‡å¤šæ—¶ä¸éšè—"></a>è®¾ç½®tabè¿‡å¤šæ—¶ä¸éšè—</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609165101396.png" alt="image-20200609165101396"></p><h3 id="è®¾ç½®æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯"><a href="#è®¾ç½®æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯" class="headerlink" title="è®¾ç½®æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯"></a>è®¾ç½®æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609165614802.png" alt="image-20200609165614802">                                                                                             </p><h3 id="å¼€å¯è‡ªåŠ¨ç¼–è¯‘"><a href="#å¼€å¯è‡ªåŠ¨ç¼–è¯‘" class="headerlink" title="å¼€å¯è‡ªåŠ¨ç¼–è¯‘"></a>å¼€å¯è‡ªåŠ¨ç¼–è¯‘</h3><p><img src= "/img/loading.gif" data-lazy-src="/2019/08/14/idea/idea%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE/image-20200609181519729.png" alt="image-20200609181519729"></p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
          <category> idea </category>
          
          <category> IDE </category>
          
          <category> idea </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
            <tag> idea </tag>
            
            <tag> IDE </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
