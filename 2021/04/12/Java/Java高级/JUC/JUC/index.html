<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JUC | LLQWQ的博客</title><meta name="keywords" content="java,JUC,高并发编程"><meta name="author" content="LLQWQ"><meta name="copyright" content="LLQWQ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Java 秃头系列之 JUC">
<meta property="og:type" content="article">
<meta property="og:title" content="JUC">
<meta property="og:url" content="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/index.html">
<meta property="og:site_name" content="LLQWQ的博客">
<meta property="og:description" content="Java 秃头系列之 JUC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://llqwq.gitee.io/img/Java-JUC-cover.jpg">
<meta property="article:published_time" content="2021-04-12T05:58:52.000Z">
<meta property="article:modified_time" content="2021-04-13T13:32:03.423Z">
<meta property="article:author" content="LLQWQ">
<meta property="article:tag" content="java">
<meta property="article:tag" content="JUC">
<meta property="article:tag" content="高并发编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://llqwq.gitee.io/img/Java-JUC-cover.jpg"><link rel="shortcut icon" href="/img/48668845.jpg"><link rel="canonical" href="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/LLQWQ" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-13 21:32:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/48668845.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/Java-JUC.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">LLQWQ的博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JUC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-12T05:58:52.000Z" title="发表于 2021-04-12 13:58:52">2021-04-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-13T13:32:03.423Z" title="更新于 2021-04-13 21:32:03">2021-04-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/JUC/">JUC</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/%E9%AB%98%E5%B9%B6%E5%8F%91/">高并发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>Java 秃头系列之 JUC</p>
</blockquote>
<span id="more"></span>

<h2 id="JUC-是什么-😦"><a href="#JUC-是什么-😦" class="headerlink" title="JUC 是什么 😦"></a>JUC 是什么 😦</h2><blockquote>
<p><code>java.util.concurrent</code>在并发编程中使用的<strong>工具类</strong></p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image004.jpg" alt="graphic"></p>
<h3 id="进程-线程回顾-😅"><a href="#进程-线程回顾-😅" class="headerlink" title="进程/线程回顾 😅"></a>进程/线程回顾 😅</h3><h4 id="进程-线程是什么？-❓"><a href="#进程-线程是什么？-❓" class="headerlink" title="进程/线程是什么？ ❓"></a>进程/线程是什么？ ❓</h4><p>进程：进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。</p>
<p>线程：通常在一个进程中可以包含若干个线程，当然一个进程中至少有一个线程，不然没有存在的意义。线程可以利用进程所拥有的资源，在引入线程的操作系统中，通常都是把进程作为分配资源的基本单位，而把线程作为独立运行和独立调度的基本单位，由于线程比进程更小，基本上不拥有系统资源，故对它的调度所付出的开销就会小得多，能更高效的提高系统多个程序间并发执行的程度。</p>
<h4 id="举个栗子-🌰"><a href="#举个栗子-🌰" class="headerlink" title="举个栗子 🌰"></a>举个栗子 🌰</h4><ul>
<li><strong>例子一：</strong> 使用 QQ，查看进程一定有一个 QQ.exe 的进程，我可以用 qq 和 A 文字聊天，和 B 视频聊天，给 C 传文件，给 D 发一段语言，QQ 支持录入信息的搜索。</li>
<li><strong>例子二：</strong> 大四的时候写论文，用 word 写论文，同时用 QQ 音乐放音乐，同时用 QQ 聊天，多个进程。</li>
<li><strong>例子三：</strong> word 如没有保存，停电关机，再通电后打开 word 可以恢复之前未保存的文档，word 也会检查你的拼写，两个线程：容灾备份，语法检查</li>
</ul>
<h4 id="线程的状态-😴"><a href="#线程的状态-😴" class="headerlink" title="线程的状态 😴"></a>线程的状态 😴</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/Java+%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%8F%98%E8%BF%81.png" alt="Java 线程状态变迁 "></p>
<p>在 Java 中我们只能得到线程以下的线程状态：</p>
<ul>
<li>new</li>
<li>runnable</li>
<li>blocked</li>
<li>waiting</li>
<li>time_waiting</li>
<li>terminated</li>
</ul>
<blockquote>
<p>操作系统隐藏 Java 虚拟机（JVM）中的 RUNNABLE 和 RUNNING 状态，它只能看到 RUNNABLE 状态，所以 Java 系统一般将这两个状态统称为 <strong>RUNNABLE（运行中）</strong> 状态 。</p>
</blockquote>
<h4 id="wait-sleep-的区别-😦"><a href="#wait-sleep-的区别-😦" class="headerlink" title="wait/sleep 的区别 😦"></a>wait/sleep 的区别 😦</h4><ul>
<li>wait：进入等待状态，并<strong>释放锁</strong>（放开手去睡，放开手里的锁）</li>
<li>sleep：进入等待状态，<strong>不释放锁</strong>（握紧手去睡，醒了手里还有锁）</li>
</ul>
<h4 id="什么是并发？什么是并行？🤔"><a href="#什么是并发？什么是并行？🤔" class="headerlink" title="什么是并发？什么是并行？🤔"></a>什么是并发？什么是并行？🤔</h4><ul>
<li>并发：同一时刻多个线程在访问同一个资源，多个线程对一个点（CPU 在多个线程之间反复横跳）</li>
<li>并行：多项工作一起执行，之后再汇总（多个 CPU 同时运行多个线程，一个 CPU 运行一个线程）</li>
</ul>
<h2 id="Lock-接口-🔒"><a href="#Lock-接口-🔒" class="headerlink" title="Lock 接口 🔒"></a>Lock 接口 🔒</h2><h3 id="复习-Synchronized😳"><a href="#复习-Synchronized😳" class="headerlink" title="复习 Synchronized😳"></a>复习 Synchronized😳</h3><p><strong>买票代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String name = Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;买票失败，没有票啦&quot;</span>;</span><br><span class="line">        ticket--;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;售出一张票，还剩：&quot;</span> + ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">    <span class="comment">// 创建五个线程去买票</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 每个线程买10次票</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                x.sell();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 休息一下，CPU核数太多了，不休息看不出来票被抢夺</span></span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;窗口&quot;</span> + j).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="是什么？❓"><a href="#是什么？❓" class="headerlink" title="是什么？❓"></a>是什么？❓</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277453136.jpg" alt="graphic"></p>
<blockquote>
<p>Lock implementations provide more extensive locking operations than can be obtained using synchronized methods and statements. They allow more flexible structuring, may have quite different properties, and may support multiple associated Condition objects.</p>
<p>翻译：锁实现提供了比使用同步方法和语句可以获得的更广泛的锁操作。它们允许更灵活的结构，可能具有非常不同的属性，并且可能支持多个关联的条件对象。</p>
</blockquote>
<h3 id="怎么用-🔧"><a href="#怎么用-🔧" class="headerlink" title="怎么用 🔧"></a>怎么用 🔧</h3><blockquote>
<p>Lock 接口有多个实现类，我们以 ReentrantLock 为例</p>
</blockquote>
<h4 id="Lock-接口的实现-ReentrantLock-可重入锁"><a href="#Lock-接口的实现-ReentrantLock-可重入锁" class="headerlink" title="Lock 接口的实现 ReentrantLock 可重入锁"></a>Lock 接口的实现 ReentrantLock 可重入锁</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618277530938.jpg" alt="graphic"></p>
<p>看看官网文档的使用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     lock.lock();  <span class="comment">// block until condition holds</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">// ... method body</span></span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock()</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>ReentrantLock</code>实现买票程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tickets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ticket = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 卖票方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = Thread.currentThread().getName();</span><br><span class="line">            <span class="keyword">assert</span> ticket &gt; <span class="number">0</span> : name + <span class="string">&quot;买票失败，没有票啦&quot;</span>;</span><br><span class="line">            ticket--;</span><br><span class="line">            System.out.println(name + <span class="string">&quot;售出一张票，还剩：&quot;</span> + ticket);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tickets x = <span class="keyword">new</span> Tickets();</span><br><span class="line">        <span class="comment">// 创建五个线程去买票</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// 每个线程买10次票</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    x.sell();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// 休息一下，CPU核数太多了，不休息看不出来票被抢夺</span></span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;窗口&quot;</span> + j).start();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="synchronized-与-Lock-的区别-😦"><a href="#synchronized-与-Lock-的区别-😦" class="headerlink" title="synchronized 与 Lock 的区别 😦"></a>synchronized 与 Lock 的区别 😦</h3><p><strong>两者区别：</strong></p>
<ol>
<li>首先<code>synchronized</code>是<strong>java 内置关键字</strong>，在 jvm 层面，<strong>Lock 是个 java 类</strong>；</li>
<li><code>synchronized</code><strong>无法</strong>判断是否获取锁的状态，<code>Lock</code><strong>可以</strong>判断是否获取到锁；</li>
<li><code>synchronized</code>会<strong>自动释放锁</strong>(a 线程执行完同步代码会释放锁 ；b 线程执行过程中发生异常会释放锁)，<code>Lock</code>需在 finally 中<strong>手工释放锁</strong>（unlock()方法释放锁），否则容易造成线程死锁；</li>
<li>用<code>synchronized</code>关键字的两个线程 1 和线程 2，如果当前线程 1 获得锁，线程 2 线程等待。<strong>如果线程 1 阻塞，线程 2 则会一直等待下去</strong>，而 Lock 锁就不一定会等待下去，<strong>如果尝试获取不到锁，线程可以不用一直等待就结束了</strong>；</li>
<li><code>synchronized</code>的锁可重入、不可中断、非公平，而<code>Lock</code>锁可重入、可判断、可公平（两者皆可）</li>
<li><code>Lock</code>锁适合大量同步的代码的同步问题，<code>synchronized</code>锁适合代码少量的同步问题。</li>
</ol>
<h2 id="线程间通信-📞"><a href="#线程间通信-📞" class="headerlink" title="线程间通信 📞"></a>线程间通信 📞</h2><h3 id="面试题：两个线程打印-📝"><a href="#面试题：两个线程打印-📝" class="headerlink" title="面试题：两个线程打印 📝"></a>面试题：两个线程打印 📝</h3><p>✍ 两个线程，一个线程打印数字 1-52，另一个打印字母 A-Z 打印顺序为 12A34B…5152Z</p>
<p>实现步骤：</p>
<ul>
<li>生产者+消费者</li>
<li>通知等待唤醒机制</li>
</ul>
<p>实现代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadCommunication</span> </span>&#123;</span><br><span class="line">    <span class="comment">// false：打印数字，true：打印字母</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// 记录数字</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 记录字母</span></span><br><span class="line">    <span class="keyword">int</span> letter = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印数字</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printNumber</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 为true先休眠，让字母先打印</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果到了52就退出并唤醒字母线程</span></span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">52</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;：&quot;</span> + num + <span class="string">&quot;, &quot;</span> + (++num));</span><br><span class="line">        num++;</span><br><span class="line">        flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印字母</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printLetter</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 为false先休眠，让数字先打印</span></span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果到了Z就退出并唤醒数字线程</span></span><br><span class="line">        <span class="keyword">if</span> (letter &gt; <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;：&quot;</span> + ((<span class="keyword">char</span>) letter++));</span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    ThreadCommunication threadCommunication = <span class="keyword">new</span> ThreadCommunication();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printNumber();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;数字线程&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        where(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadCommunication.printLetter();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;字母线程&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="增加到-4-个线程-🆙"><a href="#增加到-4-个线程-🆙" class="headerlink" title="增加到 4 个线程 🆙"></a>增加到 4 个线程 🆙</h3><ul>
<li><p><strong>出现问题：</strong> 换成 4 个线程会导致错误，虚假唤醒</p>
</li>
<li><p><strong>原因：</strong> 在 java 多线程判断时，不能用 if，程序出事出在了判断上面，突然有一添加的线程进到 if 了，突然中断了交出控制权，没有进行验证，而是直接走下去了，加了两次，甚至多次</p>
</li>
<li><p><strong>解决方法：</strong></p>
<ul>
<li><p>解决虚假唤醒：查看 API，java.lang.Object</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618284313147.jpg" alt="graphic"></p>
<p>中断和虚假唤醒是可能产生的，所以要用<strong>loop 循环</strong>，if 只判断一次，<strong>while 是只要唤醒就要拉回来再判断一次</strong>。if 换成 while</p>
</li>
</ul>
</li>
<li><p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// if改为while👇</span></span><br><span class="line"><span class="keyword">while</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="java8-新版实现-🆕"><a href="#java8-新版实现-🆕" class="headerlink" title="java8 新版实现 🆕"></a>java8 新版实现 🆕</h3><p><code>lock</code>对标<code>synchronization</code>实现</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413114243997.png" alt="image-20210413114243997"></p>
<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p><code>lock</code> 的 <code>await</code> 和 <code>signal </code>方法需要靠 <code>Condition </code>接口实现</p>
<p>查看 API，java.util.concurrent</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618286075328.jpg" alt="graphic"></p>
<p>代码举例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">final</span> Condition notFull  = lock.newCondition();</span><br><span class="line">    <span class="keyword">final</span> Condition notEmpty = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == items.length)</span><br><span class="line">                notFull.await();</span><br><span class="line">            items[putptr] = x;</span><br><span class="line">            <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</span><br><span class="line">            ++count;</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线程间定制化调用通信-💱"><a href="#线程间定制化调用通信-💱" class="headerlink" title="线程间定制化调用通信 💱"></a>线程间定制化调用通信 💱</h2><h3 id="一个问题：多个线程依次打印-📝"><a href="#一个问题：多个线程依次打印-📝" class="headerlink" title="一个问题：多个线程依次打印 📝"></a>一个问题：多个线程依次打印 📝</h3><p>✍ 有三个线程，A 线程打印字符 AA，B 线程打印字符 BB，C 线程打印字符 CC，需要依次打印出 abc，打印十轮，每轮 AA 要打印五次，BB 要打印 10 次，CC 要打印 15 次</p>
<p><strong>实现步骤：</strong></p>
<ul>
<li>有顺序通知，需要有标识位</li>
<li>有一个锁 Lock，3 把钥匙 Condition</li>
<li>判断标志位</li>
<li>输出线程名+第几次+第几轮</li>
<li>修改标志位，通知下一个</li>
</ul>
<p><strong>实现代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareResource</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1:A 2:B 3:C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition c3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print5</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 判断</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//A 就要停止</span></span><br><span class="line">                c1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 干活</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 通知</span></span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            c2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print10</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 判断</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//A 就要停止</span></span><br><span class="line">                c2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 干活</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 通知</span></span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            c3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print15</span><span class="params">(<span class="keyword">int</span> totalLoopNumber)</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 判断</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//A 就要停止</span></span><br><span class="line">                c3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 干活</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t totalLoopNumber: &quot;</span> + totalLoopNumber);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3 通知</span></span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            c1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ShareResource sr = <span class="keyword">new</span> ShareResource();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print5(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print10(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sr.print15(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;CC&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Synchronization-锁问题-❓"><a href="#Synchronization-锁问题-❓" class="headerlink" title="Synchronization 锁问题 ❓"></a>Synchronization 锁问题 ❓</h2><h3 id="八个问题-📝"><a href="#八个问题-📝" class="headerlink" title="八个问题 📝"></a>八个问题 📝</h3><ol>
<li><p>标准访问，先打印短信还是邮件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>停 4 秒在短信方法内，先打印短信还是邮件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        这里使用sleep停止<span class="number">4</span>秒</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>普通的 hello 方法，是先打短信还是 hello</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendSMS&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------sendEmail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------getHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">   Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">   Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// phone.sendEmail();</span></span><br><span class="line">     phone.getHello();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;, <span class="string">&quot;BB&quot;</span>).start();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>现在有两部手机，先打印短信还是邮件</p>
</li>
<li><p>两个静态同步方法，1 部手机，先打印短信还是邮件</p>
</li>
<li><p>两个静态同步方法，2 部手机，先打印短信还是邮件</p>
</li>
<li><p>1 个静态同步方法，1 个普通同步方法，1 部手机，先打印短信还是邮件</p>
</li>
<li><p>1 个静态同步方法，1 个普通同步方法，2 部手机，先打印短信还是邮件</p>
</li>
</ol>
<h3 id="问题答案-🤫"><a href="#问题答案-🤫" class="headerlink" title="问题答案 🤫"></a>问题答案 🤫</h3><ol>
<li>短信</li>
<li>短信</li>
<li>Hello</li>
<li>邮件</li>
<li>短信</li>
<li>短信</li>
<li>邮件</li>
<li>邮件</li>
</ol>
<h3 id="问题分析-🧐"><a href="#问题分析-🧐" class="headerlink" title="问题分析 🧐"></a>问题分析 🧐</h3><ul>
<li><code>synchronization</code>关键字锁的是对象，且当对象被锁时，需要等待锁被释放后其他线程才能获得锁</li>
<li>当<code>synchronization</code>修饰普通方法时，锁的是实例对象</li>
<li>当<code>synchronization</code>修饰的是静态方法时，锁的是类对象</li>
</ul>
<h2 id="不安全集合-🚨"><a href="#不安全集合-🚨" class="headerlink" title="不安全集合 🚨"></a>不安全集合 🚨</h2><blockquote>
<p>总所周知<code>HashMap</code>、<code>ArrayList</code>、<code>HashSet</code>都是线程不安全的，那么我们应该怎么去在多线程情况下去保证集合的线程安全呢？</p>
</blockquote>
<h3 id="证明线程不安全-🤯"><a href="#证明线程不安全-🤯" class="headerlink" title="证明线程不安全 🤯"></a>证明线程不安全 🤯</h3><p><strong>运行以下代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; arr = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">30</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> i = j;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        String key = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>) + Thread.currentThread().getName() + i;</span><br><span class="line">        arr.add(key);</span><br><span class="line">        System.out.println(arr);</span><br><span class="line">    &#125;, <span class="string">&quot;线程&quot;</span> + j + <span class="string">&quot;：&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143558545.png" alt="image-20210413143558545"></p>
<p>可以看到，运行上面的代码后出现了<code>java.util.ConcurrentModificationException</code>（并发修改异常）异常，ArrayList 在迭代的时候如果对其进行修改就会抛出这个异常</p>
<ul>
<li><p><strong>解决方案：</strong></p>
<ul>
<li><p><strong>方案一：</strong> Vector</p>
<ul>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413143920131.png" alt="image-20210413143920131"></li>
<li>我们可以选择使用<code>Vector</code>这个线程安全的集合</li>
<li>下面这个是<code>Vector</code>添加元素的源码，可以看到该方法上面添加了<code>synchronization</code>关键字，保证了线程安全</li>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144051872.png" alt="image-20210413144051872"></li>
</ul>
</li>
<li><p><strong>方案二：</strong> Collections</p>
<ul>
<li>使用<code>Collections#synchronizedList</code>方法将<code>ArrayList</code>转换成线程安全的</li>
<li><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413144654816.png" alt="image-20210413144654816"></li>
<li>可以看到实际上也是使用了<code>synchronization</code>关键字来保证的线程安全</li>
</ul>
</li>
<li><p><strong>方案三：</strong> 写时复制</p>
<ul>
<li><p>虽然不加锁性能好但是会出错误，加锁又会导致性能下降</p>
</li>
<li><p>我们可以折中一下使用<code>CopyOnWriteArrayList</code></p>
</li>
<li><blockquote>
<p>A thread-safe variant of ArrayList in which all mutative operations (add, set, and so on) are implemented by making a fresh copy of the underlying array.</p>
<p>CopyOnWriteArrayList 是 arraylist 的一种线程安全变体，其中所有可变操作（add、set 等）都是通过生成底层数组的新副本来实现的。</p>
</blockquote>
</li>
<li><p><code>CopyOnWrite</code>容器即<strong>写时复制的容器</strong>。往一个容器<strong>添加元素</strong>的时候，不直接往当前容器<code>Object[]</code>添加，而是<strong>先将当前容器<code>Object[]</code>进行 Copy</strong>，复制出一个新的容器<code>Object[] newElements</code>，然后向新的容器<code>Object[] newElements</code>里添加元素。添加元素后，<strong>再将原容器的引用指向新的容器<code>setArray(newElements)</code><strong>。这样做的好处是可以对<code>CopyOnWrite</code>容器进行</strong>并发的读</strong>，而不需要加锁，因为当前容器不会添加任何元素。所以<code>CopyOnWrite</code>容器也是一种<strong>读写分离的思想</strong>，读和写不同的容器。</p>
<ol>
<li>先复制</li>
<li>往复制的数组中添加元素</li>
<li>将原容器的引用指向复制的数组</li>
</ol>
</li>
<li><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413151325401.png" alt="image-20210413151325401"></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Callable-接口-↩️"><a href="#Callable-接口-↩️" class="headerlink" title="Callable 接口 ↩️"></a>Callable 接口 ↩️</h2><h3 id="是什么-❓"><a href="#是什么-❓" class="headerlink" title="是什么 ❓"></a>是什么 ❓</h3><h4 id="面试题：获得多线程的方法几种？"><a href="#面试题：获得多线程的方法几种？" class="headerlink" title="面试题：获得多线程的方法几种？"></a>面试题：获得多线程的方法几种？</h4><p><strong>不完整答案：</strong> 继承<code>Thread</code>类 和 实现<code>Runnable</code>接口</p>
<p>==<strong>如果只回答这两个你连被问到 juc 的机会都没有</strong>==</p>
<p><strong>正确答案如下：</strong></p>
<p><strong>传统的是</strong>继承<code>Thread</code>类 和 实现<code>Runnable</code>接口，<br><strong>java5 以后</strong>又有实现<code>Callable</code>接口 和 java 的线程池 获得</p>
<h4 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413153235849.png" alt="image-20210413153235849"></p>
<p>这是一个函数式接口，因此可以用作 lambda 表达式或方法引用的赋值对象</p>
<h3 id="与-Runnable-接口的对比-😦"><a href="#与-Runnable-接口的对比-😦" class="headerlink" title="与 Runnable 接口的对比 😦"></a>与 Runnable 接口的对比 😦</h3><p><strong>编码方面的区别</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建新类MyThread实现runnable接口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新类MyThread2实现callable接口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>面试题：callable 接口与 runnable 接口的区别？</strong></p>
<ul>
<li>Callable 接口有返回值，Runnable 接口没有</li>
<li>Callable 接口可以抛出异常，Runnable 接口不行</li>
<li>落地方法不一样，一个是 run，一个是 call</li>
</ul>
<h3 id="怎么用-🔧-1"><a href="#怎么用-🔧-1" class="headerlink" title="怎么用 🔧"></a>怎么用 🔧</h3><h4 id="直接替换-runnable-是否可行？"><a href="#直接替换-runnable-是否可行？" class="headerlink" title="直接替换 runnable 是否可行？"></a>直接替换 runnable 是否可行？</h4><p>我们来尝试一下能不能直接替换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里会报错</span></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread2(), <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154606831.png" alt="image-20210413154606831"></p>
<h4 id="曲线救国"><a href="#曲线救国" class="headerlink" title="曲线救国"></a>曲线救国</h4><p>可以看到不能直接把<code>runnable</code>接口的实现直接换成<code>callable</code>接口的实现，那么我们可以采用曲线救国的方式来修改</p>
<p>我们知道接口可以多继承，那么我们找一个实现了<code>runnable</code>和<code>callable</code>接口的类不就好了嘛 🤣</p>
<p>那么热烈欢迎我们的<code>FutureTask</code>同学登场</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413154959592.png" alt="image-20210413154959592"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> MyThread());</span><br><span class="line">    <span class="keyword">new</span> Thread(ft, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155210045.png" alt="image-20210413155210045"></p>
<p>当当当，这样就没有报错啦。但是我们发现好像并没有把我们的 200 给输出欸，那么我们怎么获得返回值呢？</p>
<p>使用：<code>ft.get();</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413155428880.png" alt="image-20210413155428880"></p>
<p>这个方法会阻塞主线程，直到任务线程运行结束</p>
<h3 id="FutureTask😲"><a href="#FutureTask😲" class="headerlink" title="FutureTask😲"></a>FutureTask😲</h3><blockquote>
<p>我们现在来正式介绍一下<code>FutureTask</code>类</p>
</blockquote>
<h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p>未来的任务，用它就干一件事，<strong>异步调用</strong></p>
<p>你可以使用它来创建一个任务并再创建一个线程来执行这个任务，线程开启后它会默默执行，你使用<code>ft.get();</code>就可以得到该任务的返回值</p>
<h5 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h5><p>老师上着课，口渴了，去买水不合适，讲课线程继续，我可以单起个线程找班长帮忙买水，水买回来了放桌上，我需要的时候再去 get。</p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><ul>
<li>在主线程中需要执行<strong>比较耗时</strong>的操作时，但又<strong>不想阻塞主线程</strong>时，可以把这些作业交给 Future 对象在后台完成，当主线程将来需要时，就可以通过 Future 对象获得后台作业的计算结果或者执行状态。</li>
<li>一般 FutureTask 多用于<strong>耗时的计算</strong>，主线程可以在完成自己的任务后，再去获取结果。</li>
<li>仅在计算完成时才能检索结果；<ul>
<li>如果计算尚未完成，则阻塞 get 方法。</li>
<li>一旦计算完成，就不能再重新开始或取消计算。</li>
<li>get 方法而获取结果只有在计算完成时获取，否则会一直阻塞直到任务转入完成状态，然后会返回结果或者抛出异常。</li>
<li>只计算一次</li>
</ul>
</li>
</ul>
<h2 id="JUC-强大的辅助类讲解-🧰"><a href="#JUC-强大的辅助类讲解-🧰" class="headerlink" title="JUC 强大的辅助类讲解 🧰"></a>JUC 强大的辅助类讲解 🧰</h2><h3 id="CountDownLatch-减少计数-➖"><a href="#CountDownLatch-减少计数-➖" class="headerlink" title="CountDownLatch 减少计数 ➖"></a>CountDownLatch 减少计数 ➖</h3><ul>
<li>CountDownLatch 主要有两个方法，当一个或多个线程调用 await 方法时，这些线程会阻塞。</li>
<li>其它线程调用 countDown 方法会将计数器减 1(调用 countDown 方法的线程不会阻塞)，</li>
<li>当计数器的值变为 0 时，因 await 方法阻塞的线程会被唤醒，继续执行。</li>
</ul>
<h4 id="应用场景举例"><a href="#应用场景举例" class="headerlink" title="应用场景举例"></a>应用场景举例</h4><p>6 个同学陆续离开教室后值班同学才可以关门。</p>
<h4 id="代码举例"><a href="#代码举例" class="headerlink" title="代码举例"></a>代码举例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//6个上自习的同学，各自离开教室的时间不一致</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t 号同学离开教室&quot;</span>);</span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t****** 班长关门走人，main线程是班长&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CyclicBarrier-循环栅栏-🚧"><a href="#CyclicBarrier-循环栅栏-🚧" class="headerlink" title="CyclicBarrier 循环栅栏 🚧"></a>CyclicBarrier 循环栅栏 🚧</h3><ul>
<li>CyclicBarrier 的字面意思是可循环（Cyclic）使用的屏障（Barrier）。它要做的事情是，让一组线程到达一个屏障（也可以叫同步点）时被阻塞，直到最后一个线程到达屏障时，屏障才会开门，所有被屏障拦截的线程才会继续干活。线程进入屏障通过 CyclicBarrier 的 await()方法。</li>
</ul>
<h4 id="应用场景举例-1"><a href="#应用场景举例-1" class="headerlink" title="应用场景举例"></a>应用场景举例</h4><p>老师需要等所有学生（7 个）到了才上课</p>
<h4 id="代码举例-1"><a href="#代码举例-1" class="headerlink" title="代码举例"></a>代码举例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(NUMBER, ()-&gt;System.out.println(<span class="string">&quot;*****老师开始上课*****&quot;</span>)) ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;到教室了&quot;</span>);</span><br><span class="line">                    cyclicBarrier.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)+<span class="string">&quot;同学&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Semaphore-信号灯-🚦"><a href="#Semaphore-信号灯-🚦" class="headerlink" title="Semaphore 信号灯 🚦"></a>Semaphore 信号灯 🚦</h3><ul>
<li>在信号量上我们定义两种操作：<ul>
<li>acquire（获取） 当一个线程调用 acquire 操作时，它要么通过成功获取信号量（信号量减 1），要么一直等下去，直到有线程释放信号量，或超时。</li>
<li>release（释放）实际上会将信号量的值加 1，然后唤醒等待的线程。</li>
</ul>
</li>
<li>信号量主要用于两个目的，一个是用于多个共享资源的互斥使用，另一个用于并发线程数的控制。</li>
</ul>
<h4 id="应用场景举例-2"><a href="#应用场景举例-2" class="headerlink" title="应用场景举例"></a>应用场景举例</h4><p>六辆车抢三个车位，需要等停车位上面的车离开后，外面的车才能进来</p>
<h4 id="代码举例-2"><a href="#代码举例-2" class="headerlink" title="代码举例"></a>代码举例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);<span class="comment">//模拟3个停车位</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) <span class="comment">//模拟6部汽车</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t 抢到了车位&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">5</span>));</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t------- 离开&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ReentrantReadWriteLock-读写锁-🔐"><a href="#ReentrantReadWriteLock-读写锁-🔐" class="headerlink" title="ReentrantReadWriteLock 读写锁 🔐"></a>ReentrantReadWriteLock 读写锁 🔐</h2><h3 id="是什么-❓-1"><a href="#是什么-❓-1" class="headerlink" title="是什么 ❓"></a>是什么 ❓</h3><p>读写锁定义其实很简单，就是：</p>
<ul>
<li>读的时候别人不能写</li>
<li>写的时候别人不能读</li>
<li>写的时候别人不能写</li>
<li>读的时候别人可以读</li>
</ul>
<p>再简单点说就是：读写不能同时进行，读读可以</p>
<h3 id="问题举例-🌰"><a href="#问题举例-🌰" class="headerlink" title="问题举例 🌰"></a>问题举例 🌰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 正在写&quot;</span> + key);</span><br><span class="line">        <span class="comment">//暂停一会儿线程</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 写完了&quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 正在读&quot;</span> + key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        result = map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 读完了&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1	 正在写1</span><br><span class="line">2	 正在写2</span><br><span class="line">5	 正在写5</span><br><span class="line">1	 正在读1</span><br><span class="line">4	 正在读4</span><br><span class="line">5	 正在读5</span><br><span class="line">3	 正在写3</span><br><span class="line">4	 正在写4</span><br><span class="line">2	 正在读2</span><br><span class="line">3	 正在读3</span><br><span class="line">1	 读完了null</span><br><span class="line">2	 写完了2</span><br><span class="line">4	 读完了null</span><br><span class="line">5	 读完了null</span><br><span class="line">3	 读完了null</span><br><span class="line">2	 读完了2</span><br><span class="line">4	 写完了4</span><br><span class="line">3	 写完了3</span><br><span class="line">1	 写完了1</span><br><span class="line">5	 写完了5</span><br></pre></td></tr></table></figure>

<p>可以看到我们还没写完就开始读了，还没读完就开始写了，这样就会导致线程安全的问题，不能保证操作的原子性</p>
<h3 id="使用读写锁的代码-👩‍💻"><a href="#使用读写锁的代码-👩‍💻" class="headerlink" title="使用读写锁的代码 👩‍💻"></a>使用读写锁的代码 👩‍💻</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> ReadWriteLock rwLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 正在写&quot;</span> + key);</span><br><span class="line">            <span class="comment">//暂停一会儿线程</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 写完了&quot;</span> + key);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 正在读&quot;</span> + key);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            result = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 读完了&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.put(num + <span class="string">&quot;&quot;</span>, num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                myCache.get(num + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1	 正在写1</span><br><span class="line">1	 写完了1</span><br><span class="line"></span><br><span class="line">3	 正在写3</span><br><span class="line">3	 写完了3</span><br><span class="line"></span><br><span class="line">4	 正在写4</span><br><span class="line">4	 写完了4</span><br><span class="line"></span><br><span class="line">2	 正在写2</span><br><span class="line">2	 写完了2</span><br><span class="line"></span><br><span class="line">5	 正在写5</span><br><span class="line">5	 写完了5</span><br><span class="line"></span><br><span class="line">1	 正在读1</span><br><span class="line">2	 正在读2</span><br><span class="line">3	 正在读3</span><br><span class="line">4	 正在读4</span><br><span class="line">5	 正在读5</span><br><span class="line">4	 读完了4</span><br><span class="line">2	 读完了2</span><br><span class="line">1	 读完了1</span><br><span class="line">5	 读完了5</span><br><span class="line">3	 读完了3</span><br></pre></td></tr></table></figure>

<p>可以看到使用了读写锁后，在写的时候没有被打断了，但是读和读之间可以随意打断</p>
<h2 id="BlockingQueue-阻塞队列-⏳"><a href="#BlockingQueue-阻塞队列-⏳" class="headerlink" title="BlockingQueue 阻塞队列 ⏳"></a>BlockingQueue 阻塞队列 ⏳</h2><h3 id="是什么-❓-2"><a href="#是什么-❓-2" class="headerlink" title="是什么 ❓"></a>是什么 ❓</h3><p>虽然说程序运行中阻塞不好，但是有些时候我们必须使用阻塞来完成某些事情</p>
<p><strong>阻塞：必须要阻塞/不得不阻塞</strong></p>
<p>阻塞队列是一个队列，在数据结构中起的作用如下图：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413170339956.png" alt="image-20210413170339956"></p>
<ul>
<li>当队列是空的，从队列中获取元素的操作将会被阻塞</li>
<li>当队列是满的，从队列中添加元素的操作将会被阻塞</li>
<li>试图从空的队列中获取元素的线程将会被阻塞，直到其他线程往空的队列插入新的元素</li>
<li>试图向已满的队列中添加新元素的线程将会被阻塞，直到其他线程从队列中移除一个或多个元素或者完全清空，使队列变得空闲起来并后续新增</li>
</ul>
<h3 id="阻塞队列的用处-🤔"><a href="#阻塞队列的用处-🤔" class="headerlink" title="阻塞队列的用处 🤔"></a>阻塞队列的用处 🤔</h3><ul>
<li>在多线程领域：<ul>
<li>所谓阻塞，在某些情况下会<strong>挂起线程</strong>（即阻塞），一旦条件满足，被挂起的线程又会<strong>自动被唤起</strong></li>
</ul>
</li>
<li>为什么需要 BlockingQueue：<ul>
<li>好处是我们<strong>不需要关心什么时候需要阻塞线程</strong>，<strong>什么时候需要唤醒线程</strong>，因为这一切 BlockingQueue 都给你一手包办</li>
<li>在 concurrent 包发布以前，在多线程环境下，我们<strong>每个程序员都必须去自己控制这些细节，尤其还要兼顾效率和线程安全</strong>，而这会给我们的程序带来不小的复杂度。</li>
</ul>
</li>
</ul>
<h3 id="架构梳理、种类分析-📚"><a href="#架构梳理、种类分析-📚" class="headerlink" title="架构梳理、种类分析 📚"></a>架构梳理、种类分析 📚</h3><ul>
<li><p>架构介绍</p>
<img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192734518.png" alt="image-20210413192734518" style="zoom:200%;"></li>
<li><p>种类分析</p>
<ul>
<li>ArrayBlockingQueue：由数组结构组成的有界阻塞队列。</li>
<li>LinkedBlockingQueue：由链表结构组成的有界（但大小默认值为 integer.MAX_VALUE）阻塞队列。</li>
<li>PriorityBlockingQueue：支持优先级排序的无界阻塞队列。</li>
<li>DelayQueue：使用优先级队列实现的延迟无界阻塞队列。</li>
<li>SynchronousQueue：不存储元素的阻塞队列，也即单个元素的队列。</li>
<li>LinkedTransferQueue：由链表组成的无界阻塞队列。</li>
<li>LinkedBlockingDeque：由链表组成的双向阻塞队列。</li>
</ul>
</li>
</ul>
<h3 id="BlockingQueue-核心方法-💠"><a href="#BlockingQueue-核心方法-💠" class="headerlink" title="BlockingQueue 核心方法 💠"></a>BlockingQueue 核心方法 💠</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413192944228.png" alt="image-20210413192944228"></p>
<table>
<thead>
<tr>
<th>方法类型</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td>抛出异常</td>
<td align="center">当阻塞队列满时，再往队列里 add 插入元素会抛 IllegalStateException:Queue full 当阻塞队列空时，再往队列里 remove 移除元素会抛 NoSuchElementException</td>
</tr>
<tr>
<td>特殊值</td>
<td align="center">插入方法，成功 ture 失败 false 移除方法，成功返回出队列的元素，队列里没有就返回 null</td>
</tr>
<tr>
<td>一直阻塞</td>
<td align="center">当阻塞队列满时，生产者线程继续往队列里 put 元素，队列会一直阻塞生产者线程直到 put 数据 or 响应中断退出 当阻塞队列空时，消费者线程试图从队列里 take 元素，队列会一直阻塞消费者线程直到队列可用</td>
</tr>
<tr>
<td>超时退出</td>
<td align="center">当阻塞队列满时，队列会阻塞生产者线程一定时间，超过限时后生产者线程会退出</td>
</tr>
</tbody></table>
<p><strong>示例代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 阻塞队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockingQueueDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//        List list = new ArrayList();</span></span><br><span class="line"></span><br><span class="line">        BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//第一组</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.add(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.element());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//System.out.println(blockingQueue.add(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.remove());</span></span><br><span class="line">        <span class="comment">//    第二组</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;a&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;b&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;c&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.offer(&quot;x&quot;));</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line">        <span class="comment">//    第三组</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;a&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//         blockingQueue.put(&quot;c&quot;);</span></span><br><span class="line">        <span class="comment">//         //blockingQueue.put(&quot;x&quot;);</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line">        <span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//    第四组</span></span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>,<span class="number">3L</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ThreadPool-线程池-🌊"><a href="#ThreadPool-线程池-🌊" class="headerlink" title="ThreadPool 线程池 🌊"></a>ThreadPool 线程池 🌊</h2><h3 id="为什么用线程池-❓"><a href="#为什么用线程池-❓" class="headerlink" title="为什么用线程池 ❓"></a>为什么用线程池 ❓</h3><h4 id="举个栗子-🌰-1"><a href="#举个栗子-🌰-1" class="headerlink" title="举个栗子 🌰"></a>举个栗子 🌰</h4><ul>
<li>10 年前单核 CPU 电脑，假的多线程，像马戏团小丑玩多个球，CPU 需要来回切换。</li>
<li>现在是多核电脑，多个线程各自跑在独立的 CPU 上，不用切换效率高。</li>
</ul>
<h4 id="线程池的优势-👍"><a href="#线程池的优势-👍" class="headerlink" title="线程池的优势 👍"></a>线程池的优势 👍</h4><blockquote>
<p>线程池做的工作只要是控制运行的线程数量，<strong>处理过程中将任务放入队列</strong>，然后在线程创建后启动这些任务，<strong>如果线程数量超过了最大数量，超出数量的线程排队等候</strong>，等其他线程执行完毕，再从队列中取出任务来执行。</p>
</blockquote>
<p><strong>它的主要特点为：</strong></p>
<blockquote>
<ol>
<li><strong>线程复用</strong></li>
<li><strong>控制最大并发数</strong></li>
<li><strong>管理线程</strong></li>
</ol>
</blockquote>
<ul>
<li><strong>降低资源消耗：</strong>通过重复利用已创建的线程降低线程创建和销毁造成的销耗。</li>
<li><strong>提高响应速度：</strong>当任务到达时，任务可以不需要等待线程创建就能立即执行。</li>
<li><strong>提高线程的可管理性：</strong>线程是稀缺资源，如果无限制的创建，不仅会销耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</li>
</ul>
<h3 id="怎么用-🦾"><a href="#怎么用-🦾" class="headerlink" title="怎么用 🦾"></a>怎么用 🦾</h3><h4 id="架构说明"><a href="#架构说明" class="headerlink" title="架构说明"></a>架构说明</h4><blockquote>
<p>Java 中的线程池是通过<code>Executor</code>框架实现的，该框架中用到了<code>Executor</code>，<code>Executors</code>，<code>ExecutorService</code>，<code>ThreadPoolExecutor</code>这几个类</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618314213310.jpg" alt="graphic" style="zoom:200%;">

<h4 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h4><ul>
<li><p><strong>FixedThreadPool</strong></p>
<p>固定线程数的线程池</p>
<p><code>Executors.newFixedThreadPool(int)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newFixedThreadPool</code>创建的线程池<code>corePoolSize</code>和<code>maximumPoolSize</code>值是相等的，它使用的是<code>LinkedBlockingQueue</code></p>
<p>执行长期任务性能好，创建一个线程池， 一池有 N 个固定的线程，有固定线程数的线程</p>
</li>
<li><p><strong>SingleThreadExecutor</strong></p>
<p>只有一个线程的线程池，一个任务一个任务的执行，一池一线程</p>
<p><code>Executors.newSingleThreadExecutor()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newSingleThreadExecutor </code>创建的线程池<code>corePoolSize</code>和<code>maximumPoolSize</code>值都是 1，它使用的是<code>LinkedBlockingQueue</code></p>
</li>
<li><p><strong>CachedThreadPool</strong></p>
<p>可以动态修改线程数量的线程池</p>
<p><code>Executors.newCachedThreadPool()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>newCachedThreadPool</code>创建的线程池将<code>corePoolSize</code>设置为 0，将<code>maximumPoolSize</code>设置为<code>Integer.MAX_VALUE</code>，它使用的是<code>SynchronousQueue</code>，也就是说来了任务就创建线程运行，当线程空闲超过 60 秒，就销毁线程。</p>
<p>执行很多短期异步任务，线程池根据需要创建新线程， 但在先前构建的线程可用时将重用它们。可扩容，遇强则强</p>
</li>
<li><p><strong>举例代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线程池</span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//固定数的线程池，一池五线程</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //一个银行网点，5个受理业务的窗口</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //一个银行网点，1个受理业务的窗口</span></span><br><span class="line">        ExecutorService threadPool =  Executors.newCachedThreadPool(); <span class="comment">//一个银行网点，可扩展受理业务的窗口</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10个顾客请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t 办理业务&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="使用Executors工具类创建线程池的详解"><a href="#使用Executors工具类创建线程池的详解" class="headerlink" title="使用Executors工具类创建线程池的详解"></a>使用<code>Executors</code>工具类创建线程池的详解</h4><blockquote>
<p>其实使用<code>Executors</code>工具类创建的线程池，实际上都是操作的<code>ThreadPoolExecutor</code>类来创建的线程池</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413195750394.png" alt="image-20210413195750394"></p>
<h3 id="线程池几个重要参数-💨"><a href="#线程池几个重要参数-💨" class="headerlink" title="线程池几个重要参数 💨"></a>线程池几个重要参数 💨</h3><blockquote>
<p>就是创建<code>ThreadPoolExecutor</code>类所需的 7 个属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ThreadPoolExecutor类的构造器</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>corePoolSize：</strong>线程池中的常驻核心线程数</li>
<li><strong>maximumPoolSize</strong>：线程池中能够容纳同时 执行的最大线程数，此值必须大于等于 1</li>
<li><strong>keepAliveTime</strong>：多余的空闲线程的存活时间 当前池中线程数量超过 corePoolSize 时，当空闲时间 达到 keepAliveTime 时，多余线程会被销毁直到 只剩下 corePoolSize 个线程为止</li>
<li><strong>unit</strong>：keepAliveTime 的单位</li>
<li><strong>workQueue</strong>：任务队列，被提交但尚未被执行的任务</li>
<li><strong>threadFactory</strong>：表示生成线程池中工作线程的线程工厂， 用于创建线程，一般默认的即可</li>
<li><strong>handler</strong>：拒绝策略，表示当队列满了，并且工作线程大于 等于线程池的最大线程数（maximumPoolSize）时如何来拒绝 请求执行的 runnable 的策略</li>
</ol>
<h3 id="线程池底层工作原理-🔍"><a href="#线程池底层工作原理-🔍" class="headerlink" title="线程池底层工作原理 🔍"></a>线程池底层工作原理 🔍</h3><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001.jpg" alt="graphic"><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003.jpg" alt="graphic"></p>
<p>==<strong>以下重要 ❗ 以下重要 ❗ 以下重要 ❗ 以下重要 ❗ 以下重要 ❗ 以下重要 ❗</strong>==</p>
<ol>
<li>在创建了线程池后，开始<strong>等待请求</strong>。</li>
<li>当调用**<code>execute()</code><strong>方法添加一个请求任务时，线程池会做出</strong>如下判断**：<ol>
<li>如果正在运行的<strong>线程数量小于 <code>corePoolSize</code><strong>，那么</strong>马上创建线程运行这个任务</strong>；</li>
<li>如果正在运行的<strong>线程数量大于或等于<code>corePoolSize</code><strong>，那么将这个任务</strong>放入队列</strong>；</li>
<li>如果这个时候<strong>队列满了且正在运行的线程数量还小于<code>maximumPoolSize</code><strong>，那么还是要</strong>创建非核心线程立刻运行这个任务</strong>；</li>
<li>如果<strong>队列满了且正在运行的线程数量大于或等于<code>maximumPoolSize</code><strong>，那么线程池会启动</strong>饱和拒绝策略来执行</strong>。</li>
</ol>
</li>
<li>当一个线程完成任务时，它会<strong>从队列中取下一个任务来执行</strong>。</li>
<li>当一个线程<strong>无事可做</strong>超过一定的时间（**<code>keepAliveTime</code>**）时，线程会判断：<ol>
<li>如果当前<strong>运行的线程数大于<code>corePoolSize</code><strong>，那么这个线程就被</strong>停掉</strong>。</li>
<li>所以线程池的所有任务完成后，它最终会收缩到**<code>corePoolSize</code>**的大小。</li>
</ol>
</li>
</ol>
<h3 id="线程池的拒绝策略-⏸"><a href="#线程池的拒绝策略-⏸" class="headerlink" title="线程池的拒绝策略 ⏸"></a>线程池的拒绝策略 ⏸</h3><h4 id="是什么-❓-3"><a href="#是什么-❓-3" class="headerlink" title="是什么 ❓"></a>是什么 ❓</h4><blockquote>
<p><strong>等待队列已经排满了，再也塞不下新任务了</strong>。同时，<strong>线程池中的 max 线程也达到了，无法继续为新任务服务</strong>。这个是时候我们就需要拒绝策略机制合理的处理这个问题。</p>
</blockquote>
<ul>
<li>JDK 内置的拒绝策略<ul>
<li><strong>AbortPolicy(默认)：</strong>直接抛出 RejectedExecutionException 异常阻止系统正常运行</li>
<li><strong>CallerRunsPolicy：</strong>“调用者运行”一种调节机制，该策略既不会抛弃任务，也不 会抛出异常，而是将某些任务回退到调用者，从而降低新任务的流量。</li>
<li><strong>DiscardOldestPolicy：</strong>抛弃队列中等待最久的任务，然后把当前任务加人队列中 尝试再次提交当前任务。</li>
<li><strong>DiscardPolicy：</strong>该策略默默地丢弃无法处理的任务，不予任何处理也不抛出异常。 如果允许任务丢失，这是最好的一种策略。</li>
</ul>
</li>
<li>以上内置拒绝策略均实现了 <code>RejectedExecutionHandle</code>接口</li>
</ul>
<h3 id="线程池的一些问题-❓"><a href="#线程池的一些问题-❓" class="headerlink" title="线程池的一些问题 ❓"></a>线程池的一些问题 ❓</h3><h4 id="在工作中单一的-固定数的-可变的三种创建线程池的方法哪个用的多？超级大坑"><a href="#在工作中单一的-固定数的-可变的三种创建线程池的方法哪个用的多？超级大坑" class="headerlink" title="在工作中单一的/固定数的/可变的三种创建线程池的方法哪个用的多？超级大坑"></a>在工作中单一的/固定数的/可变的三种创建线程池的方法哪个用的多？超级大坑</h4><p>==<strong>答案是一个都不用，我们工作中只能使用自定义的</strong>==</p>
<p>Executors 中 JDK 已经给你提供了，为什么不用？</p>
<p>阿里巴巴 Java 开发手册中规定</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413202451128.png" alt="image-20210413202451128"></p>
<h4 id="在工作中如何使用线程池，是否自定义过线程池"><a href="#在工作中如何使用线程池，是否自定义过线程池" class="headerlink" title="在工作中如何使用线程池，是否自定义过线程池"></a>在工作中如何使用线程池，是否自定义过线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线程池</span></span><br><span class="line"><span class="comment"> * Arrays</span></span><br><span class="line"><span class="comment"> * Collections</span></span><br><span class="line"><span class="comment"> * Executors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPoolDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="number">5</span>,</span><br><span class="line">            <span class="number">2L</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">3</span>),</span><br><span class="line">            Executors.defaultThreadFactory(),</span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.AbortPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.CallerRunsPolicy()</span></span><br><span class="line">            <span class="comment">//new ThreadPoolExecutor.DiscardOldestPolicy()</span></span><br><span class="line">            <span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy()</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//10个顾客请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 办理业务&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">threadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//List list = new ArrayList();</span></span><br><span class="line">        <span class="comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span></span><br><span class="line">        <span class="comment">//固定数的线程池，一池五线程</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //一个银行网点，5个受理业务的窗口</span></span><br><span class="line">        <span class="comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //一个银行网点，1个受理业务的窗口</span></span><br><span class="line">        ExecutorService threadPool = Executors.newCachedThreadPool(); <span class="comment">//一个银行网点，可扩展受理业务的窗口</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//10个顾客请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 办理业务&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分支合并框架-🔱"><a href="#分支合并框架-🔱" class="headerlink" title="分支合并框架 🔱"></a>分支合并框架 🔱</h2><h3 id="是什么-❓-4"><a href="#是什么-❓-4" class="headerlink" title="是什么 ❓"></a>是什么 ❓</h3><blockquote>
<p>可以将任务进行分发并启用一个线程去执行，可以理解成多线程版的递归,因为在执行模型上还挺像的</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413203059515.png" alt="image-20210413203059515"></p>
<p><strong>主要的两个方法：</strong></p>
<ul>
<li>Fork：把一个复杂任务进行分拆，大事化小</li>
<li>Join：把分拆任务的结果进行合并</li>
</ul>
<h3 id="相关类-🙄"><a href="#相关类-🙄" class="headerlink" title="相关类 🙄"></a>相关类 🙄</h3><h4 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image001-1618317139087.jpg" alt="graphic"></p>
<p>分支合并池 类比=&gt; 线程池</p>
<h4 id="ForkJoinTask"><a href="#ForkJoinTask" class="headerlink" title="ForkJoinTask"></a>ForkJoinTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image002-1618317139089.jpg" alt="graphic"></p>
<p>ForkJoinTask 类比=&gt; FutureTask</p>
<h4 id="RecursiveTask"><a href="#RecursiveTask" class="headerlink" title="RecursiveTask"></a>RecursiveTask</h4><p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/clip_image003-1618317139089.jpg" alt="graphic"></p>
<p>递归任务：继承后可以实现递归(自己调自己)调用的任务</p>
<h3 id="代码举例-👩‍💻"><a href="#代码举例-👩‍💻" class="headerlink" title="代码举例 👩‍💻"></a>代码举例 👩‍💻</h3><h4 id="实现斐波那契数列"><a href="#实现斐波那契数列" class="headerlink" title="实现斐波那契数列"></a>实现斐波那契数列</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> n;</span><br><span class="line">    Fibonacci(<span class="keyword">int</span> n) &#123; <span class="keyword">this</span>.n = n; &#125;</span><br><span class="line">    <span class="function">Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        Fibonacci f1 = <span class="keyword">new</span> Fibonacci(n - <span class="number">1</span>);</span><br><span class="line">        f1.fork();</span><br><span class="line">        Fibonacci f2 = <span class="keyword">new</span> Fibonacci(n - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> f2.compute() + f1.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现一加到一百"><a href="#实现一加到一百" class="headerlink" title="实现一加到一百"></a>实现一加到一百</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ADJUST_VALUE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> begin;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.begin = begin;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((end - begin)&lt;=ADJUST_VALUE)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =begin;i &lt;= end;i++)&#123;</span><br><span class="line">                result = result + i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> middle = (begin + end)/<span class="number">2</span>;</span><br><span class="line">            MyTask task01 = <span class="keyword">new</span> MyTask(begin,middle);</span><br><span class="line">            MyTask task02 = <span class="keyword">new</span> MyTask(middle+<span class="number">1</span>,end);</span><br><span class="line">            task01.fork();</span><br><span class="line">            task02.fork();</span><br><span class="line">            result =  task01.join() + task02.join();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分支合并例子</span></span><br><span class="line"><span class="comment"> * ForkJoinPool</span></span><br><span class="line"><span class="comment"> * ForkJoinTask</span></span><br><span class="line"><span class="comment"> * RecursiveTask</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForkJoinDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyTask myTask = <span class="keyword">new</span> MyTask(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        ForkJoinTask&lt;Integer&gt; forkJoinTask = forkJoinPool.submit(myTask);</span><br><span class="line"></span><br><span class="line">        System.out.println(forkJoinTask.get());</span><br><span class="line"></span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="异步回调-🔁"><a href="#异步回调-🔁" class="headerlink" title="异步回调 🔁"></a>异步回调 🔁</h2><blockquote>
<p>这个很简单啦,就是创建一个线程去异步的调用你所写的方法,只不过对执行途中的各个环节有提供回调,可以灵活的处理,比如出现异常会调用<code>exceptionally</code>函数中传入的回调函数</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/image-20210413204257768.png" alt="image-20210413204257768"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//同步，异步，异步回调</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//同步</span></span><br><span class="line">        <span class="comment">//        CompletableFuture&lt;Void&gt; completableFuture1 = CompletableFuture.runAsync(()-&gt;&#123;</span></span><br><span class="line">        <span class="comment">//            System.out.println(Thread.currentThread().getName()+&quot;\t completableFuture1&quot;);</span></span><br><span class="line">        <span class="comment">//        &#125;);</span></span><br><span class="line">        <span class="comment">//        completableFuture1.get();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//异步回调</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t completableFuture2&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        completableFuture2.whenComplete((t,u)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-------t=&quot;</span>+t);</span><br><span class="line">            System.out.println(<span class="string">&quot;-------u=&quot;</span>+u);</span><br><span class="line">        &#125;).exceptionally(f-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----exception:&quot;</span>+f.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">444</span>;</span><br><span class="line">        &#125;).get();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">LLQWQ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/">http://llqwq.gitee.io/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://llqwq.gitee.io" target="_blank">LLQWQ的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/JUC/">JUC</a><a class="post-meta__tags" href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">高并发编程</a></div><div class="post_share"><div class="social-share" data-image="/img/Java-JUC-cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/"><img class="next-cover" data-lazy-src="/img/default_top.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据结构 学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/01/05/spring-boot/spring-boot/" title="spring boot 学习笔记"><img class="cover" data-lazy-src="/img/Spring-Boot.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-05</div><div class="title">spring boot 学习笔记</div></div></a></div><div><a href="/2020/07/05/spring-cloud/spring-cloud/" title="Spring Cloud 学习笔记"><img class="cover" data-lazy-src="/img/spring-cloud-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">Spring Cloud 学习笔记</div></div></a></div><div><a href="/2020/02/05/spring-boot/错误整理/" title="Spring-Boot 错误记录"><img class="cover" data-lazy-src="/img/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-02-05</div><div class="title">Spring-Boot 错误记录</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/48668845.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">LLQWQ</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LLQWQ"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LLQWQ" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://gitee.com/LLQWQ" target="_blank" title="Gitee"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JUC-%E6%98%AF%E4%BB%80%E4%B9%88-%F0%9F%98%A6"><span class="toc-number">1.</span> <span class="toc-text">JUC 是什么 😦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B%E5%9B%9E%E9%A1%BE-%F0%9F%98%85"><span class="toc-number">1.1.</span> <span class="toc-text">进程&#x2F;线程回顾 😅</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F-%E2%9D%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">进程&#x2F;线程是什么？ ❓</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90-%F0%9F%8C%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">举个栗子 🌰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81-%F0%9F%98%B4"><span class="toc-number">1.1.3.</span> <span class="toc-text">线程的状态 😴</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wait-sleep-%E7%9A%84%E5%8C%BA%E5%88%AB-%F0%9F%98%A6"><span class="toc-number">1.1.4.</span> <span class="toc-text">wait&#x2F;sleep 的区别 😦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E8%A1%8C%EF%BC%9F%F0%9F%A4%94"><span class="toc-number">1.1.5.</span> <span class="toc-text">什么是并发？什么是并行？🤔</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lock-%E6%8E%A5%E5%8F%A3-%F0%9F%94%92"><span class="toc-number">2.</span> <span class="toc-text">Lock 接口 🔒</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0-Synchronized%F0%9F%98%B3"><span class="toc-number">2.1.</span> <span class="toc-text">复习 Synchronized😳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E2%9D%93"><span class="toc-number">2.2.</span> <span class="toc-text">是什么？❓</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%94%A7"><span class="toc-number">2.3.</span> <span class="toc-text">怎么用 🔧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lock-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0-ReentrantLock-%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">Lock 接口的实现 ReentrantLock 可重入锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized-%E4%B8%8E-Lock-%E7%9A%84%E5%8C%BA%E5%88%AB-%F0%9F%98%A6"><span class="toc-number">2.4.</span> <span class="toc-text">synchronized 与 Lock 的区别 😦</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-%F0%9F%93%9E"><span class="toc-number">3.</span> <span class="toc-text">线程间通信 📞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%89%93%E5%8D%B0-%F0%9F%93%9D"><span class="toc-number">3.1.</span> <span class="toc-text">面试题：两个线程打印 📝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%B0-4-%E4%B8%AA%E7%BA%BF%E7%A8%8B-%F0%9F%86%99"><span class="toc-number">3.2.</span> <span class="toc-text">增加到 4 个线程 🆙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java8-%E6%96%B0%E7%89%88%E5%AE%9E%E7%8E%B0-%F0%9F%86%95"><span class="toc-number">3.3.</span> <span class="toc-text">java8 新版实现 🆕</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Condition"><span class="toc-number">3.3.1.</span> <span class="toc-text">Condition</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%97%B4%E5%AE%9A%E5%88%B6%E5%8C%96%E8%B0%83%E7%94%A8%E9%80%9A%E4%BF%A1-%F0%9F%92%B1"><span class="toc-number">4.</span> <span class="toc-text">线程间定制化调用通信 💱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%E5%A4%9A%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%BE%9D%E6%AC%A1%E6%89%93%E5%8D%B0-%F0%9F%93%9D"><span class="toc-number">4.1.</span> <span class="toc-text">一个问题：多个线程依次打印 📝</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Synchronization-%E9%94%81%E9%97%AE%E9%A2%98-%E2%9D%93"><span class="toc-number">5.</span> <span class="toc-text">Synchronization 锁问题 ❓</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E4%B8%AA%E9%97%AE%E9%A2%98-%F0%9F%93%9D"><span class="toc-number">5.1.</span> <span class="toc-text">八个问题 📝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E7%AD%94%E6%A1%88-%F0%9F%A4%AB"><span class="toc-number">5.2.</span> <span class="toc-text">问题答案 🤫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-%F0%9F%A7%90"><span class="toc-number">5.3.</span> <span class="toc-text">问题分析 🧐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E9%9B%86%E5%90%88-%F0%9F%9A%A8"><span class="toc-number">6.</span> <span class="toc-text">不安全集合 🚨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E6%98%8E%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8-%F0%9F%A4%AF"><span class="toc-number">6.1.</span> <span class="toc-text">证明线程不安全 🤯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callable-%E6%8E%A5%E5%8F%A3-%E2%86%A9%EF%B8%8F"><span class="toc-number">7.</span> <span class="toc-text">Callable 接口 ↩️</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93"><span class="toc-number">7.1.</span> <span class="toc-text">是什么 ❓</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E8%8E%B7%E5%BE%97%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95%E5%87%A0%E7%A7%8D%EF%BC%9F"><span class="toc-number">7.1.1.</span> <span class="toc-text">面试题：获得多线程的方法几种？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.1.2.</span> <span class="toc-text">函数式接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-Runnable-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AF%B9%E6%AF%94-%F0%9F%98%A6"><span class="toc-number">7.2.</span> <span class="toc-text">与 Runnable 接口的对比 😦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%94%A7-1"><span class="toc-number">7.3.</span> <span class="toc-text">怎么用 🔧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%9B%BF%E6%8D%A2-runnable-%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A1%8C%EF%BC%9F"><span class="toc-number">7.3.1.</span> <span class="toc-text">直接替换 runnable 是否可行？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B2%E7%BA%BF%E6%95%91%E5%9B%BD"><span class="toc-number">7.3.2.</span> <span class="toc-text">曲线救国</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FutureTask%F0%9F%98%B2"><span class="toc-number">7.4.</span> <span class="toc-text">FutureTask😲</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">7.4.1.</span> <span class="toc-text">是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90"><span class="toc-number">7.4.1.1.</span> <span class="toc-text">举个栗子</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">7.4.1.2.</span> <span class="toc-text">原理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JUC-%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB%E8%AE%B2%E8%A7%A3-%F0%9F%A7%B0"><span class="toc-number">8.</span> <span class="toc-text">JUC 强大的辅助类讲解 🧰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CountDownLatch-%E5%87%8F%E5%B0%91%E8%AE%A1%E6%95%B0-%E2%9E%96"><span class="toc-number">8.1.</span> <span class="toc-text">CountDownLatch 减少计数 ➖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B"><span class="toc-number">8.1.1.</span> <span class="toc-text">应用场景举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B"><span class="toc-number">8.1.2.</span> <span class="toc-text">代码举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CyclicBarrier-%E5%BE%AA%E7%8E%AF%E6%A0%85%E6%A0%8F-%F0%9F%9A%A7"><span class="toc-number">8.2.</span> <span class="toc-text">CyclicBarrier 循环栅栏 🚧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">8.2.1.</span> <span class="toc-text">应用场景举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">8.2.2.</span> <span class="toc-text">代码举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semaphore-%E4%BF%A1%E5%8F%B7%E7%81%AF-%F0%9F%9A%A6"><span class="toc-number">8.3.</span> <span class="toc-text">Semaphore 信号灯 🚦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">8.3.1.</span> <span class="toc-text">应用场景举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">8.3.2.</span> <span class="toc-text">代码举例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReentrantReadWriteLock-%E8%AF%BB%E5%86%99%E9%94%81-%F0%9F%94%90"><span class="toc-number">9.</span> <span class="toc-text">ReentrantReadWriteLock 读写锁 🔐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-1"><span class="toc-number">9.1.</span> <span class="toc-text">是什么 ❓</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%BE%E4%BE%8B-%F0%9F%8C%B0"><span class="toc-number">9.2.</span> <span class="toc-text">问题举例 🌰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%BB%E5%86%99%E9%94%81%E7%9A%84%E4%BB%A3%E7%A0%81-%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB"><span class="toc-number">9.3.</span> <span class="toc-text">使用读写锁的代码 👩‍💻</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BlockingQueue-%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97-%E2%8F%B3"><span class="toc-number">10.</span> <span class="toc-text">BlockingQueue 阻塞队列 ⏳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-2"><span class="toc-number">10.1.</span> <span class="toc-text">是什么 ❓</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E7%9A%84%E7%94%A8%E5%A4%84-%F0%9F%A4%94"><span class="toc-number">10.2.</span> <span class="toc-text">阻塞队列的用处 🤔</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E6%A2%B3%E7%90%86%E3%80%81%E7%A7%8D%E7%B1%BB%E5%88%86%E6%9E%90-%F0%9F%93%9A"><span class="toc-number">10.3.</span> <span class="toc-text">架构梳理、种类分析 📚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BlockingQueue-%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95-%F0%9F%92%A0"><span class="toc-number">10.4.</span> <span class="toc-text">BlockingQueue 核心方法 💠</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ThreadPool-%E7%BA%BF%E7%A8%8B%E6%B1%A0-%F0%9F%8C%8A"><span class="toc-number">11.</span> <span class="toc-text">ThreadPool 线程池 🌊</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0-%E2%9D%93"><span class="toc-number">11.1.</span> <span class="toc-text">为什么用线程池 ❓</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90-%F0%9F%8C%B0-1"><span class="toc-number">11.1.1.</span> <span class="toc-text">举个栗子 🌰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BC%98%E5%8A%BF-%F0%9F%91%8D"><span class="toc-number">11.1.2.</span> <span class="toc-text">线程池的优势 👍</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-%F0%9F%A6%BE"><span class="toc-number">11.2.</span> <span class="toc-text">怎么用 🦾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">11.2.1.</span> <span class="toc-text">架构说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.2.2.</span> <span class="toc-text">编码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Executors%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E8%AF%A6%E8%A7%A3"><span class="toc-number">11.2.3.</span> <span class="toc-text">使用Executors工具类创建线程池的详解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0-%F0%9F%92%A8"><span class="toc-number">11.3.</span> <span class="toc-text">线程池几个重要参数 💨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%BA%95%E5%B1%82%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%F0%9F%94%8D"><span class="toc-number">11.4.</span> <span class="toc-text">线程池底层工作原理 🔍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5-%E2%8F%B8"><span class="toc-number">11.5.</span> <span class="toc-text">线程池的拒绝策略 ⏸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-3"><span class="toc-number">11.5.1.</span> <span class="toc-text">是什么 ❓</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98-%E2%9D%93"><span class="toc-number">11.6.</span> <span class="toc-text">线程池的一些问题 ❓</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%8D%95%E4%B8%80%E7%9A%84-%E5%9B%BA%E5%AE%9A%E6%95%B0%E7%9A%84-%E5%8F%AF%E5%8F%98%E7%9A%84%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%96%B9%E6%B3%95%E5%93%AA%E4%B8%AA%E7%94%A8%E7%9A%84%E5%A4%9A%EF%BC%9F%E8%B6%85%E7%BA%A7%E5%A4%A7%E5%9D%91"><span class="toc-number">11.6.1.</span> <span class="toc-text">在工作中单一的&#x2F;固定数的&#x2F;可变的三种创建线程池的方法哪个用的多？超级大坑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E6%98%AF%E5%90%A6%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">11.6.2.</span> <span class="toc-text">在工作中如何使用线程池，是否自定义过线程池</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E6%A1%86%E6%9E%B6-%F0%9F%94%B1"><span class="toc-number">12.</span> <span class="toc-text">分支合并框架 🔱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-%E2%9D%93-4"><span class="toc-number">12.1.</span> <span class="toc-text">是什么 ❓</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%B1%BB-%F0%9F%99%84"><span class="toc-number">12.2.</span> <span class="toc-text">相关类 🙄</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ForkJoinPool"><span class="toc-number">12.2.1.</span> <span class="toc-text">ForkJoinPool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ForkJoinTask"><span class="toc-number">12.2.2.</span> <span class="toc-text">ForkJoinTask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RecursiveTask"><span class="toc-number">12.2.3.</span> <span class="toc-text">RecursiveTask</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB"><span class="toc-number">12.3.</span> <span class="toc-text">代码举例 👩‍💻</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97"><span class="toc-number">12.3.1.</span> <span class="toc-text">实现斐波那契数列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%8A%A0%E5%88%B0%E4%B8%80%E7%99%BE"><span class="toc-number">12.3.2.</span> <span class="toc-text">实现一加到一百</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%9B%9E%E8%B0%83-%F0%9F%94%81"><span class="toc-number">13.</span> <span class="toc-text">异步回调 🔁</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/" title="JUC"><img data-lazy-src="/img/Java-JUC-cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC"/></a><div class="content"><a class="title" href="/2021/04/12/Java/Java%E9%AB%98%E7%BA%A7/JUC/JUC/" title="JUC">JUC</a><time datetime="2021-04-12T05:58:52.000Z" title="发表于 2021-04-12 13:58:52">2021-04-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/" title="数据结构 学习笔记"><img data-lazy-src="/img/default_top.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构 学习笔记"/></a><div class="content"><a class="title" href="/2020/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-xmind/" title="数据结构 学习笔记">数据结构 学习笔记</a><time datetime="2020-11-04T16:00:00.000Z" title="发表于 2020-11-05 00:00:00">2020-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/10/21/MQ/RabbitMQ/RabbitMQ/" title="rabbitMQ 学习笔记"><img data-lazy-src="/img/rabbitMQ-cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rabbitMQ 学习笔记"/></a><div class="content"><a class="title" href="/2020/10/21/MQ/RabbitMQ/RabbitMQ/" title="rabbitMQ 学习笔记">rabbitMQ 学习笔记</a><time datetime="2020-10-20T16:00:00.000Z" title="发表于 2020-10-21 00:00:00">2020-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/" title="rabbitMQ 错误记录"><img data-lazy-src="/img/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rabbitMQ 错误记录"/></a><div class="content"><a class="title" href="/2020/10/21/MQ/RabbitMQ/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/" title="rabbitMQ 错误记录">rabbitMQ 错误记录</a><time datetime="2020-10-20T16:00:00.000Z" title="发表于 2020-10-21 00:00:00">2020-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/08/14/zookeeper/zookeeper/" title="zookeeper 学习笔记"><img data-lazy-src="/img/zookeeper-cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zookeeper 学习笔记"/></a><div class="content"><a class="title" href="/2020/08/14/zookeeper/zookeeper/" title="zookeeper 学习笔记">zookeeper 学习笔记</a><time datetime="2020-08-13T16:00:00.000Z" title="发表于 2020-08-14 00:00:00">2020-08-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By LLQWQ</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欸嘿( •̀ ω •́ )✧</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '62ac94f6f26fbdbc60b4',
      clientSecret: '2aa21994b6d9b95bb5605ed581e6a73c6da34eb5',
      repo: 'llqwq.github.io',
      owner: 'LLQWQ',
      admin: ['LLQWQ'],
      id: 'f83d10a086cd142cafd8a0c81a5c70b4',
      language: 'zh-CN',
      perPage: 15,
      distractionFreeMode: true,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>